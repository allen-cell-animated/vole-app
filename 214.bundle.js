"use strict";(self.webpackChunk_aics_vole_app=self.webpackChunk_aics_vole_app||[]).push([[214],{9519:(e,t,r)=>{r.d(t,{Nl:()=>a,QX:()=>o,jI:()=>i});var n=r(4922);function s(e){return new n.Pq0(e.shape[4],e.shape[3],e.shape[2])}function i(){return{name:"",atlasTileDims:[1,1],subregionSize:[1,1,1],subregionOffset:[0,0,0],numChannelsPerSource:[1],channelNames:["0"],channelColors:[[255,255,255]],multiscaleLevel:0,multiscaleLevelDims:[{shape:[1,1,1,1,1],spacing:[1,1,1,1,1],spaceUnit:"",timeUnit:"",dataType:"uint8"}],transform:{translation:[0,0,0],rotation:[0,0,0],scale:[1,1,1]}}}class a{constructor(e){this.imageInfo=e||{name:"",atlasTileDims:[1,1],subregionSize:[1,1,1],subregionOffset:[0,0,0],numChannelsPerSource:[1],channelNames:["0"],channelColors:[[255,255,255]],multiscaleLevel:0,multiscaleLevelDims:[{shape:[1,1,1,1,1],spacing:[1,1,1,1,1],spaceUnit:"",timeUnit:"",dataType:"uint8"}],transform:{translation:[0,0,0],rotation:[0,0,0],scale:[1,1,1]}}}get currentLevelDims(){return this.imageInfo.multiscaleLevelDims[this.imageInfo.multiscaleLevel]}get numChannels(){return this.imageInfo.numChannelsPerSource.reduce(((e,t)=>e+t),0)}get numChannelsPerSource(){return this.imageInfo.numChannelsPerSource}get originalSize(){return s(this.imageInfo.multiscaleLevelDims[0])}get volumeSize(){return s(this.currentLevelDims)}get physicalPixelSize(){return e=this.imageInfo.multiscaleLevelDims[0],new n.Pq0(e.spacing[4],e.spacing[3],e.spacing[2]);var e}get spatialUnit(){return this.imageInfo.multiscaleLevelDims[0].spaceUnit}get times(){return this.currentLevelDims.shape[0]}get timeScale(){return this.currentLevelDims.spacing[0]}get timeUnit(){return this.currentLevelDims.timeUnit}get numMultiscaleLevels(){return this.imageInfo.multiscaleLevelDims.length}get channelNames(){return this.imageInfo.channelNames}get channelColors(){return this.imageInfo.channelColors}get subregionSize(){return new n.Pq0(...this.imageInfo.subregionSize)}get subregionOffset(){return new n.Pq0(...this.imageInfo.subregionOffset)}get multiscaleLevel(){return this.imageInfo.multiscaleLevel}get atlasTileDims(){return new n.I9Y(...this.imageInfo.atlasTileDims)}get transform(){return{translation:new n.Pq0(...this.imageInfo.transform.translation),rotation:new n.Pq0(...this.imageInfo.transform.rotation),scale:new n.Pq0(...this.imageInfo.transform.scale)}}}function o(e){const{atlasTileDims:t}=e,r=e.multiscaleLevelDims[e.multiscaleLevel];return[t[0]*r.shape[4],t[1]*r.shape[3]]}},471:(e,t,r)=>{r.d(t,{f8:()=>i,ne:()=>o,nu:()=>a});var n=r(205),s=r(7972);let i=function(e){return e.UNKNOWN="unknown",e.NOT_FOUND="not_found",e.TOO_LARGE="too_large",e.LOAD_DATA_FAILED="load_data_failed",e.INVALID_METADATA="invalid_metadata",e.INVALID_MULTI_SOURCE_ZARR="invalid_multi_source_zarr",e}({});class a extends Error{constructor(e,t){super(e,t),this.name="VolumeLoadError",this.type=t?.type??i.UNKNOWN}}function o(e="Unknown error occurred while loading volume data",t=i.UNKNOWN,r){return n=>{if(void 0!==r&&n===r)return n;if(n instanceof a)throw n;throw console.log(`Error loading volume data: ${n}`),new a(e,{type:t,cause:n})}}n.A.set("NodeNotFoundError",s._),n.A.set("KeyError",s.e),n.A.set("VolumeLoadError",a)},3487:(e,t,r)=>{r.d(t,{A:()=>o});const n=e=>e.every((t=>t===e[0])),s=(e,t,r)=>{for(let n=0;n<r;n++)e.push(t)},i=e=>{const t=e>>1;return t+Number(0!==t)};function a(e,t){e<t[0]&&(t[0]=e),e>t[1]&&(t[1]=e)}class o{constructor(e,t,r,o,u=!1){const c=[[1/0,-1/0],[1/0,-1/0],[1/0,-1/0],[1/0,-1/0]];for(const t of e)a(t[0],c[0]),a(t[2],c[1]),a(t[3],c[2]),a(t[4],c[3]);if(c.flat().some((e=>!Number.isFinite(e))))return this.directionStates=[],void(this.priorityDirectionStates=[]);this.directionStates=[],this.priorityDirectionStates=[];for(const[e,i]of c.flat().entries()){const a=e>>1,c=a+Number(0!==a);let h;if(1&e){const e=r.map((e=>Math.min(i+t[a],e[c]-1)));if(n(e))h=e[0];else{h=[];for(const[t,n]of e.entries())s(h,n,r[t][1])}}else h=Math.max(i-t[a],0);const l={direction:e,start:i,end:h,chunks:[]};o&&o.includes(e)?this.priorityDirectionStates.push(l):u||this.directionStates.push(l)}for(const t of e){for(const e of this.directionStates)t[i(e.direction)]===e.start&&e.chunks.push(t);for(const e of this.priorityDirectionStates)t[i(e.direction)]===e.start&&e.chunks.push(t)}}static*iterateDirections(e){let t=1;for(;e.length>0;){e=e.filter((e=>{const r=Array.isArray(e.end)?Math.max(...e.end):e.end;return 1&e.direction?e.start+t<=r:e.start-t>=r}));for(const r of e){const e=t*(1&r.direction?1:-1);for(const t of r.chunks){if(Array.isArray(r.end)&&t[i(r.direction)]+e>r.end[t[1]])continue;const n=t.slice();n[i(r.direction)]+=e,yield n}}t+=1}}*[Symbol.iterator](){if(this.priorityDirectionStates.length>0)for(const e of o.iterateDirections(this.priorityDirectionStates))yield e;for(const e of o.iterateDirections(this.directionStates))yield e}}},7710:(e,t,r)=>{r.d(t,{Oi:()=>i,U0:()=>o,WD:()=>u,X_:()=>h,mU:()=>p,yH:()=>c});var n=r(471);function s(e){if(void 0===e)return;const t=/^#?([a-fA-F\d]{2})([a-fA-F\d]{2})([a-fA-F\d]{2})$/i.exec(e);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:void 0}function i(e){if(e.omeroMetadata?.channels){const{channels:t}=e.omeroMetadata,r=[],n=[];for(let i=0;i<t.length;i++){const a=t[i];r.push(a.label??`Channel ${i+e.channelOffset}`),n.push(s(a.color))}return{names:r,colors:n}}const t=e.axesTCZYX[1],r=t<0?1:e.scaleLevels[0].shape[t];return{names:Array.from({length:r},((t,r)=>`Channel ${r+e.channelOffset}`)),colors:Array.from({length:r},(()=>{}))}}const a=([e,t,r])=>2+Number(e>-1)+Number(t>-1)+Number(r>-1);function o(e){const t=[-1,-1,-1,-1,-1],r=["t","c","z","y","x"];e.forEach(((e,s)=>{const i=r.indexOf(e.name);if(!(i>-1))throw new n.nu(`Unrecognized axis in zarr: ${e.name}`,{type:n.f8.INVALID_METADATA});t[i]=s}));const s=-1===t[4];if(s||-1===t[3])throw new n.nu(`Did not find ${s?"an X":"a Y"} axis in zarr`,{type:n.f8.INVALID_METADATA});return t}function u(e,t){const r=a(t),s=Array(r);return t.forEach(((t,i)=>{if(t>=0){if(t>=r)throw new n.nu(`Unexpected axis index in zarr: ${t}`,{type:n.f8.INVALID_METADATA});s[t]=e[i]}})),s}function c(e,t,r){const s=[r,r,r,r,r];return t.forEach(((t,r)=>{if(t>=0){if(t>=e.length)throw new n.nu(`Unexpected axis index in zarr: ${t}`,{type:n.f8.INVALID_METADATA});s[r]=e[t]}})),s}function h(e,t){const r=e.coordinateTransformations;if(void 0===r)return console.warn("WARNING: OMEZarrLoader: no coordinate transformations for scale level."),[1,1,1,1,1];const n=r.find((e=>"scale"===e.type));return n?c(n.scale.slice(),t,1):(console.warn('WARNING: OMEZarrLoader: no coordinate transformation of type "scale" for scale level.'),[1,1,1,1,1])}function l(e,t,r,n){const s=(t[2]>-1?e.shape[t[2]]:1)-(n[2]>-1?r.shape[n[2]]:1),i=e.shape[t[3]]-r.shape[n[3]],a=e.shape[t[4]]-r.shape[n[4]];return 0===s&&0===i&&0===a?0:s<=0&&i<=0&&a<=0?-1:s>=0&&i>=0&&a>=0?1:void 0}const d=(e,t)=>Math.abs(e-t)<1e-5;function f(e,t,r,n){const s=h(e.multiscaleMetadata.datasets[t],e.axesTCZYX),i=h(r.multiscaleMetadata.datasets[n],r.axesTCZYX);return d(s[2],i[2])&&d(s[3],i[3])&&d(s[4],i[4])}function p(e){if(e.length<2)return;const t=Array.from({length:e.length},(()=>[])),r=Array.from({length:e.length},(()=>[])),s=new Array(e.length).fill(0);for(;s.every(((t,r)=>t<e[r].scaleLevels.length));){let i=!0,a=0,o=e[0],u=o.scaleLevels[s[0]];for(let t=1;t<e.length;t++){const r=e[t],c=r.scaleLevels[s[t]],h=l(u,o.axesTCZYX,c,r.axesTCZYX);if(h)i=!1,h>0&&(a=t,o=r,u=c);else{if(void 0===h)throw new n.nu("Incompatible zarr arrays: pixel dimensions are mismatched",{type:n.f8.INVALID_MULTI_SOURCE_ZARR});f(o,s[a],r,s[t])||console.warn("Incompatible zarr arrays: scale levels of equal size have different scale transformations");const e=o.axesTCZYX[0]>-1?u.shape[o.axesTCZYX[0]]:1,i=r.axesTCZYX[0]>-1?c.shape[r.axesTCZYX[0]]:1;e!==i&&console.warn(`Incompatible zarr arrays: different numbers of timesteps: ${e} vs ${i}`)}}if(i)for(let n=0;n<s.length;n++){const i=e[n],a=s[n];t[n].push(i.scaleLevels[a]),r[n].push(i.multiscaleMetadata.datasets[a]),s[n]+=1}else for(const[t,r]of s.entries()){const n=e[t],i=n.scaleLevels[r];0!==l(u,o.axesTCZYX,i,n.axesTCZYX)&&(s[t]+=1)}}if(0===e[0].scaleLevels.length)throw new n.nu("Incompatible zarr arrays: no sets of scale levels found that matched in all sources",{type:n.f8.INVALID_MULTI_SOURCE_ZARR});for(let n=0;n<e.length;n++)e[n].scaleLevels=t[n],e[n].multiscaleMetadata.datasets=r[n]}},4296:(e,t,r)=>{r.d(t,{GB:()=>c,P9:()=>s,iM:()=>u});var n=r(471);const s=e=>e.ome??e;function i(e,t){return"object"==typeof e&&null!==e&&t in e}function a(e,t,r="zarr"){if(!i(e,t))throw new n.nu(`${r} metadata is missing required entry "${t}"`,{type:n.f8.INVALID_METADATA})}function o(e,t,r="zarr"){if(!Array.isArray(e[t]))throw new n.nu(`${r} metadata entry "${t}" is not an array`,{type:n.f8.INVALID_METADATA})}function u(e,t="zarr"){a(e,"multiscales",t),o(e,"multiscales",t)}function c(e,t=0,r="zarr"){const s=e.multiscales[t];if(!s)throw new n.nu(`${r} metadata does not have requested multiscale level ${t}`,{type:n.f8.INVALID_METADATA});const u=`${r} multiscale ${t}${i(s,"name")?` ("${s.name})`:""}`;a(s,"axes",u),o(s,"axes",u),s.axes.forEach(((e,t)=>a(e,"name",`${u} axis ${t}`))),a(s,"datasets",r),o(s,"datasets",r),s.datasets.forEach(((e,t)=>a(e,"path",`${u} dataset ${t}`)))}},5390:(e,t,r)=>{function n(e,t,r,n={}){return void 0!==t&&void 0!==r&&(n={...n,headers:{...n.headers,Range:`bytes=${t}-${t+r-1}`}}),fetch(e,n)}function s(e,t){const r="string"==typeof e?new URL(e):e;r.pathname.endsWith("/")||(r.pathname+="/");const n=new URL(t.slice(1),r);return n.search=r.search,n}async function i(e){if(404!==e.status){if(200===e.status||206===e.status)return new Uint8Array(await e.arrayBuffer());throw new Error(`Unexpected response status ${e.status} ${e.statusText}`)}}r.d(t,{L:()=>c,A:()=>u});const a=class{url;#e;#t;constructor(e,t={}){this.url=e,this.#e=t.overrides??{},this.#t=t.useSuffixRequest??!1}#r(e){return t=this.#e,r=e,{...t,...r,headers:{...t.headers,...r.headers}};var t,r}async get(e,t={}){let r=s(this.url,e).href;return i(await fetch(r,this.#r(t)))}async getRange(e,t,r={}){let a,o=s(this.url,e),u=this.#r(r);return a="suffixLength"in t?await async function(e,t,r,s){if(s)return fetch(e,{...r,headers:{...r.headers,Range:`bytes=-${t}`}});let i=await fetch(e,{...r,method:"HEAD"});if(!i.ok)return i;let a=i.headers.get("Content-Length"),o=Number(a);return n(e,o-t,o,r)}(o,t.suffixLength,u,this.#t):await n(o,t.offset,t.length,u),i(a)}};var o=r(3e3);function u(e,t,r,n){const s=(t.endsWith("/")?t.slice(0,-1):t)+e.path+(e.path.endsWith("/")?"":"/"),i=async(t,i)=>{i?.subscriber&&i.reportChunk&&i.reportChunk(t,i.subscriber);const a=s+t.join(","),u=r?.get(a);if(u&&(0,o.y)(u))return u;let c;return c=n&&i?.subscriber?await n.addRequest(a,i?.subscriber,(()=>e.getChunk(t,i)),i.isPrefetch):await e.getChunk(t,i),r?.insert(a,c),c};return new Proxy(e,{get:(e,t)=>{if("getChunk"===t)return i;const r=e[t];return r instanceof Function?function(...t){return r.apply(e,t)}:r}})}class c extends a{constructor(e,t){super(e,t)}async get(e,t={}){try{return await super.get(e,t)}catch(e){if(e?.message?.startsWith("Unexpected response status 403"))return;throw e}}}},5448:(e,t,r)=>{r.d(t,{A:()=>s});const n="request cancelled";class s{constructor(e=10,t=5){this.allRequests=new Map,this.activeRequests=new Set,this.queue=[],this.queueLowPriority=[],this.maxActiveRequests=e,this.maxLowPriorityRequests=Math.min(e,t)}registerRequest(e,t){let r,n;const s=new Promise(((e,t)=>{r=e,n=t})),i={key:e,action:t,resolve:r,reject:n,promise:s};return this.allRequests.set(e,i),i}addRequestToQueue(e,t){if(this.allRequests.has(e)){const r=this.allRequests.get(e);r&&r.timeoutId&&(clearTimeout(r.timeoutId),r.timeoutId=void 0),this.queue.includes(e)||this.queueLowPriority.includes(e)||(t?this.queueLowPriority.push(e):this.queue.push(e),this.dequeue())}}addRequest(e,t,r=!1,n=0){if(this.allRequests.has(e)){const t=this.queueLowPriority.indexOf(e);t>-1&&!r?(this.queueLowPriority.splice(t,1),this.addRequestToQueue(e)):n<=0&&this.addRequestToQueue(e,r)}else{const s=this.registerRequest(e,t);if(n>0){const t=setTimeout((()=>this.addRequestToQueue(e,r)),n);s.timeoutId=t}else this.addRequestToQueue(e,r)}const s=this.allRequests.get(e)?.promise;if(!s)throw new Error("Found no promise to return when getting stored request data.");return s}addRequests(e,t=!1,r=10){const n=[];for(let s=0;s<e.length;s++){const i=e[s],a=this.addRequest(i.key,i.requestAction,t,r*s);n.push(a)}return n}async dequeue(){const e=this.activeRequests.size;if(e>=this.maxActiveRequests||0===this.queue.length&&(e>=this.maxLowPriorityRequests||0===this.queueLowPriority.length))return;const t=this.queue.shift()??this.queueLowPriority.shift();if(!t)return;if(this.activeRequests.has(t))return void this.dequeue();const r=this.allRequests.get(t);if(!r)return;const n=r.key;this.activeRequests.add(n),await r.action().then(r.resolve,r.reject),this.activeRequests.delete(n),this.allRequests.delete(n),this.dequeue()}cancelRequest(e,t=n){if(!this.allRequests.has(e))return;const r=this.allRequests.get(e);r&&(r.timeoutId&&clearTimeout(r.timeoutId),r.reject(t));const s=this.queue.indexOf(e);if(s>-1)this.queue.splice(s,1);else{const t=this.queueLowPriority.indexOf(e);t>-1&&this.queueLowPriority.splice(t,1)}this.allRequests.delete(e),this.activeRequests.delete(e)}cancelAllRequests(e=n){this.queue=[],this.queueLowPriority=[];for(const t of this.allRequests.keys())this.cancelRequest(t,e)}hasRequest(e){return this.allRequests.has(e)}requestRunning(e){return this.activeRequests.has(e)}}},9565:(e,t,r)=>{r.d(t,{A:()=>s});var n=r(5448);class s{constructor(e,t){this.queue="number"==typeof e||void 0===e?new n.A(e,t):e,this.nextSubscriberId=0,this.subscribers=new Map,this.requests=new Map}resolveAll(e,t){const r=this.requests.get(e);if(r){for(const{resolve:n,subscriberId:s}of r)n(t),this.subscribers.get(s)?.delete(e);this.requests.delete(e)}}rejectAll(e,t){const r=this.requests.get(e);if(r){for(const{reject:n,subscriberId:s}of r)n(t),this.subscribers.get(s)?.delete(e);this.requests.delete(e)}}addSubscriber(){const e=this.nextSubscriberId;return this.nextSubscriberId++,this.subscribers.set(e,new Map),e}addRequest(e,t,r,n,s){if(this.queue.addRequest(e,r,n,s).then((t=>this.resolveAll(e,t))).catch((t=>this.rejectAll(e,t))),this.requests.has(e)||this.requests.set(e,[]),t>=this.nextSubscriberId||t<0)throw new Error(`SubscribableRequestQueue: subscriber id ${t} has not been registered`);if(!this.subscribers.get(t))throw new Error(`SubscribableRequestQueue: subscriber id ${t} has been removed`);return new Promise(((r,n)=>{this.requests.get(e)?.push({resolve:r,reject:n,subscriberId:t});const s=this.subscribers.get(t),i=s?.get(e);i?i.push(n):s?.set(e,[n])}))}rejectSubscription(e,t,r){t(r);const n=this.requests.get(e);if(!n)return;const s=n.findIndex((e=>e.reject===t));s>=0&&n.splice(s,1),n.length<1&&!this.queue.requestRunning(e)&&(this.queue.cancelRequest(e,r),this.requests.delete(e))}cancelRequest(e,t,r){const n=this.subscribers.get(t);if(!n)return!1;const s=n.get(e);if(!s||!s.length)return!1;for(const t of s)this.rejectSubscription(e,t,r);return n.delete(e),!0}removeSubscriber(e,t){const r=this.subscribers.get(e);if(r){for(const[e,n]of r.entries())for(const r of n)this.rejectSubscription(e,r,t);this.subscribers.delete(e)}}hasRequest(e){return this.queue.hasRequest(e)}requestRunning(e){return this.queue.requestRunning(e)}hasSubscriber(e){return this.subscribers.has(e)}isSubscribed(e,t){return this.subscribers.get(e)?.has(t)??!1}}},9177:(e,t,r)=>{r.d(t,{K2:()=>n,VC:()=>s,dE:()=>i});let n=function(e){return e[e.INIT=0]="INIT",e[e.CREATE_LOADER=1]="CREATE_LOADER",e[e.CLOSE_LOADER=2]="CLOSE_LOADER",e[e.CREATE_VOLUME=3]="CREATE_VOLUME",e[e.LOAD_DIMS=4]="LOAD_DIMS",e[e.LOAD_VOLUME_DATA=5]="LOAD_VOLUME_DATA",e[e.SET_PREFETCH_PRIORITY_DIRECTIONS=6]="SET_PREFETCH_PRIORITY_DIRECTIONS",e[e.SYNCHRONIZE_MULTICHANNEL_LOADING=7]="SYNCHRONIZE_MULTICHANNEL_LOADING",e[e.UPDATE_FETCH_OPTIONS=8]="UPDATE_FETCH_OPTIONS",e}({}),s=function(e){return e[e.SUCCESS=0]="SUCCESS",e[e.ERROR=1]="ERROR",e[e.EVENT=2]="EVENT",e}({}),i=function(e){return e[e.METADATA_UPDATE=0]="METADATA_UPDATE",e[e.CHANNEL_LOAD=1]="CHANNEL_LOAD",e}({})},6238:(e,t,r)=>{r.d(t,{N:()=>s});var n=r(4922);function s(e){return{...e,subregion:new n.NRn((new n.Pq0).copy(e.subregion.min),(new n.Pq0).copy(e.subregion.max))}}},6712:(e,t,r)=>{r.d(t,{O3:()=>R,YJ:()=>T,aZ:()=>E,JD:()=>q,zr:()=>k});var n=r(3333);class s{kind="array_to_array";constructor(e,t){(0,n.vA)(e.keepbits>=0,"keepbits must be zero or positive")}static fromConfig(e,t){return new s(e,t)}encode(e){throw new Error("`BitroundCodec.encode` is not implemented. Please open an issue at https://github.com/manzt/zarrita.js/issues.")}decode(e){return e}}const i=function(){const e=new Uint32Array([305419896]);return!(18===new Uint8Array(e.buffer,e.byteOffset,e.byteLength)[0])}();function a(e){return"BYTES_PER_ELEMENT"in e?e.BYTES_PER_ELEMENT:4}class o{kind="array_to_bytes";#n;#s;#i;#a;#o;constructor(e,t){this.#o=e?.endian,this.#s=(0,n.zA)(t.data_type),this.#a=t.shape,this.#n=(0,n.uV)(t.shape,"C");const r=new this.#s(0);this.#i=r.BYTES_PER_ELEMENT}static fromConfig(e,t){return new o(e,t)}encode(e){let t=new Uint8Array(e.data.buffer);return i&&"big"===this.#o&&(0,n.dq)(t,a(this.#s)),t}decode(e){return i&&"big"===this.#o&&(0,n.dq)(e,a(this.#s)),{data:new this.#s(e.buffer,e.byteOffset,e.byteLength/this.#i),shape:this.#a,stride:this.#n}}}class u{kind="bytes_to_bytes";static fromConfig(){return new u}encode(e){throw new Error("Not implemented")}decode(e){return new Uint8Array(e.buffer,e.byteOffset,e.byteLength-4)}}class c{kind="bytes_to_bytes";static fromConfig(e){return new c}encode(e){throw new Error("Gzip encoding is not enabled by default. Please register a custom codec with `numcodecs/gzip`.")}async decode(e){const t=await(0,n.mF)(e,{format:"gzip"});return new Uint8Array(t)}}function h(e,t){return(0,n.vA)(!Number.isNaN(t),"JsonCodec allow_nan is false but NaN was encountered during encoding."),(0,n.vA)(t!==Number.POSITIVE_INFINITY,"JsonCodec allow_nan is false but Infinity was encountered during encoding."),(0,n.vA)(t!==Number.NEGATIVE_INFINITY,"JsonCodec allow_nan is false but -Infinity was encountered during encoding."),t}function l(e,t){return t instanceof Object&&!Array.isArray(t)?Object.keys(t).sort().reduce(((e,r)=>(e[r]=t[r],e)),{}):t}class d{configuration;kind="array_to_bytes";#u;#c;constructor(e={}){this.configuration=e;const{encoding:t="utf-8",skipkeys:r=!1,ensure_ascii:n=!0,check_circular:s=!0,allow_nan:i=!0,sort_keys:a=!0,indent:o,strict:u=!0}=e;let c=e.separators;c||(c=o?[", ",": "]:[",",":"]),this.#u={encoding:t,skipkeys:r,ensure_ascii:n,check_circular:s,allow_nan:i,indent:o,separators:c,sort_keys:a},this.#c={strict:u}}static fromConfig(e){return new d(e)}encode(e){const{indent:t,encoding:r,ensure_ascii:s,check_circular:i,allow_nan:a,sort_keys:o}=this.#u;(0,n.vA)("utf-8"===r,"JsonCodec does not yet support non-utf-8 encoding.");const u=[];(0,n.vA)(i,"JsonCodec does not yet support skipping the check for circular references during encoding."),a||u.push(h),o&&u.push(l);const c=Array.from(e.data);let d;c.push("|O"),c.push(e.shape),u.length&&(d=(e,t)=>{let r=t;for(let t of u)r=t(e,r);return r});let f=JSON.stringify(c,d,t);return s&&(f=f.replace(/[\u007F-\uFFFF]/g,(e=>{const t=`0000${e.charCodeAt(0).toString(16)}`;return`\\u${t.substring(t.length-4)}`}))),(new TextEncoder).encode(f)}decode(e){const{strict:t}=this.#c;(0,n.vA)(t,"JsonCodec does not yet support non-strict decoding.");const r=(0,n.eg)(e),s=r.pop();return r.pop(),(0,n.vA)(s,"0D not implemented for JsonCodec."),{data:r,shape:s,stride:(0,n.uV)(s,"C")}}}var f=r(3356);function p(e){return e instanceof f.OZ||e instanceof f.Lk||e instanceof f.so?new Proxy(e,{get:(e,t)=>e.get(Number(t)),set:(e,t,r)=>(e.set(Number(t),r),!0)}):e}class y{kind="array_to_array";#h;#l;constructor(e,t){let r=e.order??"C",s=t.shape.length,i=new Array(s),a=new Array(s);if("C"===r)for(let e=0;e<s;++e)i[e]=e,a[e]=e;else if("F"===r)for(let e=0;e<s;++e)i[e]=s-e-1,a[e]=s-e-1;else i=r,i.forEach(((e,t)=>{(0,n.vA)(void 0===a[e],`Invalid permutation: ${JSON.stringify(r)}`),a[e]=t}));this.#h=i,this.#l=a}static fromConfig(e,t){return new y(e,t)}encode(e){return function(e,t){let r=function(e){let t=e.shape.length;return(0,n.vA)(t===e.stride.length,"Shape and stride must have the same length."),e.stride.map(((e,t)=>({stride:e,index:t}))).sort(((e,t)=>t.stride-e.stride)).map((e=>e.index))}(e);return(0,n.vA)(r.length===t.length,"Orders must match"),r.every(((e,r)=>e===t[r]))}(e,this.#l)?e:function(e,t){let r=function(e,t){let r;return r=e.data instanceof f.Lk||e.data instanceof f.so?new e.constructor(e.data.length,e.data.chars):new e.constructor(e.data.length),{data:r,shape:e.shape,stride:(0,n.uV)(e.shape,t)}}(e,t),s=e.shape.length,i=e.data.length,a=Array(s).fill(0),o=p(e.data),u=p(r.data);for(let t=0;t<i;t++){let n=0;for(let e=0;e<s;e++)n+=a[e]*r.stride[e];u[n]=o[t],a[0]+=1;for(let t=0;t<s;t++)if(a[t]===e.shape[t]){if(t+1===s)break;a[t]=0,a[t+1]+=1}}return r}(e,this.#l)}decode(e){return{data:e.data,shape:e.shape,stride:(0,n.uV)(e.shape,this.#h)}}}class m{kind="array_to_bytes";#a;#d;constructor(e){this.#a=e,this.#d=(0,n.uV)(e,"C")}static fromConfig(e,t){return new m(t.shape)}encode(e){throw new Error("Method not implemented.")}decode(e){let t=new TextDecoder,r=new DataView(e.buffer),n=Array(r.getUint32(0,!0)),s=4;for(let i=0;i<n.length;i++){let a=r.getUint32(s,!0);s+=4,n[i]=t.decode(e.buffer.slice(s,s+a)),s+=a}return{data:n,shape:this.#a,stride:this.#d}}}class g{kind="bytes_to_bytes";static fromConfig(e){return new g}encode(e){throw new Error("Zlib encoding is not enabled by default. Please register a codec with `numcodecs/zlib`.")}async decode(e){const t=await(0,n.mF)(e,{format:"deflate"});return new Uint8Array(t)}}const _=(new Map).set("blosc",(()=>r.e(502).then(r.bind(r,5121)).then((e=>e.default)))).set("lz4",(()=>r.e(274).then(r.bind(r,3274)).then((e=>e.default)))).set("zstd",(()=>r.e(505).then(r.bind(r,7505)).then((e=>e.default)))).set("gzip",(()=>c)).set("zlib",(()=>g)).set("transpose",(()=>y)).set("bytes",(()=>o)).set("crc32c",(()=>u)).set("vlen-utf8",(()=>m)).set("json2",(()=>d)).set("bitround",(()=>s));function b(e){let t;return{async encode(r){t||(t=await w(e));for(const e of t.array_to_array)r=await e.encode(r);let n=await t.array_to_bytes.encode(r);for(const e of t.bytes_to_bytes)n=await e.encode(n);return n},async decode(r){t||(t=await w(e));for(let e=t.bytes_to_bytes.length-1;e>=0;e--)r=await t.bytes_to_bytes[e].decode(r);let n=await t.array_to_bytes.decode(r);for(let e=t.array_to_array.length-1;e>=0;e--)n=await t.array_to_array[e].decode(n);return n}}}async function w(e){let t,r=e.codecs.map((async e=>{let t=await(_.get(e.name)?.());return(0,n.vA)(t,`Unknown codec: ${e.name}`),{Codec:t,meta:e}})),s=[],i=[];for await(let{Codec:n,meta:a}of r){let r=n.fromConfig(a.configuration,e);switch(r.kind){case"array_to_array":s.push(r);break;case"array_to_bytes":t=r;break;default:i.push(r)}}return t||((0,n.vA)("v2:object"!==e.data_type,`Cannot encode ${e.data_type} to bytes without a codec`),t=o.fromConfig({endian:"little"},e)),{array_to_array:s,array_to_bytes:t,bytes_to_bytes:i}}const A=18446744073709551615n;function v(e,t,r,s){(0,n.vA)(e.store.getRange,"Store does not support range requests");let i=e.store.getRange.bind(e.store),a=t.map(((e,t)=>e/s.chunk_shape[t])),o=b({data_type:"uint64",shape:[...a,2],codecs:s.index_codecs}),u={};return async t=>{let n,s=t.map(((e,t)=>Math.floor(e/a[t]))),c=e.resolve(r(s)).path;if(c in u)n=u[c];else{let e=4,t=16*a.reduce(((e,t)=>e*t),1),r=await i(c,{suffixLength:t+e});n=u[c]=r?await o.decode(r):null}if(null===n)return;let{data:h,shape:l,stride:d}=n,f=t.map(((e,t)=>e%l[t])).reduce(((e,t,r)=>e+t*d[r]),0),p=h[f],y=h[f+1];return p!==A||y!==A?i(c,{offset:Number(p),length:Number(y)}):void 0}}class E{store;path;constructor(e,t="/"){this.store=e,this.path=t}resolve(e){let t=new URL(`file://${this.path.endsWith("/")?this.path:`${this.path}/`}`);return new E(this.store,new URL(e,t).pathname)}}function k(e){return new E(e??new Map)}class T extends E{kind="group";#f;constructor(e,t,r){super(e,t),this.#f=r}get attrs(){return this.#f.attributes}}function L(e){const t=e.find((e=>"transpose"===e.name));return t?.configuration?.order??"C"}const I=Symbol("zarrita.context");function q(e){return e[I]}class R extends E{kind="array";#f;[I];constructor(e,t,r){super(e,t),this.#f={...r,fill_value:(0,n.HM)(r)},this[I]=function(e,t){let{configuration:r}=t.codecs.find(n.X)??{},s={encode_chunk_key:(0,n.c7)(t.chunk_key_encoding),TypedArray:(0,n.zA)(t.data_type),fill_value:t.fill_value};if(r){let i=L(r.codecs);return{...s,kind:"sharded",chunk_shape:r.chunk_shape,codec:b({data_type:t.data_type,shape:r.chunk_shape,codecs:r.codecs}),get_strides:e=>(0,n.uV)(e,i),get_chunk_bytes:v(e,t.chunk_grid.configuration.chunk_shape,s.encode_chunk_key,r)}}let i=L(t.codecs);return{...s,kind:"regular",chunk_shape:t.chunk_grid.configuration.chunk_shape,codec:b({data_type:t.data_type,shape:t.chunk_grid.configuration.chunk_shape,codecs:t.codecs}),get_strides:e=>(0,n.uV)(e,i),async get_chunk_bytes(t,r){let n=s.encode_chunk_key(t),i=e.resolve(n).path;return e.store.get(i,r)}}}(this,r)}get attrs(){return this.#f.attributes}get shape(){return this.#f.shape}get chunks(){return this[I].chunk_shape}get dtype(){return this.#f.data_type}async getChunk(e,t){let r=this[I],n=await r.get_chunk_bytes(e,t);if(!n){let e=r.chunk_shape.reduce(((e,t)=>e*t),1),t=new r.TypedArray(e);return t.fill(r.fill_value),{data:t,shape:r.chunk_shape,stride:r.get_strides(r.chunk_shape)}}return r.codec.decode(n)}is(e){return(0,n.mf)(this.dtype,e)}}},8613:(e,t,r)=>{r.d(t,{di:()=>n.di});var n=r(5508)},7950:(e,t,r)=>{r.d(t,{Jt:()=>d});var n=r(6712),s=r(5508);class i extends Error{constructor(e){super(e),this.name="IndexError"}}class a{dim_sel;dim_len;dim_chunk_len;nitems;constructor({dim_sel:e,dim_len:t,dim_chunk_len:r}){e=function(e,t){return(e=Math.trunc(e))<0&&(e=t+e),(e>=t||e<0)&&function(e){throw new i(`index out of bounds for dimension with length ${e}`)}(t),e}(e,t),this.dim_sel=e,this.dim_len=t,this.dim_chunk_len=r,this.nitems=1}*[Symbol.iterator](){const e=Math.floor(this.dim_sel/this.dim_chunk_len),t=e*this.dim_chunk_len,r=this.dim_sel-t;yield{dim_chunk_ix:e,dim_chunk_sel:r}}}class o{start;stop;step;dim_len;dim_chunk_len;nitems;nchunks;constructor({dim_sel:e,dim_len:t,dim_chunk_len:r}){const[n,a,o]=(0,s.LS)(e,t);this.start=n,this.stop=a,this.step=o,this.step<1&&function(){throw new i("only slices with step >= 1 are supported")}(),this.dim_len=t,this.dim_chunk_len=r,this.nitems=Math.max(0,Math.ceil((this.stop-this.start)/this.step)),this.nchunks=Math.ceil(this.dim_len/this.dim_chunk_len)}*[Symbol.iterator](){const e=Math.floor(this.start/this.dim_chunk_len),t=Math.ceil(this.stop/this.dim_chunk_len);for(const r of(0,s.y1)(e,t)){const e=r*this.dim_chunk_len,t=Math.min(this.dim_len,(r+1)*this.dim_chunk_len),n=t-e;let s=0,i=0;if(this.start<e){const t=(e-this.start)%this.step;t&&(i+=this.step-t),s=Math.ceil((e-this.start)/this.step)}else i=this.start-e;const a=this.stop>t?n:this.stop-e,o=[i,a,this.step],u=[s,s+Math.ceil((a-i)/this.step),1];yield{dim_chunk_ix:r,dim_chunk_sel:o,dim_out_sel:u}}}}class u{dim_indexers;shape;constructor({selection:e,shape:t,chunk_shape:r}){this.dim_indexers=function(e,t){let r=[];return null===e?r=t.map((e=>(0,s.di)(null))):Array.isArray(e)&&(r=e.map((e=>e??(0,s.di)(null)))),function(e,t){e.length>t.length&&function(e,t){throw new i(`too many indicies for array; expected ${t.length}, got ${e.length}`)}(e,t)}(r,t),r}(e,t).map(((e,n)=>new("number"==typeof e?a:o)({dim_sel:e,dim_len:t[n],dim_chunk_len:r[n]}))),this.shape=this.dim_indexers.filter((e=>e instanceof o)).map((e=>e.nitems))}*[Symbol.iterator](){for(const e of(0,s.qM)(...this.dim_indexers)){const t=e.map((e=>e.dim_chunk_ix)),r=e.map((e=>"dim_out_sel"in e?{from:e.dim_chunk_sel,to:e.dim_out_sel}:{from:e.dim_chunk_sel,to:null}));yield{chunk_coords:t,mapping:r}}}}function c(e,t=0,r){let n=r??e.length-t;return{length:n,subarray:(r,s=n)=>c(e,t+r,s-r),set(r,n=0){for(let s=0;s<r.length;s++)e[t+n+s]=r.get(s)},get:r=>e[t+r]}}function h(e){return globalThis.Array.isArray(e.data)?{data:c(e.data),stride:e.stride,bytes_per_element:1}:{data:new Uint8Array(e.data.buffer,e.data.byteOffset,e.data.byteLength),stride:e.stride,bytes_per_element:e.data.BYTES_PER_ELEMENT}}const l={prepare:(e,t,r)=>({data:e,shape:t,stride:r}),set_scalar(e,t,r){let n=h(e);p(n,t,function(e,t){if(globalThis.Array.isArray(e.data))return c([t]);let r=new(function(e){return"chars"in e?e.constructor.bind(null,e.chars):e.constructor}(e.data))([t]);return new Uint8Array(r.buffer,r.byteOffset,r.byteLength)}(e,r),n.bytes_per_element)},set_from_chunk(e,t,r){let n=h(e);y(n,h(t),n.bytes_per_element,r)}};async function d(e,t=null,r={}){return async function(e,t,r,i){let a=(0,n.JD)(e),o=new u({selection:t,shape:e.shape,chunk_shape:e.chunks}),c=i.prepare(new a.TypedArray(o.shape.reduce(((e,t)=>e*t),1)),o.shape,a.get_strides(o.shape)),h=r.create_queue?.()??(0,s.XB)();for(const{chunk_coords:t,mapping:n}of o)h.add((async()=>{let{data:s,shape:a,stride:o}=await e.getChunk(t,r.opts),u=i.prepare(s,a,o);i.set_from_chunk(c,u,n)}));return await h.onIdle(),0===o.shape.length?function(e){return"get"in e?e.get(0):e[0]}(c.data):c}(e,t,r,l)}function f(e,t,r){return r<0&&t<e?Math.floor((e-t-1)/-r)+1:e<t?Math.floor((t-e-1)/r)+1:0}function p(e,t,r,n){if(0===t.length)return void e.data.set(r,0);const[s,...i]=t,[a,...o]=e.stride;if("number"==typeof s)return void p({data:e.data.subarray(a*s*n),stride:o},i,r,n);const[u,c,h]=s,l=f(u,c,h);if(0!==i.length)for(let t=0;t<l;t++)p({data:e.data.subarray(a*(u+h*t)*n),stride:o},i,r,n);else for(let t=0;t<l;t++)e.data.set(r,a*(u+h*t)*n)}function y(e,t,r,n){const[s,...i]=n,[a,...o]=e.stride,[u,...c]=t.stride;if(null===s.from)return 0===i.length?void e.data.set(t.data.subarray(0,r),s.to*r):void y({data:e.data.subarray(a*s.to*r),stride:o},t,r,i);if(null===s.to){if(0===i.length){let n=s.from*r;return void e.data.set(t.data.subarray(n,n+r),0)}return void y(e,{data:t.data.subarray(u*s.from*r),stride:c},r,i)}const[h,l,d]=s.to,[p,m,g]=s.from,_=f(h,l,d);if(0!==i.length)for(let n=0;n<_;n++)y({data:e.data.subarray(a*(h+n*d)*r),stride:o},{data:t.data.subarray(u*(p+n*g)*r),stride:c},r,i);else{if(1===d&&1===g&&1===a&&1===u){let n=p*r,s=_*r;return void e.data.set(t.data.subarray(n,n+s),h*r)}for(let n=0;n<_;n++){let s=u*(p+g*n)*r;e.data.set(t.data.subarray(s,s+r),a*(h+d*n)*r)}}}},5508:(e,t,r)=>{function*n(e,t,r=1){void 0===t&&(t=e,e=0);for(let n=e;n<t;n+=r)yield n}function*s(...e){if(0===e.length)return;const t=e.map((e=>e[Symbol.iterator]())),r=t.map((e=>e.next()));if(r.some((e=>e.done)))throw new Error("Input contains an empty iterator.");for(let n=0;;){if(r[n].done){if(t[n]=e[n][Symbol.iterator](),r[n]=t[n].next(),++n>=t.length)return}else yield r.map((({value:e})=>e)),n=0;r[n]=t[n].next()}}function i({start:e,stop:t,step:r},n){if(0===r)throw new Error("slice step cannot be zero");const s=(r=r??1)<0,[i,a]=s?[-1,n-1]:[0,n];return null===e?e=s?a:i:e<0?(e+=n)<i&&(e=i):e>a&&(e=a),null===t?t=s?i:a:t<0?(t+=n)<i&&(t=i):t>a&&(t=a),[e,t,r]}function a(e,t,r=null){return void 0===t&&(t=e,e=null),{start:e,stop:t,step:r}}function o(){const e=[];return{add:t=>e.push(t()),onIdle:()=>Promise.all(e)}}r.d(t,{LS:()=>i,XB:()=>o,di:()=>a,qM:()=>s,y1:()=>n})},2081:(e,t,r)=>{r.d(t,{h:()=>c});var n=r(7972),s=r(6712),i=r(3333);let a=function(){let e=new WeakMap;function t(t){let r=e.get(t)??{v2:0,v3:0};return e.set(t,r),r}return{increment(e,r){t(e)[r]+=1},version_max(e){let r=t(e);return r.v3>r.v2?"v3":"v2"}}}();async function o(e,t){let{path:r}=e.resolve(".zarray"),o=await e.store.get(r);if(!o)throw new n._("v2 array",{cause:new n.e(r)});return a.increment(e.store,"v2"),new s.O3(e.store,e.path,(0,i.PQ)((0,i.eg)(o),t))}async function u(e,t){let{path:r}=e.resolve(".zgroup"),o=await e.store.get(r);if(!o)throw new n._("v2 group",{cause:new n.e(r)});return a.increment(e.store,"v2"),new s.YJ(e.store,e.path,(0,i.NO)((0,i.eg)(o),t))}async function c(e,t={}){let r="store"in e?e.store:e,s=a.version_max(r),o="v2"===s?c.v2:c.v3,u="v2"===s?c.v3:c.v2;return o(e,t).catch((r=>((0,i.tz)(r,n._),u(e,t))))}c.v2=async function(e,t={}){let r="store"in e?e:new s.aZ(e),a={};return(t.attrs??1)&&(a=await async function(e){let t=await e.store.get(e.resolve(".zattrs").path);return t?(0,i.eg)(t):{}}(r)),"array"===t.kind?o(r,a):"group"===t.kind?u(r,a):o(r,a).catch((e=>((0,i.tz)(e,n._),u(r,a))))},c.v3=async function(e,t={}){let r="store"in e?e:new s.aZ(e),o=await async function(e){let{store:t,path:r}=e.resolve("zarr.json"),a=await e.store.get(r);if(!a)throw new n._("v3 array or group",{cause:new n.e(r)});let o=(0,i.eg)(a);return"array"===o.node_type&&(o.fill_value=(0,i.HM)(o)),"array"===o.node_type?new s.O3(t,e.path,o):new s.YJ(t,e.path,o)}(r);if(a.increment(r.store,"v3"),void 0===t.kind)return o;if("array"===t.kind&&o instanceof s.O3)return o;if("group"===t.kind&&o instanceof s.YJ)return o;let u=o instanceof s.O3?"array":"group";throw new Error(`Expected node of kind ${t.kind}, found ${u}.`)}},3356:(e,t,r)=>{r.d(t,{Lk:()=>s,OZ:()=>n,so:()=>i});class n{#p;constructor(e,t,r){"number"==typeof e?this.#p=new Uint8Array(e):e instanceof ArrayBuffer?this.#p=new Uint8Array(e,t,r):this.#p=new Uint8Array(Array.from(e,(e=>e?1:0)))}get BYTES_PER_ELEMENT(){return 1}get byteOffset(){return this.#p.byteOffset}get byteLength(){return this.#p.byteLength}get buffer(){return this.#p.buffer}get length(){return this.#p.length}get(e){let t=this.#p[e];return"number"==typeof t?0!==t:t}set(e,t){this.#p[e]=t?1:0}fill(e){this.#p.fill(e?1:0)}*[Symbol.iterator](){for(let e=0;e<this.length;e++)yield this.get(e)}}class s{_data;chars;#y;constructor(e,t,r,n){if(this.chars=e,this.#y=new TextEncoder,"number"==typeof t)this._data=new Uint8Array(t*e);else if(t instanceof ArrayBuffer)n&&(n*=e),this._data=new Uint8Array(t,r,n);else{let r=Array.from(t);this._data=new Uint8Array(r.length*e);for(let e=0;e<r.length;e++)this.set(e,r[e])}}get BYTES_PER_ELEMENT(){return this.chars}get byteOffset(){return this._data.byteOffset}get byteLength(){return this._data.byteLength}get buffer(){return this._data.buffer}get length(){return this.byteLength/this.BYTES_PER_ELEMENT}get(e){const t=new Uint8Array(this.buffer,this.byteOffset+this.chars*e,this.chars);return(new TextDecoder).decode(t).replace(/\x00/g,"")}set(e,t){const r=new Uint8Array(this.buffer,this.byteOffset+this.chars*e,this.chars);r.fill(0),r.set(this.#y.encode(t))}fill(e){const t=this.#y.encode(e);for(let e=0;e<this.length;e++)this._data.set(t,e*this.chars)}*[Symbol.iterator](){for(let e=0;e<this.length;e++)yield this.get(e)}}class i{#m;chars;constructor(e,t,r,n){if(this.chars=e,"number"==typeof t)this.#m=new Int32Array(t*e);else if(t instanceof ArrayBuffer)n&&(n*=e),this.#m=new Int32Array(t,r,n);else{const r=t,n=new i(e,1);this.#m=new Int32Array(function*(){for(let e of r)n.set(0,e),yield*n.#m}())}}get BYTES_PER_ELEMENT(){return this.#m.BYTES_PER_ELEMENT*this.chars}get byteLength(){return this.#m.byteLength}get byteOffset(){return this.#m.byteOffset}get buffer(){return this.#m.buffer}get length(){return this.#m.length/this.chars}get(e){const t=this.chars*e;let r="";for(let e=0;e<this.chars;e++)r+=String.fromCodePoint(this.#m[t+e]);return r.replace(/\u0000/g,"")}set(e,t){const r=this.chars*e,n=this.#m.subarray(r,r+this.chars);n.fill(0);for(let e=0;e<this.chars;e++)n[e]=t.codePointAt(e)??0}fill(e){this.set(0,e);let t=this.#m.subarray(0,this.chars);for(let e=1;e<this.length;e++)this.#m.set(t,e*this.chars)}*[Symbol.iterator](){for(let e=0;e<this.length;e++)yield this.get(e)}}},3333:(e,t,r)=>{r.d(t,{HM:()=>f,NO:()=>h,PQ:()=>c,X:()=>d,c7:()=>u,dq:()=>i,eg:()=>s,mF:()=>m,mf:()=>l,tz:()=>p,uV:()=>o,vA:()=>y,zA:()=>a});var n=r(3356);function s(e){const t=(new TextDecoder).decode(e);return JSON.parse(t)}function i(e,t){const r=t/2,n=t-1;let s=0;for(let i=0;i<e.length;i+=t)for(let t=0;t<r;t+=1)s=e[i+t],e[i+t]=e[i+n-t],e[i+n-t]=s}function a(e){if("v2:object"===e)return globalThis.Array;let t=e.match(/v2:([US])(\d+)/);if(t){let[,e,r]=t;return("U"===e?n.so:n.Lk).bind(null,Number(r))}let r={int8:Int8Array,int16:Int16Array,int32:Int32Array,int64:globalThis.BigInt64Array,uint8:Uint8Array,uint16:Uint16Array,uint32:Uint32Array,uint64:globalThis.BigUint64Array,float16:globalThis.Float16Array,float32:Float32Array,float64:Float64Array,bool:n.OZ}[e];return y(r,`Unknown or unsupported data_type: ${e}`),r}function o(e,t){const r=e.length;"string"==typeof t&&(t="C"===t?Array.from({length:r},((e,t)=>t)):Array.from({length:r},((e,t)=>r-1-t))),y(r===t.length,"Order length must match the number of dimensions.");let n=1,s=new Array(r);for(let r=t.length-1;r>=0;r--)s[t[r]]=n,n*=e[t[r]];return s}function u({name:e,configuration:t}){if("default"===e){const e=t?.separator??"/";return t=>["c",...t].join(e)}if("v2"===e){const e=t?.separator??".";return t=>t.join(e)||"0"}throw new Error(`Unknown chunk key encoding: ${e}`)}function c(e,t={}){let r=[],n=function(e){if("|O"===e)return{data_type:"v2:object"};let t=e.match(/^([<|>])(.*)$/);y(t,`Invalid dtype: ${e}`);let[,r,n]=t,s={b1:"bool",i1:"int8",u1:"uint8",i2:"int16",u2:"uint16",i4:"int32",u4:"uint32",i8:"int64",u8:"uint64",f2:"float16",f4:"float32",f8:"float64"}[n]??(n.startsWith("S")||n.startsWith("U")?`v2:${n}`:void 0);return y(s,`Unsupported or unknown dtype: ${e}`),"|"===r?{data_type:s}:{data_type:s,endian:"<"===r?"little":"big"}}(e.dtype);"F"===e.order&&r.push({name:"transpose",configuration:{order:"F"}}),"endian"in n&&"big"===n.endian&&r.push({name:"bytes",configuration:{endian:"big"}});for(let{id:t,...n}of e.filters??[])r.push({name:t,configuration:n});if(e.compressor){let{id:t,...n}=e.compressor;r.push({name:t,configuration:n})}return{zarr_format:3,node_type:"array",shape:e.shape,data_type:n.data_type,chunk_grid:{name:"regular",configuration:{chunk_shape:e.chunks}},chunk_key_encoding:{name:"v2",configuration:{separator:e.dimension_separator??"."}},codecs:r,fill_value:e.fill_value,attributes:t}}function h(e,t={}){return{zarr_format:3,node_type:"group",attributes:t}}function l(e,t){if("number"!==t&&"bigint"!==t&&"boolean"!==t&&"object"!==t&&"string"!==t)return e===t;let r="bool"===e;if("boolean"===t)return r;let n=e.startsWith("v2:U")||e.startsWith("v2:S");if("string"===t)return n;let s="int64"===e||"uint64"===e;if("bigint"===t)return s;let i="v2:object"===e;return"object"===t?i:!(n||s||r||i)}function d(e){return"sharding_indexed"===e?.name}function f(e){return"uint64"!==e.data_type&&"int64"!==e.data_type||null==e.fill_value?e.fill_value:BigInt(e.fill_value)}function p(e,...t){if(!t.some((t=>e instanceof t)))throw e}function y(e,t=""){if(!e)throw new Error(t)}async function m(e,{format:t,signal:r}){const n=e instanceof Response?e:new Response(e);y(n.body,"Response does not contain body.");try{const e=new Response(n.body.pipeThrough(new DecompressionStream(t),{signal:r}));return await e.arrayBuffer()}catch{throw r?.throwIfAborted(),new Error(`Failed to decode ${t}`)}}}}]);
//# sourceMappingURL=214.bundle.js.map