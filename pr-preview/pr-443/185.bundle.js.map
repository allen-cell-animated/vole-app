{"version":3,"file":"185.bundle.js","mappings":"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","sources":["webpack://@aics/vole-app/./website/components/Modals/ShareModal.tsx","webpack://@aics/vole-app/./website/components/AppWrapper.tsx"],"sourcesContent":["import { View3d } from \"@aics/vole-core\";\nimport { ShareAltOutlined } from \"@ant-design/icons\";\nimport { Button, Input, Modal, notification } from \"antd\";\nimport React, { useRef, useState } from \"react\";\nimport styled from \"styled-components\";\n\nimport { MultisceneUrls } from \"../../../src/aics-image-viewer/components/App/types\";\nimport { ViewerStateContextType } from \"../../../src/aics-image-viewer/components/ViewerStateProvider/types\";\nimport { AppDataProps } from \"../../types\";\nimport { ENCODED_COLON_REGEX, ENCODED_COMMA_REGEX, serializeViewerUrlParams } from \"../../utils/url_utils\";\nimport { FlexRow } from \"../LandingPage/utils\";\n\nimport {\n  ALL_VIEWER_STATE_KEYS,\n  connectToViewerState,\n} from \"../../../src/aics-image-viewer/components/ViewerStateProvider\";\n\ntype ShareModalProps = {\n  appProps: AppDataProps;\n  // Used to retrieve the current camera position information\n  view3dRef?: React.RefObject<View3d | null>;\n} & ViewerStateContextType;\n\nconst ModalContainer = styled.div``;\n\nconst ShareModal: React.FC<ShareModalProps> = (props: ShareModalProps) => {\n  const [showModal, setShowModal] = useState(false);\n  const modalContainerRef = useRef<HTMLDivElement>(null);\n\n  const [notificationApi, notificationContextHolder] = notification.useNotification({\n    getContainer: modalContainerRef.current ? () => modalContainerRef.current! : undefined,\n    placement: \"bottomLeft\",\n    duration: 2,\n  });\n\n  // location.pathname will include up to `.../viewer`\n  const baseUrl = location.protocol + \"//\" + location.host + location.pathname;\n  const paramProps = {\n    ...props,\n    cameraState: props.view3dRef?.current?.getCameraState(),\n  };\n\n  const urlParams: string[] = [];\n  const { imageUrl } = props.appProps;\n\n  if (imageUrl) {\n    const urls = (imageUrl as MultisceneUrls).scenes ?? [imageUrl];\n    const serializedUrl = urls\n      .map((scene) => {\n        if (Array.isArray(scene)) {\n          return scene.map((url) => encodeURIComponent(url)).join(\",\");\n        } else {\n          return encodeURIComponent(scene);\n        }\n      })\n      .join(\"+\");\n\n    urlParams.push(`url=${serializedUrl}`);\n  }\n\n  let serializedViewerParams = new URLSearchParams(serializeViewerUrlParams(paramProps) as Record<string, string>);\n  if (serializedViewerParams.size > 0) {\n    // Decode specifically colons and commas for better readability + decreased char count\n    let viewerParamString = serializedViewerParams\n      .toString()\n      .replace(ENCODED_COLON_REGEX, \":\")\n      .replace(ENCODED_COMMA_REGEX, \",\");\n    urlParams.push(viewerParamString);\n  }\n\n  const shareUrl = urlParams.length > 0 ? `${baseUrl}?${urlParams.join(\"&\")}` : baseUrl;\n\n  const onClickCopy = (): void => {\n    navigator.clipboard.writeText(shareUrl);\n    notificationApi.success({\n      message: \"URL copied\",\n    });\n  };\n\n  return (\n    <ModalContainer ref={modalContainerRef}>\n      {notificationContextHolder}\n\n      <Button type=\"link\" onClick={() => setShowModal(!showModal)}>\n        <ShareAltOutlined />\n        Share\n      </Button>\n      <Modal\n        open={showModal}\n        title={\"Share URL\"}\n        onCancel={() => {\n          setShowModal(false);\n        }}\n        getContainer={modalContainerRef.current || undefined}\n        footer={\n          <Button type=\"default\" onClick={() => setShowModal(false)}>\n            Close\n          </Button>\n        }\n        destroyOnClose={true}\n      >\n        <FlexRow $gap={8} style={{ marginTop: \"12px\" }}>\n          <Input value={shareUrl} readOnly={true}></Input>\n          <Button type=\"primary\" onClick={onClickCopy}>\n            Copy URL\n          </Button>\n        </FlexRow>\n      </Modal>\n    </ModalContainer>\n  );\n};\n\nexport default connectToViewerState(ShareModal, ALL_VIEWER_STATE_KEYS);\n","import { View3d } from \"@aics/vole-core\";\nimport { FirebaseFirestore } from \"@firebase/firestore-types\";\nimport React, { type ReactElement, useCallback, useEffect, useState } from \"react\";\nimport { useLocation, useNavigate, useSearchParams } from \"react-router-dom\";\n\nimport { ImageViewerApp, ViewerStateProvider } from \"../../src\";\nimport type { ViewerState } from \"../../src/aics-image-viewer/components/ViewerStateProvider/types\";\nimport { getDefaultViewerChannelSettings } from \"../../src/aics-image-viewer/shared/constants\";\nimport type { AppDataProps } from \"../types\";\nimport { encodeImageUrlProp, parseViewerUrlParams } from \"../utils/url_utils\";\nimport { FlexRowAlignCenter } from \"./LandingPage/utils\";\n\nimport { useErrorAlert } from \"../../src/aics-image-viewer/components/ErrorAlert\";\nimport Header, { HEADER_HEIGHT_PX } from \"./Header\";\nimport HelpDropdown from \"./HelpDropdown\";\nimport LoadModal from \"./Modals/LoadModal\";\nimport ShareModal from \"./Modals/ShareModal\";\n\nconst DEFAULT_APP_PROPS: AppDataProps = {\n  imageUrl: \"\",\n  cellId: \"\",\n  imageDownloadHref: \"\",\n  parentImageDownloadHref: \"\",\n  viewerChannelSettings: getDefaultViewerChannelSettings(),\n};\n\ntype AppWrapperProps = {\n  firestore?: FirebaseFirestore;\n};\n\n/**\n * Wrapper around the main ImageViewer component. Handles the collection of parameters from the\n * URL and location state (from routing) to pass to the viewer.\n */\nexport default function AppWrapper(props: AppWrapperProps): ReactElement {\n  const location = useLocation();\n  const navigation = useNavigate();\n\n  const view3dRef = React.useRef<View3d | null>(null);\n  const [viewerSettings, setViewerSettings] = useState<Partial<ViewerState>>({});\n  const [viewerProps, setViewerProps] = useState<AppDataProps | null>(null);\n  const [imageTitle, setImageTitle] = useState<string | undefined>(undefined);\n  const [searchParams] = useSearchParams();\n  const [errorAlert, showErrorAlert] = useErrorAlert();\n\n  useEffect(() => {\n    // On load, fetch parameters from the URL and location state, then merge.\n    const locationArgs = location.state as AppDataProps;\n    parseViewerUrlParams(searchParams, props.firestore).then(\n      ({ args: urlArgs, viewerSettings: urlViewerSettings }) => {\n        setViewerSettings({ ...urlViewerSettings, ...locationArgs?.viewerSettings });\n        setViewerProps({ ...DEFAULT_APP_PROPS, ...urlArgs, ...locationArgs });\n      },\n      (reason) => {\n        showErrorAlert(\"Failed to parse URL parameters: \" + reason);\n        setViewerSettings({});\n        setViewerProps({ ...DEFAULT_APP_PROPS, ...locationArgs });\n      }\n    );\n  }, [location.state, searchParams, showErrorAlert, props.firestore]);\n\n  // TODO: Disabled for now, since it only makes sense for Zarr/OME-tiff URLs. Checking for\n  // validity may be more complex. (Also, we could add a callback to `ImageViewerApp` for successful\n  // loading and only save the URL then.)\n  //\n  // Save recent zarr data urls\n  // useEffect(() => {\n  //   if (typeof viewerArgs.imageUrl === \"string\" && isValidZarrUrl(viewerArgs.imageUrl)) {\n  //     // TODO: Handle case where there are multiple URLs?\n  //     // TODO: Save ALL AppProps instead of only the URL? Ignore/handle rawData?\n  //     addRecentDataUrl({ url: viewerArgs.imageUrl as string, label: viewerArgs.imageUrl as string });\n  //   }\n  // }, [viewerArgs]);\n\n  const onImageTitleChange = useCallback(\n    (title: string | undefined) => {\n      if (!searchParams.get(\"hideTitle\")) {\n        setImageTitle(title);\n        document.title = title ? `Vol-E — ${title}` : \"Vol-E\";\n      }\n    },\n    [setImageTitle, searchParams]\n  );\n\n  const onLoad = (appProps: AppDataProps): void => {\n    // Force a page reload when loading new data. This prevents a bug where a desync in the number\n    // of channels in the viewer can cause a crash. The root cause is React immediately forcing a\n    // re-render every time `setState` is called in an async function.\n    navigation(`/viewer?url=${encodeImageUrlProp(appProps.imageUrl)}`, {\n      state: appProps,\n    });\n    navigation(0);\n  };\n\n  return (\n    <div>\n      {errorAlert}\n      <ViewerStateProvider viewerSettings={viewerSettings}>\n        <Header title={imageTitle} noNavigate>\n          <FlexRowAlignCenter $gap={12}>\n            <FlexRowAlignCenter $gap={2}>\n              <LoadModal onLoad={onLoad} />\n              {viewerProps && <ShareModal appProps={viewerProps} view3dRef={view3dRef} />}\n            </FlexRowAlignCenter>\n            <HelpDropdown />\n          </FlexRowAlignCenter>\n        </Header>\n        {viewerProps && (\n          <ImageViewerApp\n            {...viewerProps}\n            appHeight={`calc(100vh - ${HEADER_HEIGHT_PX}px)`}\n            canvasMargin=\"0 0 0 0\"\n            view3dRef={view3dRef}\n            showError={showErrorAlert}\n            onImageTitleChange={onImageTitleChange}\n          />\n        )}\n      </ViewerStateProvider>\n    </div>\n  );\n}\n"],"names":["ModalContainer","styled","div","_templateObject","connectToViewerState","props","_props$view3dRef","_useState2","_slicedToArray","useState","showModal","setShowModal","modalContainerRef","useRef","_notification$useNoti2","notification","useNotification","getContainer","current","undefined","placement","duration","notificationApi","notificationContextHolder","baseUrl","location","protocol","host","pathname","paramProps","_objectSpread","cameraState","view3dRef","getCameraState","urlParams","imageUrl","appProps","_scenes","serializedUrl","scenes","map","scene","Array","isArray","url","encodeURIComponent","join","push","concat","serializedViewerParams","URLSearchParams","serializeViewerUrlParams","size","viewerParamString","toString","replace","ENCODED_COLON_REGEX","ENCODED_COMMA_REGEX","shareUrl","length","React","ref","Button","type","onClick","ShareAltOutlined","Modal","open","title","onCancel","footer","destroyOnClose","FlexRow","$gap","style","marginTop","Input","value","readOnly","navigator","clipboard","writeText","success","message","ALL_VIEWER_STATE_KEYS","DEFAULT_APP_PROPS","cellId","imageDownloadHref","parentImageDownloadHref","viewerChannelSettings","getDefaultViewerChannelSettings","AppWrapper","useLocation","navigation","useNavigate","viewerSettings","setViewerSettings","_useState4","viewerProps","setViewerProps","_useState6","imageTitle","setImageTitle","searchParams","useSearchParams","_useErrorAlert2","useErrorAlert","errorAlert","showErrorAlert","useEffect","locationArgs","state","parseViewerUrlParams","firestore","then","_ref","urlArgs","args","urlViewerSettings","reason","onImageTitleChange","useCallback","get","document","ViewerStateProvider","Header","noNavigate","FlexRowAlignCenter","LoadModal","onLoad","encodeImageUrlProp","ShareModal","HelpDropdown","ImageViewerApp","_extends","appHeight","HEADER_HEIGHT_PX","canvasMargin","showError"],"sourceRoot":""}