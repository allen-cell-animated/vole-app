{"version":3,"file":"226.bundle.js","mappings":"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","sources":["webpack://@aics/vole-app/./src/aics-image-viewer/components/ErrorAlert/index.tsx","webpack://@aics/vole-app/./src/aics-image-viewer/components/ViewerStateProvider/ResetStateProvider.ts","webpack://@aics/vole-app/./src/aics-image-viewer/components/ViewerStateProvider/index.tsx","webpack://@aics/vole-app/./src/aics-image-viewer/shared/utils/hooks.ts","webpack://@aics/vole-app/./src/aics-image-viewer/shared/utils/viewerChannelSettings.ts","webpack://@aics/vole-app/./src/aics-image-viewer/shared/utils/viewerState.ts","webpack://@aics/vole-app/./src/aics-image-viewer/shared/types.ts","webpack://@aics/vole-app/./src/aics-image-viewer/shared/utils/colorRepresentations.ts","webpack://@aics/vole-app/./src/aics-image-viewer/shared/utils/controlPointsToLut.ts","webpack://@aics/vole-app/./src/aics-image-viewer/shared/utils/playControls.ts","webpack://@aics/vole-app/./src/aics-image-viewer/shared/utils/sceneStore.ts","webpack://@aics/vole-app/./src/aics-image-viewer/components/useVolume.ts","webpack://@aics/vole-app/./src/aics-image-viewer/components/shared/NumericInput/index.tsx","webpack://@aics/vole-app/./src/aics-image-viewer/components/shared/SmarterSlider.tsx","webpack://@aics/vole-app/./src/aics-image-viewer/components/AxisClipSliders/index.tsx","webpack://@aics/vole-app/./src/aics-image-viewer/assets/icons/turnTable.svg","webpack://@aics/vole-app/./src/aics-image-viewer/assets/icons/index.ts","webpack://@aics/vole-app/./src/aics-image-viewer/assets/icons/axes.svg","webpack://@aics/vole-app/./src/aics-image-viewer/assets/icons/boundingBox.svg","webpack://@aics/vole-app/./src/aics-image-viewer/assets/icons/camera.svg","webpack://@aics/vole-app/./src/aics-image-viewer/assets/icons/channels.svg","webpack://@aics/vole-app/./src/aics-image-viewer/assets/icons/closePanel.svg","webpack://@aics/vole-app/./src/aics-image-viewer/assets/icons/download.svg","webpack://@aics/vole-app/./src/aics-image-viewer/assets/icons/dropdownArrow.svg","webpack://@aics/vole-app/./src/aics-image-viewer/assets/icons/metadata.svg","webpack://@aics/vole-app/./src/aics-image-viewer/assets/icons/preferences.svg","webpack://@aics/vole-app/./src/aics-image-viewer/assets/icons/resetView.svg","webpack://@aics/vole-app/./src/aics-image-viewer/components/shared/ViewerIcon.tsx","webpack://@aics/vole-app/./src/aics-image-viewer/components/BottomPanel/index.tsx","webpack://@aics/vole-app/./src/aics-image-viewer/components/CellViewerCanvasWrapper/index.tsx","webpack://@aics/vole-app/./src/aics-image-viewer/components/ColorPicker.tsx","webpack://@aics/vole-app/./src/aics-image-viewer/components/shared/SliderRow/index.tsx","webpack://@aics/vole-app/./src/aics-image-viewer/components/TfEditor/index.tsx","webpack://@aics/vole-app/./src/aics-image-viewer/components/ChannelsWidgetRow/index.tsx","webpack://@aics/vole-app/./src/aics-image-viewer/components/shared/SharedCheckBox.tsx","webpack://@aics/vole-app/./src/aics-image-viewer/components/ChannelsWidget.tsx","webpack://@aics/vole-app/./src/aics-image-viewer/components/CustomizeWidget.tsx","webpack://@aics/vole-app/./src/aics-image-viewer/components/GlobalVolumeControls.tsx","webpack://@aics/vole-app/./src/aics-image-viewer/components/MetadataViewer/index.tsx","webpack://@aics/vole-app/./src/aics-image-viewer/components/ControlPanel/index.tsx","webpack://@aics/vole-app/./src/aics-image-viewer/components/Toolbar/DownloadButton.tsx","webpack://@aics/vole-app/./src/aics-image-viewer/components/Toolbar/ViewModeRadioButtons.tsx","webpack://@aics/vole-app/./src/aics-image-viewer/components/Toolbar/index.tsx","webpack://@aics/vole-app/./src/aics-image-viewer/components/App/ChannelUpdater.tsx","webpack://@aics/vole-app/./src/aics-image-viewer/components/App/index.tsx","webpack://@aics/vole-app/./src/aics-image-viewer/shared/utils/sliderValuesToImageValues.ts","webpack://@aics/vole-app/./website/components/Buttons/index.tsx","webpack://@aics/vole-app/./website/components/HelpDropdown.tsx","webpack://@aics/vole-app/./website/utils/react_utils.ts","webpack://@aics/vole-app/./website/components/MiddleTruncatedText.tsx","webpack://@aics/vole-app/./website/components/Modals/LoadModal.tsx"],"sourcesContent":["import { VolumeLoadError, VolumeLoadErrorType } from \"@aics/vole-core\";\nimport { RightOutlined } from \"@ant-design/icons\";\nimport { Alert, Button } from \"antd\";\nimport React from \"react\";\n\nimport { useConstructor } from \"../../shared/utils/hooks\";\n\nimport \"./styles.css\";\n\nconst IssueLink: React.FC<React.PropsWithChildren<{ bug?: boolean }>> = ({ bug, children }) => (\n  <a\n    href={`https://github.com/allen-cell-animated/vole-app/issues/new${bug ? \"?template=bug_report.md\" : \"/choose\"}`}\n    target=\"_blank\"\n    rel=\"noreferrer noopener\"\n  >\n    {children}\n  </a>\n);\n\nconst UNKNOWN_ERROR_DESCRIPTION: React.ReactNode = (\n  <>\n    An unknown error occurred. Check the browser console (F12) for more details. If this looks like a bug,{\" \"}\n    <IssueLink bug>send us a bug report here</IssueLink>.\n  </>\n);\n\nconst ERROR_TYPE_DESCRIPTIONS: { [T in VolumeLoadErrorType]: React.ReactNode } = {\n  [VolumeLoadErrorType.UNKNOWN]: (\n    <>\n      An unknown error occurred while loading volume data. Check the browser console (F12) for more details. If this\n      looks like a bug, <IssueLink bug>send us a bug report here</IssueLink>.\n    </>\n  ),\n  [VolumeLoadErrorType.NOT_FOUND]: (\n    <>\n      The viewer was unable to find any volume data at the specified location. Check that the provided URL is correct\n      and try again.\n    </>\n  ),\n  [VolumeLoadErrorType.TOO_LARGE]: (\n    <>\n      No scale level is available for this volume which fits within our maximum GPU memory footprint. This maximum is\n      tuned to ensure compatibility with the majority of browsers. If you&apos;re trying to load your own OME-Zarr\n      dataset, you may be able to open this volume by including a lower scale level.\n    </>\n  ),\n  [VolumeLoadErrorType.LOAD_DATA_FAILED]: (\n    <>\n      The viewer was able to find a source of volume data at the specified location, but encountered an error while\n      trying to load it. Check that your dataset is complete and properly formatted. You can also check the browser\n      console (F12) for more details about this error. If it looks like a problem on our end,{\" \"}\n      <IssueLink bug>start a bug report here</IssueLink>.\n    </>\n  ),\n  [VolumeLoadErrorType.INVALID_METADATA]: (\n    <>\n      The viewer was unable to read all necessary information from this volume&apos;s metadata. Check that your\n      dataset&apos;s metadata is complete and properly formatted. If you believe your data is valid and should be\n      supported by our viewer, let us know by <IssueLink>opening a GitHub issue</IssueLink>.\n    </>\n  ),\n  [VolumeLoadErrorType.INVALID_MULTI_SOURCE_ZARR]: (\n    <>\n      The viewer is currently configured to consolidate multiple OME-Zarr datasets into a single volume, but the\n      provided datasets can&apos;t all be matched up. Ensure that all dataset URLs are correct and that at least one\n      equivalently-sized scale level exists in all datasets.\n    </>\n  ),\n};\n\nconst getErrorTitle = (error: unknown): string =>\n  (error instanceof Error && error.toString?.()) || (typeof error === \"string\" && error) || \"Unknown error\";\n\nconst getErrorDescription = (error: unknown): React.ReactNode => {\n  const type: VolumeLoadErrorType | undefined = (error as VolumeLoadError).type;\n  if (!type) {\n    return UNKNOWN_ERROR_DESCRIPTION;\n  }\n  return ERROR_TYPE_DESCRIPTIONS[type] ?? UNKNOWN_ERROR_DESCRIPTION;\n};\n\nexport type ErrorAlertProps = {\n  errors: unknown;\n  /** The number of times we've seen an error of the type that is currently being displayed before */\n  firstErrorCount?: number;\n  afterClose?: () => void;\n  onSkipError?: () => void;\n};\n\nconst ErrorAlert: React.FC<ErrorAlertProps> = ({ errors, firstErrorCount = 0, afterClose, onSkipError }) => {\n  const [showDetails, setShowDetails] = React.useState(false);\n  const [errorsSeenCount, setErrorsSeenCount] = React.useState(0);\n  const error = Array.isArray(errors) ? errors[0] : errors;\n\n  const errorMessage = (\n    <>\n      <div>\n        {getErrorTitle(error) + (firstErrorCount > 1 ? ` (${firstErrorCount})` : \"\")}{\" \"}\n        <Button type=\"text\" onClick={() => setShowDetails(!showDetails)}>\n          {showDetails ? \"Show less info\" : \"Show more info\"}\n        </Button>\n      </div>\n      <div style={{ display: showDetails ? undefined : \"none\" }}>{getErrorDescription(error)}</div>\n    </>\n  );\n\n  const skipErrorButton = Array.isArray(errors) && errors.length > 1 && (\n    <Button\n      type=\"text\"\n      onClick={() => {\n        setErrorsSeenCount((count) => count + 1);\n        onSkipError?.();\n      }}\n    >\n      Error {errorsSeenCount + 1} of {errors.length + errorsSeenCount} <RightOutlined />\n    </Button>\n  );\n\n  return (\n    <Alert\n      showIcon\n      type=\"error\"\n      className=\"load-error-alert\"\n      message={errorMessage}\n      closable\n      afterClose={() => {\n        setErrorsSeenCount(0);\n        afterClose?.();\n      }}\n      action={skipErrorButton}\n    />\n  );\n};\n\nexport const useErrorAlert = (): [React.ReactNode, (error: unknown) => void] => {\n  const [errorList, setErrorList] = React.useState<unknown[]>([]);\n  // Keep track of which errors have been seen and how many times\n  const seenErrors = useConstructor(() => new Map<string, number>());\n  const [errorCounts, setErrorCounts] = React.useState<number[]>([]);\n\n  const addError = React.useCallback(\n    (error: unknown) => {\n      console.error(error);\n      const errorTitle = getErrorTitle(error);\n      const errorSeenCount = (seenErrors.get(errorTitle) ?? 0) + 1;\n\n      setErrorList((prev) => [...prev, error]);\n      setErrorCounts((prev) => [...prev, errorSeenCount]);\n      seenErrors.set(errorTitle, errorSeenCount);\n    },\n    [seenErrors]\n  );\n\n  const onSkipError = React.useCallback(() => {\n    setErrorList((prev) => prev.slice(1));\n    setErrorCounts((prev) => prev.slice(1));\n  }, []);\n\n  const afterClose = React.useCallback(() => {\n    setErrorList([]);\n    setErrorCounts([]);\n  }, []);\n\n  const errCount = errorCounts[0];\n  const alertComponent = errorList.length > 0 && (\n    <ErrorAlert errors={errorList} firstErrorCount={errCount} onSkipError={onSkipError} afterClose={afterClose} />\n  );\n  return [alertComponent, addError];\n};\n\nexport default ErrorAlert;\n","import { isEqual } from \"lodash\";\n\nimport { ChannelState, ViewerState, ViewerStateContextType, ResetState } from \"./types\";\nimport {\n  getDefaultViewerState,\n  getDefaultCameraState,\n  getDefaultChannelState,\n  getDefaultViewerChannelSettings,\n  getDefaultChannelColor,\n} from \"../../shared/constants\";\nimport { ViewMode } from \"../../shared/enums\";\nimport {\n  overrideViewerState,\n  overrideChannelStates,\n  getEnabledChannelIndices,\n  initializeOneChannelSetting,\n} from \"../../shared/utils/viewerState\";\nimport { ViewerChannelSettings } from \"../../shared/utils/viewerChannelSettings\";\n\n/**\n * Provides reset functionality for the viewer and channel states.\n */\nexport default class ResetStateProvider implements ResetState {\n  savedViewerState: Partial<ViewerState>;\n  savedViewerChannelSettings: ViewerChannelSettings | undefined;\n  useDefaultViewerChannelSettings: boolean;\n\n  channelsToReset: Set<number>;\n  channelsToResetOnLoad: Set<number>;\n\n  ref: React.MutableRefObject<ViewerStateContextType>;\n\n  constructor(viewerStateRef: React.MutableRefObject<ViewerStateContextType>) {\n    this.ref = viewerStateRef;\n\n    this.savedViewerState = {};\n    this.channelsToReset = new Set();\n    this.channelsToResetOnLoad = new Set();\n    this.savedViewerChannelSettings = undefined;\n    this.useDefaultViewerChannelSettings = false;\n\n    this.resetToSavedViewerState = this.resetToSavedViewerState.bind(this);\n    this.resetToDefaultViewerState = this.resetToDefaultViewerState.bind(this);\n    this.resetToState = this.resetToState.bind(this);\n    this.setSavedViewerState = this.setSavedViewerState.bind(this);\n    this.setSavedViewerChannelSettings = this.setSavedViewerChannelSettings.bind(this);\n    this.getChannelsAwaitingReset = this.getChannelsAwaitingReset.bind(this);\n    this.getChannelsAwaitingResetOnLoad = this.getChannelsAwaitingResetOnLoad.bind(this);\n    this.onResetChannel = this.onResetChannel.bind(this);\n    this.getCurrentViewerChannelSettings = this.getCurrentViewerChannelSettings.bind(this);\n  }\n\n  // Setup Callbacks ////////////////////////////////////////////////////////////////////\n\n  public setSavedViewerState(state: Partial<ViewerState>): void {\n    this.savedViewerState = state;\n  }\n\n  public setSavedViewerChannelSettings(settings: ViewerChannelSettings | undefined): void {\n    this.savedViewerChannelSettings = settings;\n  }\n\n  public getChannelsAwaitingReset(): Set<number> {\n    return this.channelsToReset;\n  }\n\n  public getChannelsAwaitingResetOnLoad(): Set<number> {\n    return this.channelsToResetOnLoad;\n  }\n\n  public onResetChannel(channelIndex: number): void {\n    this.channelsToReset.delete(channelIndex);\n    this.channelsToResetOnLoad.delete(channelIndex);\n  }\n\n  /**\n   * Returns the current viewer channel settings that the viewer should use when\n   * resetting channels to an initial state.\n   */\n  public getCurrentViewerChannelSettings(): ViewerChannelSettings | undefined {\n    if (this.useDefaultViewerChannelSettings) {\n      return getDefaultViewerChannelSettings();\n    }\n    return this.savedViewerChannelSettings;\n  }\n\n  /**\n   * Helper method. Resets the viewer and all channels to the provided state. If new data needs to\n   * be loaded, handles setup so the reset will be applied to each channel as it loads in.\n   */\n  private resetToState(newState: ViewerState, newChannelStates: ChannelState[]): void {\n    const { changeViewerSetting, setChannelSettings, channelSettings, viewMode, time, slice } = this.ref.current;\n\n    // Needs reset on reload if one of the view modes is 2D while the other is 3D,\n    // if the timestamp is different, or if we're on a different z slice.\n    // TODO: Handle stopping playback? Requires playback to be part of ViewerStateContext\n    const isInDifferentViewMode =\n      viewMode !== newState.viewMode && (viewMode === ViewMode.xy || newState.viewMode === ViewMode.xy);\n    const isAtDifferentTime = time !== newState.time;\n    const isAtDifferentZSlice = newState.viewMode === ViewMode.xy && !isEqual(newState.slice.z, slice.z);\n    const willNeedResetOnLoad = isInDifferentViewMode || isAtDifferentTime || isAtDifferentZSlice;\n\n    overrideViewerState(changeViewerSetting, newState);\n    overrideChannelStates(setChannelSettings, channelSettings, newChannelStates);\n\n    this.channelsToReset = new Set(Array(newChannelStates.length).keys());\n    if (willNeedResetOnLoad) {\n      const enabledChannelsAndResetState = getEnabledChannelIndices(newChannelStates);\n      this.channelsToResetOnLoad = new Set(enabledChannelsAndResetState);\n      for (const channelIndex of enabledChannelsAndResetState) {\n        this.channelsToReset.delete(channelIndex);\n      }\n    }\n  }\n\n  /** Resets to the initial saved state of the viewer, as shown to the user on load. */\n  public resetToSavedViewerState(): void {\n    const { channelSettings } = this.ref.current;\n    const newViewerState = {\n      ...getDefaultViewerState(),\n      cameraState: getDefaultCameraState(this.savedViewerState.viewMode || ViewMode.threeD),\n      ...this.savedViewerState,\n    };\n    const newChannelSettings = channelSettings.map((_, index) => {\n      const initialChannelSetting = initializeOneChannelSetting(\n        channelSettings[index].name,\n        index,\n        getDefaultChannelColor(index),\n        this.savedViewerChannelSettings\n      );\n      return initialChannelSetting;\n    });\n\n    this.resetToState(newViewerState, newChannelSettings);\n    this.useDefaultViewerChannelSettings = false;\n  }\n\n  /** Reset to global default viewer state, as if loading the volume with no parameters. */\n  public resetToDefaultViewerState(): void {\n    const { channelSettings } = this.ref.current;\n    const defaultViewerState = { ...getDefaultViewerState(), cameraState: getDefaultCameraState(ViewMode.threeD) };\n    const defaultChannelStates = channelSettings.map((_, index) => getDefaultChannelState(index));\n\n    for (let i = 0; i < Math.min(3, defaultChannelStates.length); i++) {\n      defaultChannelStates[i].volumeEnabled = true;\n    }\n\n    this.resetToState(defaultViewerState, defaultChannelStates);\n    this.useDefaultViewerChannelSettings = true;\n  }\n}\n","import { isEqual } from \"lodash\";\nimport React, { useCallback, useContext, useEffect, useMemo, useReducer, useRef } from \"react\";\n\nimport { getDefaultViewerChannelSettings, getDefaultViewerState } from \"../../shared/constants\";\nimport { RenderMode, ViewMode } from \"../../shared/enums\";\nimport { ColorArray } from \"../../shared/utils/colorRepresentations\";\nimport { useConstructor } from \"../../shared/utils/hooks\";\nimport type {\n  ChannelSettingUpdater,\n  ChannelState,\n  ChannelStateKey,\n  PartialIfObject,\n  ViewerSettingChangeHandlers,\n  ViewerSettingUpdater,\n  ViewerState,\n  ViewerStateContextType,\n} from \"./types\";\n\nimport ResetStateProvider from \"./ResetStateProvider\";\n\nconst isObject = <T,>(val: T): val is Extract<T, Record<string, unknown>> =>\n  typeof val === \"object\" && val !== null && !Array.isArray(val);\n\n// Some viewer settings require custom change behaviors to change related settings simultaneously or guard against\n// entering an illegal state (e.g. autorotate must not be on in pathtrace mode). Those behaviors are defined here.\nconst VIEWER_SETTINGS_CHANGE_HANDLERS: ViewerSettingChangeHandlers = {\n  // View mode: if we're switching to 2d, switch to volumetric rendering\n  viewMode: (prevSettings, viewMode) => {\n    const switchToVolumetric = viewMode !== ViewMode.threeD && prevSettings.renderMode === RenderMode.pathTrace;\n    return {\n      ...prevSettings,\n      viewMode,\n      renderMode: switchToVolumetric ? RenderMode.volumetric : prevSettings.renderMode,\n    };\n  },\n  // Render mode: if we're switching to pathtrace, turn off autorotate\n  // Also, do not allow pathtrace mode in any mode other than 3D.\n  renderMode: (prevSettings, renderMode) => {\n    if (renderMode === RenderMode.pathTrace && prevSettings.viewMode !== ViewMode.threeD) {\n      return { ...prevSettings };\n    }\n    return {\n      ...prevSettings,\n      renderMode,\n      autorotate: renderMode === RenderMode.pathTrace ? false : prevSettings.autorotate,\n    };\n  },\n  // Autorotate: do not enable autorotate while in pathtrace mode\n  autorotate: (prevSettings, autorotate) => ({\n    ...prevSettings,\n    // The button should theoretically be unclickable while in pathtrace mode, but this provides extra security\n    autorotate: prevSettings.renderMode === RenderMode.pathTrace ? false : autorotate,\n  }),\n};\n\ntype ViewerStateAction<K extends keyof ViewerState> = {\n  key: K;\n  value: PartialIfObject<ViewerState[K]>;\n};\n\nconst viewerSettingsReducer = <K extends keyof ViewerState>(\n  viewerSettings: ViewerState,\n  { key, value }: ViewerStateAction<K>\n): ViewerState => {\n  const changeHandler = VIEWER_SETTINGS_CHANGE_HANDLERS[key];\n\n  if (changeHandler) {\n    // This setting has a custom change handler. Let it handle creating a new state object.\n    return changeHandler(viewerSettings, value);\n  } else {\n    const setting = viewerSettings[key];\n    if (isObject(setting) && isObject(value)) {\n      // This setting is an object, and we may be updating it with a partial object.\n      return { ...viewerSettings, [key]: { ...setting, ...value } };\n    } else {\n      // This setting is regular. Update it the regular way.\n      return { ...viewerSettings, [key]: value };\n    }\n  }\n};\n\nenum ChannelSettingActionType {\n  UniformUpdate = \"UniformUpdate\",\n  ArrayUpdate = \"ArrayUpdate\",\n  Init = \"Init\",\n}\n\n/** Set channel setting `key` on one or more channels specified by `index` to value `value`. */\ntype ChannelSettingUniformUpdateAction<K extends ChannelStateKey> = {\n  type: ChannelSettingActionType.UniformUpdate;\n  index: number | number[];\n  value: Partial<Record<K, ChannelState[K]>>;\n};\n/** Set the values of channel setting `key` for all channels from an array of values ordered by channel index */\ntype ChannelSettingArrayUpdateAction<K extends ChannelStateKey> = {\n  type: ChannelSettingActionType.ArrayUpdate;\n  key: K;\n  value: ChannelState[K][];\n};\n/** Initialize list of channel states */\ntype ChannelSettingInitAction = {\n  type: ChannelSettingActionType.Init;\n  value: ChannelState[];\n};\n\ntype ChannelStateAction<K extends ChannelStateKey> =\n  | ChannelSettingUniformUpdateAction<K>\n  | ChannelSettingArrayUpdateAction<K>\n  | ChannelSettingInitAction;\n\nconst channelSettingsReducer = <K extends ChannelStateKey>(\n  channelSettings: ChannelState[],\n  action: ChannelStateAction<K>\n): ChannelState[] => {\n  if (action.type === ChannelSettingActionType.Init) {\n    // ChannelSettingInitAction\n    return action.value;\n  } else if (action.type === ChannelSettingActionType.ArrayUpdate) {\n    // ChannelSettingArrayUpdateAction\n    return channelSettings.map((channel, idx) => {\n      return action.value[idx] ? { ...channel, [action.key]: action.value[idx] } : channel;\n    });\n  } else {\n    // type is ChannelSettingActionType.UniformUpdate\n    if (Array.isArray(action.index)) {\n      // ChannelSettingUniformUpdateAction on potentially multiple channels\n      return channelSettings.map((channel, idx) =>\n        (action.index as number[]).includes(idx) ? { ...channel, ...action.value } : channel\n      );\n    } else {\n      // ChannelSettingUniformUpdateAction on a single channel\n      const newSettings = channelSettings.slice();\n      if (action.index >= 0 && action.index < channelSettings.length) {\n        newSettings[action.index] = { ...newSettings[action.index], ...action.value };\n      }\n      return newSettings;\n    }\n  }\n};\n\nconst nullfn = (): void => {};\n\nconst DEFAULT_VIEWER_CONTEXT: ViewerStateContextType = {\n  ...getDefaultViewerState(),\n  channelSettings: [],\n  changeViewerSetting: nullfn,\n  setChannelSettings: nullfn,\n  changeChannelSetting: nullfn,\n  applyColorPresets: nullfn,\n  resetToSavedViewerState: nullfn,\n  resetToDefaultViewerState: nullfn,\n  setSavedViewerChannelSettings: nullfn,\n  getCurrentViewerChannelSettings: () => getDefaultViewerChannelSettings(),\n  getChannelsAwaitingReset: () => new Set(),\n  getChannelsAwaitingResetOnLoad: () => new Set(),\n  onResetChannel: nullfn,\n};\n\nexport const ALL_VIEWER_STATE_KEYS = Object.keys(DEFAULT_VIEWER_CONTEXT) as (keyof ViewerStateContextType)[];\n\nconst DEFAULT_VIEWER_CONTEXT_OUTER = { ref: { current: DEFAULT_VIEWER_CONTEXT } };\n\ntype NoNull<T> = { [K in keyof T]: NonNullable<T[K]> };\ntype ContextRefType = NoNull<React.MutableRefObject<ViewerStateContextType>>;\n\nexport const ViewerStateContext = React.createContext<{ ref: ContextRefType }>(DEFAULT_VIEWER_CONTEXT_OUTER);\n\n/** Provides a central store for the state of the viewer, and the methods to update it. */\nconst ViewerStateProvider: React.FC<{ viewerSettings?: Partial<ViewerState>; children?: React.ReactNode }> = (\n  props\n) => {\n  const [viewerSettings, viewerDispatch] = useReducer(viewerSettingsReducer, { ...getDefaultViewerState() });\n  const [channelSettings, channelDispatch] = useReducer(channelSettingsReducer, []);\n  // Provide viewer state via a ref, so that closures that run asynchronously can capture the ref instead of the\n  // specific values they need and always have the most up-to-date state.\n  const ref = useRef(DEFAULT_VIEWER_CONTEXT);\n\n  const resetProvider = useConstructor(() => new ResetStateProvider(ref));\n  useEffect(() => {\n    resetProvider.setSavedViewerState(props.viewerSettings || {});\n  }, [props.viewerSettings, resetProvider]);\n\n  const changeViewerSetting = useCallback<ViewerSettingUpdater>((key, value) => viewerDispatch({ key, value }), []);\n\n  const changeChannelSetting = useCallback<ChannelSettingUpdater>((index, value) => {\n    channelDispatch({ type: ChannelSettingActionType.UniformUpdate, index, value });\n  }, []);\n\n  const applyColorPresets = useCallback(\n    (value: ColorArray[]): void => channelDispatch({ type: ChannelSettingActionType.ArrayUpdate, key: \"color\", value }),\n    []\n  );\n\n  const setChannelSettings = useCallback(\n    (channels: ChannelState[]) => channelDispatch({ type: ChannelSettingActionType.Init, value: channels }),\n    []\n  );\n\n  // https://react.dev/learn/you-might-not-need-an-effect#adjusting-some-state-when-a-prop-changes\n  const prevViewerSettingsPropsRef = useRef<Partial<ViewerState> | undefined>(undefined);\n  if (props.viewerSettings && !isEqual(props.viewerSettings, prevViewerSettingsPropsRef.current)) {\n    for (const key of Object.keys(props.viewerSettings) as (keyof ViewerState)[]) {\n      if (viewerSettings[key] !== props.viewerSettings[key]) {\n        changeViewerSetting(key, props.viewerSettings[key] as any);\n      }\n    }\n    prevViewerSettingsPropsRef.current = props.viewerSettings;\n  }\n\n  const context = useMemo(() => {\n    ref.current = {\n      ...viewerSettings,\n      channelSettings,\n      changeViewerSetting,\n      setChannelSettings,\n      changeChannelSetting,\n      applyColorPresets,\n      // Reset-related callbacks\n      setSavedViewerChannelSettings: resetProvider.setSavedViewerChannelSettings,\n      getCurrentViewerChannelSettings: resetProvider.getCurrentViewerChannelSettings,\n      getChannelsAwaitingReset: resetProvider.getChannelsAwaitingReset,\n      getChannelsAwaitingResetOnLoad: resetProvider.getChannelsAwaitingResetOnLoad,\n      onResetChannel: resetProvider.onResetChannel,\n      resetToSavedViewerState: resetProvider.resetToSavedViewerState,\n      resetToDefaultViewerState: resetProvider.resetToDefaultViewerState,\n    };\n\n    // `ref` is wrapped in another object to ensure that the context updates when state does.\n    // (`ref` on its own would always compare equal to itself and the context would never update.)\n    return { ref };\n  }, [\n    viewerSettings,\n    channelSettings,\n    applyColorPresets,\n    changeViewerSetting,\n    changeChannelSetting,\n    setChannelSettings,\n    resetProvider,\n  ]);\n\n  return <ViewerStateContext.Provider value={context}>{props.children}</ViewerStateContext.Provider>;\n};\n\n/**\n * Higher-order component that connects a component to the viewer state context.\n *\n * Accepts a `component` and an array of `keys` from the viewer state context, and returns a new memoized component\n * which \"subscribes\" to only those fields of state, and will not re-render if other fields change. This works by\n * creating a component which is \"split in two\" as described\n * [here](https://react.dev/reference/react/memo#updating-a-memoized-component-using-a-context).\n *\n * NOTE that while higher-order components don't seem to be explicitly considered an anti-pattern, they don't appear in\n * modern documentation because they are \"[not commonly used in modern React\n * code](https://legacy.reactjs.org/docs/higher-order-components.html).\" React-redux, which inspired this \"connect\"\n * pattern, has also generally moved away from this pattern [in favor of a hooks-based\n * approach](https://react-redux.js.org/api/hooks). I too would love to use hooks to connect to viewer state, but there\n * is currently no way to hook into context without agreeing to re-render on every change. I feel okay using a higher-\n * order component in this case because, analogous to a custom hook, it extends a provided primitive HOC (`memo`).\n */\nexport function connectToViewerState<\n  Keys extends keyof ViewerStateContextType,\n  Props extends Pick<ViewerStateContextType, Keys>,\n>(component: React.FC<Props>, keys: Keys[]): React.FC<Omit<Props, Keys>> {\n  const MemoedComponent = React.memo(component);\n\n  const ConnectedComponent: React.FC<Omit<Props, Keys>> = (props) => {\n    const viewerState = useContext(ViewerStateContext);\n\n    const mergedProps = { ...props } as Props;\n    for (const key of keys) {\n      (mergedProps as Pick<ViewerStateContextType, Keys>)[key] = viewerState.ref.current[key];\n    }\n\n    return <MemoedComponent {...mergedProps} />;\n  };\n\n  ConnectedComponent.displayName = `Connected(${component.displayName || component.name})`;\n  return ConnectedComponent;\n}\n\nexport default ViewerStateProvider;\n","import { MutableRefObject, useCallback, useRef } from \"react\";\n\n/**\n * Wraps a setter function and keeps a ref updated to follow the set value. Useful for making the most up-to-date value\n * of some state accessible to a closure that might be called after the value is updated.\n */\n// TODO should this replace `useStateWithGetter`?\nexport function useRefWithSetter<T>(setter: (value: T) => void): [MutableRefObject<T | undefined>, (value: T) => void];\nexport function useRefWithSetter<T>(setter: (value: T) => void, init: T): [MutableRefObject<T>, (value: T) => void];\nexport function useRefWithSetter<T>(\n  setter: (value: T) => void,\n  init?: T\n): [MutableRefObject<T | undefined>, (value: T) => void] {\n  const value = useRef<T | undefined>(init);\n  const wrappedSetter = useCallback(\n    (newValue: T) => {\n      value.current = newValue;\n      setter(newValue);\n    },\n    [setter, value]\n  );\n  return [value, wrappedSetter];\n}\n\n/**\n * For objects which are persistent for the lifetime of the component, not\n * a member of state, and require a constructor to create. Wraps `useRef`.\n */\nexport function useConstructor<T>(constructor: () => T): T {\n  const value = useRef<T | null>(null);\n  if (value.current === null) {\n    value.current = constructor();\n  }\n  return value.current;\n}\n","import { ControlPoint } from \"@aics/vole-core\";\n\nimport { OTHER_CHANNEL_KEY, SINGLE_GROUP_CHANNEL_KEY } from \"../constants\";\n\n/** Settings for a single channel, as passed in via props by App users */\nexport interface ViewerChannelSetting {\n  // regex or string or array of regexes or strings or number for raw channel index\n  // if you want to match on channel index, then you must provide the index here.\n  match: (string | number)[] | string | number;\n\n  // name is the display name for this channel.\n  // if name is not given, use raw data channel name for display\n  name?: string;\n\n  // 6 digit hex rrggbb. defaults to auto-assigned by app\n  color?: string;\n  // default to false\n  enabled?: boolean;\n  // default to false\n  surfaceEnabled?: boolean;\n  /**\n   * Min and max values for the intensity lookup table, which maps from raw intensity values\n   * in the volume to opacity and color. Defaults to [0, 255].\n   *\n   * - Plain numbers are treated as direct intensity values.\n   * - `p{n}` represents a percentile, where `n` is a percentile in the [0, 100] range.\n   * - `m{n}` represents the median multiplied by `n / 100`.\n   * - `autoij` in either the min or max fields will use the \"auto\" algorithm\n   * from ImageJ to select the min and max.\n   */\n  lut?: [string, string];\n  /**\n   * Whether to show control point controls instead of a simpler ramp control.\n   * Defaults to false.\n   */\n  controlPointsEnabled?: boolean;\n  controlPoints?: ControlPoint[];\n  ramp?: [number, number];\n  // valid when surfaceEnabled = true. default 128 or 0.5 of max intensity range\n  isovalue?: number;\n  // valid when surfaceEnabled = true. default 1.0 fully opaque\n  surfaceOpacity?: number;\n  colorizeEnabled?: boolean;\n  colorizeAlpha?: number;\n}\n\nexport interface ViewerChannelGroup {\n  name: string;\n  channels: ViewerChannelSetting[];\n}\n\nexport interface ViewerChannelSettings {\n  maskChannelName?: string;\n  groups: ViewerChannelGroup[];\n}\n\nexport type ChannelGrouping = { [key: string]: number[] };\n\nexport function matchChannel(channelName: string, channelIndex: number, c: ViewerChannelSetting): boolean {\n  // c could be a number, an array of (strings or numbers), or a single regex\n  if (typeof c.match === \"number\") {\n    if (c.match === channelIndex) {\n      return true;\n    }\n  } else if (Array.isArray(c.match)) {\n    for (const r of c.match) {\n      if (typeof r === \"number\") {\n        if (r === channelIndex) {\n          return true;\n        }\n      } else {\n        const re = new RegExp(r);\n        if (re.test(channelName)) {\n          return true;\n        }\n      }\n    }\n  } else if (typeof c.match === \"string\") {\n    const re = new RegExp(c.match);\n    if (re.test(channelName)) {\n      return true;\n    }\n  } else {\n    throw new Error(\n      \"match is required for channel settings groups, and must be a string, number, or array of strings or numbers\"\n    );\n  }\n  return false;\n}\n\nfunction findFirstChannelMatchOfGroup(\n  channel: string,\n  channelIndex: number,\n  g: ViewerChannelGroup\n): ViewerChannelSetting | undefined {\n  for (const c of g.channels) {\n    if (matchChannel(channel, channelIndex, c)) {\n      return c;\n    }\n  }\n  return undefined;\n}\n\nexport function findFirstChannelMatch(\n  channel: string,\n  channelIndex: number,\n  settings: ViewerChannelSettings\n): ViewerChannelSetting | undefined {\n  if (!settings.groups) {\n    return undefined;\n  }\n  for (const g of settings.groups) {\n    const c = findFirstChannelMatchOfGroup(channel, channelIndex, g);\n    if (c !== undefined) {\n      return c;\n    }\n  }\n  return undefined;\n}\n\nexport function getDisplayName(name: string, index: number, settings?: ViewerChannelSettings): string {\n  if (settings) {\n    const c = findFirstChannelMatch(name, index, settings);\n    if (c) {\n      return c.name || name;\n    }\n  }\n  return name;\n}\n\nexport function makeChannelIndexGrouping(channels: string[], settings?: ViewerChannelSettings): ChannelGrouping {\n  if (!channels) {\n    return {};\n  }\n  if (!settings) {\n    // return all channels\n    return { [SINGLE_GROUP_CHANNEL_KEY]: channels.map((_val, index) => index) };\n  }\n\n  const groups = settings.groups;\n  const grouping: ChannelGrouping = {};\n  const channelsMatched: number[] = [];\n  // this is kinda inefficient but we want to ensure the order as specified in viewerChannelSettings\n  if (groups !== undefined) {\n    for (const g of groups) {\n      grouping[g.name] = [];\n      g.channels.forEach((groupMatch) => {\n        // check all channels against the match\n        channels.forEach((channel, index) => {\n          // make sure channel was not already matched someplace.\n          if (!channelsMatched.includes(index)) {\n            if (matchChannel(channel, index, groupMatch)) {\n              grouping[g.name].push(index);\n              channelsMatched.push(index);\n            }\n          }\n        });\n      });\n    }\n  }\n  // now any channels not still matched go in the catchall group.\n  if (channelsMatched.length < channels.length) {\n    const remainderGroupName = groups.length === 0 ? SINGLE_GROUP_CHANNEL_KEY : OTHER_CHANNEL_KEY;\n    grouping[remainderGroupName] = [];\n    channels.forEach((channel, index) => {\n      // make sure channel was not already matched someplace.\n      if (!channelsMatched.includes(index)) {\n        grouping[remainderGroupName].push(index);\n      }\n    });\n  }\n  return grouping;\n}\n","import { ChannelState, ViewerSettingUpdater, ViewerState } from \"../../components/ViewerStateProvider/types\";\nimport { getDefaultChannelState } from \"../constants\";\nimport { ColorArray } from \"./colorRepresentations\";\nimport {\n  findFirstChannelMatch,\n  getDisplayName,\n  ViewerChannelSetting,\n  ViewerChannelSettings,\n} from \"./viewerChannelSettings\";\n\n/** Sets all fields of the viewer state to the values of the `newState`. */\nexport function overrideViewerState(changeViewerSetting: ViewerSettingUpdater, newState: ViewerState): void {\n  for (const key of Object.keys(newState) as (keyof ViewerState)[]) {\n    changeViewerSetting(key, newState[key] as any);\n  }\n\n  // Pathtrace rendering is not allowed in 2D view mode but is in 3D mode.\n  // Since we're not guaranteed on the order of object keys, apply changes to render mode a second time\n  // in case we were previously in 2D view mode and the change was blocked, but we're now in 3D.\n  changeViewerSetting(\"renderMode\", newState.renderMode);\n}\n\nexport function overrideChannelStates(\n  setChannelSettings: (settings: ChannelState[]) => void,\n  currentStates: ChannelState[],\n  newStates: ChannelState[]\n): void {\n  // Match the names in the new state with the existing state so we do not override the names.\n  // Also don't reset the control points or ramps, since these will be reset in the app.\n  for (let i = 0; i < newStates.length; i++) {\n    newStates[i].name = currentStates[i].name;\n    newStates[i].controlPoints = currentStates[i].controlPoints;\n    newStates[i].ramp = currentStates[i].ramp;\n  }\n  setChannelSettings(newStates);\n}\n\n/** Returns the indices of channels that have either the volume or isosurface enabled. */\nexport function getEnabledChannelIndices(channelSettings: ChannelState[]): number[] {\n  const enabledChannels = [];\n  for (let i = 0; i < channelSettings.length; i++) {\n    if (channelSettings[i].volumeEnabled || channelSettings[i].isosurfaceEnabled) {\n      enabledChannels.push(i);\n    }\n  }\n  return enabledChannels;\n}\n\nexport function colorHexToArray(hex: string): ColorArray | null {\n  // hex is a xxxxxx string. split it into array of rgb ints\n  const result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n  if (result) {\n    return [parseInt(result[1], 16), parseInt(result[2], 16), parseInt(result[3], 16)];\n  } else {\n    return null;\n  }\n}\n\nexport function initializeOneChannelSetting(\n  channelName: string,\n  index: number,\n  defaultColor: ColorArray,\n  viewerChannelSettings?: ViewerChannelSettings,\n  defaultChannelState: ChannelState = getDefaultChannelState()\n): ChannelState {\n  let initSettings = {} as Partial<ViewerChannelSetting>;\n  if (viewerChannelSettings) {\n    // search for channel in settings using groups, names and match values\n    initSettings = findFirstChannelMatch(channelName, index, viewerChannelSettings) ?? {};\n  }\n\n  return {\n    name: channelName ?? \"Channel \" + index,\n    displayName: getDisplayName(channelName ?? \"Channel \" + index, index, viewerChannelSettings),\n    volumeEnabled: initSettings.enabled ?? defaultChannelState.volumeEnabled,\n    isosurfaceEnabled: initSettings.surfaceEnabled ?? defaultChannelState.isosurfaceEnabled,\n    colorizeEnabled: initSettings.colorizeEnabled ?? defaultChannelState.colorizeEnabled,\n    colorizeAlpha: initSettings.colorizeAlpha ?? defaultChannelState.colorizeAlpha,\n    isovalue: initSettings.isovalue ?? defaultChannelState.isovalue,\n    opacity: initSettings.surfaceOpacity ?? defaultChannelState.opacity,\n    color: colorHexToArray(initSettings.color ?? \"\") ?? defaultColor,\n    useControlPoints: initSettings.controlPointsEnabled ?? defaultChannelState.useControlPoints,\n    controlPoints: initSettings.controlPoints ?? defaultChannelState.controlPoints,\n    ramp: initSettings.ramp ?? defaultChannelState.ramp,\n    plotMin: defaultChannelState.plotMin,\n    plotMax: defaultChannelState.plotMax,\n  };\n}\n","import { CSSProperties } from \"react\";\n\nimport { ViewMode } from \"./enums\";\n\nexport type AxisName = \"x\" | \"y\" | \"z\";\nexport type PerAxis<T> = Record<AxisName, T>;\nexport const activeAxisMap: { [A in ViewMode]: AxisName | null } = {\n  [ViewMode.yz]: \"x\",\n  [ViewMode.xz]: \"y\",\n  [ViewMode.xy]: \"z\",\n  [ViewMode.threeD]: null,\n};\n\nexport type IsosurfaceFormat = \"GLTF\" | \"STL\";\n\nexport type Styles = { [key: string]: CSSProperties };\n\nexport type MetadataEntry = string | number | boolean | MetadataRecord | MetadataEntry[] | null | undefined;\nexport type MetadataRecord = { [key: string]: MetadataEntry };\n","export type ColorObject = { r: number; g: number; b: number };\nexport type ColorArray = [number, number, number];\n\nexport const colorObjectToArray = (obj: ColorObject): ColorArray => [obj.r, obj.g, obj.b];\n\nexport const colorArrayToObject = (arr: ColorArray): ColorObject => ({ r: arr[0], g: arr[1], b: arr[2] });\n\nexport const colorArrayToFloats = (arr: ColorArray): ColorArray => [arr[0] / 255, arr[1] / 255, arr[2] / 255];\n\nexport const colorArrayToString = (arr: ColorArray): string => `rgb(${arr[0]}, ${arr[1]}, ${arr[2]})`;\n","import { Channel, ControlPoint, Histogram, Lut, remapControlPoints, Volume } from \"@aics/vole-core\";\n\nimport { LUT_MAX_PERCENTILE, LUT_MIN_PERCENTILE, TFEDITOR_DEFAULT_COLOR, TFEDITOR_MAX_BIN } from \"../constants\";\nimport { findFirstChannelMatch, ViewerChannelSetting, ViewerChannelSettings } from \"./viewerChannelSettings\";\n\n// @param {Object[]} controlPoints - array of {x:number, opacity:number, color:string}\n// @return {Uint8Array} array of length 256*4 representing the rgba values of the gradient\nexport function controlPointsToLut(controlPoints: ControlPoint[]): Lut {\n  const lut = new Lut().createFromControlPoints(controlPoints);\n  return lut;\n}\n\n/** Returns a default lookup table based on a min/max percentile of the current volume's data. */\nexport function getDefaultLut(histogram: Histogram): Lut {\n  const hmin = histogram.findBinOfPercentile(LUT_MIN_PERCENTILE);\n  const hmax = histogram.findBinOfPercentile(LUT_MAX_PERCENTILE);\n  return new Lut().createFromMinMax(hmin, hmax);\n}\n\n/**\n * Parses a single LUT value from a string, where the value is either a number, a percentile, or a median multiplier.\n */\nfunction parseLutValue(value: string, histogram: Histogram): number {\n  // look at first char of string.\n  const firstChar = value.charAt(0);\n  if (firstChar === \"m\") {\n    // median\n    const parsedValue = parseFloat(value.substring(1)) / 100.0;\n    return histogram.maxBin * parsedValue;\n  } else if (firstChar === \"p\") {\n    // percentile\n    const parsedValue = parseFloat(value.substring(1)) / 100.0;\n    return histogram.findBinOfPercentile(parsedValue);\n  } else {\n    // plain number\n    return parseFloat(value);\n  }\n}\n\n/**\n * Parses a lookup table (LUT) from a `ViewerChannelSetting` object, where the `lut` field is an\n * array of two alphanumeric strings.\n *\n * @returns a Lut object if the `lut` field is valid; otherwise, returns undefined.\n *\n * Min and max values are determined as following:\n * - Plain numbers are direct intensity values.\n * - `p{n}` represents a percentile, where `n` is a percentile in the [0, 100] range.\n * - `m{n}` represents the median multiplied by `n / 100`.\n * - `autoij` in either the min or max fields will use the \"auto\" algorithm\n * from ImageJ to select the min AND max.\n *\n * @example\n * ```\n * \"0:255\"    // min: intensity 0, max: intensity 255.\n * \"p50:p90\"  // min: 50th percentile, max: 90th percentile.\n * \"m1:p75\"   // min: median, max: 75th percentile.\n * \"autoij:0\" // use Auto-IJ to calculate min and max.\n * ```\n */\nexport function parseLutFromSettings(histogram: Histogram, initSettings: ViewerChannelSetting): Lut | undefined {\n  if (initSettings.lut === undefined || initSettings.lut.length !== 2) {\n    return undefined;\n  }\n\n  let lutValues: [number, number];\n  if (initSettings.lut[0] === \"autoij\" || initSettings.lut[1] === \"autoij\") {\n    lutValues = histogram.findAutoIJBins();\n  } else {\n    lutValues = [parseLutValue(initSettings.lut[0], histogram), parseLutValue(initSettings.lut[1], histogram)];\n  }\n  return new Lut().createFromMinMax(Math.min(lutValues[0], lutValues[1]), Math.max(lutValues[0], lutValues[1]));\n}\n\n/**\n * Initializes the lookup table (LUT) that maps from volume intensity values to color + opacity and applies the LUT to the volume.\n *\n * @param aimg The loaded volume data.\n * @param channelIndex The index of the channel to initialize the LUT for.\n * @param channelSettings The ViewerChannelSettings object that may contain settings for this channel. If relevant\n * settings are not found, a default LUT will be used.\n * @returns an object containing the retrieved ramp control points and \"advanced mode\" control points.\n *\n * LUT values will be determined using the following rules:\n * - If no `lut` is provided in the `channelSettings`, a default LUT is calculated using min/max percentiles of the data.\n * - Otherwise, `lut` will be parsed as described in `ViewerChannelSettingParams.lut`.\n * - The `controlPoints` and `ramp` fields in the `channelSettings` will be used to override the returned \"advanced mode\"\n * control points and ramp, respectively.\n *\n * If `controlPointsEnabled` is set to true in the `channelSettings`, the \"advanced mode\" control points will be applied\n * to the volume; otherwise, the ramp will be applied.\n */\nexport function initializeLut(\n  aimg: Volume,\n  channelIndex: number,\n  channelSettings?: ViewerChannelSettings\n): { ramp: ControlPoint[]; controlPoints: ControlPoint[] } {\n  const histogram = aimg.getHistogram(channelIndex);\n  const defaultLut = getDefaultLut(histogram);\n\n  let ramp: ControlPoint[] = [];\n  let controlPoints: ControlPoint[] = [];\n  let lut = defaultLut;\n\n  const name = aimg.channelNames[channelIndex];\n  const initSettings = channelSettings && findFirstChannelMatch(name, channelIndex, channelSettings);\n\n  // Attempt to load a LUT from the settings, which will be used to initialize the control points and ramp\n  if (initSettings && initSettings.lut) {\n    lut = parseLutFromSettings(histogram, initSettings) ?? defaultLut;\n  }\n  // Initialize the control points + ramp using the LUT.\n  // Optionally, override the LUT's control points with the provided control points and/or ramp.\n  controlPoints = initSettings?.controlPoints ?? [...lut.controlPoints];\n  ramp = initSettings?.ramp ? rampToControlPoints(initSettings.ramp) : [...lut.controlPoints];\n\n  // Apply whatever lut is currently visible\n  let visibleLut: Lut;\n  if (initSettings?.controlPointsEnabled) {\n    visibleLut = new Lut().createFromControlPoints(controlPoints);\n  } else {\n    visibleLut = new Lut().createFromControlPoints(ramp);\n  }\n\n  aimg.setLut(channelIndex, visibleLut);\n  return { ramp, controlPoints };\n}\n\nexport function controlPointsToRamp(controlPoints: ControlPoint[]): [number, number] {\n  if (controlPoints.length <= 1) {\n    return [0, TFEDITOR_MAX_BIN];\n  } else if (controlPoints.length === 2) {\n    return [controlPoints[0].x, controlPoints[1].x];\n  } else if (controlPoints.length === 3) {\n    if (\n      controlPoints[0].opacity !== controlPoints[1].opacity &&\n      controlPoints[0].opacity !== controlPoints[2].opacity &&\n      controlPoints[1].opacity !== controlPoints[2].opacity\n    ) {\n      // if all 3 are unequal, assume a ramp from first to last\n      return [controlPoints[0].x, controlPoints[2].x];\n    } else if (controlPoints[0].opacity !== controlPoints[1].opacity) {\n      return [controlPoints[0].x, controlPoints[1].x];\n    } else if (controlPoints[1].opacity !== controlPoints[2].opacity) {\n      return [controlPoints[1].x, controlPoints[2].x];\n    }\n  }\n  return [controlPoints[1].x, controlPoints[controlPoints.length - 2].x];\n}\n\nexport function rampToControlPoints([min, max]: [number, number]): ControlPoint[] {\n  return [\n    { x: Math.min(min - 1, 0), opacity: 0, color: TFEDITOR_DEFAULT_COLOR },\n    { x: min, opacity: 0, color: TFEDITOR_DEFAULT_COLOR },\n    { x: max, opacity: 1, color: TFEDITOR_DEFAULT_COLOR },\n    { x: Math.max(max + 1, TFEDITOR_MAX_BIN), opacity: 1, color: TFEDITOR_DEFAULT_COLOR },\n  ];\n}\n\n/** Remaps an array of control points from an old range (as a 2-tuple) to a new one (extracted from a `Channel`) */\nexport function remapControlPointsForChannel(\n  controlPoints: ControlPoint[],\n  oldRange: [number, number] | undefined,\n  { rawMin, rawMax }: Channel\n): ControlPoint[] {\n  if (oldRange === undefined) {\n    return controlPoints;\n  }\n\n  return remapControlPoints(controlPoints, oldRange[0], oldRange[1], rawMin, rawMax);\n}\n","import { AxisName } from \"../types\";\n\ntype PlayAxisName = AxisName | \"t\";\n\nconst PLAY_STEP_INTERVAL_MS = 125;\n\nexport default class PlayControls {\n  playingAxis: PlayAxisName | null = null;\n  playWaitingForLoad = false;\n  playHolding = false;\n  playTimeoutId = 0;\n\n  public getVolumeIsLoaded?: () => boolean;\n  public stepAxis?: (axis: PlayAxisName) => void;\n  public onPlayingAxisChanged?: (axis: PlayAxisName | null) => void;\n\n  private setPlayingAxis(axis: PlayAxisName | null): void {\n    this.playingAxis = axis;\n    this.onPlayingAxisChanged?.(axis);\n  }\n\n  private playStep(): void {\n    if (!this.playingAxis || this.playHolding || !this.stepAxis) {\n      return;\n    }\n    // If the volume is not loaded, wait for it to load before continuing\n    if (!this.getVolumeIsLoaded?.()) {\n      this.playWaitingForLoad = true;\n      return;\n    }\n\n    this.stepAxis(this.playingAxis);\n    this.playTimeoutId = window.setTimeout(this.playStep.bind(this), PLAY_STEP_INTERVAL_MS);\n  }\n\n  /** Call whenever new data is loaded to resume playback if it was paused for data loading. */\n  onImageLoaded(): void {\n    if (this.playWaitingForLoad) {\n      this.playWaitingForLoad = false;\n      this.playStep();\n    }\n  }\n\n  /**\n   * Pause playback on the currently playing axis.\n   * `willResume` marks this as a temporary suspension, e.g. while the user is scrubbing along the playing axis.\n   */\n  pause(willResume: boolean = false): void {\n    window.clearTimeout(this.playTimeoutId);\n    this.playTimeoutId = 0;\n    this.playWaitingForLoad = false;\n    if (this.playingAxis !== null && !willResume) {\n      this.playHolding = false;\n      this.setPlayingAxis(null);\n    }\n  }\n\n  /** Begin playback on `axis`. */\n  play(axis: PlayAxisName): void {\n    if (this.playingAxis !== null) {\n      this.pause(true);\n    }\n    this.setPlayingAxis(axis);\n    this.playStep();\n  }\n\n  /** If `axis` is currently playing, begin a temporary hold on playback while other input is pending. */\n  startHold(axis: PlayAxisName): void {\n    this.playHolding = true;\n    this.pause(axis === this.playingAxis);\n  }\n\n  /** If a playback hold is active, end it. */\n  endHold(): void {\n    if (this.playHolding) {\n      this.playHolding = false;\n      this.playStep();\n    }\n  }\n}\n","import {\n  CreateLoaderOptions,\n  LoadSpec,\n  PerChannelCallback,\n  PrefetchDirection,\n  RawArrayLoaderOptions,\n  Volume,\n  VolumeLoaderContext,\n} from \"@aics/vole-core\";\nimport { ThreadableVolumeLoader } from \"@aics/vole-core/es/types/loaders/IVolumeLoader\";\n\nexport default class SceneStore {\n  context: VolumeLoaderContext;\n  loaders: (ThreadableVolumeLoader | undefined)[];\n  paths: (string | string[] | RawArrayLoaderOptions)[];\n  currentScene: number = 0;\n  syncChannels: boolean = false;\n  prefetchPriority: PrefetchDirection[] = [];\n\n  constructor(context: VolumeLoaderContext, paths: (string | string[] | RawArrayLoaderOptions)[]) {\n    this.paths = paths;\n    this.context = context;\n    this.loaders = new Array(paths.length).fill(undefined);\n  }\n\n  /** Get the loader associated with the given scene index, or create it if it doesn't exist */\n  private async getLoader(scene: number): Promise<ThreadableVolumeLoader> {\n    this.currentScene = scene;\n    let loader = this.loaders[scene];\n\n    if (!loader) {\n      let path = this.paths[scene];\n      let options: Partial<CreateLoaderOptions> = {};\n      if (typeof path === \"object\" && !Array.isArray(path)) {\n        options.rawArrayOptions = path;\n        path = \"\";\n      }\n\n      await this.context.onOpen();\n      loader = await this.context.createLoader(path, options);\n      this.loaders[scene] = loader;\n    }\n\n    loader.syncMultichannelLoading(this.syncChannels);\n    loader.setPrefetchPriority(this.prefetchPriority);\n    return loader;\n  }\n\n  public async loadScene(\n    scene: number,\n    image: Volume,\n    loadSpec?: LoadSpec,\n    onChannelLoaded?: PerChannelCallback\n  ): Promise<void> {\n    const loader = await this.getLoader(scene);\n    const spec = loadSpec ?? image.loadSpecRequired;\n\n    image.loader = loader;\n    image.imageInfo.imageInfo = (await loader.createImageInfo(spec)).imageInfo;\n    loader.loadVolumeData(image, spec, onChannelLoaded);\n  }\n\n  public async createVolume(scene: number, loadSpec: LoadSpec, onChannelLoaded?: PerChannelCallback): Promise<Volume> {\n    const loader = await this.getLoader(scene);\n    return loader.createVolume(loadSpec, onChannelLoaded);\n  }\n\n  public syncMultichannelLoading(sync: boolean): void {\n    this.syncChannels = sync;\n    const currentLoader = this.loaders[this.currentScene];\n    if (currentLoader) {\n      currentLoader.syncMultichannelLoading(sync);\n    }\n  }\n\n  public setPrefetchPriority(priority: PrefetchDirection[]): void {\n    this.prefetchPriority = priority;\n    const currentLoader = this.loaders[this.currentScene];\n    if (currentLoader) {\n      currentLoader.setPrefetchPriority(priority);\n    }\n  }\n}\n","import { LoadSpec, RawArrayLoaderOptions, View3d, Volume, VolumeLoaderContext } from \"@aics/vole-core\";\nimport { useCallback, useContext, useEffect, useMemo, useRef, useState } from \"react\";\nimport { Box3, Vector3 } from \"three\";\n\nimport {\n  AXIS_TO_LOADER_PRIORITY,\n  CACHE_MAX_SIZE,\n  getDefaultChannelColor,\n  QUEUE_MAX_LOW_PRIORITY_SIZE,\n  QUEUE_MAX_SIZE,\n} from \"../shared/constants\";\nimport { ViewMode } from \"../shared/enums\";\nimport { AxisName } from \"../shared/types\";\nimport { useConstructor, useRefWithSetter } from \"../shared/utils/hooks\";\nimport PlayControls from \"../shared/utils/playControls\";\nimport SceneStore from \"../shared/utils/sceneStore\";\nimport { ChannelGrouping, getDisplayName, makeChannelIndexGrouping } from \"../shared/utils/viewerChannelSettings\";\nimport { initializeOneChannelSetting } from \"../shared/utils/viewerState\";\nimport { ChannelState } from \"./ViewerStateProvider/types\";\n\nimport { ViewerStateContext } from \"./ViewerStateProvider\";\n\nexport type UseVolumeOptions = {\n  /** Callback for when a single channel of the volume has loaded. */\n  onChannelLoaded?: (image: Volume, channelIndex: number, isInitialLoad: boolean) => void;\n  /** Callback for when image loading encounters an error. */\n  onError?: (error: unknown) => void;\n  /** The name of a channel which should be treated as a mask rather than as viewable data. */\n  maskChannelName?: string;\n};\n\nexport const enum ImageLoadStatus {\n  REQUESTED,\n  LOADING,\n  LOADED,\n  ERROR,\n}\n\n// Used by `channelVersions` (see below)\nconst CHANNEL_INITIAL_LOAD = -1;\nconst CHANNEL_RELOAD = 0;\n\nexport type ReactiveVolume = {\n  image: Volume | null;\n  /**\n   * Indicates the load status of each channel:\n   *\n   * - `-1` indicates the channel has not yet loaded and will get some extra initialization (e.g. LUTs) when it loads.\n   * - `0` indicates the channel has been loaded once, but is currently waiting for new data.\n   * - `1` or greater indicates the channel is loaded. Note this is not exactly `1` to handle multiple simultaneous\n   *   loads; if multiple loads are issued before the first one completes, _incrementing_ rather than _setting_ the\n   *   version number means we react to each load when it completes, rather than just the first.\n   */\n  channelVersions: number[];\n  imageLoadStatus: ImageLoadStatus;\n  setTime: (view3d: View3d, time: number) => void;\n  setScene: (scene: number) => void;\n  playControls: PlayControls;\n  playingAxis: AxisName | \"t\" | null;\n  channelGroupedByType: ChannelGrouping;\n};\n\n/**\n * Temporary hack while `useEffectEvent` is still experimental.\n *\n * Some functions play the role of event handlers (called to notify that something has happened) _within_ an effect.\n * Without any intervention, the linter will insist the function needs to be in the effect's dependencies, even though\n * it would make no sense to re-run the effect when the handler changes. So we hide the function behind a stable ref.\n *\n * See https://react.dev/learn/separating-events-from-effects#declaring-an-effect-event\n */\nconst useEffectEventRef = <T extends undefined | ((...args: any[]) => void)>(\n  callback: T\n): React.MutableRefObject<T> => {\n  const callbackRef = useRef<T>(callback);\n  useEffect(() => {\n    callbackRef.current = callback;\n  }, [callback]);\n  return callbackRef;\n};\n\n/**\n * Hook to open a volume from one or more sources (URLs or raw data) and provide controls for (re)loading and playback.\n *\n * @param scenePaths An array of volume data sources, one per scene. These can be:\n * - a string URL to a single source, or\n * - an array of strings to load multiple sources as a single volume, or\n * - a `RawArrayLoaderOptions` object to load raw data directly.\n * @param options An optional object with callbacks and other info. See docs for `UseVolumeOptions`.\n * @returns An object with the current image, its load status, and controls for playback and loading.\n */\nconst useVolume = (\n  scenePaths: (string | string[] | RawArrayLoaderOptions)[],\n  options?: UseVolumeOptions\n): ReactiveVolume => {\n  const viewerStateRef = useContext(ViewerStateContext).ref;\n  const onErrorRef = useEffectEventRef(options?.onError);\n  const onChannelLoadedRef = useEffectEventRef(options?.onChannelLoaded);\n  const maskChannelName = options?.maskChannelName;\n\n  // set up our big objects: the image, its loading infrastructure, and controls for playback\n  const [image, setImage] = useState<Volume | null>(null);\n  const loadContext = useConstructor(\n    () => new VolumeLoaderContext(CACHE_MAX_SIZE, QUEUE_MAX_SIZE, QUEUE_MAX_LOW_PRIORITY_SIZE)\n  );\n  const sceneLoader = useMemo(() => new SceneStore(loadContext, scenePaths), [loadContext, scenePaths]);\n  const playControls = useConstructor(() => new PlayControls());\n  const [playingAxis, setPlayingAxis] = useState<AxisName | \"t\" | null>(null);\n  useEffect(() => {\n    playControls.onPlayingAxisChanged = (axis) => {\n      const isPlaying = axis !== null;\n      setPlayingAxis(axis);\n      // prioritize prefetching along the playing axis\n      sceneLoader.setPrefetchPriority(axis ? [AXIS_TO_LOADER_PRIORITY[axis]] : []);\n      // sync multichannel loading so we don't show loaded channels one at a time\n      sceneLoader.syncMultichannelLoading(isPlaying);\n      if (image) {\n        // If we're playing and entire axis is not in memory (T always, Z likely), downlevel to speed things up\n        const { volumeSize, subregionSize } = image.imageInfo;\n        const shouldDownlevel = isPlaying && (axis === \"t\" || volumeSize[axis] !== subregionSize[axis]);\n        image.updateRequiredData({ scaleLevelBias: shouldDownlevel ? 1 : 0 });\n      }\n    };\n  }, [sceneLoader, playControls, image]);\n\n  // track which channels have been loaded\n  const [channelVersions, _setChannelVersions] = useState<number[]>([]);\n  const [channelVersionsRef, setChannelVersions] = useRefWithSetter(_setChannelVersions, channelVersions);\n\n  const { channelSettings } = viewerStateRef.current;\n  // Some extra items for tracking load status\n  const [loadThrewError, setLoadThrewError] = useState(false);\n  const inInitialLoadRef = useRef(true);\n\n  // derive whether the image is loaded from whether any and/or all channels are loaded\n  const imageLoadStatus = useMemo(() => {\n    if (loadThrewError) {\n      return ImageLoadStatus.ERROR;\n    }\n\n    const [allLoaded, noneLoaded] = channelVersions.reduce(\n      ([allLoaded, noneLoaded], version, idx) => {\n        const setting = channelSettings[idx];\n        if (setting && (setting.volumeEnabled || setting.isosurfaceEnabled || maskChannelName === setting.name)) {\n          const loaded = version > 0;\n          return [allLoaded && loaded, noneLoaded && !loaded];\n        }\n        return [allLoaded, noneLoaded];\n      },\n      [true, true]\n    );\n\n    if (allLoaded && inInitialLoadRef.current) {\n      inInitialLoadRef.current = false;\n    }\n\n    return noneLoaded ? ImageLoadStatus.REQUESTED : allLoaded ? ImageLoadStatus.LOADED : ImageLoadStatus.LOADING;\n  }, [channelVersions, channelSettings, maskChannelName, loadThrewError]);\n\n  const setIsLoading = useCallback(() => {\n    setLoadThrewError(false);\n    setChannelVersions(channelVersionsRef.current.map((version) => Math.min(version, CHANNEL_RELOAD)));\n  }, [channelVersionsRef, setChannelVersions]);\n\n  const onError = useCallback(\n    (e: unknown): never => {\n      setLoadThrewError(true);\n      onErrorRef.current?.(e);\n      throw e;\n    },\n    [onErrorRef]\n  );\n\n  // channel indexes, sorted by category\n  const [channelGroupedByType, setChannelGroupedByType] = useState<ChannelGrouping>({});\n\n  const onChannelDataLoaded = useCallback(\n    (aimg: Volume, channelIndex: number): void => {\n      // let the hook caller know that this channel has loaded\n      const isInitialLoad = channelVersionsRef.current[channelIndex] === CHANNEL_INITIAL_LOAD;\n      onChannelLoadedRef.current?.(aimg, channelIndex, isInitialLoad);\n\n      // set this channel as loaded\n      const newVersions = channelVersionsRef.current.slice();\n      newVersions[channelIndex] = Math.max(newVersions[channelIndex], CHANNEL_RELOAD) + 1;\n      setChannelVersions(newVersions);\n\n      // if the whole image has loaded, let `playControls` know (if we're playing, it may want to go to the next frame)\n      if (aimg.isLoaded()) {\n        playControls.onImageLoaded();\n      }\n    },\n    [channelVersionsRef, onChannelLoadedRef, playControls, setChannelVersions]\n  );\n\n  // effect to start the initial load of the image\n  useEffect(() => {\n    const { changeViewerSetting, channelSettings, getCurrentViewerChannelSettings, setChannelSettings } =\n      viewerStateRef.current;\n    setChannelVersions(new Array(channelVersionsRef.current.length).fill(CHANNEL_INITIAL_LOAD));\n    setLoadThrewError(false);\n    inInitialLoadRef.current = true;\n\n    const setChannelStateForNewImage = (channelNames: string[]): ChannelState[] | undefined => {\n      const viewerChannelSettings = getCurrentViewerChannelSettings();\n      const grouping = makeChannelIndexGrouping(channelNames, viewerChannelSettings);\n      setChannelGroupedByType(grouping);\n\n      // compare each channel's new displayName to the old displayNames currently in state:\n      // same number of channels, and each channel has same displayName\n      const allNamesAreEqual = channelNames.every((name, idx) => {\n        const displayName = getDisplayName(name, idx, viewerChannelSettings);\n        return displayName === channelSettings[idx]?.displayName;\n      });\n\n      if (allNamesAreEqual) {\n        const newChannelSettings = channelNames.map((channel, index) => {\n          return { ...channelSettings[index], name: channel };\n        });\n        setChannelSettings(newChannelSettings);\n        return newChannelSettings;\n      }\n\n      const newChannelSettings = channelNames.map((channel, index) => {\n        const color = getDefaultChannelColor(index);\n        return initializeOneChannelSetting(channel, index, color, viewerChannelSettings);\n      });\n      setChannelSettings(newChannelSettings);\n      return newChannelSettings;\n    };\n\n    const openImage = async (): Promise<void> => {\n      const { scene, time } = viewerStateRef.current;\n\n      const loadSpec = new LoadSpec();\n      loadSpec.time = time;\n\n      const aimg = await sceneLoader.createVolume(scene, loadSpec, onChannelDataLoaded).catch(onError);\n\n      const channelNames = aimg.imageInfo.channelNames;\n      const newChannelSettings = setChannelStateForNewImage(channelNames);\n\n      setChannelVersions(new Array(channelNames.length).fill(CHANNEL_INITIAL_LOAD));\n      setImage(aimg);\n\n      playControls.stepAxis = (axis: AxisName | \"t\") => {\n        const { time, slice } = viewerStateRef.current;\n        if (axis === \"t\") {\n          changeViewerSetting(\"time\", (time + 1) % aimg.imageInfo.times);\n        } else {\n          const max = aimg.imageInfo.volumeSize[axis];\n          const current = slice[axis] * max;\n          changeViewerSetting(\"slice\", { ...slice, [axis]: ((current + 1) % max) / max });\n        }\n      };\n      playControls.getVolumeIsLoaded = aimg.isLoaded.bind(aimg);\n\n      const requiredLoadSpec = new LoadSpec();\n      requiredLoadSpec.time = time;\n\n      // make the currently enabled channels \"required\":\n      // find all enabled indices in newChannelSettings:\n      const requiredChannelsToLoad = newChannelSettings\n        ? newChannelSettings.map((channel, index) => (channel.volumeEnabled ? index : -1)).filter((index) => index >= 0)\n        : [];\n\n      // add mask channel to required channels, if specified\n      const maskChannelName = getCurrentViewerChannelSettings()?.maskChannelName;\n      if (maskChannelName) {\n        const maskChannelIndex = channelNames.indexOf(maskChannelName);\n        if (maskChannelIndex >= 0 && !requiredChannelsToLoad.includes(maskChannelIndex)) {\n          requiredChannelsToLoad.push(maskChannelIndex);\n        }\n      }\n      requiredLoadSpec.channels = requiredChannelsToLoad;\n\n      // When in 2D Z-axis view mode, we restrict the subregion to only the current slice. This is\n      // to match an optimization that volume viewer does by loading Z-slices at a higher resolution,\n      // and ensures the very first volume that is loaded is the same as the one that\n      // will be shown whenever we switch back to the same viewer settings (2D Z-axis view mode).\n      // (We don't do this for ZX and YZ modes because we assume that the data won't be chunked along the\n      // X or Y axes in ways that would improve loading resolution, and we load the full 3D volume instead.)\n      if (viewerStateRef.current.viewMode === ViewMode.xy) {\n        const slice = viewerStateRef.current.slice;\n        requiredLoadSpec.subregion = new Box3(new Vector3(0, 0, slice.z), new Vector3(1, 1, slice.z));\n      }\n\n      // initiate loading only after setting up new channel settings,\n      // in case the loader callback fires before the state is set\n      sceneLoader.loadScene(scene, aimg, requiredLoadSpec).catch(onError);\n    };\n\n    openImage();\n  }, [\n    sceneLoader,\n    onError,\n    onChannelLoadedRef,\n    viewerStateRef,\n    channelVersionsRef,\n    setChannelVersions,\n    playControls,\n    setIsLoading,\n    onChannelDataLoaded,\n  ]);\n  // of the above dependencies, we expect only `sceneLoader` to change.\n\n  const setTime = useCallback(\n    (view3d: View3d, time: number): void => {\n      if (image && !inInitialLoadRef.current) {\n        view3d.setTime(image, time, onChannelDataLoaded).catch(onError);\n        setIsLoading();\n      }\n    },\n    [image, onError, setIsLoading, inInitialLoadRef, onChannelDataLoaded]\n  );\n\n  const setScene = useCallback(\n    (scene: number): void => {\n      if (image && !inInitialLoadRef.current) {\n        sceneLoader.loadScene(scene, image, undefined, onChannelDataLoaded).catch(onError);\n        setIsLoading();\n      }\n    },\n    [image, onError, sceneLoader, setIsLoading, inInitialLoadRef, onChannelDataLoaded]\n  );\n\n  return useMemo(\n    () => ({\n      image,\n      channelVersions,\n      imageLoadStatus,\n      setTime,\n      setScene,\n      playControls,\n      playingAxis,\n      channelGroupedByType,\n    }),\n    [image, channelVersions, imageLoadStatus, setTime, setScene, playControls, playingAxis, channelGroupedByType]\n  );\n};\n\nexport default useVolume;\n","import React from \"react\";\nimport { CaretDownOutlined, CaretUpOutlined } from \"@ant-design/icons\";\n\nimport { useRefWithSetter } from \"../../../shared/utils/hooks\";\n\nimport \"./styles.css\";\n\ninterface NumericInputProps {\n  value: number;\n  step?: number;\n  precision?: number;\n  min?: number;\n  max?: number;\n  disabled?: boolean;\n  className?: string;\n  onChange: (value: number) => void;\n}\n\n/**\n * Fully-controlled numeric input (value must be supplied from state in parent).\n * Changeable with arrow keys, typing values, or clickable arrows. Inspired by\n * ant's `InputNumber`, but conforms to our style and behavior expectations.\n */\nconst NumericInput: React.FC<NumericInputProps> = ({\n  value,\n  step = 1,\n  precision = step,\n  min = 0,\n  max = Number.MAX_SAFE_INTEGER,\n  disabled = false,\n  className = \"\",\n  onChange,\n}) => {\n  // While the input has focus, allow invalid input, just don't call `onChange` with it\n  const [hasFocus, _setHasFocus] = React.useState(false);\n  // State doesn't update before focus handler runs - keep a ref following focus state\n  const [hasFocusRef, setHasFocus] = useRefWithSetter(_setHasFocus, hasFocus);\n\n  // Hold the potentially invalid contents of the focused input here\n  const [textContent, setTextContent] = React.useState(\"\");\n\n  const inputRef = React.useRef<HTMLInputElement>(null);\n\n  const clamp = (newValue: number): number => Math.min(Math.max(newValue, min), max);\n  const roundToPrecision = (newValue: number): number => clamp(Math.round(newValue / precision) * precision);\n  const shouldChange = (newValue: number): boolean => !(isNaN(newValue) || newValue === value || disabled);\n\n  const displayedValue = roundToPrecision(value);\n\n  const onFocus = (): void => {\n    if (!hasFocusRef.current) {\n      // propagate current value to `textContent` on focus\n      setTextContent(displayedValue.toString());\n      setHasFocus(true);\n    }\n  };\n\n  const changeByStep = (up: boolean): void => {\n    const delta = up ? step : -step;\n    const newValue = clamp(displayedValue + delta);\n\n    if (shouldChange(newValue)) {\n      onChange(newValue);\n      setTextContent(newValue.toString());\n      // let the focus handler know we've taken care of things, so it won't restore the previous value\n      setHasFocus(true);\n    }\n\n    inputRef.current?.focus();\n  };\n\n  const onKeyDown: React.KeyboardEventHandler<HTMLDivElement> = (event) => {\n    const { key } = event;\n\n    if ([\"Up\", \"ArrowUp\", \"Down\", \"ArrowDown\"].includes(key)) {\n      changeByStep(key === \"Up\" || key === \"ArrowUp\");\n      event.preventDefault();\n    } else if (key === \"Enter\") {\n      inputRef.current?.blur();\n    }\n  };\n\n  const handleTyping = (inputStr: string): void => {\n    setTextContent(inputStr);\n\n    // if the user clears all text, assume they mean 0 (or the extremum closest to it)\n    // this is likely not completely general, but should be reasonable for any of our purposes\n    const inputNum = inputStr === \"\" ? 0 : parseFloat(inputStr);\n    const newValue = roundToPrecision(inputNum);\n\n    if (shouldChange(newValue)) {\n      onChange(newValue);\n    }\n  };\n\n  const fullClassName = \"numinput\" + (disabled ? \" numinput-disabled\" : \"\") + (className && ` ${className}`);\n  return (\n    <div className={fullClassName} onKeyDown={onKeyDown}>\n      <input\n        value={hasFocus ? textContent : displayedValue}\n        step={step}\n        min={min}\n        max={max}\n        disabled={disabled}\n        className=\"numinput-input\"\n        autoComplete=\"off\"\n        role=\"spinbutton\"\n        aria-valuenow={displayedValue}\n        aria-valuemin={min}\n        aria-valuemax={max}\n        ref={inputRef}\n        onChange={({ target }) => handleTyping(target.value)}\n        onFocus={onFocus}\n        onBlur={() => setHasFocus(false)}\n      />\n      <div className=\"numinput-controls\">\n        <div\n          className=\"numinput-controls-button numinput-controls-button-up\"\n          role=\"button\"\n          aria-label=\"Increase Value\"\n          aria-disabled={disabled}\n          onClick={() => changeByStep(true)}\n        >\n          <CaretUpOutlined className=\"numinput-controls-button-icon\" />\n        </div>\n        <div\n          className=\"numinput-controls-button numinput-controls-button-down\"\n          role=\"button\"\n          aria-label=\"Decrease Value\"\n          aria-disabled={disabled}\n          onClick={() => changeByStep(false)}\n        >\n          <CaretDownOutlined className=\"numinput-controls-button-icon\" />\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default NumericInput;\n","import React from \"react\";\nimport Nouislider, { NouisliderProps } from \"nouislider-react\";\n\ntype CallbackArgs = Parameters<NonNullable<NouisliderProps[\"onStart\"]>>;\n\nconst MemoedNouislider = React.memo(\n  Nouislider as React.ComponentType<NouisliderProps & { noUpdate: boolean }>,\n  (_prevProps, { noUpdate }) => noUpdate\n);\n\n/** A wrapper around `Nouislider` that prevents updates while the slider is being dragged. */\nconst SmarterSlider: React.FC<NouisliderProps> = (props) => {\n  const [noUpdate, setNoUpdate] = React.useState(false);\n  const wrapEventHandler = (shouldNotUpdate: boolean, handler?: (...args: CallbackArgs) => void) => {\n    return (...args: CallbackArgs) => {\n      setNoUpdate(shouldNotUpdate);\n      if (handler) handler(...args);\n    };\n  };\n\n  const onStart = wrapEventHandler(true, props.onStart);\n  const onEnd = wrapEventHandler(false, props.onEnd);\n  return <MemoedNouislider {...{ ...props, noUpdate, onStart, onEnd }} />;\n};\n\nexport default SmarterSlider;\n","import { Volume } from \"@aics/vole-core\";\nimport { CaretRightOutlined, PauseOutlined } from \"@ant-design/icons\";\nimport { Button, Tooltip } from \"antd\";\nimport React, { useCallback, useEffect, useState } from \"react\";\n\nimport { ViewMode } from \"../../shared/enums\";\nimport { activeAxisMap, AxisName, PerAxis } from \"../../shared/types\";\nimport PlayControls from \"../../shared/utils/playControls\";\nimport { ViewerSettingUpdater } from \"../ViewerStateProvider/types\";\n\nimport NumericInput from \"../shared/NumericInput\";\nimport SmarterSlider from \"../shared/SmarterSlider\";\n\nimport \"./styles.css\";\n\nconst AXES: AxisName[] = [\"x\", \"y\", \"z\"];\n\ntype SliderRowProps = {\n  label: string;\n  vals: number[];\n  valsReadout?: number[];\n  max: number;\n  // These event handlers attach to the events of the same names provided by noUiSlider.\n  // Their behavior is documented at https://refreshless.com/nouislider/events-callbacks/\n  onSlide?: (values: number[]) => void;\n  /** `onChange` is called on the corresponding noUiSlider event AND on interaction with a spinbox. */\n  onChange?: (values: number[]) => void;\n  onStart?: () => void;\n  onEnd?: () => void;\n};\n\n/** A single slider row, with a slider, one or two spinbox inputs, and a max value */\nconst SliderRow: React.FC<SliderRowProps> = ({\n  label,\n  vals,\n  valsReadout = vals,\n  max,\n  onSlide,\n  onChange = onSlide,\n  onStart,\n  onEnd,\n}) => {\n  const isRange = vals.length > 1;\n  // If slider is a range, handles represent slice *edges*: the range around only the 1st slice is [0, 1]; the range\n  // around only the last is [max-1, max].\n  // If slider is not a range, just work with slices, but don't 0-index: 1st slice is 1, last is max\n  const min = isRange ? 0 : 1;\n  const wrappedOnSlide = isRange ? onSlide : (values: number[]) => onSlide?.([values[0] - 1]);\n  const wrappedOnChange = isRange ? onChange : (values: number[]) => onChange?.([values[0] - 1]);\n\n  return (\n    <span className=\"axis-slider-container\">\n      <span className=\"slider-name\">{label}</span>\n      {max <= min ? (\n        <i>No values to adjust</i>\n      ) : (\n        <span className=\"axis-slider\">\n          <SmarterSlider\n            className={isRange ? \"\" : \"slider-single-handle\"}\n            connect={true}\n            range={{ min, max }}\n            start={isRange ? vals : [vals[0] + 1]}\n            step={1}\n            margin={1}\n            behaviour=\"drag\"\n            pips={{\n              mode: \"positions\",\n              values: [25, 50, 75],\n              density: 25,\n              format: {\n                // remove labels from pips\n                to: () => \"\",\n              },\n            }}\n            // round slider output to nearest slice; assume any string inputs represent ints\n            format={{ to: Math.round, from: parseInt }}\n            onSlide={wrappedOnSlide}\n            onChange={wrappedOnChange}\n            onStart={onStart}\n            onEnd={onEnd}\n          />\n        </span>\n      )}\n      {max > min && (\n        <span className=\"slider-values\">\n          <NumericInput\n            min={min}\n            max={max}\n            value={valsReadout[0] + (isRange ? 0 : 1)}\n            onChange={(value) => onChange?.(isRange ? [value, vals[1]] : [value - 1])}\n          />\n          {isRange && (\n            <>\n              {\" , \"}\n              <NumericInput\n                min={min}\n                max={max}\n                value={valsReadout[1]}\n                onChange={(value) => onChange?.([vals[0], value])}\n              />\n            </>\n          )}\n          {\" / \"}\n          {max}\n        </span>\n      )}\n    </span>\n  );\n};\n\ntype PlaySliderRowProps = {\n  label: string;\n  val: number;\n  max: number;\n  playing: boolean;\n  updateWhileSliding?: boolean;\n  onTogglePlayback: (play: boolean) => void;\n  // These event handlers attach to the events of the same names provided by noUiSlider.\n  // Their behavior is documented at https://refreshless.com/nouislider/events-callbacks/\n  /**\n   * `onChange`'s behavior depends on `updateWhileSliding`: if true, it's called on slide and on release;\n   * if false, it's called only on slide.\n   */\n  onChange?: (values: number) => void;\n  onStart?: () => void;\n  onEnd?: () => void;\n};\n\n/** Wrapper around `SliderRow` that adds a play button and accounts for the case where not all of an axis is loaded */\nconst PlaySliderRow: React.FC<PlaySliderRowProps> = (props) => {\n  const { onChange, onStart, onEnd } = props;\n  // In partially-loaded axes, stores the displayed value of the slider while the user is sliding it\n  const [valReadout, setValReadout] = useState(props.val);\n  // Tracks when the user is sliding the slider and `valReadout` may have to sub in for props\n  const [sliderHeld, setSliderHeld] = useState(false);\n\n  const wrappedOnChange = useCallback(([val]: number[]) => onChange?.(val), [onChange]);\n  const wrappedSetValReadout = useCallback(([val]: number[]) => setValReadout(val), []);\n  const wrappedOnStart = useCallback((): void => {\n    setValReadout(props.val);\n    setSliderHeld(true);\n    onStart?.();\n  }, [onStart, props.val]);\n  const wrappedOnEnd = useCallback((): void => {\n    setSliderHeld(false);\n    onEnd?.();\n  }, [onEnd]);\n\n  return (\n    <>\n      <SliderRow\n        label={props.label}\n        vals={[props.val]}\n        valsReadout={props.updateWhileSliding || !sliderHeld ? undefined : [valReadout]}\n        max={props.max}\n        onSlide={props.updateWhileSliding ? wrappedOnChange : wrappedSetValReadout}\n        onChange={props.updateWhileSliding ? undefined : wrappedOnChange}\n        onStart={wrappedOnStart}\n        onEnd={wrappedOnEnd}\n      />\n      {props.max > 1 && (\n        <Tooltip placement=\"top\" title=\"Play through sequence\" trigger={[\"hover\", \"focus\"]}>\n          <Button\n            className=\"slider-play-button\"\n            onClick={() => props.onTogglePlayback(!props.playing)}\n            icon={props.playing ? <PauseOutlined /> : <CaretRightOutlined />}\n            aria-label={(props.playing ? \"Pause \" : \"Play \") + props.label}\n          />\n        </Tooltip>\n      )}\n    </>\n  );\n};\n\ntype AxisClipSlidersProps = {\n  mode: ViewMode;\n  image: Volume | null;\n  changeViewerSetting: ViewerSettingUpdater;\n  numSlices: PerAxis<number>;\n  numSlicesLoaded: PerAxis<number>;\n  numScenes: number;\n  region: PerAxis<[number, number]>;\n  slices: PerAxis<number>;\n  numTimesteps: number;\n  time: number;\n  scene: number;\n  playingAxis: AxisName | \"t\" | null;\n  playControls: PlayControls;\n};\n\nconst AxisClipSliders: React.FC<AxisClipSlidersProps> = (props) => {\n  const activeAxis = activeAxisMap[props.mode];\n\n  const pauseOnInput = (axis: AxisName | \"t\"): void => {\n    // Pause on slider input unless user is scrubbing along the playing axis (playback is held while this is happening)\n    if (!props.playControls.playHolding || props.playingAxis !== axis) {\n      props.playControls.pause();\n    }\n  };\n\n  const updateRegion = (axis: AxisName, minval: number, maxval: number): void => {\n    pauseOnInput(axis);\n\n    const { changeViewerSetting, numSlices } = props;\n    // get a value from 0-1\n    const max = numSlices[axis];\n    const start = minval / max;\n    const end = maxval / max;\n    changeViewerSetting(\"region\", { [axis]: [start, end] });\n  };\n\n  const updateSlice = (axis: AxisName, slice: number): void => {\n    pauseOnInput(axis);\n    props.changeViewerSetting(\"slice\", { [axis]: slice / props.numSlices[axis] });\n  };\n\n  const updateTime = (time: number): void => {\n    pauseOnInput(\"t\");\n    props.changeViewerSetting(\"time\", time);\n  };\n\n  // Pause when view mode or volume size has changed\n  useEffect(() => props.playControls.pause(), [props.mode, props.image, props.playControls]);\n\n  const handlePlayPause = (axis: AxisName | \"t\", willPlay: boolean): void => {\n    if (willPlay) {\n      props.playControls.play(axis);\n    } else {\n      props.playControls.pause();\n    }\n  };\n\n  const create2dAxisSlider = (axis: AxisName): React.ReactNode => {\n    const numSlices = props.numSlices[axis];\n    const numSlicesLoaded = props.numSlicesLoaded[axis];\n\n    return (\n      <div key={axis + numSlices + numSlicesLoaded} className={`slider-row slider-${axis}`}>\n        <PlaySliderRow\n          label={axis.toUpperCase()}\n          val={Math.round(props.slices[axis] * numSlices)}\n          max={numSlices}\n          onChange={(val) => updateSlice(axis, val)}\n          onStart={() => props.playControls.startHold(axis)}\n          onEnd={() => props.playControls.endHold()}\n          playing={props.playingAxis === axis}\n          onTogglePlayback={(willPlay) => handlePlayPause(axis, willPlay)}\n          updateWhileSliding={numSlices === numSlicesLoaded}\n        />\n      </div>\n    );\n  };\n\n  const create3dAxisSlider = (axis: AxisName): React.ReactNode => {\n    const numSlices = props.numSlices[axis];\n    if (numSlices === 1) {\n      return null;\n    }\n    const region = props.region[axis];\n\n    return (\n      <div key={axis + numSlices + \"3d\"} className={`slider-row slider-${axis}`}>\n        <SliderRow\n          label={axis.toUpperCase()}\n          vals={[Math.round(region[0] * numSlices), Math.round(region[1] * numSlices)]}\n          max={numSlices}\n          onSlide={(values) => updateRegion(axis, values[0], values[1])}\n          onStart={() => props.playControls.startHold(axis)}\n          onEnd={() => props.playControls.endHold()}\n        />\n      </div>\n    );\n  };\n\n  return (\n    <div className={activeAxis ? \"clip-sliders clip-sliders-2d\" : \"clip-sliders\"}>\n      <span className=\"slider-group\">\n        <h4 className=\"slider-group-title\">ROI</h4>\n        <span className=\"slider-group-rows\">\n          {activeAxis ? create2dAxisSlider(activeAxis) : AXES.map(create3dAxisSlider)}\n        </span>\n      </span>\n\n      {props.numTimesteps > 1 && (\n        <span className=\"slider-group\">\n          <h4 className=\"slider-group-title\">Time</h4>\n          <span className=\"slider-group-rows\">\n            <div className=\"slider-row slider-t\">\n              <PlaySliderRow\n                label={\"\"}\n                val={props.time}\n                max={props.numTimesteps}\n                playing={props.playingAxis === \"t\"}\n                onTogglePlayback={(willPlay) => handlePlayPause(\"t\", willPlay)}\n                onChange={(time) => updateTime(time)}\n                onStart={() => props.playControls.startHold(\"t\")}\n                onEnd={() => props.playControls.endHold()}\n              />\n            </div>\n          </span>\n        </span>\n      )}\n\n      {props.numScenes > 1 && (\n        <span className=\"slider-group\">\n          <h4 className=\"slider-group-title\">Scene</h4>\n          <span className=\"slider-group-rows\">\n            <div className=\"slider-row slider-scene\">\n              <SliderRow\n                label={\"\"}\n                vals={[props.scene]}\n                max={props.numScenes}\n                onChange={([scene]) => props.changeViewerSetting(\"scene\", scene)}\n              />\n            </div>\n          </span>\n        </span>\n      )}\n    </div>\n  );\n};\n\nexport default AxisClipSliders;\n","<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<svg id=\"icon-turnTable-f\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 20 20\">\n  <path id=\"arrow-tail\" d=\"M19.19,7.69c-.09,.16-.19,.3-.3,.44-.26-.29-.55-.56-.85-.8,.34-.28,.58-.61,.61-.99,.05-.55-.4-1.15-.95-1.59-.56-.45-1.23-.79-1.92-1.07-.08-.04-.12-.13-.08-.21,.03-.07,.11-.11,.19-.09,.73,.21,1.46,.48,2.15,.89,.34,.21,.67,.46,.95,.79,.28,.32,.51,.76,.55,1.25,.05,.49-.1,.99-.35,1.38Z\" fill=\"currentColor\"/>\n  <path id=\"arrow-head\" d=\"M7.85,5.12l1.54-1.8c-1.27,.03-2.52,.18-3.73,.46-.71,.16-1.4,.37-2.05,.65-.64,.28-1.25,.63-1.67,1.06-.43,.45-.54,.87-.33,1.29,.22,.45,.76,.88,1.36,1.19,1.13,.6,2.46,.94,3.81,1.15-.27,.42-.51,.87-.7,1.35-1.29-.23-2.56-.6-3.79-1.26-.71-.4-1.46-.9-1.93-1.83-.23-.46-.3-1.05-.16-1.57,.14-.53,.43-.94,.75-1.27,.65-.65,1.39-1.04,2.13-1.35,.75-.32,1.51-.54,2.28-.71,1.39-.31,2.79-.45,4.19-.46L8.28,0l5.86,3.07-6.29,2.05Z\" fill=\"currentColor\"/>\n  <path id=\"button\" d=\"M18.17,8.83c-.31-.36-.66-.67-1.05-.95h-.01c-1.09-.79-2.43-1.26-3.89-1.26-2.16,0-4.09,1.03-5.3,2.63-.33,.42-.61,.88-.82,1.38-.36,.81-.56,1.72-.56,2.67,0,3.69,2.99,6.68,6.68,6.68s6.68-2.99,6.68-6.68c0-1.73-.65-3.29-1.73-4.47Zm-4.95,10.15c-3.13,0-5.68-2.55-5.68-5.68,0-.92,.22-1.79,.62-2.56,.26-.52,.6-1,1.01-1.41,1.03-1.06,2.47-1.71,4.05-1.71,1,0,1.94,.26,2.76,.72,.5,.28,.96,.64,1.35,1.06,.97,1.01,1.57,2.38,1.57,3.9,0,3.13-2.55,5.68-5.68,5.68Z\" fill=\"currentColor\"/>\n  <path id=\"play-head\" d=\"M12.83,10.68l-1.18-.94v7.16l4.48-3.58-3.3-2.64Zm-.18,1.14l1.88,1.5-1.88,1.5v-3Z\" fill=\"currentColor\"/>\n</svg>","import axes from \"./axes.svg\";\nimport boundingBox from \"./boundingBox.svg\";\nimport camera from \"./camera.svg\";\nimport channels from \"./channels.svg\";\nimport closePanel from \"./closePanel.svg\";\nimport download from \"./download.svg\";\nimport dropdownArrow from \"./dropdownArrow.svg\";\nimport metadata from \"./metadata.svg\";\nimport preferences from \"./preferences.svg\";\nimport resetView from \"./resetView.svg\";\nimport turnTable from \"./turnTable.svg\";\n\nexport default {\n  axes,\n  boundingBox,\n  camera,\n  channels,\n  closePanel,\n  download,\n  dropdownArrow,\n  metadata,\n  preferences,\n  resetView,\n  turnTable,\n};\n","<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<svg id=\"icon-axes\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 20 20\">\n  <circle id=\"center\" cx=\"6.26\" cy=\"12.84\" r=\"1\" fill=\"currentColor\"/>\n  <path id=\"arrow-x\" d=\"M14.27,15.23l.7-1.64h-6.86c.09-.23,.15-.48,.15-.75s-.06-.52-.15-.75h6.86l-.7-1.64,5.66,2.39-5.66,2.39Z\" fill=\"currentColor\"/>\n  <path id=\"arrow-y\" d=\"M6.26,.03L3.87,5.69l1.64-.69v5.99c.23-.1,.48-.15,.75-.15s.52,.05,.75,.15V5l1.64,.69L6.26,.03Z\" fill=\"currentColor\"/>\n  <path id=\"arrow-z\" d=\"M5.59,17.23L.07,19.91l1.93-5.83,.77,1.6,1.61-1.83s.08-.06,.11-.09c.23,.44,.62,.78,1.09,.95-.02,.04-.04,.09-.07,.12l-1.61,1.84,1.69,.56Z\" fill=\"currentColor\"/>\n</svg>","<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 20 20\">\n    <path id=\"back\" d=\"M.52,13.67m12.76-3.42c0,.21,.17,.38,.38,.38s.38-.17,.38-.38v-1.25c0-.21-.17-.38-.38-.38s-.38,.17-.38,.38v1.25Zm-2.5,3.42c0-.21-.17-.38-.38-.38h-1.25c-.21,0-.38,.17-.38,.38s.17,.38,.38,.38h1.25c.21,0,.38-.17,.38-.38Zm3.93,.52l-.68-.67s0,0,0-.01v-1.25c0-.21-.17-.38-.38-.38s-.38,.17-.38,.38v1.05h-.88c-.21,0-.38,.17-.38,.38s.17,.38,.38,.38h1.1l.68,.67c.07,.07,.17,.11,.26,.11s.19-.04,.27-.11c.15-.15,.15-.38,0-.53Zm2.31,2.29l-.89-.88c-.15-.15-.38-.14-.53,0-.15,.15-.15,.38,0,.53l.89,.88c.07,.07,.17,.11,.26,.11s.19-.04,.27-.11c.15-.15,.15-.38,0-.53Zm-12.73-2.81c0-.21-.17-.38-.38-.38h-1.25c-.21,0-.38,.17-.38,.38s.17,.38,.38,.38h1.25c.21,0,.38-.17,.38-.38ZM13.27,3.75c0,.21,.17,.38,.38,.38s.38-.17,.38-.38v-1.25c0-.21-.17-.38-.38-.38s-.38,.17-.38,.38v1.25Zm.75,2c0-.21-.17-.38-.38-.38s-.38,.17-.38,.38v.08h.75v-.08Zm-.38,1.62c.21,0,.38-.17,.38-.38v-.17h-.75v.17c0,.21,.17,.38,.38,.38Zm0-3.25c.21,0,.38-.17,.38-.38v-1.25c0-.21-.17-.38-.38-.38s-.38,.17-.38,.38v1.25c0,.21,.17,.38,.38,.38ZM3.9,13.3h-1.25c-.21,0-.38,.17-.38,.38s.17,.38,.38,.38h1.25c.21,0,.38-.17,.38-.38s-.17-.38-.38-.38Zm1.62,.38c0,.19,.14,.34,.32,.36v-.73c-.18,.03-.32,.18-.32,.36Zm10.59,1.93c-.15-.15-.38-.14-.53,0-.15,.15-.15,.38,0,.53l.89,.88c.07,.07,.17,.11,.26,.11s.19-.04,.27-.11c.15-.15,.15-.38,0-.53l-.89-.88Zm2.86,2.84l-.56-.55c-.15-.15-.38-.15-.53,0-.15,.15-.15,.38,0,.53l.55,.54h.54v-.52Zm-8.58-5.14h-1.25c-.21,0-.38,.17-.38,.38s.17,.38,.38,.38h1.25c.21,0,.38-.17,.38-.38s-.17-.38-.38-.38Zm3.62,.22s0,0,0-.01v-1.25c0-.21-.17-.38-.38-.38s-.38,.17-.38,.38v1.05h-.88c-.21,0-.38,.17-.38,.38s.17,.38,.38,.38h1.1l.68,.67c.07,.07,.17,.11,.26,.11s.19-.04,.27-.11c.15-.15,.15-.38,0-.53l-.68-.67Zm-.37-2.89c.21,0,.38-.17,.38-.38v-1.25c0-.21-.17-.38-.38-.38s-.38,.17-.38,.38v1.25c0,.21,.17,.38,.38,.38Zm-6.12,3.05c0-.21-.17-.38-.38-.38h-.3v.75h.3c.21,0,.38-.17,.38-.38Z\" fill=\"currentColor\"/>\n    <path id=\"front\" d=\"M19.83,5.98h0l-.7-.69L14.7,.88s-.23-.23-.69-.69c0,0,0,0,0,0,0,0,0,0,0,0h0c-.09-.09-.21-.15-.35-.15H.52C.24,.04,.02,.26,.02,.54V13.67c0,.14,.06,.26,.15,.35,0,0,0,0,0,0,.46,.46,.7,.69,.7,.69l4.44,4.41s.23,.23,.7,.69c0,0,0,0,0,0,.09,.09,.21,.15,.35,.15h13.13c.28,0,.5-.22,.5-.5V6.33c0-.14-.06-.26-.15-.35ZM5.85,13.31v4.96L1.56,14.01s-.19-.19-.55-.54V1.74L5.3,6s.19,.19,.55,.54v6.77Zm.16-8.02L1.73,1.04H13.44c.36,.36,.55,.55,.55,.55l4.28,4.25H6.55c-.36-.36-.55-.55-.55-.55Zm.84,13.68V6.83h12.13v12.13H6.85Z\" fill=\"currentColor\"/>\n</svg>\n","<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<svg id=\"Layer_2\" data-name=\"Layer 2\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 32 32\">\n  <g id=\"icon-camera\">\n    <path id=\"camera-body\" d=\"M29.54,32H2.46c-1.36,0-2.46-1.1-2.46-2.45V15.34c0-1.35,1.1-2.45,2.46-2.45h6.64c1.21,0,2.34-.54,3.1-1.48l.88-1.09c.75-.94,1.88-1.47,3.08-1.47h6.32c1.21,0,2.33,.54,3.08,1.47l.88,1.09c.76,.94,1.89,1.48,3.1,1.48,1.36,0,2.46,1.1,2.46,2.45v14.21c0,1.35-1.1,2.45-2.46,2.45ZM2.46,13.9c-.8,0-1.46,.65-1.46,1.45v14.21c0,.8,.65,1.45,1.46,1.45H29.54c.8,0,1.46-.65,1.46-1.45V15.34c0-.8-.65-1.45-1.46-1.45-1.52,0-2.93-.68-3.88-1.85l-.88-1.09c-.56-.7-1.4-1.1-2.3-1.1h-6.32c-.9,0-1.74,.4-2.3,1.1l-.88,1.09c-.95,1.18-2.36,1.85-3.88,1.85H2.46Zm4.25,4.85c.58,0,1.04-.46,1.04-1.03s-.47-1.03-1.04-1.03h-1.67c-.58,0-1.04,.46-1.04,1.03s.47,1.03,1.04,1.03h1.67Zm12.61-3.24c2.81,0,5.09,2.29,5.09,5.1s-2.28,5.1-5.09,5.1-5.09-2.29-5.09-5.1,2.28-5.1,5.09-5.1m0-2c-3.91,0-7.09,3.18-7.09,7.1s3.17,7.1,7.09,7.1,7.09-3.18,7.09-7.1-3.17-7.1-7.09-7.1h0Z\" fill=\"currentColor\"/>\n    <path id=\"burst-lines\" d=\"M19.39,3.87c-.28,0-.5-.22-.5-.5V.5c0-.28,.22-.5,.5-.5s.5,.22,.5,.5V3.37c0,.28-.22,.5-.5,.5Zm4.76,1.12l2.15-2.34c.19-.2,.17-.52-.03-.71-.2-.18-.52-.17-.71,.03l-2.15,2.34c-.19,.2-.17,.52,.03,.71,.1,.09,.22,.13,.34,.13,.13,0,.27-.05,.37-.16Zm-8.95,.03c.2-.19,.22-.5,.03-.71l-2.15-2.34c-.19-.2-.5-.21-.71-.03-.2,.19-.22,.5-.03,.71l2.15,2.34c.1,.11,.23,.16,.37,.16,.12,0,.24-.04,.34-.13Z\" fill=\"currentColor\"/>\n  </g>\n</svg>","<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<svg id=\"icon-channels\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 20 20\">\n  <path id=\"line-mid\" d=\"M13.55,10.36h-1c-.21,0-.38-.17-.38-.38s.17-.38,.38-.38h1c.21,0,.38,.17,.38,.38s-.17,.38-.38,.38Zm-3,0h-1c-.21,0-.38-.17-.38-.38s.17-.38,.38-.38h1c.21,0,.38,.17,.38,.38s-.17,.38-.38,.38Zm-3,0h-1c-.21,0-.38-.17-.38-.38s.17-.38,.38-.38h1c.21,0,.38,.17,.38,.38s-.17,.38-.38,.38Z\" fill=\"currentColor\"/>\n  <path id=\"line-top\" d=\"M2.65,6.64c-.21,0-.38-.17-.38-.38v-.3c0-.26,.03-.52,.08-.78,.04-.2,.24-.33,.45-.29,.2,.04,.33,.24,.29,.45-.04,.2-.07,.41-.07,.62v.3c0,.21-.17,.38-.38,.38Zm1.06-2.7c-.1,0-.2-.04-.28-.12-.14-.15-.13-.39,.02-.53,.27-.25,.59-.46,.92-.62,.19-.09,.41,0,.5,.18s0,.41-.18,.5c-.27,.12-.51,.29-.73,.49-.07,.07-.16,.1-.25,.1Zm9.78-.86h-1c-.21,0-.38-.17-.38-.38s.17-.38,.38-.38h1c.21,0,.38,.17,.38,.38s-.17,.38-.38,.38Zm-3,0h-1c-.21,0-.38-.17-.38-.38s.17-.38,.38-.38h1c.21,0,.38,.17,.38,.38s-.17,.38-.38,.38Zm-3,0h-1c-.21,0-.38-.17-.38-.38s.17-.38,.38-.38h1c.21,0,.38,.17,.38,.38s-.17,.38-.38,.38Z\" fill=\"currentColor\"/>\n  <path id=\"line-bottom\" d=\"M13.44,17.69h-1c-.21,0-.38-.17-.38-.38s.17-.38,.38-.38h1c.21,0,.38,.17,.38,.38s-.17,.38-.38,.38Zm-3,0h-1c-.21,0-.38-.17-.38-.38s.17-.38,.38-.38h1c.21,0,.38,.17,.38,.38s-.17,.38-.38,.38Zm-3,0h-1c-.21,0-.38-.17-.38-.38s.17-.38,.38-.38h1c.21,0,.38,.17,.38,.38s-.17,.38-.38,.38Zm-2.95-.32c-.05,0-.11-.01-.16-.04-.33-.16-.64-.38-.91-.63-.15-.14-.16-.38-.02-.53s.38-.16,.53-.02c.22,.2,.46,.37,.73,.5,.19,.09,.26,.32,.17,.5-.06,.13-.2,.21-.34,.21Zm-1.78-2.28c-.17,0-.33-.12-.37-.3-.05-.24-.07-.48-.07-.73v-.34c0-.21,.17-.38,.38-.38s.38,.17,.38,.38v.34c0,.19,.02,.39,.06,.58,.04,.2-.09,.4-.29,.44-.02,0-.05,0-.08,0Z\" fill=\"currentColor\"/>\n  <path id=\"channel-composite\" d=\"M5.42,12.69H.01V7.29H5.42v5.4Zm-4.4-1h3.4v-3.4H1.01v3.4Z\" fill=\"currentColor\"/>\n  <path id=\"channel-1\" d=\"M19.99,5.41h-5.4V0h5.4V5.41Zm-4.4-1h3.4V1h-3.4v3.4Z\" fill=\"currentColor\"/>\n  <path id=\"channel-2\" d=\"M19.99,12.69h-5.4V7.29h5.4v5.4Zm-4.4-1h3.4v-3.4h-3.4v3.4Z\" fill=\"currentColor\"/>\n  <path id=\"channel-3\" d=\"M19.99,19.97h-5.4v-5.4h5.4v5.4Zm-4.4-1h3.4v-3.4h-3.4v3.4Z\" fill=\"currentColor\"/>\n</svg>","<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<svg id=\"icon-openPanel\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 20 20\">\n  <path id=\"chevron-2\" d=\"M10.64,17.78c-.21,0-.41-.06-.59-.2-.44-.33-.54-.96-.21-1.4l4.59-6.21L9.83,3.76c-.33-.44-.23-1.07,.21-1.4,.44-.33,1.07-.23,1.4,.21l5.03,6.8c.26,.35,.26,.84,0,1.19l-5.03,6.81c-.2,.27-.5,.41-.81,.41Z\" fill=\"currentColor\"/>\n  <path id=\"chevron-1\" d=\"M4.33,17.84c-.21,0-.41-.06-.59-.2-.44-.33-.54-.96-.21-1.4l4.59-6.21L3.53,3.82c-.33-.44-.23-1.07,.21-1.4,.44-.33,1.07-.23,1.4,.21l5.03,6.81c.26,.35,.26,.83,0,1.19l-5.03,6.81c-.2,.27-.5,.41-.81,.41Z\" fill=\"currentColor\"/>\n</svg>","<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<svg id=\"Layer_2\" data-name=\"Layer 2\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 32 32\">\n  <g id=\"icon-download\">\n    <polygon id=\"arrow\" points=\"17 14.93 17 0 15 0 15 14.93 11.56 13.47 16 24 20.44 13.47 17 14.93\" fill=\"currentColor\"/>\n    <path id=\"base\" d=\"M28.5,32H3.5c-1.38,0-2.5-1.12-2.5-2.5v-9.5h1v9.5c0,.83,.67,1.5,1.5,1.5H28.5c.83,0,1.5-.67,1.5-1.5v-9.5h1v9.5c0,1.38-1.12,2.5-2.5,2.5Z\" fill=\"currentColor\"/>\n  </g>\n</svg>","<svg\n    xmlns=\"http://www.w3.org/2000/svg\"\n    width=\"14\"\n    height=\"14\"\n    viewBox=\"0 0 12 12\"\n>\n    <path\n        fill=\"currentColor\"\n        d=\"M1.11652 3.1204C1.30891 2.94718 1.6053 2.96271 1.77853 3.1551L6.0059 7.85006L10.2333 3.1551C10.4065 2.96271 10.7029 2.94718 10.8953 3.12041C11.0876 3.29363 11.1032 3.59002 10.9299 3.78241L6.37171 8.84486C6.27496 8.9523 6.1398 9.00459 6.00579 8.99963C5.87185 9.00453 5.73678 8.95224 5.64008 8.84485L1.08183 3.78241C0.908604 3.59002 0.924137 3.29363 1.11652 3.1204Z\"\n    />\n</svg>","<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<svg id=\"Layer_2\" data-name=\"Layer 2\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 32 32\">\n  <g id=\"icon-metadata\">\n    <path id=\"lines\" d=\"M19.46,21.54c0-.28-.22-.5-.5-.5H.5c-.28,0-.5,.22-.5,.5s.22,.5,.5,.5H18.96c.28,0,.5-.22,.5-.5Zm3.52-14.03c0-.28-.22-.5-.5-.5H.51C.23,7.01,0,7.24,0,7.51s.22,.5,.5,.5H22.48c.28,0,.5-.22,.5-.5Zm-4.74,7.01c0-.28-.22-.5-.5-.5H.5c-.28,0-.5,.22-.5,.5s.22,.5,.5,.5H17.75c.28,0,.5-.22,.5-.5ZM32,.5c0-.28-.22-.5-.5-.5H.54C.26,0,.04,.22,.04,.5s.22,.5,.5,.5H31.5c.28,0,.5-.22,.5-.5Z\" fill=\"currentColor\"/>\n    <path id=\"i\" d=\"M23.62,14.79l.16-.56h6.29l-4.67,13.66c-.13,.4-.26,.81-.4,1.23-.13,.42-.2,.81-.2,1.19,0,.32,.09,.6,.28,.83,.18,.23,.46,.34,.83,.34,.42,0,.84-.15,1.25-.44s.78-.64,1.13-1.03c.34-.39,.63-.79,.87-1.19s.41-.73,.51-.97l.47,.2c-.11,.21-.27,.54-.49,.99-.23,.44-.53,.89-.93,1.33-.39,.44-.88,.83-1.46,1.15s-1.26,.48-2.06,.48c-.87,0-1.56-.18-2.08-.54s-.77-.97-.77-1.83c0-.46,.08-.96,.24-1.51,.16-.55,.32-1.05,.48-1.51l4.07-11.81h-3.52Zm4.67-6.57c0,.54,.18,.99,.53,1.35s.8,.54,1.32,.54,.97-.18,1.32-.54,.53-.81,.53-1.35-.18-.99-.53-1.35-.8-.54-1.32-.54-.97,.18-1.32,.54-.53,.81-.53,1.35Z\" fill=\"currentColor\"/>\n  </g>\n</svg>","<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<svg id=\"icon-preferences\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 20 20\">\n  <path id=\"bar-1\" d=\"M8.04,3.61H.81C.39,3.61,.06,3.27,.06,2.86s.34-.75,.75-.75h7.23v1.5Zm11.15-1.5h-5.65v1.5h5.65c.41,0,.75-.34,.75-.75s-.34-.75-.75-.75Z\" fill=\"currentColor\"/>\n  <path id=\"slider-head-1\" d=\"M10.79,5.61c-.41,0-.75-.34-.75-.75V.85c0-.41,.34-.75,.75-.75s.75,.34,.75,.75V4.86c0,.41-.34,.75-.75,.75Z\" fill=\"currentColor\"/>\n  <path id=\"bar-2\" d=\"M2.81,10.75H.81c-.41,0-.75-.34-.75-.75s.34-.75,.75-.75H2.81v1.5Zm16.38-1.5H8.31v1.5h10.88c.41,0,.75-.34,.75-.75s-.34-.75-.75-.75Z\" fill=\"currentColor\"/>\n  <path id=\"slider-head-2\" d=\"M5.56,12.76c-.41,0-.75-.34-.75-.75V7.99c0-.41,.34-.75,.75-.75s.75,.34,.75,.75v4.01c0,.41-.34,.75-.75,.75Z\" fill=\"currentColor\"/>\n  <path id=\"bar-3\" d=\"M19.94,17.14c0,.41-.34,.75-.75,.75h-3.08v-1.5h3.08c.41,0,.75,.34,.75,.75Zm-9.33-.75H.81c-.41,0-.75,.34-.75,.75s.34,.75,.75,.75H10.61v-1.5Z\" fill=\"currentColor\"/>\n  <path id=\"slider-head-3\" d=\"M13.36,19.9c-.41,0-.75-.34-.75-.75v-4.01c0-.41,.34-.75,.75-.75s.75,.34,.75,.75v4.01c0,.41-.34,.75-.75,.75Z\" fill=\"currentColor\"/>\n</svg>","<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<svg id=\"icon-resetView-2\" data-name=\"icon-resetView\" xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 20 20\">\n  <path id=\"corner-top-left\" d=\"M.6,5.48c-.28,0-.5-.22-.5-.5V.09H4.99c.28,0,.5,.22,.5,.5s-.22,.5-.5,.5H1.1v3.89c0,.28-.22,.5-.5,.5Z\" fill=\"currentColor\"/>\n  <path id=\"corner-bottom-left\" d=\"M4.99,19.91H.1v-4.88c0-.28,.22-.5,.5-.5s.5,.22,.5,.5v3.88h3.89c.28,0,.5,.22,.5,.5s-.22,.5-.5,.5Z\" fill=\"currentColor\"/>\n  <path id=\"corner-bottom-right\" d=\"M19.9,19.91h-4.89c-.28,0-.5-.22-.5-.5s.22-.5,.5-.5h3.89v-3.88c0-.28,.22-.5,.5-.5s.5,.22,.5,.5v4.88Z\" fill=\"currentColor\"/>\n  <path id=\"corner-top-right\" d=\"M19.4,6.11c-.28,0-.5-.22-.5-.5V1.09h-4.51c-.28,0-.5-.22-.5-.5s.22-.5,.5-.5h5.51V5.61c0,.28-.22,.5-.5,.5Z\" fill=\"currentColor\"/>\n  <path id=\"frame\" d=\"M16.46,16.46H3.54V3.54h12.92v12.92Zm-10.92-2H14.46V5.54H5.54V14.46Z\" fill=\"currentColor\"/>\n</svg>","import React from \"react\";\nimport Icon from \"@ant-design/icons\";\nimport { IconComponentProps } from \"@ant-design/icons/lib/components/Icon\";\n\nimport ICONS from \"../../assets/icons\";\n\nconst STYLE = { fontSize: \"19px\" };\ntype ViewerIconProps = { type: keyof typeof ICONS } & Omit<IconComponentProps, \"type\" | \"component\" | \"ref\">;\n\n/** Wrapper component for easy inclusion of our own custom icons. */\nconst ViewerIcon: React.FC<ViewerIconProps> = (props) => {\n  const newProps = { ...props };\n  newProps.style = { ...STYLE, ...props.style };\n  return <Icon component={ICONS[props.type]} {...newProps} />;\n};\n\nexport default ViewerIcon;\n","import { Button, Drawer } from \"antd\";\nimport React, { useCallback, useState } from \"react\";\n\nimport ViewerIcon from \"../shared/ViewerIcon\";\n\nimport \"./styles.css\";\n\ntype BottomPanelProps = {\n  title?: string;\n  open?: boolean;\n  onOpenChange?: (visible: boolean) => void;\n  children?: React.ReactNode;\n  height?: number;\n};\n\nconst BottomPanel: React.FC<BottomPanelProps> = ({ children, open: openProp, title, height, onOpenChange }) => {\n  const [openState, setOpenState] = useState(true);\n  const open = openProp ?? openState;\n\n  const toggleDrawer = useCallback((): void => {\n    if (openProp === undefined) {\n      setOpenState(!open);\n    }\n\n    onOpenChange?.(!open);\n  }, [open, openProp, onOpenChange]);\n\n  const optionsButton = (\n    <Button className=\"options-button\" size=\"small\" onClick={toggleDrawer}>\n      {title || \"Options\"}\n      <ViewerIcon type=\"closePanel\" className=\"button-arrow\" style={{ fontSize: \"15px\" }} />\n    </Button>\n  );\n\n  return (\n    <div className=\"bottom-panel\">\n      <Drawer\n        className=\"drawer\"\n        placement=\"bottom\"\n        closable={false}\n        getContainer={false}\n        open={open}\n        mask={false}\n        title={optionsButton}\n        height={height ?? 190}\n      >\n        <div className=\"drawer-body-wrapper\">{children}</div>\n      </Drawer>\n    </div>\n  );\n};\n\nexport default BottomPanel;\n","import { View3d, Volume } from \"@aics/vole-core\";\nimport { LoadingOutlined } from \"@ant-design/icons\";\nimport React from \"react\";\n\nimport { CLIPPING_PANEL_HEIGHT_DEFAULT, CLIPPING_PANEL_HEIGHT_TALL } from \"../../shared/constants\";\nimport { ViewMode } from \"../../shared/enums\";\nimport { AxisName, PerAxis, Styles } from \"../../shared/types\";\nimport PlayControls from \"../../shared/utils/playControls\";\nimport { ViewerSettingUpdater } from \"../ViewerStateProvider/types\";\n\nimport AxisClipSliders from \"../AxisClipSliders\";\nimport BottomPanel from \"../BottomPanel\";\nimport { connectToViewerState } from \"../ViewerStateProvider\";\n\nimport \"./styles.css\";\n\ntype ViewerWrapperProps = {\n  // From parent\n  view3d: View3d;\n  loadingImage: boolean;\n  appHeight: string;\n  image: Volume | null;\n  numSlices: PerAxis<number>;\n  numSlicesLoaded: PerAxis<number>;\n  playControls: PlayControls;\n  playingAxis: AxisName | \"t\" | null;\n  numTimesteps: number;\n  numScenes: number;\n  visibleControls: {\n    axisClipSliders: boolean;\n  };\n  clippingPanelOpen?: boolean;\n  onClippingPanelOpenChange?: (visible: boolean) => void;\n\n  // From viewer state\n  autorotate: boolean;\n  viewMode: ViewMode;\n  region: PerAxis<[number, number]>;\n  slice: PerAxis<number>;\n  time: number;\n  scene: number;\n  changeViewerSetting: ViewerSettingUpdater;\n};\n\nconst ViewerWrapper: React.FC<ViewerWrapperProps> = (props) => {\n  const view3dviewerRef = React.createRef<HTMLDivElement>();\n\n  React.useEffect(() => {\n    view3dviewerRef.current!.appendChild(props.view3d.getDOMElement());\n  }, [props.view3d, view3dviewerRef]);\n\n  const renderOverlay = (): React.ReactNode => {\n    // Don't show spinner during playback - we may be constantly loading new data, it'll block the view!\n    const showSpinner = props.loadingImage && !props.playingAxis;\n    const spinner = showSpinner ? (\n      <div style={STYLES.noImage}>\n        <LoadingOutlined style={{ fontSize: 60, zIndex: 1000 }} />\n      </div>\n    ) : null;\n\n    const noImageText =\n      !props.loadingImage && !props.image ? <div style={STYLES.noImage}>No image selected</div> : null;\n    if (!!noImageText && props.view3d) {\n      props.view3d.removeAllVolumes();\n    }\n    return noImageText || spinner;\n  };\n\n  const { appHeight, changeViewerSetting, visibleControls, numTimesteps, numScenes, viewMode, region, slice, time } =\n    props;\n  const clippingPanelTall = numTimesteps > 1 && numScenes > 1 && viewMode === ViewMode.threeD;\n\n  return (\n    <div className=\"cell-canvas\" style={{ ...STYLES.viewer, height: appHeight }}>\n      <div ref={view3dviewerRef} style={STYLES.view3d}></div>\n      <BottomPanel\n        title=\"Clipping\"\n        open={props.clippingPanelOpen}\n        onOpenChange={props.onClippingPanelOpenChange}\n        height={clippingPanelTall ? CLIPPING_PANEL_HEIGHT_TALL : CLIPPING_PANEL_HEIGHT_DEFAULT}\n      >\n        {visibleControls.axisClipSliders && !!props.image && (\n          <AxisClipSliders\n            mode={viewMode}\n            image={props.image}\n            changeViewerSetting={changeViewerSetting}\n            numSlices={props.numSlices}\n            numSlicesLoaded={props.numSlicesLoaded}\n            numScenes={numScenes}\n            region={region}\n            slices={slice}\n            numTimesteps={numTimesteps}\n            time={time}\n            scene={props.scene}\n            playControls={props.playControls}\n            playingAxis={props.playingAxis}\n          />\n        )}\n      </BottomPanel>\n      {renderOverlay()}\n    </div>\n  );\n};\n\nexport default connectToViewerState(ViewerWrapper, [\n  \"autorotate\",\n  \"viewMode\",\n  \"region\",\n  \"slice\",\n  \"time\",\n  \"scene\",\n  \"changeViewerSetting\",\n]);\n\nconst STYLES: Styles = {\n  viewer: {\n    display: \"flex\",\n    position: \"relative\",\n  },\n  view3d: {\n    width: \"100%\",\n    display: \"flex\",\n    overflow: \"hidden\",\n  },\n  noImage: {\n    position: \"absolute\",\n    zIndex: 999,\n    top: 0,\n    left: 0,\n    bottom: 0,\n    right: 0,\n    display: \"flex\",\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    backgroundColor: \"#eeeee\",\n    color: \"#9b9b9b\",\n    fontSize: \"2em\",\n    opacity: 0.75,\n  },\n};\n","import React from \"react\";\nimport { ColorResult, SketchPicker } from \"react-color\";\nimport { map } from \"lodash\";\n\nimport { ColorObject } from \"../shared/utils/colorRepresentations\";\nimport { Styles } from \"../shared/types\";\n\n// if there are fewer than this many screen pixels below the swatch but more above, open above the swatch\nconst OPEN_ABOVE_MARGIN = 310;\n\ntype ColorChangeHandler = (currentColor: ColorObject, prevColor?: ColorObject, idx?: number) => void;\n\ninterface ColorPickerProps {\n  color: ColorObject;\n  width: number;\n  onColorChange?: ColorChangeHandler;\n  onColorChangeComplete?: ColorChangeHandler;\n  idx?: any;\n  disableAlpha?: boolean;\n}\n\nconst DEFAULT_COLOR = {\n  r: \"241\",\n  g: \"112\",\n  b: \"19\",\n  a: \"1\",\n};\n\nconst ColorPicker: React.FC<ColorPickerProps> = (props) => {\n  const [isOpen, setIsOpen] = React.useState(false);\n  const [openAboveSwatch, setOpenAboveSwatch] = React.useState(false);\n  const [currentColor, setCurrentColor] = React.useState(props.color || DEFAULT_COLOR);\n\n  const swatchRef = React.useRef<HTMLDivElement>(null);\n\n  const handleClick = (): void => {\n    const swatchRect = swatchRef.current!.getBoundingClientRect();\n    const noRoomBelowSwatch = swatchRect.bottom > window.innerHeight - OPEN_ABOVE_MARGIN;\n    setIsOpen(!isOpen);\n    setOpenAboveSwatch(noRoomBelowSwatch && swatchRect.top > OPEN_ABOVE_MARGIN);\n  };\n\n  const handleClose = (): void => setIsOpen(false);\n\n  const handleChange = (color: ColorResult): void => {\n    setCurrentColor(color.rgb);\n    // supply onColorChange callback in props.\n    props.onColorChange?.(color.rgb, currentColor, props.idx);\n  };\n\n  const handleChangeComplete = (color: ColorResult): void => {\n    setCurrentColor(color.rgb);\n    // supply onColorChange callback in props.\n    props.onColorChangeComplete?.(color.rgb, currentColor, props.idx);\n  };\n\n  React.useEffect(() => setCurrentColor(props.color), [props.color]);\n\n  const width = props.width || 36;\n  const popoverDirectionStyle = openAboveSwatch ? { bottom: \"21px\" } : { top: \"0px\" };\n  return (\n    <div>\n      <div style={STYLES.swatch} ref={swatchRef} onClick={handleClick}>\n        <div style={{ ...STYLES.color, width: `${width}px`, background: `rgba(${map(currentColor, (ele) => ele)})` }} />\n      </div>\n      <div style={{ position: \"absolute\" }}>\n        {isOpen ? (\n          <div style={{ ...STYLES.popover, ...popoverDirectionStyle }}>\n            <div style={STYLES.cover} onClick={handleClose} />\n            <SketchPicker\n              color={currentColor}\n              onChange={handleChange}\n              onChangeComplete={handleChangeComplete}\n              disableAlpha={props.disableAlpha}\n            />\n          </div>\n        ) : null}\n      </div>\n    </div>\n  );\n};\n\nexport default ColorPicker;\n\nconst STYLES: Styles = {\n  color: {\n    height: \"14px\",\n    margin: \"3px\",\n    borderRadius: \"2px\",\n  },\n  swatch: {\n    borderRadius: \"3px\",\n    border: \"1px solid var(--color-controlpanel-border)\",\n    display: \"inline-block\",\n    cursor: \"pointer\",\n    verticalAlign: \"middle\",\n  },\n  popover: {\n    position: \"absolute\",\n    zIndex: \"9999\",\n  },\n  cover: {\n    position: \"fixed\",\n    top: \"0px\",\n    right: \"0px\",\n    bottom: \"0px\",\n    left: \"0px\",\n  },\n};\n","import React from \"react\";\nimport { NouisliderProps } from \"nouislider-react\";\nimport SmarterSlider from \"../SmarterSlider\";\n\nimport \"./styles.css\";\n\ntype SliderRowProps = {\n  label: React.ReactNode;\n  start?: number | number[];\n  step?: number;\n  formatInteger?: boolean;\n  max?: number;\n  onUpdate?: NouisliderProps[\"onUpdate\"];\n  onChange?: NouisliderProps[\"onChange\"];\n  hideSlider?: boolean;\n\n  children?: React.ReactNode;\n};\n\nconst INTEGER_FORMATTER = { to: Math.round, from: Number };\n\n/** A component to ensure a single unified style across the many labeled slider rows in the control panel */\nconst SliderRow: React.FC<SliderRowProps> = (props) => (\n  <div className=\"viewer-control-row\">\n    <div className=\"control-name\">{props.label}</div>\n    <div className=\"control\">\n      {props.start === undefined\n        ? props.children\n        : !props.hideSlider && (\n            <SmarterSlider\n              range={{ min: 0, max: props.max }}\n              start={props.start}\n              connect={true}\n              tooltips={true}\n              behaviour=\"drag\"\n              format={props.formatInteger ? INTEGER_FORMATTER : undefined}\n              onUpdate={props.onUpdate}\n              onChange={props.onChange}\n            />\n          )}\n    </div>\n  </div>\n);\n\nexport default SliderRow;\n","import { Channel, ControlPoint, Histogram, Lut } from \"@aics/vole-core\";\nimport { Button, Checkbox, InputNumber, Tooltip } from \"antd\";\nimport * as d3 from \"d3\";\nimport \"nouislider/distribute/nouislider.css\";\nimport React, { useCallback, useMemo, useRef, useState } from \"react\";\nimport { ColorResult, SketchPicker } from \"react-color\";\n\nimport { DTYPE_RANGE, LUT_MAX_PERCENTILE, LUT_MIN_PERCENTILE, TFEDITOR_DEFAULT_COLOR } from \"../../shared/constants\";\nimport {\n  ColorArray,\n  colorArrayToObject,\n  colorArrayToString,\n  colorObjectToArray,\n} from \"../../shared/utils/colorRepresentations\";\nimport { controlPointsToRamp, rampToControlPoints } from \"../../shared/utils/controlPointsToLut\";\nimport { useRefWithSetter } from \"../../shared/utils/hooks\";\nimport type { SingleChannelSettingUpdater } from \"../ViewerStateProvider/types\";\n\nimport SliderRow from \"../shared/SliderRow\";\n\nimport \"./styles.css\";\n\n/**The color picker opens next to control points like a context menu. This constant gives it a bit of space. */\nconst TFEDITOR_COLOR_PICKER_MARGIN_X_PX = 2;\n/** If a control point is within this distance of the bottom of the screen, open the color picker upward */\nconst TFEDITOR_COLOR_PICKER_OPEN_UPWARD_MARGIN_PX = 310;\n\nconst TFEDITOR_GRADIENT_MAX_OPACITY = 0.75;\nconst TFEDITOR_NUM_TICKS = 4;\n/**\n * If the first or last \"round\" tick mark is within this ratio of the end of the x axis, remove it to get it out of the\n * way of the tick mark right at the end.\n *\n * For instance, if the x range is [0, 255], the last tick mark d3 generates will likely be at 250. That should be\n * removed to get it out of the way of the tick mark at 255! But if the range is [0, 390], it may be that the last tick\n * mark is at 300. It would make no sense to remove that tick mark to make space for one at 390.\n */\nconst TFEDITOR_END_TICK_MARGIN = 0.1;\n\nconst TFEDITOR_MARGINS = {\n  top: 18,\n  right: 20,\n  bottom: 30, // includes space for x-axis\n  left: 25,\n};\n\nconst MOUSE_EVENT_BUTTONS_PRIMARY = 1;\n\nconst enum TfEditorRampSliderHandle {\n  Min = \"min\",\n  Max = \"max\",\n}\n\ntype TfEditorProps = {\n  id: string;\n  width: number;\n  height: number;\n  channelData: Channel;\n  changeChannelSetting: SingleChannelSettingUpdater;\n  colorizeEnabled: boolean;\n  colorizeAlpha: number;\n  useControlPoints: boolean;\n  controlPoints: ControlPoint[];\n  ramp: [number, number];\n  plotMin: number;\n  plotMax: number;\n};\n\nconst TF_GENERATORS: Record<string, (histogram: Histogram) => Lut> = {\n  autoXF: (histo) => {\n    // Currently unused. min and max are the first and last bins whose values are >=10% that of the max bin\n    const [hmin, hmax] = histo.findAutoMinMax();\n    return new Lut().createFromMinMax(hmin, hmax);\n  },\n  auto2XF: (histo) => {\n    const [hmin, hmax] = histo.findAutoIJBins();\n    return new Lut().createFromMinMax(hmin, hmax);\n  },\n  auto98XF: (histo) => {\n    const hmin = histo.findBinOfPercentile(LUT_MIN_PERCENTILE);\n    const hmax = histo.findBinOfPercentile(LUT_MAX_PERCENTILE);\n    return new Lut().createFromMinMax(hmin, hmax);\n  },\n  bestFitXF: (histo) => {\n    const [hmin, hmax] = histo.findBestFitBins();\n    return new Lut().createFromMinMax(hmin, hmax);\n  },\n  resetXF: (_histo) => new Lut().createFullRange(),\n};\n\n// *---*\n// |   |\n// |   |\n//  \\ /\n//   *\n// width: 0.65 * height; height of rectangle: 0.6 * height; height of triangle: 0.4 * height\nconst sliderHandleSymbol: d3.SymbolType = {\n  draw: (context, size) => {\n    // size is symbol area in px^2\n    const height = Math.sqrt(size * 1.9);\n    const triangleHeight = height * 0.4;\n    const halfWidth = height * 0.325;\n\n    context.moveTo(-halfWidth, -height);\n    context.lineTo(halfWidth, -height);\n    context.lineTo(halfWidth, -triangleHeight);\n    context.lineTo(0, 0);\n    context.lineTo(-halfWidth, -triangleHeight);\n    context.closePath();\n  },\n};\n\nfunction u8ToAbsolute(value: number, channel: { rawMin: number; rawMax: number }): number {\n  return channel.rawMin + (value / 255) * (channel.rawMax - channel.rawMin);\n}\n\nfunction absoluteToU8(value: number, channel: { rawMin: number; rawMax: number }): number {\n  return ((value - channel.rawMin) / (channel.rawMax - channel.rawMin)) * 255;\n}\n\nfunction controlPointToAbsolute(cp: ControlPoint, channel: { rawMin: number; rawMax: number }): number {\n  // the x value of the control point is in the range [0, 255]\n  // because of the way the histogram is generated\n  // (see LUT_ENTRIES and the fact that we use Uint8Array)\n  return u8ToAbsolute(cp.x, channel);\n}\n\n/** For when all control points are outside the plot's range: just fill the plot with the settings from 1 point */\nconst coverRangeWithPoint = (point: ControlPoint, plotMin: number, plotMax: number): ControlPoint[] => {\n  return [\n    { ...point, x: plotMin },\n    { ...point, x: plotMax },\n  ];\n};\n\n/** For when some control points are outside the plot's range: create an intermediate point on the edge of the range */\nconst createPointOnRangeBoundary = (outOfRangePt: ControlPoint, inRangePt: ControlPoint, x: number): ControlPoint => {\n  const rangeRatio = (x - outOfRangePt.x) / (inRangePt.x - outOfRangePt.x);\n  const opacity = outOfRangePt.opacity + (inRangePt.opacity - outOfRangePt.opacity) * rangeRatio;\n  const color = outOfRangePt.color.map((c, i) => c + (inRangePt.color[i] - c) * rangeRatio) as ColorArray;\n  return { x, opacity, color };\n};\n\n/**\n * Ensures the list of `controlPoints` exactly covers the range from `plotMin` to `plotMax` by removing any\n * out-of-range points and adding new points right at the edges of the range.\n */\nconst fitControlPointsToRange = (controlPoints: ControlPoint[], plotMin: number, plotMax: number): ControlPoint[] => {\n  const points = controlPoints.slice();\n\n  const firstPoint = points[0];\n  const lastPoint = points[points.length - 1];\n\n  // If all control points are outside the range, just fill the range with the first or last point.\n  if (lastPoint.x < plotMin) {\n    return coverRangeWithPoint(lastPoint, plotMin, plotMax);\n  }\n  if (firstPoint.x > plotMax) {\n    return coverRangeWithPoint(firstPoint, plotMin, plotMax);\n  }\n\n  if (firstPoint.x > plotMin) {\n    // If the control points don't go all the way to the min, add a new point at the min.\n    points.unshift({ ...firstPoint, x: plotMin });\n  } else {\n    // If some control points are out of range, remove those points...\n    let outOfRangePoint: ControlPoint | undefined = undefined;\n    while (points[0].x < plotMin && points.length > 1) {\n      outOfRangePoint = points.shift();\n    }\n\n    // ...and create a new point at the edge of the range.\n    if (outOfRangePoint !== undefined) {\n      points.unshift(createPointOnRangeBoundary(outOfRangePoint, points[0], plotMin));\n    }\n  }\n\n  if (lastPoint.x < plotMax) {\n    // If the control points don't go all the way to the max, add a new point at the max.\n    points.push({ ...lastPoint, x: plotMax });\n  } else {\n    // If some control points are out of range, remove those points...\n    let outOfRangePoint: ControlPoint | undefined = undefined;\n    while (points[points.length - 1].x > plotMax && points.length > 1) {\n      outOfRangePoint = points.pop();\n    }\n\n    // ...and create a new point at the edge of the range.\n    if (outOfRangePoint !== undefined) {\n      points.push(createPointOnRangeBoundary(outOfRangePoint, points[points.length - 1], plotMax));\n    }\n  }\n\n  return points;\n};\n\n/** Defines an SVG gradient with id `id` based on the provided `controlPoints` */\nconst ControlPointGradientDef: React.FC<{ controlPoints: ControlPoint[]; id: string }> = ({ controlPoints, id }) => {\n  const range = controlPoints[controlPoints.length - 1].x - controlPoints[0].x;\n  return (\n    <defs>\n      <linearGradient id={id} gradientUnits=\"objectBoundingBox\" spreadMethod=\"pad\" x2=\"100%\">\n        {controlPoints.map((cp, i) => {\n          const offset = `${((cp.x - controlPoints[0].x) / range) * 100}%`;\n          const opacity = Math.min(cp.opacity, TFEDITOR_GRADIENT_MAX_OPACITY);\n          return <stop key={i} stopColor={colorArrayToString(cp.color)} stopOpacity={opacity} offset={offset} />;\n        })}\n      </linearGradient>\n    </defs>\n  );\n};\n\n/** Retrieves the bin contents and max bin value from `histogram` */\nfunction getHistogramBinLengths(histogram: Histogram): { binLengths: number[]; max: number } {\n  const binLengths = [];\n  // TODO: Change `histogram.bins` to be readable/readonly\n  // so we don't have to copy it here!\n  let max = Number.NEGATIVE_INFINITY;\n  for (let i = 0; i < histogram.getNumBins(); i++) {\n    const binLength = histogram.getBin(i);\n    binLengths.push(binLength);\n    max = Math.max(max, binLength);\n  }\n  return { binLengths, max };\n}\n\nconst colorPickerPositionToStyle = ([x, y]: [number, number]): React.CSSProperties => ({\n  position: \"absolute\",\n  [x < 0 ? \"right\" : \"left\"]: Math.abs(x),\n  [y < 0 ? \"bottom\" : \"top\"]: y,\n});\n\nconst numberFormatter = (v: number | string | undefined): string => (v === undefined ? \"\" : Number(v).toFixed(0));\n\nconst clamp = (value: number, min: number, max: number): number => Math.min(Math.max(value, min), max);\n\nconst TfEditor: React.FC<TfEditorProps> = (props) => {\n  const { changeChannelSetting, plotMin, plotMax } = props;\n\n  const innerWidth = props.width - TFEDITOR_MARGINS.left - TFEDITOR_MARGINS.right;\n  const innerHeight = props.height - TFEDITOR_MARGINS.top - TFEDITOR_MARGINS.bottom;\n\n  const [selectedPointIdx, setSelectedPointIdx] = useState<number | null>(null);\n  const [draggedPointIdx, _setDraggedPointIdx] = useState<number | TfEditorRampSliderHandle | null>(null);\n\n  const _setCPs = useCallback(\n    (p: ControlPoint[]) => changeChannelSetting({ controlPoints: p }),\n    [changeChannelSetting]\n  );\n  const setRamp = useCallback((ramp: [number, number]) => changeChannelSetting({ ramp: ramp }), [changeChannelSetting]);\n\n  // these bits of state need their freshest, most up-to-date values available in mouse event handlers. make refs!\n  const [controlPointsRef, setControlPoints] = useRefWithSetter(_setCPs, props.controlPoints);\n  const [draggedPointIdxRef, setDraggedPointIdx] = useRefWithSetter(_setDraggedPointIdx, draggedPointIdx);\n\n  // Either `null` when the control panel is closed, or an x offset into the plot to position the color picker.\n  // Positive: offset right from the left edge of the plot; negative: offset left from the right edge of the plot.\n  const [colorPickerPosition, setColorPickerPosition] = useState<[number, number] | null>(null);\n  const lastColorRef = useRef<ColorArray>(TFEDITOR_DEFAULT_COLOR);\n\n  const svgRef = useRef<SVGSVGElement>(null); // need access to SVG element to measure mouse position\n\n  const { rawMin, rawMax, dtype, histogram } = props.channelData;\n  const typeRange = DTYPE_RANGE[dtype];\n\n  // d3 scales define the mapping between data and screen space (and do the heavy lifting of generating plot axes)\n  /** `xScale` is in raw intensity range, not U8 range. We use `u8ToAbsolute` and `absoluteToU8` to translate to U8. */\n  const xScale = useMemo(\n    () => d3.scaleLinear().domain([plotMin, plotMax]).range([0, innerWidth]),\n    [innerWidth, plotMin, plotMax]\n  );\n  const plotMinU8 = useMemo(() => absoluteToU8(plotMin, { rawMin, rawMax }), [plotMin, rawMin, rawMax]);\n  const plotMaxU8 = useMemo(() => absoluteToU8(plotMax, { rawMin, rawMax }), [plotMax, rawMin, rawMax]);\n  const yScale = useMemo(() => d3.scaleLinear().domain([0, 1]).range([innerHeight, 0]), [innerHeight]);\n\n  const mouseEventToControlPointValues = (event: MouseEvent | React.MouseEvent): [number, number] => {\n    const svgRect = svgRef.current?.getBoundingClientRect() ?? { x: 0, y: 0 };\n    return [\n      absoluteToU8(\n        xScale.invert(clamp(event.clientX - svgRect.x - TFEDITOR_MARGINS.left, 0, innerWidth)),\n        props.channelData\n      ),\n      yScale.invert(clamp(event.clientY - svgRect.y - TFEDITOR_MARGINS.top, 0, innerHeight)),\n    ];\n  };\n\n  const dragControlPoint = (draggedIdx: number, x: number, opacity: number): void => {\n    const newControlPoints = [...controlPointsRef.current];\n    const draggedPoint = newControlPoints[draggedIdx];\n    draggedPoint.x = x;\n    draggedPoint.opacity = opacity;\n\n    // Remove control points to keep the list sorted by x value\n    const bisector = d3.bisector<ControlPoint, ControlPoint>((a, b) => a.x - b.x);\n    const idxLeft = bisector.left(newControlPoints, draggedPoint);\n    const idxRight = bisector.right(newControlPoints, draggedPoint);\n\n    if (idxLeft < draggedIdx) {\n      const numPointsToRemove = draggedIdx - idxLeft; // should almost always be 1\n      newControlPoints.splice(idxLeft, numPointsToRemove);\n\n      const newIdx = draggedIdx - numPointsToRemove;\n      setDraggedPointIdx(newIdx);\n      setSelectedPointIdx(newIdx);\n    } else if (idxRight > draggedIdx + 1) {\n      newControlPoints.splice(draggedIdx + 1, idxRight - draggedIdx - 1);\n    }\n\n    setControlPoints(newControlPoints);\n  };\n\n  const dragRampSlider = (handle: TfEditorRampSliderHandle, x: number): void => {\n    if (handle === TfEditorRampSliderHandle.Min) {\n      const max = props.ramp[1];\n      setRamp([Math.min(x, max), max]);\n    } else {\n      const min = props.ramp[0];\n      setRamp([min, Math.max(x, min)]);\n    }\n  };\n\n  const handlePlotPointerDown: React.PointerEventHandler<SVGSVGElement> = (event) => {\n    if (props.useControlPoints) {\n      // Advanced mode - we're either creating a new control point or selecting/dragging an existing one\n      if (draggedPointIdxRef.current === null && event.button === 0) {\n        // this click is not on an existing point - create a new one\n        const [x, opacity] = mouseEventToControlPointValues(event);\n        const point = { x, opacity, color: lastColorRef.current };\n\n        // add new control point to controlPoints\n        const index = d3.bisector<ControlPoint, ControlPoint>((a, b) => a.x - b.x).left(props.controlPoints, point);\n        setDraggedPointIdx(index);\n\n        const newControlPoints = [...props.controlPoints];\n        newControlPoints.splice(index, 0, point);\n        setControlPoints(newControlPoints);\n      } else {\n        // this click is on an existing point - update current points to ref (may have been remapped since last edit)\n        controlPointsRef.current = props.controlPoints;\n      }\n\n      if (typeof draggedPointIdxRef.current !== \"string\") {\n        setSelectedPointIdx(draggedPointIdxRef.current);\n      }\n    }\n\n    if (event.button === 0 && draggedPointIdxRef.current !== null) {\n      // get set up to drag the point around, even if the mouse leaves the SVG element\n      event.currentTarget.setPointerCapture(event.nativeEvent.pointerId);\n    } else {\n      setDraggedPointIdx(null);\n    }\n  };\n\n  const handlePlotPointerMove: React.PointerEventHandler<SVGSVGElement> = (event) => {\n    if (draggedPointIdxRef.current === null) {\n      return;\n    }\n\n    if ((event.buttons & MOUSE_EVENT_BUTTONS_PRIMARY) === 0) {\n      handleDragEnd(event);\n      return;\n    }\n\n    event.stopPropagation();\n    event.preventDefault();\n    const [x, opacity] = mouseEventToControlPointValues(event);\n\n    // `draggedPointIdxRef` may either be a number (control point index) or a string (ramp slider handle).\n    // The result of this check should always be the same as `props.useControlPoints`, but this narrows the type for TS\n    if (typeof draggedPointIdxRef.current === \"number\") {\n      dragControlPoint(draggedPointIdxRef.current, x, opacity);\n    } else {\n      dragRampSlider(draggedPointIdxRef.current, x);\n    }\n  };\n\n  const handleDragEnd: React.PointerEventHandler<SVGSVGElement> = (event) => {\n    setDraggedPointIdx(null);\n    event.currentTarget.releasePointerCapture(event.pointerId);\n  };\n\n  const handleControlPointContextMenu: React.MouseEventHandler<SVGCircleElement> = (event) => {\n    event.preventDefault();\n    if (!event.target || !svgRef.current) {\n      setColorPickerPosition(null);\n      return;\n    }\n\n    const svgRect = svgRef.current.getBoundingClientRect();\n    const cpRect = (event.target as SVGCircleElement).getBoundingClientRect();\n    const cpRectCenter = cpRect.left + cpRect.width / 2;\n\n    // If the control point is closer to the left edge of the SVG, open the color picker to the right\n    const openLeft = cpRectCenter - svgRect.left < svgRect.width / 2;\n    const xPosition = openLeft\n      ? cpRect.right - svgRect.left + TFEDITOR_COLOR_PICKER_MARGIN_X_PX\n      : cpRect.left - svgRect.right - TFEDITOR_COLOR_PICKER_MARGIN_X_PX;\n\n    // If the control point is too close to the bottom of the screen, open the color picker upward\n    const openUp = window.innerHeight - cpRect.bottom < TFEDITOR_COLOR_PICKER_OPEN_UPWARD_MARGIN_PX;\n    const yPosition = openUp ? svgRect.top - cpRect.bottom : cpRect.top - svgRect.top;\n    setColorPickerPosition([xPosition, yPosition]);\n  };\n\n  const handleChangeColor = (color: ColorResult): void => {\n    lastColorRef.current = colorObjectToArray(color.rgb);\n    if (selectedPointIdx !== null) {\n      const newControlPoints = [...props.controlPoints];\n      newControlPoints[selectedPointIdx].color = lastColorRef.current;\n      setControlPoints(newControlPoints);\n    }\n  };\n\n  const controlPointsToRender = useMemo(() => {\n    const points = props.useControlPoints ? props.controlPoints.slice() : rampToControlPoints(props.ramp);\n    return fitControlPointsToRange(points, plotMinU8, plotMaxU8);\n  }, [props.controlPoints, props.ramp, props.useControlPoints, plotMinU8, plotMaxU8]);\n\n  /** d3-generated svg data string representing both the line between points and the region filled with gradient */\n  const areaPath = useMemo(() => {\n    const areaGenerator = d3\n      .area<ControlPoint>()\n      .x((d) => xScale(controlPointToAbsolute(d, { rawMin, rawMax })))\n      .y0((d) => yScale(d.opacity))\n      .y1(innerHeight)\n      .curve(d3.curveLinear);\n    return areaGenerator(controlPointsToRender) ?? undefined;\n  }, [controlPointsToRender, xScale, yScale, innerHeight, rawMin, rawMax]);\n\n  /** d3-generated svg data string representing the \"basic mode\" min/max slider handles */\n  const sliderHandlePath = useMemo(() => d3.symbol().type(sliderHandleSymbol).size(80)() ?? undefined, []);\n\n  // The below `useCallback`s are used as \"ref callbacks\" - passed as the `ref` prop of SVG elements in order to render\n  // these elements' content using D3. They are called when the ref'd component mounts and unmounts, and whenever their\n  // identity changes (i.e. whenever their dependencies change).\n\n  const xAxisRef = useCallback(\n    (el: SVGGElement) => {\n      // generate tick marks\n      const ticks = xScale.ticks(TFEDITOR_NUM_TICKS);\n\n      // make sure we have sensible tick marks right at the min and max of the x axis\n      const [min, max] = xScale.domain();\n      const domain = max - min;\n\n      if ((ticks[0] - min) / domain < TFEDITOR_END_TICK_MARGIN) {\n        ticks[0] = min;\n      } else {\n        ticks.unshift(min);\n      }\n\n      if ((ticks[ticks.length - 1] - min) / domain > 1 - TFEDITOR_END_TICK_MARGIN) {\n        ticks[ticks.length - 1] = max;\n      } else {\n        ticks.push(max);\n      }\n\n      // now make the axis!\n      d3.select(el).call(\n        d3\n          .axisBottom(xScale)\n          .tickValues(ticks)\n          .tickPadding(props.useControlPoints ? 3 : 10) // get tick labels out of the way of sliders in \"basic\" mode\n      );\n    },\n    [xScale, props.useControlPoints]\n  );\n\n  const yAxisRef = useCallback(\n    (el: SVGGElement) => d3.select(el).call(d3.axisLeft(yScale).ticks(TFEDITOR_NUM_TICKS)),\n    [yScale]\n  );\n\n  const histogramRef = useCallback(\n    (el: SVGGElement) => {\n      if (el === null) {\n        return;\n      }\n      const numBins = histogram.getNumBins();\n      if (numBins < 1) {\n        return;\n      }\n      const { binLengths, max } = getHistogramBinLengths(histogram);\n      const start = Math.max(0, Math.ceil(plotMinU8));\n      const end = Math.min(numBins, Math.floor(plotMaxU8));\n      const binLengthsToRender = binLengths.slice(start, end);\n\n      const barWidth = innerWidth / (plotMaxU8 - plotMinU8);\n      const binScale = d3.scaleLog().domain([0.1, max]).range([innerHeight, 0]).base(2).clamp(true);\n\n      d3.select(el)\n        .selectAll(\".bar\") // select all the bars of the histogram\n        .data(binLengthsToRender) // bind the histogram bins to this selection\n        .join(\"rect\") // ensure we have exactly as many bound `rect` elements in the DOM as we have histogram bins\n        .attr(\"class\", \"bar\")\n        .attr(\"width\", barWidth)\n        .attr(\"x\", (_len, idx) => xScale(u8ToAbsolute(idx + start, { rawMin, rawMax }))) // set position and height from data\n        .attr(\"y\", (len) => binScale(len))\n        .attr(\"height\", (len) => innerHeight - binScale(len));\n    },\n    [xScale, rawMin, rawMax, histogram, innerWidth, innerHeight, plotMinU8, plotMaxU8]\n  );\n\n  const applyTFGenerator = useCallback(\n    (generator: string): void => {\n      setSelectedPointIdx(null);\n      lastColorRef.current = TFEDITOR_DEFAULT_COLOR;\n      const lut = TF_GENERATORS[generator](histogram);\n      if (props.useControlPoints) {\n        setControlPoints(lut.controlPoints.map((cp) => ({ ...cp, color: TFEDITOR_DEFAULT_COLOR })));\n      } else {\n        setRamp(controlPointsToRamp(lut.controlPoints));\n      }\n    },\n    [histogram, props.useControlPoints, setControlPoints, setRamp]\n  );\n\n  const createTFGeneratorButton = (generator: string, name: string, description: string): React.ReactNode => (\n    <Tooltip title={description} placement=\"top\">\n      <Button size=\"small\" onClick={() => applyTFGenerator(generator)}>\n        {name}\n      </Button>\n    </Tooltip>\n  );\n\n  // create one svg circle element for each control point\n  const controlPointCircles = props.useControlPoints\n    ? props.controlPoints\n        .filter((cp) => plotMinU8 <= cp.x && cp.x <= plotMaxU8) // filter out-of-range points\n        .map((cp, i) => (\n          <circle\n            key={i}\n            className={i === selectedPointIdx ? \"selected\" : \"\"}\n            cx={xScale(controlPointToAbsolute(cp, props.channelData))}\n            cy={yScale(cp.opacity)}\n            style={{ fill: colorArrayToString(cp.color) }}\n            r={5}\n            onPointerDown={() => setDraggedPointIdx(i)}\n            onContextMenu={handleControlPointContextMenu}\n          />\n        ))\n    : null;\n  // move selected control point to the end so it's drawn last and not occluded by other nearby points\n  if (controlPointCircles !== null && selectedPointIdx !== null) {\n    controlPointCircles.push(controlPointCircles.splice(selectedPointIdx, 1)[0]);\n  }\n\n  const viewerModeString = props.useControlPoints ? \"advanced\" : \"basic\";\n\n  return (\n    <div>\n      {/* ----- PRESET BUTTONS ----- */}\n      <div className=\"button-row\">\n        {createTFGeneratorButton(\"auto98XF\", \"Default\", \"Ramp from 50th percentile to 98th\")}\n        {createTFGeneratorButton(\"auto2XF\", \"IJ Auto\", `Emulates ImageJ's \"auto\" button`)}\n        {createTFGeneratorButton(\"resetXF\", \"Auto 1\", \"Ramp over the full data range (0% to 100%)\")}\n        {createTFGeneratorButton(\"bestFitXF\", \"Auto 2\", \"Ramp over the middle 80% of data\")}\n        <Checkbox\n          checked={props.useControlPoints}\n          onChange={(e) => changeChannelSetting({ useControlPoints: e.target.checked })}\n          style={{ marginLeft: \"auto\" }}\n        >\n          Advanced\n        </Checkbox>\n      </div>\n\n      {/* ----- MIN/MAX SPINBOXES ----- */}\n      {!props.useControlPoints && (\n        <div className=\"tf-editor-control-row ramp-row\">\n          Levels min/max\n          <InputNumber\n            value={u8ToAbsolute(props.ramp[0], props.channelData)}\n            onChange={(v) => v !== null && setRamp([absoluteToU8(v, props.channelData), props.ramp[1]])}\n            formatter={numberFormatter}\n            min={typeRange.min}\n            max={Math.min(u8ToAbsolute(props.ramp[1], props.channelData), typeRange.max)}\n            size=\"small\"\n            controls={false}\n          />\n          <InputNumber\n            value={u8ToAbsolute(props.ramp[1], props.channelData)}\n            onChange={(v) => v !== null && setRamp([props.ramp[0], absoluteToU8(v, props.channelData)])}\n            formatter={numberFormatter}\n            min={Math.max(typeRange.min, u8ToAbsolute(props.ramp[0], props.channelData))}\n            max={typeRange.max}\n            size=\"small\"\n            controls={false}\n          />\n        </div>\n      )}\n\n      {/* ----- CONTROL POINT COLOR PICKER ----- */}\n      {colorPickerPosition !== null && (\n        <div className=\"tf-editor-popover\">\n          <div className=\"tf-editor-cover\" onClick={() => setColorPickerPosition(null)} />\n          <div style={colorPickerPositionToStyle(colorPickerPosition)}>\n            <SketchPicker\n              color={colorArrayToObject(lastColorRef.current)}\n              onChange={handleChangeColor}\n              disableAlpha={true}\n            />\n          </div>\n        </div>\n      )}\n\n      {/* ----- PLOT SVG ----- */}\n      <svg\n        className={`tf-editor-svg ${viewerModeString}${draggedPointIdx !== null ? \" dragging\" : \"\"}`}\n        ref={svgRef}\n        width={props.width}\n        height={props.height}\n        onPointerDown={handlePlotPointerDown}\n        onPointerMove={handlePlotPointerMove}\n        onPointerUp={handleDragEnd}\n      >\n        <ControlPointGradientDef controlPoints={controlPointsToRender} id={`tfGradient-${props.id}`} />\n        <g transform={`translate(${TFEDITOR_MARGINS.left},${TFEDITOR_MARGINS.top})`}>\n          {/* histogram bars */}\n          <g ref={histogramRef} />\n          {/* line between control points, and the gradient under it */}\n          <path className=\"line\" fill={`url(#tfGradient-${props.id})`} d={areaPath} />\n          {/* plot axes */}\n          <g ref={xAxisRef} className=\"axis\" transform={`translate(0,${innerHeight})`} />\n          <g ref={yAxisRef} className=\"axis\" />\n          {/* \"advanced mode\" control points */}\n          {controlPointCircles}\n          {/* \"basic mode\" sliders */}\n          {!props.useControlPoints && (\n            <g className=\"ramp-sliders\">\n              {plotMinU8 <= props.ramp[0] && props.ramp[0] <= plotMaxU8 && (\n                <g transform={`translate(${xScale(u8ToAbsolute(props.ramp[0], props.channelData))})`}>\n                  <line y1={innerHeight} strokeDasharray=\"5,5\" strokeWidth={2} />\n                  <line\n                    className=\"ramp-slider-click-target\"\n                    y1={innerHeight}\n                    strokeWidth={6}\n                    onPointerDown={() => setDraggedPointIdx(TfEditorRampSliderHandle.Min)}\n                  />\n                  <path\n                    d={sliderHandlePath}\n                    transform={`translate(0,${innerHeight}) rotate(180)`}\n                    onPointerDown={() => setDraggedPointIdx(TfEditorRampSliderHandle.Min)}\n                  />\n                </g>\n              )}\n              {plotMinU8 <= props.ramp[1] && props.ramp[1] <= plotMaxU8 && (\n                <g transform={`translate(${xScale(u8ToAbsolute(props.ramp[1], props.channelData))})`}>\n                  <line y1={innerHeight} strokeDasharray=\"5,5\" strokeWidth={2} />\n                  <line\n                    className=\"ramp-slider-click-target\"\n                    y1={innerHeight}\n                    strokeWidth={6}\n                    onPointerDown={() => setDraggedPointIdx(TfEditorRampSliderHandle.Max)}\n                  />\n                  <path d={sliderHandlePath} onPointerDown={() => setDraggedPointIdx(TfEditorRampSliderHandle.Max)} />\n                </g>\n              )}\n            </g>\n          )}\n        </g>\n      </svg>\n\n      {/* ----- PLOT RANGE ----- */}\n      <div className=\"tf-editor-control-row plot-range-row\">\n        Plot min/max\n        <InputNumber\n          value={plotMin}\n          onChange={(v) => v !== null && changeChannelSetting({ plotMin: v, plotMax: Math.max(v + 1, plotMax) })}\n          formatter={numberFormatter}\n          min={typeRange.min}\n          max={typeRange.max - 1}\n          size=\"small\"\n          controls={false}\n        />\n        <InputNumber\n          value={plotMax}\n          onChange={(v) => v !== null && changeChannelSetting({ plotMax: v, plotMin: Math.min(v - 1, plotMin) })}\n          formatter={numberFormatter}\n          min={typeRange.min + 1}\n          max={typeRange.max}\n          size=\"small\"\n          controls={false}\n        />\n        <Button\n          size=\"small\"\n          style={{ marginLeft: \"12px\" }}\n          onClick={() => changeChannelSetting({ plotMin: rawMin, plotMax: rawMax })}\n        >\n          Fit to data\n        </Button>\n        <Button size=\"small\" onClick={() => changeChannelSetting({ plotMin: typeRange.min, plotMax: typeRange.max })}>\n          Full range\n        </Button>\n      </div>\n\n      {/* ----- COLORIZE SLIDER ----- */}\n      <SliderRow\n        label={\n          <Checkbox\n            checked={props.colorizeEnabled}\n            onChange={(e) => changeChannelSetting({ colorizeEnabled: e.target.checked })}\n          >\n            Colorize\n          </Checkbox>\n        }\n        max={1}\n        start={props.colorizeAlpha}\n        onUpdate={(values) => changeChannelSetting({ colorizeAlpha: values[0] })}\n        hideSlider={!props.colorizeEnabled}\n      />\n    </div>\n  );\n};\n\nexport default TfEditor;\n","import { Channel } from \"@aics/vole-core\";\nimport { Button, Checkbox, List } from \"antd\";\nimport { CheckboxChangeEvent } from \"antd/lib/checkbox\";\nimport React, { useCallback, useState } from \"react\";\n\nimport { ISOSURFACE_OPACITY_SLIDER_MAX } from \"../../shared/constants\";\nimport { IsosurfaceFormat } from \"../../shared/types\";\nimport { colorArrayToObject, ColorObject, colorObjectToArray } from \"../../shared/utils/colorRepresentations\";\nimport {\n  type ChannelSettingUpdater,\n  type ChannelState,\n  type SingleChannelSettingUpdater,\n} from \"../ViewerStateProvider/types\";\n\nimport ColorPicker from \"../ColorPicker\";\nimport SliderRow from \"../shared/SliderRow\";\nimport ViewerIcon from \"../shared/ViewerIcon\";\nimport TfEditor from \"../TfEditor\";\n\nimport \"./styles.css\";\n\ninterface ChannelsWidgetRowProps {\n  index: number;\n  name: string;\n  channelState: ChannelState;\n  channelDataForChannel: Channel;\n\n  changeChannelSetting: ChannelSettingUpdater;\n\n  saveIsosurface: (channelIndex: number, type: IsosurfaceFormat) => void;\n  onColorChangeComplete?: (newRGB: ColorObject, oldRGB?: ColorObject, index?: number) => void;\n}\n\nconst ChannelsWidgetRow: React.FC<ChannelsWidgetRowProps> = (props: ChannelsWidgetRowProps) => {\n  const { index, changeChannelSetting, saveIsosurface, channelState } = props;\n  const [controlsOpen, setControlsOpen] = useState(false);\n\n  const changeSettingForThisChannel = useCallback<SingleChannelSettingUpdater>(\n    (value) => changeChannelSetting(index, value),\n    [changeChannelSetting, index]\n  );\n\n  const volumeCheckHandler = ({ target }: CheckboxChangeEvent): void => {\n    changeChannelSetting(index, { volumeEnabled: target.checked });\n  };\n\n  const isosurfaceCheckHandler = ({ target }: CheckboxChangeEvent): void => {\n    changeChannelSetting(index, { isosurfaceEnabled: target.checked });\n  };\n\n  const onIsovalueChange = ([newValue]: number[]): void => changeSettingForThisChannel({ isovalue: newValue });\n  const onOpacityChange = ([newValue]: number[]): void =>\n    changeSettingForThisChannel({ opacity: newValue / ISOSURFACE_OPACITY_SLIDER_MAX });\n\n  const onColorChange = (newRGB: ColorObject, _oldRGB?: ColorObject, index?: number): void => {\n    const color = colorObjectToArray(newRGB);\n    props.changeChannelSetting(index!, { color: color });\n  };\n\n  const createColorPicker = (): React.ReactNode => (\n    <ColorPicker\n      color={colorArrayToObject(channelState.color)}\n      onColorChange={onColorChange}\n      onColorChangeComplete={props.onColorChangeComplete}\n      disableAlpha={true}\n      idx={index}\n      width={18}\n    />\n  );\n\n  const visibilityControls = (\n    <div className=\"channel-visibility-controls\">\n      <Checkbox checked={channelState.volumeEnabled} onChange={volumeCheckHandler}>\n        Vol\n      </Checkbox>\n      <Checkbox checked={channelState.isosurfaceEnabled} onChange={isosurfaceCheckHandler}>\n        Surf\n      </Checkbox>\n      <Button\n        icon={<ViewerIcon type=\"preferences\" style={{ fontSize: \"16px\" }} />}\n        onClick={() => setControlsOpen(!controlsOpen)}\n        title=\"Open channel settings\"\n        type=\"text\"\n      />\n    </div>\n  );\n\n  const createTFEditor = (): React.ReactNode => {\n    const { controlPoints, colorizeEnabled, colorizeAlpha, useControlPoints, ramp, plotMin, plotMax } = channelState;\n    return (\n      <TfEditor\n        id={\"TFEditor\" + index}\n        width={418}\n        height={145}\n        channelData={props.channelDataForChannel}\n        controlPoints={controlPoints}\n        changeChannelSetting={changeSettingForThisChannel}\n        colorizeEnabled={colorizeEnabled}\n        colorizeAlpha={colorizeAlpha}\n        useControlPoints={useControlPoints}\n        ramp={ramp}\n        plotMin={plotMin}\n        plotMax={plotMax}\n      />\n    );\n  };\n\n  const renderSurfaceControls = (): React.ReactNode => (\n    <div>\n      <SliderRow\n        label=\"Isovalue\"\n        max={255}\n        start={channelState.isovalue}\n        onChange={onIsovalueChange}\n        formatInteger={true}\n      />\n      <SliderRow\n        label=\"Opacity\"\n        max={ISOSURFACE_OPACITY_SLIDER_MAX}\n        start={channelState.opacity * ISOSURFACE_OPACITY_SLIDER_MAX}\n        onChange={onOpacityChange}\n        formatInteger={true}\n      />\n      <div className=\"button-row\">\n        <Button onClick={() => saveIsosurface(index, \"GLTF\")}>Export GLTF</Button>\n        <Button onClick={() => saveIsosurface(index, \"STL\")}>Export STL</Button>\n      </div>\n    </div>\n  );\n\n  const renderControls = (): React.ReactNode => {\n    if (!channelState.volumeEnabled && !channelState.isosurfaceEnabled) {\n      return <h4 style={{ fontStyle: \"italic\" }}>Not currently visible</h4>;\n    }\n    return (\n      <>\n        {channelState.volumeEnabled && (\n          <>\n            <h4>Volume settings:</h4>\n            {createTFEditor()}\n          </>\n        )}\n        {channelState.isosurfaceEnabled && (\n          <>\n            <h4>Surface settings:</h4>\n            {renderSurfaceControls()}\n          </>\n        )}\n      </>\n    );\n  };\n\n  const rowClass = controlsOpen ? \"channel-row\" : \"channel-row controls-closed\";\n  return (\n    <List.Item key={index} className={rowClass}>\n      <List.Item.Meta title={props.name} avatar={createColorPicker()} />\n      {visibilityControls}\n      {controlsOpen && <div style={{ width: \"100%\" }}>{renderControls()}</div>}\n    </List.Item>\n  );\n};\n\nexport default ChannelsWidgetRow;\n","import React from \"react\";\nimport { Checkbox } from \"antd\";\nimport { CheckboxChangeEvent } from \"antd/lib/checkbox\";\n\ntype SharedCheckboxProps<T> = React.PropsWithChildren<{\n  allOptions: T[];\n  checkedList: T[];\n  onChange: (checked: boolean, checkedList: T[]) => void;\n  style?: React.CSSProperties;\n}>;\n\nconst SharedCheckbox = <T,>(props: SharedCheckboxProps<T>): React.ReactElement => {\n  const onCheckAllChange = ({ target }: CheckboxChangeEvent): void => props.onChange(target.checked, props.allOptions);\n\n  const indeterminate = !!props.checkedList.length && props.checkedList.length < props.allOptions.length;\n  const checkAll = props.checkedList.length === props.allOptions.length;\n\n  return (\n    <Checkbox indeterminate={indeterminate} onChange={onCheckAllChange} checked={checkAll} style={props.style}>\n      {props.children}\n    </Checkbox>\n  );\n};\n\nexport default SharedCheckbox;\n","import { Channel } from \"@aics/vole-core\";\nimport { Collapse, CollapseProps, List } from \"antd\";\nimport React from \"react\";\n\nimport type { IsosurfaceFormat } from \"../shared/types\";\nimport type { ColorArray, ColorObject } from \"../shared/utils/colorRepresentations\";\nimport type { ChannelGrouping, ViewerChannelSettings } from \"../shared/utils/viewerChannelSettings\";\nimport { getDisplayName } from \"../shared/utils/viewerChannelSettings\";\nimport type { ChannelSettingUpdater, ChannelState, ChannelStateKey } from \"./ViewerStateProvider/types\";\n\nimport ChannelsWidgetRow from \"./ChannelsWidgetRow\";\nimport SharedCheckBox from \"./shared/SharedCheckBox\";\nimport { connectToViewerState } from \"./ViewerStateProvider\";\n\nexport type ChannelsWidgetProps = {\n  // From parent\n  channelDataChannels: Channel[] | undefined;\n  channelGroupedByType: ChannelGrouping;\n  viewerChannelSettings?: ViewerChannelSettings;\n\n  saveIsosurface: (channelIndex: number, type: IsosurfaceFormat) => void;\n  onApplyColorPresets: (presets: ColorArray[]) => void;\n\n  filterFunc?: (key: string) => boolean;\n  onColorChangeComplete?: (newRGB: ColorObject, oldRGB?: ColorObject, index?: number) => void;\n\n  // From viewer state\n  channelSettings: ChannelState[];\n  changeChannelSetting: ChannelSettingUpdater;\n};\n\nconst ChannelsWidget: React.FC<ChannelsWidgetProps> = (props: ChannelsWidgetProps) => {\n  const { channelGroupedByType, channelSettings, channelDataChannels, filterFunc, viewerChannelSettings } = props;\n\n  const createCheckboxHandler = (key: ChannelStateKey) => (value: boolean, channelArray: number[]) => {\n    props.changeChannelSetting(channelArray, { [key]: value });\n  };\n\n  const showVolumes = createCheckboxHandler(\"volumeEnabled\");\n  const showSurfaces = createCheckboxHandler(\"isosurfaceEnabled\");\n\n  const renderVisibilityControls = (channelArray: number[]): React.ReactNode => {\n    let volChecked: number[] = [];\n    let isoChecked: number[] = [];\n    channelArray.forEach((channelIndex: number) => {\n      const channelSetting = channelSettings[channelIndex];\n      if (!channelSetting) return;\n      if (channelSetting.volumeEnabled) {\n        volChecked.push(channelIndex);\n      }\n      if (channelSetting.isosurfaceEnabled) {\n        isoChecked.push(channelIndex);\n      }\n    });\n\n    return (\n      <>\n        <SharedCheckBox allOptions={channelArray} checkedList={volChecked} onChange={showVolumes}>\n          All Vol\n        </SharedCheckBox>\n        <SharedCheckBox\n          allOptions={channelArray}\n          checkedList={isoChecked}\n          onChange={showSurfaces}\n          // keep checkboxes lined up when channel rows have settings icon and headers don't\n          style={{ flex: 5 }}\n        >\n          All Surf\n        </SharedCheckBox>\n      </>\n    );\n  };\n\n  const renderChannelRow = (channelIndex: number): React.ReactNode => {\n    const thisChannelSettings = channelSettings[channelIndex];\n\n    return thisChannelSettings ? (\n      <ChannelsWidgetRow\n        key={`${channelIndex}_${thisChannelSettings.name}_${channelIndex}`}\n        index={channelIndex}\n        channelDataForChannel={channelDataChannels![channelIndex]}\n        name={getDisplayName(thisChannelSettings.name, channelIndex, viewerChannelSettings)}\n        channelState={thisChannelSettings}\n        changeChannelSetting={props.changeChannelSetting}\n        onColorChangeComplete={props.onColorChangeComplete}\n        saveIsosurface={props.saveIsosurface}\n      />\n    ) : null;\n  };\n\n  const firstKey = Object.keys(channelGroupedByType)[0];\n  const rows: CollapseProps[\"items\"] =\n    channelDataChannels &&\n    Object.entries(channelGroupedByType)\n      .filter(([key, channelArray]) => channelArray.length > 0 && (!filterFunc || filterFunc(key)))\n      .map(([key, channelArray]) => {\n        const children = <List itemLayout=\"horizontal\" dataSource={channelArray} renderItem={renderChannelRow} />;\n\n        return {\n          key,\n          label: key,\n          children,\n          extra: renderVisibilityControls(channelArray),\n        };\n      });\n\n  return <Collapse bordered={false} defaultActiveKey={firstKey} items={rows} collapsible=\"icon\" />;\n};\n\nexport default connectToViewerState(ChannelsWidget, [\"channelSettings\", \"changeChannelSetting\"]);\n","import React from \"react\";\n\nimport ColorPicker from \"./ColorPicker\";\nimport { ColorArray, colorArrayToObject, colorObjectToArray } from \"../shared/utils/colorRepresentations\";\nimport { Styles } from \"../shared/types\";\nimport { ViewerSettingUpdater } from \"./ViewerStateProvider/types\";\nimport { connectToViewerState } from \"./ViewerStateProvider\";\n\nconst ColorPickerRow: React.FC<{\n  color: ColorArray;\n  onColorChange: (color: ColorArray) => void;\n  children?: React.ReactNode;\n}> = ({ color, onColorChange, children }) => (\n  <div style={STYLES.colorPickerRow}>\n    <span style={STYLES.colorPicker}>\n      <ColorPicker\n        color={colorArrayToObject(color)}\n        onColorChange={(color) => onColorChange(colorObjectToArray(color))}\n        width={18}\n        disableAlpha={true}\n      />\n    </span>\n    <span>{children}</span>\n  </div>\n);\n\nexport interface CustomizeWidgetProps {\n  // From parent\n  visibleControls: {\n    backgroundColorPicker: boolean;\n    boundingBoxColorPicker: boolean;\n  };\n\n  // From viewer state\n  showBoundingBox: boolean;\n  backgroundColor: ColorArray;\n  boundingBoxColor: ColorArray;\n\n  changeViewerSetting: ViewerSettingUpdater;\n}\n\nconst CustomizeWidget: React.FC<CustomizeWidgetProps> = (props) => (\n  <>\n    {props.visibleControls.backgroundColorPicker && (\n      <ColorPickerRow\n        color={props.backgroundColor}\n        onColorChange={(color) => props.changeViewerSetting(\"backgroundColor\", color)}\n      >\n        Background color\n      </ColorPickerRow>\n    )}\n    {props.visibleControls.boundingBoxColorPicker && (\n      <ColorPickerRow\n        color={props.boundingBoxColor}\n        onColorChange={(color) => props.changeViewerSetting(\"boundingBoxColor\", color)}\n      >\n        Bounding box color\n        {!props.showBoundingBox && <i> - bounding box turned off</i>}\n      </ColorPickerRow>\n    )}\n  </>\n);\n\nconst STYLES: Styles = {\n  colorPickerRow: {\n    padding: \"14px 0\",\n    display: \"flex\",\n    borderBottom: \"1px solid #6e6e6e\",\n    color: \"var(--color-controlpanel-text)\",\n  },\n  colorPicker: {\n    marginRight: \"16px\",\n  },\n};\n\nexport default connectToViewerState(CustomizeWidget, [\n  \"showBoundingBox\",\n  \"backgroundColor\",\n  \"boundingBoxColor\",\n  \"changeViewerSetting\",\n]);\n","import React from \"react\";\nimport { Checkbox } from \"antd\";\n\nimport SliderRow from \"./shared/SliderRow\";\nimport { connectToViewerState } from \"./ViewerStateProvider\";\nimport { ViewerSettingUpdater } from \"./ViewerStateProvider/types\";\n\ntype GlobalVolumeControlKey = \"maskAlpha\" | \"brightness\" | \"density\" | \"levels\";\n\nexport interface GlobalVolumeControlsProps {\n  // From parent\n  imageName: string | undefined;\n  pixelSize: [number, number, number];\n  visibleControls: {\n    alphaMaskSlider: boolean;\n    brightnessSlider: boolean;\n    densitySlider: boolean;\n    levelsSliders: boolean;\n    interpolationControl: boolean;\n  };\n\n  // From viewer state\n  maskAlpha: number;\n  brightness: number;\n  density: number;\n  levels: [number, number, number];\n  interpolationEnabled: boolean;\n\n  changeViewerSetting: ViewerSettingUpdater;\n}\n\nconst GlobalVolumeControls: React.FC<GlobalVolumeControlsProps> = (props) => {\n  const createSliderRow = (\n    label: string,\n    start: number | number[],\n    max: number,\n    propKey: GlobalVolumeControlKey\n  ): React.ReactNode => {\n    const onUpdate = (_strValues: string[], _handle: number, values: number[]): void => {\n      const selectValue = values.length === 1 ? values[0] : (values as [number, number, number]);\n      props.changeViewerSetting(propKey, selectValue);\n    };\n\n    return <SliderRow label={label} start={start} max={max} onUpdate={onUpdate} />;\n  };\n\n  const { visibleControls: showControls, maskAlpha, brightness, density, levels } = props;\n\n  return (\n    <div style={{ paddingTop: 18, paddingBottom: 22 }}>\n      {showControls.alphaMaskSlider && createSliderRow(\"mask cell\", maskAlpha, 100, \"maskAlpha\")}\n      {showControls.brightnessSlider && createSliderRow(\"brightness\", brightness, 100, \"brightness\")}\n      {showControls.densitySlider && createSliderRow(\"density\", density, 100, \"density\")}\n      {showControls.levelsSliders && createSliderRow(\"levels\", levels, 255, \"levels\")}\n      {showControls.interpolationControl && (\n        <SliderRow label=\"interpolate\">\n          <Checkbox\n            checked={props.interpolationEnabled}\n            onChange={({ target }) => props.changeViewerSetting(\"interpolationEnabled\", target.checked)}\n          />\n        </SliderRow>\n      )}\n    </div>\n  );\n};\n\nexport default connectToViewerState(GlobalVolumeControls, [\n  \"maskAlpha\",\n  \"brightness\",\n  \"density\",\n  \"levels\",\n  \"interpolationEnabled\",\n  \"changeViewerSetting\",\n]);\n","import { RightOutlined } from \"@ant-design/icons\";\nimport React from \"react\";\n\nimport { MetadataEntry, MetadataRecord } from \"../../shared/types\";\n\nimport \"./styles.css\";\n\ntype MetadataTableProps = {\n  metadata: MetadataRecord | MetadataEntry[];\n  topLevel?: boolean;\n};\n\ntype CollapsibleCategoryProps = {\n  metadata: MetadataRecord | MetadataEntry[];\n  title: string;\n};\n\nconst isCategory = (entry: MetadataEntry): entry is MetadataRecord | MetadataEntry[] =>\n  typeof entry === \"object\" && entry !== null;\n\nconst sortCategoriesFirst = (entry: MetadataEntry): MetadataEntry => {\n  if (!isCategory(entry) || Array.isArray(entry)) {\n    return entry;\n  }\n\n  const cats: MetadataRecord = {};\n  const vals: MetadataRecord = {};\n  for (const key in entry) {\n    if (isCategory(entry[key])) {\n      cats[key] = entry[key];\n    } else {\n      vals[key] = entry[key];\n    }\n  }\n\n  return { ...cats, ...vals };\n};\n\n/** Component to hold collapse state */\nconst MetadataCategory: React.FC<CollapsibleCategoryProps> = ({ metadata, title }) => {\n  const [collapsed, setCollapsed] = React.useState(true);\n  const collapsedClass = collapsed ? \" metadata-collapse-collapsed\" : \"\";\n\n  return (\n    <>\n      <tr className={\"metadata-row-collapse-title\" + collapsedClass} onClick={() => setCollapsed(!collapsed)}>\n        <td colSpan={2}>\n          <span className=\"metadata-collapse-caret\">\n            <RightOutlined style={{ transform: `rotate(${collapsed ? 0 : 90}deg)` }} />\n          </span>\n          {title}\n        </td>\n      </tr>\n      <tr className={\"metadata-row-collapse-content\" + collapsedClass}>\n        <td className=\"metadata-collapse-content\" colSpan={2}>\n          <MetadataTable metadata={metadata} />\n        </td>\n      </tr>\n    </>\n  );\n};\n\nconst MetadataTable: React.FC<MetadataTableProps> = ({ metadata, topLevel }) => {\n  const metadataKeys = Object.keys(metadata);\n  const metadataIsArray = Array.isArray(metadata);\n\n  return (\n    <table className={\"viewer-metadata-table\" + (topLevel ? \" metadata-top-level\" : \"\")}>\n      <tbody>\n        {metadataKeys.map((key, idx) => {\n          const metadataValue = sortCategoriesFirst(metadataIsArray ? metadata[idx] : metadata[key]);\n\n          if (isCategory(metadataValue)) {\n            return <MetadataCategory key={key} metadata={metadataValue} title={key} />;\n          } else {\n            return (\n              <tr key={key}>\n                <td className=\"metadata-key\">{key}</td>\n                <td className=\"metadata-value\">{metadataValue + \"\"}</td>\n              </tr>\n            );\n          }\n        })}\n      </tbody>\n    </table>\n  );\n};\n\nconst MetadataViewer: React.FC<{ metadata: MetadataRecord }> = ({ metadata }) => (\n  <MetadataTable metadata={metadata} topLevel={true} />\n);\n\nexport default MetadataViewer;\n","import { Button, Collapse, CollapseProps, Dropdown, Flex, MenuProps, Tooltip } from \"antd\";\nimport { MenuInfo } from \"rc-menu/lib/interface\";\nimport React from \"react\";\n\nimport { PRESET_COLOR_MAP } from \"../../shared/constants\";\nimport { MetadataRecord } from \"../../shared/types\";\n\nimport ChannelsWidget from \"../ChannelsWidget\";\nimport CustomizeWidget, { CustomizeWidgetProps } from \"../CustomizeWidget\";\nimport GlobalVolumeControls, { GlobalVolumeControlsProps } from \"../GlobalVolumeControls\";\nimport MetadataViewer from \"../MetadataViewer\";\nimport ViewerIcon from \"../shared/ViewerIcon\";\nimport { connectToViewerState } from \"../ViewerStateProvider\";\n\nimport \"./styles.css\";\n\ntype PropsOf<T> = T extends React.ComponentType<infer P> ? P : never;\n\ninterface ControlPanelProps\n  extends PropsOf<typeof ChannelsWidget>,\n    PropsOf<typeof GlobalVolumeControls>,\n    PropsOf<typeof CustomizeWidget> {\n  hasImage: boolean;\n  visibleControls: GlobalVolumeControlsProps[\"visibleControls\"] &\n    CustomizeWidgetProps[\"visibleControls\"] & {\n      colorPresetsDropdown: boolean;\n      metadataViewer: boolean;\n    };\n  getMetadata: () => MetadataRecord;\n  collapsed: boolean;\n  setCollapsed: (value: boolean) => void;\n  resetToDefaultViewerState: () => void;\n}\n\nconst enum ControlTab {\n  Channels,\n  Advanced,\n  Metadata,\n}\n\nconst ControlTabNames = {\n  [ControlTab.Channels]: \"Channel Settings\",\n  [ControlTab.Advanced]: \"Advanced Settings\",\n  [ControlTab.Metadata]: \"Metadata\",\n};\n\nfunction ControlPanel(props: ControlPanelProps): React.ReactElement {\n  const [tab, _setTab] = React.useState(ControlTab.Channels);\n  const setTab = (newTab: ControlTab): void => {\n    _setTab(newTab);\n    props.setCollapsed(false);\n  };\n\n  const controlPanelContainerRef = React.useRef<HTMLDivElement>(null);\n  const getDropdownContainer = controlPanelContainerRef.current ? () => controlPanelContainerRef.current! : undefined;\n\n  const { viewerChannelSettings, visibleControls, hasImage } = props;\n\n  // TODO key is a number, but MenuInfo assumes keys will always be strings\n  //   if future versions of antd make this type more permissive, remove ugly double-cast\n  const makeTurnOnPresetFn = ({ key }: MenuInfo): void =>\n    props.onApplyColorPresets(PRESET_COLOR_MAP[key as unknown as number].colors);\n\n  const renderColorPresetsDropdown = (): React.ReactNode => {\n    const dropDownMenuProps: MenuProps = {\n      items: PRESET_COLOR_MAP.map((preset, index) => {\n        return { key: index, label: preset.name };\n      }),\n      onClick: makeTurnOnPresetFn,\n    };\n    return (\n      <div className=\"color-presets-dropdown\">\n        <Dropdown trigger={[\"click\"]} menu={dropDownMenuProps} getPopupContainer={getDropdownContainer}>\n          <Button>\n            <div style={{ display: \"flex\", flexDirection: \"row\", alignItems: \"center\", gap: \"4px\" }}>\n              Apply palette\n              <ViewerIcon type=\"dropdownArrow\" style={{ fontSize: \"14px\" }} />\n            </div>\n          </Button>\n        </Dropdown>\n      </div>\n    );\n  };\n\n  const renderTab = (thisTab: ControlTab, icon: React.ReactNode): React.ReactNode => (\n    <Tooltip title={ControlTabNames[thisTab]} placement=\"right\" {...(!props.collapsed && { open: false })}>\n      <Button\n        className={tab === thisTab ? \"ant-btn-icon-only btn-tabactive\" : \"ant-btn-icon-only\"}\n        onClick={() => setTab(thisTab)}\n        icon={typeof icon === \"string\" ? icon : undefined}\n      >\n        {typeof icon === \"object\" && icon}\n      </Button>\n    </Tooltip>\n  );\n\n  const renderAdvancedSettings = (): React.ReactNode => {\n    const items: CollapseProps[\"items\"] = [\n      {\n        key: 0,\n        label: \"Rendering adjustments\",\n        children: (\n          <GlobalVolumeControls\n            imageName={props.imageName}\n            pixelSize={props.pixelSize}\n            visibleControls={visibleControls}\n          />\n        ),\n      },\n    ];\n    const showCustomize = visibleControls.backgroundColorPicker || visibleControls.boundingBoxColorPicker;\n\n    if (showCustomize) {\n      items.push({\n        key: 1,\n        label: \"Customize\",\n        children: <CustomizeWidget visibleControls={props.visibleControls} />,\n      });\n    }\n\n    return (\n      <Flex gap={10} vertical>\n        <Collapse bordered={false} defaultActiveKey={showCustomize ? [0, 1] : 0} items={items} />\n        <div style={{ margin: \"0 10px\", width: \"fit-content\" }}>\n          <Tooltip\n            trigger={[\"hover\", \"focus\"]}\n            placement=\"right\"\n            title=\"Clears ALL rendering settings and channel configuration to the default viewer state.\n            This will replace any edits to channel settings, color presets, and rendering adjustments.\"\n          >\n            <Button onClick={props.resetToDefaultViewerState}>Clear all settings</Button>\n          </Tooltip>\n        </div>\n      </Flex>\n    );\n  };\n\n  return (\n    <div className=\"control-panel-col-container\" ref={controlPanelContainerRef}>\n      <div className=\"control-panel-tab-col\" style={{ flex: \"0 0 50px\" }}>\n        <Button\n          className={\"ant-btn-icon-only btn-collapse\" + (props.collapsed ? \" btn-collapse-collapsed\" : \"\")}\n          onClick={() => props.setCollapsed(!props.collapsed)}\n        >\n          <ViewerIcon type=\"closePanel\" />\n        </Button>\n\n        <div className=\"tab-divider\" />\n\n        {renderTab(ControlTab.Channels, <ViewerIcon type=\"channels\" />)}\n        {renderTab(ControlTab.Advanced, <ViewerIcon type=\"preferences\" />)}\n        {props.visibleControls.metadataViewer && renderTab(ControlTab.Metadata, <ViewerIcon type=\"metadata\" />)}\n      </div>\n      <div className=\"control-panel-col\" style={{ flex: \"0 0 450px\" }}>\n        <h2 className=\"control-panel-title\">{ControlTabNames[tab]}</h2>\n        {visibleControls.colorPresetsDropdown && tab === ControlTab.Channels && renderColorPresetsDropdown()}\n        {hasImage && (\n          <div className=\"channel-rows-list\">\n            {tab === ControlTab.Channels && (\n              <ChannelsWidget\n                channelDataChannels={props.channelDataChannels}\n                channelGroupedByType={props.channelGroupedByType}\n                saveIsosurface={props.saveIsosurface}\n                onColorChangeComplete={props.onColorChangeComplete}\n                onApplyColorPresets={props.onApplyColorPresets}\n                filterFunc={props.filterFunc}\n                viewerChannelSettings={viewerChannelSettings}\n              />\n            )}\n            {tab === ControlTab.Advanced && renderAdvancedSettings()}\n            {tab === ControlTab.Metadata && <MetadataViewer metadata={props.getMetadata()} />}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\nexport default connectToViewerState(ControlPanel, [\"resetToDefaultViewerState\"]);\n","import React from \"react\";\nimport { Dropdown, Button, MenuProps, Tooltip } from \"antd\";\n\nimport ViewerIcon from \"../shared/ViewerIcon\";\n\ninterface DownloadButtonProps {\n  cellDownloadHref: string;\n  fovDownloadHref: string;\n  hasFov: boolean;\n}\n\nconst DownloadButton: React.FC<DownloadButtonProps> = ({ fovDownloadHref, cellDownloadHref, hasFov }) => {\n  if (hasFov) {\n    const menu: MenuProps = {\n      className: \"download-dropdown\",\n      items: [\n        {\n          key: \"1\",\n          label: (\n            <a href={cellDownloadHref}>\n              <ViewerIcon type=\"download\" /> Segmented cell\n            </a>\n          ),\n        },\n        {\n          key: \"2\",\n          label: (\n            <a href={fovDownloadHref}>\n              <ViewerIcon type=\"download\" /> Full field image\n            </a>\n          ),\n        },\n      ],\n    };\n    return (\n      <Tooltip trigger={[\"hover\", \"focus\"]} placement=\"bottom\" title={\"Download volume data\"}>\n        <Dropdown menu={menu} placement=\"bottomRight\" trigger={[\"click\"]}>\n          <Button className=\"ant-btn-icon-only btn-borderless\">\n            <ViewerIcon type=\"download\" />\n          </Button>\n        </Dropdown>\n      </Tooltip>\n    );\n  } else if (cellDownloadHref) {\n    return (\n      <Tooltip trigger={[\"hover\", \"focus\"]} placement=\"bottom\" title={\"Download volume data\"}>\n        <Button className=\"ant-btn-icon-only btn-borderless\" href={cellDownloadHref}>\n          <ViewerIcon type=\"download\" />\n        </Button>\n      </Tooltip>\n    );\n  } else {\n    return null;\n  }\n};\n\nexport default DownloadButton;\n","import { Radio } from \"antd\";\nimport { RadioChangeEvent } from \"antd/lib/radio\";\nimport React from \"react\";\n\nimport { ViewMode } from \"../../shared/enums\";\n\nconst viewModes = [ViewMode.threeD, ViewMode.xy, ViewMode.xz, ViewMode.yz];\n\ninterface ViewModeRadioButtonsProps {\n  mode: ViewMode;\n  onViewModeChange: (newMode: ViewMode) => void;\n}\n\nconst ViewModeRadioButtons: React.FC<ViewModeRadioButtonsProps> = (props) => {\n  const onChangeButton = ({ target }: RadioChangeEvent): void => {\n    if (props.mode !== target.value) {\n      props.onViewModeChange(target.value);\n    }\n  };\n\n  return (\n    <Radio.Group onChange={onChangeButton} value={props.mode.toString()}>\n      {viewModes.map((mode, index) => (\n        <Radio.Button key={index} value={mode.toString()}>\n          {mode}\n        </Radio.Button>\n      ))}\n    </Radio.Group>\n  );\n};\n\nexport default ViewModeRadioButtons;\n","import { ReloadOutlined } from \"@ant-design/icons\";\nimport { Button, Radio, Select, Tooltip } from \"antd\";\nimport { debounce } from \"lodash\";\nimport React from \"react\";\n\nimport { ImageType, RenderMode, ViewMode } from \"../../shared/enums\";\nimport { ViewerSettingUpdater } from \"../ViewerStateProvider/types\";\n\nimport ViewerIcon from \"../shared/ViewerIcon\";\nimport { connectToViewerState } from \"../ViewerStateProvider\";\nimport DownloadButton from \"./DownloadButton\";\nimport ViewModeRadioButtons from \"./ViewModeRadioButtons\";\n\nimport \"./styles.css\";\n\ntype ToolbarProps = {\n  // From parent\n  cellDownloadHref: string;\n  fovDownloadHref: string;\n  hasCellId: boolean;\n  hasParentImage: boolean;\n  canPathTrace: boolean;\n\n  resetCamera: () => void;\n  downloadScreenshot: () => void;\n\n  visibleControls: {\n    autoRotateButton: boolean;\n    viewModeRadioButtons: boolean;\n    fovCellSwitchControls: boolean;\n    resetCameraButton: boolean;\n    showAxesButton: boolean;\n    showBoundingBoxButton: boolean;\n  };\n\n  // From viewer state\n  imageType: ImageType;\n  renderMode: RenderMode;\n  viewMode: ViewMode;\n  autorotate: boolean;\n  showAxes: boolean;\n  showBoundingBox: boolean;\n  changeViewerSetting: ViewerSettingUpdater;\n  resetToSavedViewerState: () => void;\n};\n\nconst RESIZE_DEBOUNCE_DELAY = 50;\n\nconst visuallyHiddenStyle: React.CSSProperties = {\n  position: \"absolute\",\n  width: \"1px\",\n  height: \"1px\",\n  padding: \"0\",\n  margin: \"-1px\",\n  overflow: \"hidden\",\n  clip: \"rect(0, 0, 0, 0)\",\n  whiteSpace: \"nowrap\",\n  borderWidth: \"0\",\n};\n\nconst Toolbar: React.FC<ToolbarProps> = (props) => {\n  const containerRef = React.useRef<HTMLDivElement>(null);\n  const barRef = React.useRef<HTMLDivElement>(null);\n  const leftRef = React.useRef<HTMLDivElement>(null);\n  const rightRef = React.useRef<HTMLDivElement>(null);\n  const centerRef = React.useRef<HTMLDivElement>(null);\n\n  const [scrollMode, setScrollMode] = React.useState(false);\n  const [showScrollBtnLeft, setScrollBtnLeft] = React.useState(false);\n  const [showScrollBtnRight, setScrollBtnRight] = React.useState(false);\n\n  // Scroll buttons are only visible when toolbar can be scrolled in that direction.\n  // This may change on either scroll or resize.\n  const checkScrollBtnVisible = React.useCallback((): void => {\n    const barEl = barRef.current;\n    if (!barEl) {\n      return;\n    }\n    setScrollBtnLeft(barEl.scrollLeft > 0);\n    setScrollBtnRight(barEl.scrollLeft < barEl.scrollWidth - barEl.clientWidth);\n  }, []);\n\n  // This is effectively a `useCallback` - it memoizes a function - but since we're feeding the whole function into\n  // lodash's `debounce`, using `useMemo` memoizes the transformation done by `debounce` as well.\n  const checkSize = React.useMemo(() => {\n    return debounce((): void => {\n      if (!leftRef.current || !centerRef.current || !rightRef.current || !barRef.current) {\n        return;\n      }\n      const leftRect = leftRef.current.getBoundingClientRect();\n      const centerRect = centerRef.current.getBoundingClientRect();\n      const rightRect = rightRef.current.getBoundingClientRect();\n\n      // when calculating width required to leave scroll mode, add a bit of extra width to ensure that triggers\n      // for entering and leaving scroll mode never overlap (causing toolbar to rapidly switch when resizing)\n      const SCROLL_OFF_EXTRA_WIDTH = 15;\n\n      setScrollMode((mode) => {\n        if (mode) {\n          // Leave scroll mode if there is enough space for centered controls not to overlap left/right-aligned ones\n          const barWidth = barRef.current!.getBoundingClientRect().width;\n          const requiredWidth =\n            Math.max(leftRect.width, rightRect.width) * 2 + centerRect.width + SCROLL_OFF_EXTRA_WIDTH;\n          return barWidth <= requiredWidth;\n        } else {\n          // Enter scroll mode if centered controls are overlapping either left/right-aligned ones\n          return leftRect.right > centerRect.left || centerRect.right > rightRect.left;\n        }\n      });\n      checkScrollBtnVisible();\n    }, RESIZE_DEBOUNCE_DELAY);\n  }, [checkScrollBtnVisible]);\n\n  React.useEffect(() => {\n    // Make sure `checkSize` is run once on mount\n    checkSize();\n    window.addEventListener(\"resize\", checkSize);\n    return () => window.removeEventListener(\"resize\", checkSize);\n  }, [checkSize]);\n\n  const scrollX = (amount: number): number => (barRef.current!.scrollLeft += amount);\n\n  // Translate vertical scrolling into horizontal scrolling\n  const wheelHandler: React.WheelEventHandler<HTMLDivElement> = (e) => {\n    e.preventDefault();\n    if (e.deltaY === 0) {\n      return;\n    }\n    scrollX(e.deltaY);\n  };\n\n  const toggleAxis = (): void => props.changeViewerSetting(\"showAxes\", !props.showAxes);\n  const toggleBoundingBox = (): void => props.changeViewerSetting(\"showBoundingBox\", !props.showBoundingBox);\n  // TODO remove ant-btn-icon-only hack when upgrading antd\n  const classForToggleBtn = (active: boolean): string =>\n    \"ant-btn-icon-only btn-borderless\" + (active ? \" btn-active\" : \"\");\n\n  const { changeViewerSetting, resetToSavedViewerState, visibleControls, showAxes, showBoundingBox, autorotate } =\n    props;\n  const twoDMode = props.viewMode !== ViewMode.threeD;\n\n  const renderGroup1 =\n    visibleControls.viewModeRadioButtons || visibleControls.resetCameraButton || visibleControls.autoRotateButton;\n  const renderGroup4 = visibleControls.showAxesButton || visibleControls.showBoundingBoxButton;\n\n  const axesToggleTitle = showAxes ? \"Hide axes\" : \"Show axes\";\n  const boundingBoxToggleTitle = showBoundingBox ? \"Hide bounding box\" : \"Show bounding box\";\n  const turntableToggleTitle = autorotate ? \"Turn off turntable\" : \"Turn on turntable\";\n\n  const getPopupContainer = containerRef.current ? () => containerRef.current! : undefined;\n\n  return (\n    <div className={`viewer-toolbar-container${scrollMode ? \" viewer-toolbar-scroll\" : \"\"}`} ref={containerRef}>\n      <div\n        className=\"viewer-toolbar-scroll-left\"\n        style={{ display: showScrollBtnLeft ? \"flex\" : \"none\" }}\n        onClick={() => scrollX(-100)}\n      >\n        <ViewerIcon type=\"closePanel\" style={{ fontSize: \"12px\", transform: \"rotate(180deg)\" }} />\n      </div>\n      <div className=\"viewer-toolbar\" ref={barRef} onWheel={wheelHandler} onScroll={checkScrollBtnVisible}>\n        <div className=\"viewer-toolbar-left\" ref={leftRef}>\n          <Tooltip placement=\"bottom\" title=\"Reset to initial settings\" trigger={[\"focus\", \"hover\"]}>\n            <Button className=\"ant-btn-icon-only btn-borderless\" onClick={resetToSavedViewerState}>\n              <ReloadOutlined />\n              <span style={visuallyHiddenStyle}>Reset to initial settings</span>\n            </Button>\n          </Tooltip>\n        </div>\n        <div className=\"viewer-toolbar-center\" ref={centerRef}>\n          {renderGroup1 && (\n            <div className=\"viewer-toolbar-group\">\n              {visibleControls.viewModeRadioButtons && (\n                <ViewModeRadioButtons\n                  mode={props.viewMode}\n                  onViewModeChange={(newMode) => changeViewerSetting(\"viewMode\", newMode)}\n                />\n              )}\n              {visibleControls.resetCameraButton && (\n                <Tooltip placement=\"bottom\" title=\"Reset camera\">\n                  <Button className=\"ant-btn-icon-only btn-borderless\" onClick={props.resetCamera}>\n                    <ViewerIcon type=\"resetView\" />\n                  </Button>\n                </Tooltip>\n              )}\n              {visibleControls.autoRotateButton && (\n                <Tooltip placement=\"bottom\" title={turntableToggleTitle}>\n                  <Button\n                    className={classForToggleBtn(autorotate && !twoDMode)}\n                    disabled={twoDMode || props.renderMode === RenderMode.pathTrace}\n                    onClick={() => changeViewerSetting(\"autorotate\", !autorotate)}\n                  >\n                    <ViewerIcon type=\"turnTable\" />\n                  </Button>\n                </Tooltip>\n              )}\n            </div>\n          )}\n\n          {visibleControls.fovCellSwitchControls && props.hasCellId && props.hasParentImage && (\n            <div className=\"viewer-toolbar-group\">\n              <Radio.Group\n                value={props.imageType}\n                onChange={({ target }) => changeViewerSetting(\"imageType\", target.value)}\n              >\n                <Radio.Button value={ImageType.segmentedCell}>Single cell</Radio.Button>\n                <Radio.Button value={ImageType.fullField}>Full field</Radio.Button>\n              </Radio.Group>\n            </div>\n          )}\n\n          <div className=\"viewer-toolbar-group\">\n            <Select\n              className=\"select-render-setting\"\n              popupClassName=\"viewer-toolbar-dropdown\"\n              value={props.renderMode}\n              onChange={(value) => changeViewerSetting(\"renderMode\", value)}\n              getPopupContainer={getPopupContainer}\n            >\n              <Select.Option value={RenderMode.volumetric} key={RenderMode.volumetric}>\n                Volumetric\n              </Select.Option>\n              {props.canPathTrace && (\n                <Select.Option value={RenderMode.pathTrace} key={RenderMode.pathTrace} disabled={twoDMode}>\n                  Path trace\n                </Select.Option>\n              )}\n              <Select.Option value={RenderMode.maxProject} key={RenderMode.maxProject}>\n                Max project\n              </Select.Option>\n            </Select>\n          </div>\n\n          {renderGroup4 && (\n            <div className=\"viewer-toolbar-group\">\n              {visibleControls.showAxesButton && (\n                <Tooltip placement=\"bottom\" title={axesToggleTitle}>\n                  <Button className={classForToggleBtn(showAxes)} onClick={toggleAxis}>\n                    <ViewerIcon type=\"axes\" />\n                  </Button>\n                </Tooltip>\n              )}\n              {visibleControls.showBoundingBoxButton && (\n                <Tooltip placement=\"bottom\" title={boundingBoxToggleTitle}>\n                  <Button className={classForToggleBtn(showBoundingBox)} onClick={toggleBoundingBox}>\n                    <ViewerIcon type=\"boundingBox\" />\n                  </Button>\n                </Tooltip>\n              )}\n            </div>\n          )}\n        </div>\n\n        <div className=\"viewer-toolbar-right viewer-toolbar-group\" ref={rightRef}>\n          <Tooltip placement=\"bottom\" title=\"Download\">\n            <DownloadButton\n              cellDownloadHref={props.cellDownloadHref}\n              fovDownloadHref={props.fovDownloadHref}\n              hasFov={props.hasCellId && props.hasParentImage}\n            />\n          </Tooltip>\n          <Tooltip placement=\"bottom\" title=\"Screenshot\">\n            <Button className=\"ant-btn-icon-only btn-borderless\" onClick={props.downloadScreenshot}>\n              <ViewerIcon type=\"camera\" />\n            </Button>\n          </Tooltip>\n        </div>\n      </div>\n      <div\n        className=\"viewer-toolbar-scroll-right\"\n        style={{ display: showScrollBtnRight ? \"flex\" : \"none\" }}\n        onClick={() => scrollX(100)}\n      >\n        <ViewerIcon type=\"closePanel\" style={{ fontSize: \"12px\" }} />\n      </div>\n    </div>\n  );\n};\n\nexport default connectToViewerState(Toolbar, [\n  \"imageType\",\n  \"renderMode\",\n  \"viewMode\",\n  \"autorotate\",\n  \"showAxes\",\n  \"showBoundingBox\",\n  \"changeViewerSetting\",\n  \"resetToSavedViewerState\",\n]);\n","import { Lut, View3d, Volume } from \"@aics/vole-core\";\nimport React, { useEffect } from \"react\";\n\nimport { controlPointsToLut, rampToControlPoints } from \"../../shared/utils/controlPointsToLut\";\nimport { ChannelState } from \"../ViewerStateProvider/types\";\nimport { UseImageEffectType } from \"./types\";\n\ninterface ChannelUpdaterProps {\n  index: number;\n  channelState: ChannelState;\n  view3d: View3d;\n  image: Volume | null;\n  version: number;\n}\n\n/**\n * A component that doesn't render anything, but reacts to the provided `ChannelState`\n * and keeps it in sync with the viewer.\n */\nconst ChannelUpdater: React.FC<ChannelUpdaterProps> = ({ index, channelState, view3d, image, version }) => {\n  const { volumeEnabled, isosurfaceEnabled, isovalue, colorizeEnabled, colorizeAlpha, opacity, color } = channelState;\n\n  // Effects to update channel settings should check if image is present and channel is loaded first\n  const useImageEffect: UseImageEffectType = (effect, deps) => {\n    useEffect(() => {\n      if (image && version > 0) {\n        return effect(image);\n      }\n      // react-hooks will check that `deps` match `effect`'s dependencies, so we can safely exclude `effect` here\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [...deps, image, version]);\n  };\n\n  // enable/disable channel can't be dependent on channel load state because it may trigger the channel to load\n  useEffect(() => {\n    if (image) {\n      view3d.setVolumeChannelEnabled(image, index, volumeEnabled);\n      view3d.updateLuts(image);\n    }\n  }, [image, volumeEnabled, index, view3d]);\n\n  useEffect(() => {\n    if (image) {\n      view3d.setVolumeChannelOptions(image, index, { isosurfaceEnabled });\n    }\n  }, [image, isosurfaceEnabled, index, view3d]);\n\n  useImageEffect(\n    (currentImage) => view3d.setVolumeChannelOptions(currentImage, index, { isovalue }),\n    [isovalue, index, view3d]\n  );\n\n  useImageEffect(\n    (currentImage) => view3d.setVolumeChannelOptions(currentImage, index, { isosurfaceOpacity: opacity }),\n    [opacity, index, view3d]\n  );\n\n  useImageEffect(\n    (currentImage) => {\n      view3d.setVolumeChannelOptions(currentImage, index, { color });\n      view3d.updateLuts(currentImage);\n    },\n    [color, index, view3d]\n  );\n\n  const { controlPoints, ramp, useControlPoints } = channelState;\n  useImageEffect(\n    (currentImage) => {\n      if (useControlPoints && controlPoints.length < 2) {\n        return;\n      }\n      const controlPointsToUse = useControlPoints ? controlPoints : rampToControlPoints(ramp);\n      const gradient = controlPointsToLut(controlPointsToUse);\n      currentImage.setLut(index, gradient);\n      view3d.updateLuts(currentImage);\n    },\n    [controlPoints, ramp, useControlPoints, index, view3d]\n  );\n\n  useImageEffect(\n    (currentImage) => {\n      if (colorizeEnabled) {\n        // TODO get the labelColors from the tf editor component\n        const lut = new Lut().createLabelColors(currentImage.getHistogram(index));\n        currentImage.setColorPalette(index, lut.lut);\n        // following effect will also run and call `updateLuts`\n      }\n    },\n    [colorizeEnabled, index, view3d]\n  );\n\n  useImageEffect(\n    (currentImage) => {\n      currentImage.setColorPaletteAlpha(index, colorizeEnabled ? colorizeAlpha : 0);\n      view3d.updateLuts(currentImage);\n    },\n    [colorizeEnabled, colorizeAlpha, index, view3d]\n  );\n\n  return null;\n};\n\nexport default ChannelUpdater;\n","// 3rd Party Imports\nimport { RawArrayLoaderOptions, RENDERMODE_PATHTRACE, RENDERMODE_RAYMARCH, View3d, Volume } from \"@aics/vole-core\";\nimport { Layout } from \"antd\";\nimport { debounce, isEqual } from \"lodash\";\nimport React, { useCallback, useContext, useEffect, useMemo, useRef, useState } from \"react\";\n\nimport {\n  AXIS_MARGIN_DEFAULT,\n  CLIPPING_PANEL_HEIGHT_DEFAULT,\n  CLIPPING_PANEL_HEIGHT_TALL,\n  CONTROL_PANEL_CLOSE_WIDTH,\n  DTYPE_RANGE,\n  getDefaultViewerState,\n  SCALE_BAR_MARGIN_DEFAULT,\n} from \"../../shared/constants\";\nimport { ImageType, RenderMode, ViewMode } from \"../../shared/enums\";\nimport { activeAxisMap, AxisName, IsosurfaceFormat, MetadataRecord, PerAxis } from \"../../shared/types\";\nimport { colorArrayToFloats } from \"../../shared/utils/colorRepresentations\";\nimport {\n  controlPointsToRamp,\n  initializeLut,\n  rampToControlPoints,\n  remapControlPointsForChannel,\n} from \"../../shared/utils/controlPointsToLut\";\nimport { useConstructor } from \"../../shared/utils/hooks\";\nimport {\n  alphaSliderToImageValue,\n  brightnessSliderToImageValue,\n  densitySliderToImageValue,\n  gammaSliderToImageValues,\n} from \"../../shared/utils/sliderValuesToImageValues\";\nimport useVolume, { ImageLoadStatus } from \"../useVolume\";\nimport type { AppProps, ControlVisibilityFlags, MultisceneUrls, UseImageEffectType } from \"./types\";\n\nimport CellViewerCanvasWrapper from \"../CellViewerCanvasWrapper\";\nimport ControlPanel from \"../ControlPanel\";\nimport { useErrorAlert } from \"../ErrorAlert\";\nimport StyleProvider from \"../StyleProvider\";\nimport Toolbar from \"../Toolbar\";\nimport { ViewerStateContext } from \"../ViewerStateProvider\";\nimport ChannelUpdater from \"./ChannelUpdater\";\n\nimport \"../../assets/styles/globals.css\";\nimport \"./styles.css\";\n\nconst { Sider, Content } = Layout;\n\nconst defaultVisibleControls: ControlVisibilityFlags = {\n  alphaMaskSlider: true,\n  autoRotateButton: true,\n  axisClipSliders: true,\n  brightnessSlider: true,\n  backgroundColorPicker: true,\n  boundingBoxColorPicker: true,\n  colorPresetsDropdown: true,\n  densitySlider: true,\n  levelsSliders: true,\n  interpolationControl: true,\n  saveSurfaceButtons: true,\n  fovCellSwitchControls: true,\n  viewModeRadioButtons: true,\n  resetCameraButton: true,\n  showAxesButton: true,\n  showBoundingBoxButton: true,\n  metadataViewer: true,\n};\n\nconst defaultProps: AppProps = {\n  // rawData has a \"dtype\" which is expected to be \"uint8\", a \"shape\":[c,z,y,x] and a \"buffer\" which is a DataView\n  rawData: undefined,\n  // rawDims is the volume dims that normally come from a json file\n  rawDims: undefined,\n\n  imageUrl: \"\",\n  parentImageUrl: \"\",\n\n  appHeight: \"100vh\",\n  visibleControls: defaultVisibleControls,\n  viewerSettings: getDefaultViewerState(),\n  cellId: \"\",\n  imageDownloadHref: \"\",\n  parentImageDownloadHref: \"\",\n  pixelSize: undefined,\n  canvasMargin: \"0 0 0 0\",\n  view3dRef: undefined,\n  showError: undefined,\n};\n\nconst CLIPPING_PANEL_ANIMATION_DURATION_MS = 300;\n\nconst setIndicatorPositions = (\n  view3d: View3d,\n  panelOpen: boolean,\n  hasTime: boolean,\n  hasScenes: boolean,\n  isMode3d: boolean\n): void => {\n  // The height of the clipping panel includes the button, but we're trying to put these elements next to the button\n  const CLIPPING_PANEL_BUTTON_HEIGHT = 40;\n  // Move scale bars this far to the left when showing time series, to make room for timestep indicator\n  const SCALE_BAR_TIME_SERIES_OFFSET = 120;\n\n  let axisY = AXIS_MARGIN_DEFAULT[1];\n  let [scaleBarX, scaleBarY] = SCALE_BAR_MARGIN_DEFAULT;\n  if (panelOpen) {\n    // If we have Time, Scene, X, Y, and Z sliders, the drawer will need to be a bit taller\n    let isTall = hasTime && hasScenes && isMode3d;\n    let clippingPanelFullHeight = isTall ? CLIPPING_PANEL_HEIGHT_TALL : CLIPPING_PANEL_HEIGHT_DEFAULT;\n    let clippingPanelHeight = clippingPanelFullHeight - CLIPPING_PANEL_BUTTON_HEIGHT;\n    // Move indicators up out of the way of the clipping panel\n    axisY += clippingPanelHeight;\n    scaleBarY += clippingPanelHeight;\n  }\n  if (hasTime) {\n    // Move scale bar left out of the way of timestep indicator\n    scaleBarX += SCALE_BAR_TIME_SERIES_OFFSET;\n    // Make sure the timestep indicator is showing\n    view3d.setShowTimestepIndicator(true);\n  }\n\n  view3d.setAxisPosition(AXIS_MARGIN_DEFAULT[0], axisY);\n  view3d.setTimestepIndicatorPosition(SCALE_BAR_MARGIN_DEFAULT[0], scaleBarY);\n  view3d.setScaleBarPosition(scaleBarX, scaleBarY);\n};\n\nconst App: React.FC<AppProps> = (props) => {\n  props = { ...defaultProps, ...props };\n\n  // State management /////////////////////////////////////////////////////////\n  const viewerState = useContext(ViewerStateContext).ref;\n  const {\n    imageType,\n    viewMode,\n    channelSettings,\n    changeChannelSetting,\n    applyColorPresets,\n    setSavedViewerChannelSettings,\n    getCurrentViewerChannelSettings,\n    // TODO: Show a loading spinner while any channels are awaiting reset.\n    getChannelsAwaitingReset,\n    onResetChannel,\n  } = viewerState.current;\n  const { onControlPanelToggle, metadata, metadataFormatter } = props;\n\n  useMemo(() => {\n    if (props.viewerChannelSettings) {\n      setSavedViewerChannelSettings(props.viewerChannelSettings);\n    }\n  }, [props.viewerChannelSettings, setSavedViewerChannelSettings]);\n\n  const view3d = useConstructor(() => new View3d());\n  if (props.view3dRef !== undefined) {\n    props.view3dRef.current = view3d;\n  }\n\n  const [errorAlert, _showError] = useErrorAlert();\n  const showError = props.showError ?? _showError;\n\n  useEffect(() => {\n    // Get notifications of loading errors which occur after the initial load, e.g. on time change or new channel load\n    view3d.setLoadErrorHandler((_vol, e) => showError(e));\n    return () => view3d.setLoadErrorHandler(undefined);\n  }, [view3d, showError]);\n\n  const imageUrlRef = useRef<string | string[] | MultisceneUrls>(\"\");\n  const scenesRef = useRef<(string | string[])[] | [RawArrayLoaderOptions]>([]);\n  const { imageUrl, parentImageUrl, rawData, rawDims } = props;\n  const scenes = useMemo((): (string | string[])[] | [RawArrayLoaderOptions] => {\n    if (rawData && rawDims) {\n      return [{ data: rawData, metadata: rawDims }];\n    } else {\n      const showParentImage = imageType === ImageType.fullField && parentImageUrl !== undefined;\n      const path = showParentImage ? parentImageUrl : imageUrl;\n      // Don't reload if we're already looking at this image\n      if (isEqual(path, imageUrlRef.current)) {\n        return scenesRef.current;\n      }\n      imageUrlRef.current = path;\n\n      const result = (path as MultisceneUrls).scenes ?? [path];\n      scenesRef.current = result;\n      return result;\n    }\n  }, [imageUrl, parentImageUrl, rawData, rawDims, imageType]);\n\n  const maskChannelName = getCurrentViewerChannelSettings()?.maskChannelName;\n\n  // we need to keep track of channel ranges for remapping control points\n  const channelRangesRef = useRef<([number, number] | undefined)[]>([]);\n\n  const onChannelLoaded = useCallback(\n    (image: Volume, channelIndex: number, isInitialLoad: boolean): void => {\n      // TODO this was once a search by name - is that still necessary or will the index always be correct?\n      const thisChannelSettings = channelSettings[channelIndex];\n      const { getChannelsAwaitingResetOnLoad, getCurrentViewerChannelSettings, changeChannelSetting } =\n        viewerState.current;\n      const { ramp, controlPoints } = thisChannelSettings;\n      const thisChannel = image.getChannel(channelIndex);\n\n      if (isInitialLoad || !controlPoints || !ramp || getChannelsAwaitingResetOnLoad().has(channelIndex)) {\n        // This channel needs its LUT initialized\n        const { ramp, controlPoints } = initializeLut(image, channelIndex, getCurrentViewerChannelSettings());\n        const { dtype } = thisChannel;\n\n        changeChannelSetting(channelIndex, {\n          controlPoints: controlPoints,\n          ramp: controlPointsToRamp(ramp),\n          // set the default range of the transfer function editor to cover the full range of the data type\n          plotMin: DTYPE_RANGE[dtype].min,\n          plotMax: DTYPE_RANGE[dtype].max,\n        });\n      } else {\n        // This channel has already been initialized, but its LUT was just remapped and we need to update some things\n        const oldRange = channelRangesRef.current[channelIndex];\n        if (thisChannelSettings.useControlPoints) {\n          // control points were just automatically remapped - update in state\n          const rampControlPoints = rampToControlPoints(thisChannelSettings.ramp);\n          // now manually remap ramp using the channel's old range\n          const remappedRampControlPoints = remapControlPointsForChannel(rampControlPoints, oldRange, thisChannel);\n          changeChannelSetting(channelIndex, {\n            ramp: controlPointsToRamp(remappedRampControlPoints),\n            controlPoints: thisChannel.lut.controlPoints,\n          });\n        } else {\n          // ramp was just automatically remapped - update in state\n          const ramp = controlPointsToRamp(thisChannel.lut.controlPoints);\n          // now manually remap control points using the channel's old range\n          const { controlPoints } = thisChannelSettings;\n          const remappedControlPoints = remapControlPointsForChannel(controlPoints, oldRange, thisChannel);\n          changeChannelSetting(channelIndex, { controlPoints: remappedControlPoints, ramp: ramp });\n        }\n      }\n\n      // save the channel's new range for remapping next time\n      channelRangesRef.current[channelIndex] = [thisChannel.rawMin, thisChannel.rawMax];\n\n      view3d.updateLuts(image);\n      view3d.onVolumeData(image, [channelIndex]);\n\n      view3d.setVolumeChannelEnabled(image, channelIndex, thisChannelSettings.volumeEnabled);\n      if (image.channelNames[channelIndex] === maskChannelName) {\n        view3d.setVolumeChannelAsMask(image, channelIndex);\n      }\n      if (image.isLoaded()) {\n        view3d.updateActiveChannels(image);\n      }\n    },\n    [view3d, channelSettings, maskChannelName, viewerState]\n  );\n\n  const volume = useVolume(scenes, { onChannelLoaded, onError: showError, maskChannelName });\n  const { image, setTime, setScene } = volume;\n\n  // add the image to the viewer on load\n  useEffect(() => {\n    if (image === null) {\n      return;\n    }\n\n    channelRangesRef.current = new Array(image.channelNames.length).fill(undefined);\n\n    const { channelSettings } = viewerState.current;\n\n    view3d.addVolume(image, {\n      // Immediately passing down channel parameters isn't strictly necessary, but keeps things looking consistent on load\n      channels: image.channelNames.map((name) => {\n        // TODO do we really need to be searching by name here?\n        const ch = channelSettings.find((channel) => channel.name === name);\n        if (!ch) {\n          return {};\n        }\n        return {\n          enabled: ch.volumeEnabled,\n          isosurfaceEnabled: ch.isosurfaceEnabled,\n          isovalue: ch.isovalue,\n          isosurfaceOpacity: ch.opacity,\n          color: ch.color,\n        };\n      }),\n    });\n\n    view3d.updateActiveChannels(image);\n    return view3d.removeAllVolumes.bind(view3d);\n  }, [image, view3d, viewerState]);\n\n  const hasRawImage = !!(props.rawData && props.rawDims);\n  const numScenes = hasRawImage ? 1 : ((props.imageUrl as MultisceneUrls).scenes?.length ?? 1);\n  const numSlices: PerAxis<number> = image?.imageInfo.volumeSize ?? { x: 1, y: 1, z: 1 };\n  const numSlicesLoaded: PerAxis<number> = image?.imageInfo.subregionSize ?? { x: 0, y: 0, z: 0 };\n  const numTimesteps = image?.imageInfo.times ?? 1;\n\n  // const [channelGroupedByType, setChannelGroupedByType] = useState<ChannelGrouping>({});\n  const [controlPanelClosed, setControlPanelClosed] = useState(() => window.innerWidth < CONTROL_PANEL_CLOSE_WIDTH);\n  // Only allow auto-close once while the screen is too narrow.\n  const [hasAutoClosedControlPanel, setHasAutoClosedControlPanel] = useState(false);\n\n  const [clippingPanelOpen, setClippingPanelOpen] = useState(true);\n  const clippingPanelOpenTimeout = useRef<number>(0);\n\n  // Imperative callbacks /////////////////////////////////////////////////////\n\n  const viewerSettings = viewerState.current;\n\n  const saveIsosurface = useCallback(\n    (channelIndex: number, type: IsosurfaceFormat): void => {\n      if (image) view3d.saveChannelIsosurface(image, channelIndex, type);\n    },\n    [image, view3d]\n  );\n\n  const saveScreenshot = useCallback((): void => {\n    view3d.capture((dataUrl: string) => {\n      const anchor = document.createElement(\"a\");\n      anchor.href = dataUrl;\n      anchor.download = \"screenshot.png\";\n      anchor.click();\n    });\n  }, [view3d]);\n\n  const getMetadata = useCallback((): MetadataRecord => {\n    let imageMetadata = image?.imageMetadata as MetadataRecord;\n    if (imageMetadata && metadataFormatter) {\n      imageMetadata = metadataFormatter(imageMetadata);\n    }\n\n    let sceneMeta: MetadataRecord | undefined;\n    if (Array.isArray(metadata)) {\n      // If metadata is an array, try to index it by scene\n      if (metadata.length >= numScenes) {\n        sceneMeta = metadata[viewerState.current.scene];\n      } else {\n        sceneMeta = metadata[0];\n      }\n    } else {\n      sceneMeta = metadata;\n    }\n\n    if (imageMetadata && Object.keys(imageMetadata).length > 0) {\n      return { Image: imageMetadata, ...sceneMeta };\n    } else {\n      return sceneMeta ?? {};\n    }\n  }, [metadata, metadataFormatter, image, numScenes, viewerState]);\n\n  useEffect((): void => {\n    const hasTime = numTimesteps > 1;\n    const hasScenes = numScenes > 1;\n    const mode3d = viewerSettings.viewMode === ViewMode.threeD;\n\n    setIndicatorPositions(view3d, clippingPanelOpen, hasTime, hasScenes, mode3d);\n\n    // Hide indicators while clipping panel is in motion - otherwise they pop to the right place prematurely\n    if (clippingPanelOpen) {\n      view3d.setShowScaleBar(false);\n      view3d.setShowTimestepIndicator(false);\n      view3d.setShowAxis(false);\n\n      window.clearTimeout(clippingPanelOpenTimeout.current);\n      clippingPanelOpenTimeout.current = window.setTimeout(() => {\n        view3d.setShowScaleBar(true);\n        view3d.setShowTimestepIndicator(true);\n        if (viewerSettings.showAxes) {\n          view3d.setShowAxis(true);\n        }\n      }, CLIPPING_PANEL_ANIMATION_DURATION_MS);\n    }\n  }, [view3d, numTimesteps, numScenes, viewerSettings.viewMode, viewerSettings.showAxes, clippingPanelOpen]);\n\n  // Effects //////////////////////////////////////////////////////////////////\n\n  // On mount\n  useEffect(() => {\n    const onResize = (): void => {\n      if (window.innerWidth < CONTROL_PANEL_CLOSE_WIDTH) {\n        if (!hasAutoClosedControlPanel) {\n          setControlPanelClosed(true);\n          setHasAutoClosedControlPanel(true);\n        }\n      } else {\n        setHasAutoClosedControlPanel(false);\n      }\n    };\n    const onResizeDebounced = debounce(onResize, 500);\n\n    window.addEventListener(\"resize\", onResizeDebounced);\n    return () => window.removeEventListener(\"resize\", onResizeDebounced);\n  }, [hasAutoClosedControlPanel]);\n\n  useEffect(\n    () => onControlPanelToggle && onControlPanelToggle(controlPanelClosed),\n    [controlPanelClosed, onControlPanelToggle]\n  );\n\n  useEffect(() => {\n    // delayed for the animation to finish\n    window.setTimeout(() => {\n      window.dispatchEvent(new Event(\"resize\"));\n    }, 200);\n  }, [controlPanelClosed]);\n\n  /** Custom effect hook for viewer updates that depend on `image`, so we don't have to repeatedly null-check it */\n  const useImageEffect: UseImageEffectType = (effect, deps) => {\n    useEffect(() => {\n      if (image && volume.imageLoadStatus === ImageLoadStatus.LOADED) {\n        return effect(image);\n      }\n      // react-hooks will check that `deps` match `effect`'s dependencies, so we can safely exclude `effect` here\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [...deps, image, volume.imageLoadStatus]);\n  };\n\n  // Effects to imperatively sync `viewerSettings` to `view3d`\n  useImageEffect(\n    (_currentImage) => {\n      view3d.setCameraMode(viewerSettings.viewMode);\n      view3d.resize(null);\n    },\n    [viewerSettings.viewMode, view3d]\n  );\n\n  useImageEffect(\n    (_currentImage) => {\n      if (viewerSettings.cameraState) {\n        view3d.setCameraState(viewerSettings.cameraState);\n      }\n    },\n    [viewerSettings.cameraState, view3d]\n  );\n\n  useImageEffect(\n    (_currentImage) => view3d.setAutoRotate(viewerSettings.autorotate),\n    [viewerSettings.autorotate, view3d]\n  );\n\n  useImageEffect((_currentImage) => view3d.setShowAxis(viewerSettings.showAxes), [viewerSettings.showAxes, view3d]);\n\n  useImageEffect(\n    (_currentImage) => view3d.setBackgroundColor(colorArrayToFloats(viewerSettings.backgroundColor)),\n    [viewerSettings.backgroundColor, view3d]\n  );\n\n  useImageEffect(\n    (currentImage) => view3d.setBoundingBoxColor(currentImage, colorArrayToFloats(viewerSettings.boundingBoxColor)),\n    [viewerSettings.boundingBoxColor, view3d]\n  );\n\n  useImageEffect(\n    (currentImage) => view3d.setShowBoundingBox(currentImage, viewerSettings.showBoundingBox),\n    [viewerSettings.showBoundingBox, view3d]\n  );\n\n  useImageEffect(\n    (image) => {\n      // Check whether any channels are marked to be reset and apply it.\n      const channelsAwaitingReset = getChannelsAwaitingReset();\n      for (let i = 0; i < channelSettings.length; i++) {\n        if (channelsAwaitingReset.has(i)) {\n          const { ramp, controlPoints } = initializeLut(image, i, getCurrentViewerChannelSettings());\n          changeChannelSetting(i, { controlPoints: controlPoints, ramp: controlPointsToRamp(ramp) });\n          onResetChannel(i);\n        }\n      }\n    },\n    [changeChannelSetting, channelSettings, getChannelsAwaitingReset, getCurrentViewerChannelSettings, onResetChannel]\n  );\n\n  useImageEffect(\n    (currentImage) => {\n      const renderMode = viewerSettings.renderMode;\n      view3d.setMaxProjectMode(currentImage, renderMode === RenderMode.maxProject);\n      view3d.setVolumeRenderMode(renderMode === RenderMode.pathTrace ? RENDERMODE_PATHTRACE : RENDERMODE_RAYMARCH);\n      view3d.updateActiveChannels(currentImage);\n    },\n    [viewerSettings.renderMode, view3d]\n  );\n\n  useImageEffect(\n    (currentImage) => {\n      view3d.updateMaskAlpha(currentImage, alphaSliderToImageValue(viewerSettings.maskAlpha));\n      view3d.updateActiveChannels(currentImage);\n    },\n    [viewerSettings.maskAlpha, view3d]\n  );\n\n  useImageEffect(\n    (_currentImage) => {\n      const brightness = brightnessSliderToImageValue(viewerSettings.brightness);\n      view3d.updateExposure(brightness);\n    },\n    [viewerSettings.brightness, view3d]\n  );\n\n  useImageEffect(\n    (currentImage) => {\n      const density = densitySliderToImageValue(viewerSettings.density);\n      view3d.updateDensity(currentImage, density);\n    },\n    [viewerSettings.density, view3d]\n  );\n\n  useImageEffect(\n    (currentImage) => {\n      const imageValues = gammaSliderToImageValues(viewerSettings.levels);\n      view3d.setGamma(currentImage, imageValues.min, imageValues.scale, imageValues.max);\n    },\n    [viewerSettings.levels, view3d]\n  );\n\n  // `time` and `scene` have their own special handlers via `volume`, since they both trigger loads\n  useEffect(() => setTime(view3d, viewerSettings.time), [view3d, viewerSettings.time, setTime]);\n  useEffect(() => setScene(viewerSettings.scene), [viewerSettings.scene, setScene]);\n\n  useImageEffect(\n    (currentImage) => view3d.setInterpolationEnabled(currentImage, viewerSettings.interpolationEnabled),\n    [viewerSettings.interpolationEnabled, view3d]\n  );\n\n  useImageEffect(\n    (currentImage) => view3d.setVolumeTranslation(currentImage, props.transform?.translation || [0, 0, 0]),\n    [props.transform?.translation, view3d]\n  );\n\n  useImageEffect(\n    (currentImage) => view3d.setVolumeRotation(currentImage, props.transform?.rotation || [0, 0, 0]),\n    [props.transform?.rotation, view3d]\n  );\n\n  const usePerAxisClippingUpdater = (\n    axis: AxisName,\n    [minval, maxval]: [number, number],\n    slice: number,\n    viewMode: ViewMode\n  ): void => {\n    useImageEffect(\n      // Logic to determine axis clipping range, for each of x,y,z,3d slider:\n      // if slider was same as active axis view mode:  [viewerSettings.slice[axis], viewerSettings.slice[axis] + 1.0/volumeSize[axis]]\n      // if in 3d mode: viewerSettings.region[axis]\n      // else: [0,1]\n      (currentImage) => {\n        let isOrthoAxis = false;\n        let axismin = 0.0;\n        let axismax = 1.0;\n        if (viewMode === ViewMode.threeD) {\n          axismin = minval;\n          axismax = maxval;\n          isOrthoAxis = false;\n        } else {\n          isOrthoAxis = activeAxisMap[viewMode] === axis;\n          const oneSlice = 1 / currentImage.imageInfo.volumeSize[axis];\n          axismin = isOrthoAxis ? slice : 0.0;\n          axismax = isOrthoAxis ? slice + oneSlice : 1.0;\n          if (axis === \"z\" && viewMode === ViewMode.xy) {\n            view3d.setZSlice(currentImage, Math.floor(slice * currentImage.imageInfo.volumeSize.z));\n          }\n        }\n        // view3d wants the coordinates in the -0.5 to 0.5 range\n        view3d.setAxisClip(currentImage, axis, axismin - 0.5, axismax - 0.5, isOrthoAxis);\n        view3d.setCameraMode(viewMode);\n        // TODO under some circumstances, this effect will trigger a load. Ideally, this would be reflected in the load\n        //   state managed by `useVolume`. This is complicated by the fact that the relevant methods (`setAxisClip` and\n        //   `setZSlice`) don't provide a channel load callback like other load-triggering methods (e.g. `setTime`).\n      },\n      [axis, minval, maxval, slice, viewMode]\n    );\n  };\n\n  usePerAxisClippingUpdater(\"x\", viewerSettings.region.x, viewerSettings.slice.x, viewMode);\n  usePerAxisClippingUpdater(\"y\", viewerSettings.region.y, viewerSettings.slice.y, viewMode);\n  usePerAxisClippingUpdater(\"z\", viewerSettings.region.z, viewerSettings.slice.z, viewMode);\n\n  // Rendering ////////////////////////////////////////////////////////////////\n\n  const visibleControls = useMemo(\n    (): ControlVisibilityFlags => ({ ...defaultVisibleControls, ...props.visibleControls }),\n    [props.visibleControls]\n  );\n  const pixelSize = useMemo(\n    (): [number, number, number] => (image ? image.imageInfo.physicalPixelSize.toArray() : [1, 1, 1]),\n    [image]\n  );\n  const resetCamera = useMemo(() => view3d.resetCamera.bind(view3d), [view3d]);\n\n  return (\n    <StyleProvider>\n      {errorAlert}\n      <Layout className=\"cell-viewer-app\" style={{ height: props.appHeight }}>\n        {channelSettings.map((channelState, index) => (\n          <ChannelUpdater\n            key={`${index}_${channelState.name}`}\n            {...{ channelState, index }}\n            view3d={view3d}\n            image={image}\n            version={volume.channelVersions[index]}\n          />\n        ))}\n        <Sider\n          className=\"control-panel-holder\"\n          collapsible={true}\n          defaultCollapsed={false}\n          collapsedWidth={50}\n          trigger={null}\n          collapsed={controlPanelClosed}\n          width={500}\n        >\n          <ControlPanel\n            visibleControls={visibleControls}\n            collapsed={controlPanelClosed}\n            // image state\n            imageName={image?.name}\n            hasImage={!!image}\n            pixelSize={pixelSize}\n            channelDataChannels={image?.channels}\n            channelGroupedByType={volume.channelGroupedByType}\n            // functions\n            setCollapsed={setControlPanelClosed}\n            saveIsosurface={saveIsosurface}\n            onApplyColorPresets={applyColorPresets}\n            viewerChannelSettings={props.viewerChannelSettings}\n            getMetadata={getMetadata}\n          />\n        </Sider>\n        <Layout className=\"cell-viewer-wrapper\" style={{ margin: props.canvasMargin }}>\n          <Content>\n            <Toolbar\n              fovDownloadHref={props.parentImageDownloadHref}\n              cellDownloadHref={props.imageDownloadHref}\n              hasParentImage={!!props.parentImageUrl}\n              hasCellId={!!props.cellId}\n              canPathTrace={view3d ? view3d.hasWebGL2() : false}\n              resetCamera={resetCamera}\n              downloadScreenshot={saveScreenshot}\n              visibleControls={visibleControls}\n            />\n            <CellViewerCanvasWrapper\n              view3d={view3d}\n              image={image}\n              loadingImage={volume.imageLoadStatus === ImageLoadStatus.REQUESTED}\n              numSlices={numSlices}\n              numSlicesLoaded={numSlicesLoaded}\n              numTimesteps={numTimesteps}\n              numScenes={numScenes}\n              playControls={volume.playControls}\n              playingAxis={volume.playingAxis}\n              appHeight={props.appHeight}\n              visibleControls={visibleControls}\n              clippingPanelOpen={clippingPanelOpen}\n              onClippingPanelOpenChange={setClippingPanelOpen}\n            />\n          </Content>\n        </Layout>\n      </Layout>\n    </StyleProvider>\n  );\n};\n\nexport default App;\n","type ImageValues = {\n  min: number;\n  max: number;\n  scale: number;\n};\n\nexport const gammaSliderToImageValues = (sliderValues: [number, number, number]): ImageValues => {\n  let min = Number(sliderValues[0]);\n  let mid = Number(sliderValues[1]);\n  let max = Number(sliderValues[2]);\n\n  if (mid > max || mid < min) {\n    mid = 0.5 * (min + max);\n  }\n  let div = 255;\n  min /= div;\n  max /= div;\n  mid /= div;\n  let diff = max - min;\n  let x = (mid - min) / diff;\n  let scale = 4 * x * x;\n  if ((mid - 0.5) * (mid - 0.5) < 0.0005) {\n    scale = 1.0;\n  }\n  return {\n    min,\n    max,\n    scale,\n  };\n};\n\n// Density and brightness were once overloaded for the two rendering modes in the volume viewer (raymarch & pathtrace).\n// Now both work the same, and the mapping from slider values to numbers in vole-core is relatively straightforward.\n// But the mapping can still be tweaked here in the future, should we want to.\n\n/** vole-core expects a value from 0..1 for density. */\nexport const densitySliderToImageValue = (sliderValue: number): number => sliderValue / 100.0;\n\n/** vole-core expects a value from 0..1 for brigness. */\nexport const brightnessSliderToImageValue = (sliderValue: number): number => sliderValue / 100.0;\n\n/** vole-core expects a value from 0..1 for alpha, and its scale is inverted from the app's slider. */\nexport const alphaSliderToImageValue = (sliderValue: number): number => 1 - sliderValue / 100.0;\n","import { Button } from \"antd\";\nimport React from \"react\";\nimport styled from \"styled-components\";\n\n// TODO: Make exports here for primary/tertiary buttons to abstract away\n// Ant button styling.\n\n// Enforce the primary type for behavior on hover.\nconst PrimaryButton = React.forwardRef<HTMLButtonElement, { children?: React.ReactNode }>((props, ref) => (\n  <Button {...props} ref={ref} type=\"primary\">\n    {props.children}\n  </Button>\n));\n// Used for debugging in React. Eslint complains if not set.\nPrimaryButton.displayName = \"PrimaryButton\";\n\n// Secondary button is outlined but turns solid on hover (uses primary button behavior).\nexport const SecondaryButton = styled(PrimaryButton)`\n  &&& {\n    background-color: var(--color-button-secondary-bg);\n    border: 1px solid var(--color-button-secondary-outline);\n    color: var(--color-button-secondary-text);\n  }\n` as typeof Button;\n","import { Button, Dropdown, MenuProps, Modal } from \"antd\";\nimport React, { ReactElement, useEffect, useState } from \"react\";\nimport { Link } from \"react-router-dom\";\n\nimport { DropdownSVG } from \"../assets/icons\";\nimport { FlexColumnAlignCenter, FlexRowAlignCenter } from \"./LandingPage/utils\";\n\nimport { SecondaryButton } from \"./Buttons\";\n\n// Defined in webpack config\ndeclare const VOLEAPP_VERSION: string;\ndeclare const VOLECORE_VERSION: string;\n\nexport default function HelpDropdown(): ReactElement {\n  const [container, setContainer] = useState<HTMLDivElement | null>();\n  const containerRef = React.useRef<HTMLDivElement>(null);\n\n  const [showVersionModal, setShowVersionModal] = useState(false);\n\n  const items: MenuProps[\"items\"] = [\n    {\n      key: \"github\",\n      label: (\n        <Link to=\"https://github.com/allen-cell-animated/vole-app\" target=\"_blank\" rel=\"noreferrer noopener\">\n          Visit GitHub repository\n        </Link>\n      ),\n    },\n    {\n      key: \"github-issue\",\n      label: (\n        <Link\n          to=\"https://github.com/allen-cell-animated/vole-app/issues/new/choose\"\n          target=\"_blank\"\n          rel=\"noreferrer noopener\"\n        >\n          Report issue via GitHub\n        </Link>\n      ),\n    },\n    {\n      key: \"forum\",\n      label: (\n        <Link to=\"https://forum.allencell.org/c/software-code/11\" target=\"_blank\" rel=\"noreferrer noopener\">\n          Allen Cell Discussion Forum\n        </Link>\n      ),\n    },\n    {\n      key: \"version\",\n      label: \"Version info\",\n      onClick: () => {\n        setShowVersionModal(true);\n      },\n    },\n  ];\n\n  // Use state update here to force a re-render so Dropdown is rendered with a valid `getContainer` callback.\n  // Otherwise, the `getContainer` callback will be undefined on the first render.\n  useEffect(() => {\n    setContainer(containerRef.current);\n  }, []);\n  const getContainer = container !== null ? () => container! : undefined;\n\n  const closeVersionModal = (): void => setShowVersionModal(false);\n\n  return (\n    <div ref={containerRef}>\n      <Dropdown menu={{ items: items }} getPopupContainer={getContainer} trigger={[\"click\"]}>\n        <SecondaryButton>\n          <FlexRowAlignCenter $gap={6}>\n            Help <DropdownSVG />\n          </FlexRowAlignCenter>\n        </SecondaryButton>\n      </Dropdown>\n      <Modal\n        open={showVersionModal}\n        title=\"Version info\"\n        getContainer={getContainer}\n        onCancel={() => setShowVersionModal(false)}\n        footer={<Button onClick={closeVersionModal}>Close</Button>}\n      >\n        <FlexColumnAlignCenter $gap={0}>\n          <p style={{ margin: 0 }}>Vol-E App v{VOLEAPP_VERSION}</p>\n          <p style={{ margin: 0 }}>Vol-E Core package v{VOLECORE_VERSION}</p>\n        </FlexColumnAlignCenter>\n      </Modal>\n    </div>\n  );\n}\n","import { useCallback, useMemo } from \"react\";\nimport { useLocalStorage } from \"usehooks-ts\";\n\n/** Key for local storage to read/write recently opened datasets */\nconst RECENT_DATASETS_STORAGE_KEY = \"WEBSITE_3D_CELL_VIEWER.recentDatasets\";\nconst MAX_RECENT_URLS = 100;\n\n// Label and URL are stored separately, so if a user provides an input URL (the label) that is transformed into an absolute\n// URL, we can check for duplicates using the absolute URL while still showing the user's input.\n// This is more relevant in nucmorph, where we're resolving filepaths to absolute URLs, but it's useful functionality to bake in\n// for future use.\n\nexport type RecentDataUrl = {\n  /** The absolute URL path, post any transformation or remapping. Stored for comparison between urls. */\n  url: string;\n  /** The user input that was used to load the data. */\n  label: string;\n};\n\n/**\n * Wrapper around locally-stored recent urls.\n * @returns an array containing the list of recent data urls and a function to add a new url to the list.\n */\nexport const useRecentDataUrls = (): [RecentDataUrl[], (newEntry: RecentDataUrl) => void] => {\n  const [storedRecentEntries, setRecentEntries] = useLocalStorage<RecentDataUrl[]>(RECENT_DATASETS_STORAGE_KEY, []);\n\n  // Sanitize/validate recent entries\n  let recentEntries: RecentDataUrl[] = useMemo(\n    () => storedRecentEntries.filter(({ url, label }) => typeof url === \"string\" && typeof label === \"string\"),\n    [storedRecentEntries]\n  );\n  if (recentEntries.length !== storedRecentEntries.length) {\n    setRecentEntries(recentEntries);\n  }\n\n  /** Adds a new URL entry (url + label) to the list of recent datasets. */\n  const addRecentEntry = useCallback(\n    (newEntry: RecentDataUrl): void => {\n      if (recentEntries === null) {\n        setRecentEntries([newEntry]);\n        return;\n      }\n\n      // Find matches by absolute URL and move to front of the list if a match exists.\n      const datasetIndex = recentEntries.findIndex(({ url }) => url === newEntry.url);\n      if (datasetIndex === -1) {\n        // New entry, add to front while maintaining max length\n        setRecentEntries([newEntry as RecentDataUrl, ...recentEntries.slice(0, MAX_RECENT_URLS - 1)]);\n      } else {\n        // Move to front; this also updates the label if it changed.\n        setRecentEntries([\n          newEntry as RecentDataUrl,\n          ...recentEntries.slice(0, datasetIndex),\n          ...recentEntries.slice(datasetIndex + 1),\n        ]);\n      }\n    },\n    [recentEntries, setRecentEntries]\n  );\n\n  return [recentEntries || [], addRecentEntry];\n};\n","import React, { ReactElement } from \"react\";\nimport styled, { css } from \"styled-components\";\n\n// Adapted from \"CSS-only middle truncation with ellipsis\"\n// by Mark Chitty https://codepen.io/markchitty/pen/RNZbRE\n\ntype MiddleTruncatedTextProps = {\n  text: string;\n  /** Minimum characters to show at the start of the text. 3 by default. */\n  startCharacters?: number;\n  /**\n   * Minimum characters to show at the end of the text. Hidden by start characters if the container\n   * does not have enough space. 35 by default.\n   */\n  endCharacters?: number;\n};\n\nconst defaultProps: Partial<MiddleTruncatedTextProps> = {\n  startCharacters: 3,\n  endCharacters: 35,\n};\n\nconst MiddleTruncatedTextContainer = styled.div<{ $startChars: number; $endChars: number }>`\n  display: flex;\n  flex-direction: row;\n  vertical-align: bottom;\n  white-space: nowrap;\n\n  ${(props) => {\n    // Determined experimentally. If this is too high, excess padding will appear to the right of\n    // the end text. If this is too low, the end text will be clipped.\n    const characterPxWidthToFontSizeRatio = 0.5;\n    return css`\n      --startWidth: calc(1em * ${props.$startChars + 3} * ${characterPxWidthToFontSizeRatio});\n      --endWidth: calc(1em * ${props.$endChars} * ${characterPxWidthToFontSizeRatio});\n\n      & span {\n        display: inline-block;\n        vertical-align: bottom;\n        white-space: nowrap;\n        overflow: hidden;\n      }\n\n      & span:first-child {\n        max-width: calc(100% - var(--endWidth));\n        min-width: var(--startWidth);\n        text-overflow: ellipsis;\n        overflow: hidden;\n      }\n\n      & span:last-child {\n        max-width: calc(100% - var(--startWidth));\n        direction: rtl;\n        z-index: 800;\n      }\n    `;\n  }}\n`;\n\n/**\n * Renders text that will be truncated with ellipses in the middle of the text if there isn't\n * enough space to show the full text. The number of characters shown at the start and end of the text are configurable.\n *\n * @example\n * ```\n * <MiddleTruncatedText text=\"This is a long text that will be truncated in the middle\" startCharacters={3} endCharacters={5} />\n * ```\n * can be rendered as any of the following depending on the available space:\n * - `This is a long text that will be truncated in the middle`\n * - `This is a long text that will ...iddle`\n * - `This is a long text...iddle`\n * - `Thi...iddle`\n * - `Thi...`\n */\nexport default function MiddleTruncatedText(inputProps: MiddleTruncatedTextProps): ReactElement {\n  const props = { ...defaultProps, ...inputProps } as Required<MiddleTruncatedTextProps>;\n\n  let startChars = Math.max(0, props.startCharacters);\n  let endChars = Math.max(0, props.endCharacters);\n  if (props.text.length <= startChars + endChars) {\n    endChars = props.text.length - startChars;\n  }\n\n  const splitIndex = Math.max(0, props.text.length - endChars);\n  const startText = props.text.slice(0, splitIndex);\n  const endText = props.text.slice(splitIndex);\n\n  // TODO: Text characters in endText can be partially clipped. Is there a way to prevent this from happening?\n\n  return (\n    <MiddleTruncatedTextContainer\n      $startChars={startChars}\n      $endChars={endChars}\n      aria-label={props.text}\n      title={props.text}\n    >\n      {\n        // The `$lrm;` is a non-printing character that indicates text punctuation should be rendered as left-to-right instead of rtl.\n        // It's included to prevent a visual bug where punctuation at the start (ex: !?_.:, etc.)\n        // of `endText` is rendered at the end instead. See https://en.wikipedia.org/wiki/Left-to-right_mark.\n        // (we are using rtl rendering so that the ellipses render on the left side of the text. )\n      }\n      <span>{startText}</span>\n      <span>&lrm;{endText}</span>\n    </MiddleTruncatedTextContainer>\n  );\n}\n","import { UploadOutlined } from \"@ant-design/icons\";\nimport { AutoComplete, Button, Modal } from \"antd\";\nimport Fuse from \"fuse.js\";\nimport React, { ReactElement, useMemo, useRef, useState } from \"react\";\nimport styled from \"styled-components\";\n\nimport { AppDataProps } from \"../../types\";\nimport { RecentDataUrl, useRecentDataUrls } from \"../../utils/react_utils\";\nimport { isValidUrl } from \"../../utils/url_utils\";\nimport { FlexRow } from \"../LandingPage/utils\";\n\nimport MiddleTruncatedText from \"../MiddleTruncatedText\";\n\nconst MAX_RECENT_URLS_TO_DISPLAY = 20;\n\ntype LoadModalProps = {\n  onLoad: (appProps: AppDataProps) => void;\n};\n\nconst ModalContainer = styled.div`\n  // Get the dropdown to size itself based on the webpage width, but resize itself to match the\n  // input area (~100vw - 100px of padding) when the webpage is very narrow\n  .ant-select-dropdown {\n    // TODO: Size to max-content so there isn't extra dead space past the end of the current items.\n    // Setting width to max-content directly causes the dropdown to collapse to a width of\n    // 0 pixels when more than 8 items are present and scrolling becomes enabled.\n    width: 100% !important;\n    max-width: calc(max(50vw, min(400px, 100vw - 100px)));\n  }\n`;\n\nexport default function LoadModal(props: LoadModalProps): ReactElement {\n  const [showModal, _setShowModal] = useState(false);\n  const [urlInput, setUrlInput] = useState(\"\");\n  const [errorText, setErrorText] = useState<string>(\"\");\n\n  const [recentDataUrls, addRecentDataUrl] = useRecentDataUrls();\n\n  const modalContainerRef = useRef<HTMLDivElement>(null);\n\n  const setShowModal = (show: boolean): void => {\n    if (show) {\n      setUrlInput(\"\");\n      setErrorText(\"\");\n    }\n    _setShowModal(show);\n  };\n\n  const onClickLoad = (): void => {\n    // TODO: Handle multiple URLs?\n    // TODO: Do any transformation of URLs here? Currently just using the labels directly.\n    if (!isValidUrl(urlInput)) {\n      setErrorText(\"Please enter a valid URL.\");\n      return;\n    }\n\n    const appProps: AppDataProps = {\n      imageUrl: urlInput,\n      imageDownloadHref: urlInput,\n      cellId: \"1\",\n      parentImageUrl: \"\",\n      parentImageDownloadHref: \"\",\n      // Enable first three channels by default\n      viewerChannelSettings: {\n        groups: [\n          {\n            name: \"Channels\",\n            channels: [\n              { match: [0, 1, 2], enabled: true },\n              { match: \"(.+)\", enabled: false },\n            ],\n          },\n        ],\n      },\n    };\n    props.onLoad(appProps);\n    addRecentDataUrl({ url: urlInput, label: urlInput });\n    setShowModal(false);\n  };\n\n  // Set up fuse for fuzzy searching on the labels of recent datasets\n  const fuse = useMemo(() => {\n    return new Fuse(recentDataUrls, {\n      keys: [\"label\"],\n      isCaseSensitive: false,\n      shouldSort: true, // sorts by match score\n      ignoreLocation: true, // search more than first 60 characters\n      findAllMatches: true, // return all matches\n    });\n  }, [recentDataUrls]);\n\n  // This search could be done using a transition if needed, but since there is a max of 100 urls,\n  // performance hits should be minimal.\n  const autoCompleteOptions: { label: React.ReactNode; value: string }[] = useMemo(() => {\n    let filteredItems: RecentDataUrl[] = [];\n    if (urlInput === \"\") {\n      // Show first 20 recent data urls\n      filteredItems = recentDataUrls.slice(0, MAX_RECENT_URLS_TO_DISPLAY);\n    } else {\n      // Show first 20 search results\n      filteredItems = fuse\n        .search(urlInput)\n        .slice(0, MAX_RECENT_URLS_TO_DISPLAY)\n        .map((option) => option.item);\n    }\n    return filteredItems.map((item) => {\n      return {\n        label: <MiddleTruncatedText text={item.label} />,\n        value: item.url,\n      };\n    });\n  }, [urlInput, fuse, recentDataUrls]);\n\n  const getAutoCompletePopupContainer = modalContainerRef.current ? () => modalContainerRef.current! : undefined;\n\n  return (\n    <ModalContainer ref={modalContainerRef}>\n      <Button type=\"link\" onClick={() => setShowModal(!showModal)}>\n        <UploadOutlined />\n        Load\n      </Button>\n      <Modal\n        open={showModal}\n        title={\"Load\"}\n        onCancel={() => setShowModal(false)}\n        getContainer={modalContainerRef.current || undefined}\n        okButtonProps={{}}\n        footer={\n          <Button type=\"default\" onClick={() => setShowModal(false)}>\n            Cancel\n          </Button>\n        }\n        destroyOnClose={true}\n      >\n        <p style={{ fontSize: \"16px\" }}>Provide the URL to load your OME-Zarr or OME-TIFF* data.</p>\n        <p style={{ fontSize: \"12px\" }}>\n          <i>*Note: this tool is intended for OME-Zarr use. Large {\"(> 100 MB)\"} OME-TIFF files are not supported.</i>\n        </p>\n        <FlexRow $gap={6}>\n          <AutoComplete\n            value={urlInput}\n            onChange={(value) => setUrlInput(value)}\n            onSelect={setUrlInput}\n            style={{ width: \"100%\" }}\n            allowClear={true}\n            options={autoCompleteOptions}\n            getPopupContainer={getAutoCompletePopupContainer}\n            placeholder=\"Enter a URL...\"\n            autoFocus={true}\n          ></AutoComplete>\n          <Button type=\"primary\" onClick={onClickLoad}>\n            Load\n          </Button>\n        </FlexRow>\n        {errorText !== \"\" && <p style={{ color: \"var(--color-text-error)\" }}>{errorText}</p>}\n      </Modal>\n    </ModalContainer>\n  );\n}\n"],"names":["IssueLink","_ref","bug","children","React","href","concat","target","rel","UNKNOWN_ERROR_DESCRIPTION","ERROR_TYPE_DESCRIPTIONS","_defineProperty","VolumeLoadErrorType","UNKNOWN","NOT_FOUND","TOO_LARGE","LOAD_DATA_FAILED","INVALID_METADATA","INVALID_MULTI_SOURCE_ZARR","getErrorTitle","error","_error$toString","Error","toString","call","ErrorAlert","_ref2","errors","_ref2$firstErrorCount","firstErrorCount","afterClose","onSkipError","_React$useState2","_slicedToArray","showDetails","setShowDetails","_React$useState4","errorsSeenCount","setErrorsSeenCount","Array","isArray","errorMessage","Button","type","onClick","style","display","undefined","_ERROR_TYPE_DESCRIPTI2","getErrorDescription","skipErrorButton","length","count","RightOutlined","Alert","showIcon","className","message","closable","action","useErrorAlert","_React$useState6","errorList","setErrorList","seenErrors","useConstructor","Map","_React$useState8","errorCounts","setErrorCounts","addError","_seenErrors$get","console","errorTitle","errorSeenCount","get","prev","_toConsumableArray","set","slice","errCount","ResetStateProvider","viewerStateRef","_classCallCheck","this","ref","savedViewerState","channelsToReset","Set","channelsToResetOnLoad","savedViewerChannelSettings","useDefaultViewerChannelSettings","resetToSavedViewerState","bind","resetToDefaultViewerState","resetToState","setSavedViewerState","setSavedViewerChannelSettings","getChannelsAwaitingReset","getChannelsAwaitingResetOnLoad","onResetChannel","getCurrentViewerChannelSettings","key","value","state","settings","channelIndex","getDefaultViewerChannelSettings","newState","newChannelStates","_this$ref$current","current","changeViewerSetting","setChannelSettings","channelSettings","viewMode","time","isInDifferentViewMode","ViewMode","xy","isAtDifferentTime","isAtDifferentZSlice","isEqual","z","willNeedResetOnLoad","overrideViewerState","overrideChannelStates","keys","enabledChannelsAndResetState","getEnabledChannelIndices","_step","_iterator","_createForOfIteratorHelper","s","n","done","err","e","f","_this","newViewerState","_objectSpread","getDefaultViewerState","cameraState","getDefaultCameraState","threeD","newChannelSettings","map","_","index","initializeOneChannelSetting","name","getDefaultChannelColor","defaultViewerState","defaultChannelStates","getDefaultChannelState","i","Math","min","volumeEnabled","isObject","val","_typeof","VIEWER_SETTINGS_CHANGE_HANDLERS","prevSettings","switchToVolumetric","renderMode","RenderMode","pathTrace","volumetric","autorotate","viewerSettingsReducer","viewerSettings","changeHandler","setting","ChannelSettingActionType","channelSettingsReducer","Init","ArrayUpdate","channel","idx","includes","newSettings","nullfn","DEFAULT_VIEWER_CONTEXT","changeChannelSetting","applyColorPresets","ALL_VIEWER_STATE_KEYS","Object","DEFAULT_VIEWER_CONTEXT_OUTER","ViewerStateContext","connectToViewerState","component","MemoedComponent","ConnectedComponent","props","viewerState","useContext","mergedProps","displayName","_useReducer2","useReducer","viewerDispatch","_useReducer4","channelDispatch","useRef","resetProvider","useEffect","useCallback","UniformUpdate","channels","prevViewerSettingsPropsRef","_i","_arr","context","useMemo","Provider","useRefWithSetter","setter","init","wrappedSetter","newValue","constructor","matchChannel","channelName","c","match","r","RegExp","test","findFirstChannelMatchOfGroup","g","_step2","_iterator2","findFirstChannelMatch","groups","_step3","_iterator3","getDisplayName","makeChannelIndexGrouping","SINGLE_GROUP_CHANNEL_KEY","_val","grouping","channelsMatched","_step4","_iterator4","_loop","forEach","groupMatch","push","remainderGroupName","OTHER_CHANNEL_KEY","currentStates","newStates","controlPoints","ramp","enabledChannels","isosurfaceEnabled","defaultColor","viewerChannelSettings","_initSettings$enabled","_initSettings$surface","_initSettings$coloriz","_initSettings$coloriz2","_initSettings$isovalu","_initSettings$surface2","_colorHexToArray","_initSettings$color","_initSettings$control","_initSettings$control2","_initSettings$ramp","_findFirstChannelMatc","hex","result","defaultChannelState","arguments","initSettings","enabled","surfaceEnabled","colorizeEnabled","colorizeAlpha","isovalue","opacity","surfaceOpacity","color","exec","parseInt","useControlPoints","controlPointsEnabled","plotMin","plotMax","activeAxisMap","yz","xz","colorObjectToArray","obj","b","colorArrayToObject","arr","colorArrayToFloats","colorArrayToString","parseLutValue","histogram","firstChar","charAt","parsedValue","parseFloat","substring","maxBin","findBinOfPercentile","initializeLut","aimg","_parseLutFromSettings","visibleLut","getHistogram","defaultLut","hmin","LUT_MIN_PERCENTILE","hmax","LUT_MAX_PERCENTILE","Lut","createFromMinMax","getDefaultLut","lut","channelNames","lutValues","findAutoIJBins","max","parseLutFromSettings","rampToControlPoints","createFromControlPoints","setLut","controlPointsToRamp","TFEDITOR_MAX_BIN","x","TFEDITOR_DEFAULT_COLOR","remapControlPointsForChannel","oldRange","_ref3","rawMin","rawMax","remapControlPoints","PlayControls","axis","_this$onPlayingAxisCh","playingAxis","onPlayingAxisChanged","_this$getVolumeIsLoad","playHolding","stepAxis","getVolumeIsLoaded","playTimeoutId","window","setTimeout","playStep","playWaitingForLoad","willResume","clearTimeout","setPlayingAxis","pause","_regeneratorRuntime","t","prototype","hasOwnProperty","o","defineProperty","Symbol","a","iterator","asyncIterator","u","toStringTag","define","enumerable","configurable","writable","wrap","Generator","create","Context","makeInvokeMethod","tryCatch","arg","h","l","y","GeneratorFunction","GeneratorFunctionPrototype","p","d","getPrototypeOf","v","values","defineIteratorMethods","_invoke","AsyncIterator","invoke","resolve","__await","then","callInvokeWithMethodAndArg","method","delegate","maybeInvokeDelegate","sent","_sent","dispatchException","abrupt","TypeError","resultName","next","nextLoc","pushTryEntry","tryLoc","catchLoc","finallyLoc","afterLoc","tryEntries","resetTryEntry","completion","reset","isNaN","isGeneratorFunction","mark","setPrototypeOf","__proto__","awrap","async","Promise","reverse","pop","stop","rval","handle","complete","finish","delegateYield","asyncGeneratorStep","_asyncToGenerator","apply","_next","_throw","_defineProperties","_toPropertyKey","toPrimitive","String","_toPrimitive","SceneStore","paths","loaders","fill","_getLoader","_callee","scene","loader","path","options","_context","currentScene","rawArrayOptions","onOpen","createLoader","syncMultichannelLoading","syncChannels","setPrefetchPriority","prefetchPriority","_x","_loadScene","_callee2","image","loadSpec","onChannelLoaded","spec","_context2","getLoader","loadSpecRequired","createImageInfo","imageInfo","loadVolumeData","_x2","_x3","_x4","_x5","_createVolume","_callee3","_context3","createVolume","_x6","_x7","_x8","sync","currentLoader","priority","ownKeys","getOwnPropertySymbols","filter","getOwnPropertyDescriptor","getOwnPropertyDescriptors","defineProperties","_arrayWithHoles","_iterableToArrayLimit","_arrayLikeToArray","from","_unsupportedIterableToArray","_nonIterableRest","ImageLoadStatus","useEffectEventRef","callback","callbackRef","scenePaths","onErrorRef","onError","onChannelLoadedRef","maskChannelName","_useState2","useState","setImage","loadContext","VolumeLoaderContext","CACHE_MAX_SIZE","QUEUE_MAX_SIZE","QUEUE_MAX_LOW_PRIORITY_SIZE","sceneLoader","playControls","_useState4","isPlaying","AXIS_TO_LOADER_PRIORITY","_image$imageInfo","volumeSize","subregionSize","shouldDownlevel","updateRequiredData","scaleLevelBias","_useState6","channelVersions","_setChannelVersions","_useRefWithSetter2","channelVersionsRef","setChannelVersions","_useState8","loadThrewError","setLoadThrewError","inInitialLoadRef","imageLoadStatus","ERROR","_channelVersions$redu","reduce","version","allLoaded","noneLoaded","loaded","_channelVersions$redu2","REQUESTED","LOADED","LOADING","setIsLoading","_onErrorRef$current","_useState10","channelGroupedByType","setChannelGroupedByType","onChannelDataLoaded","_onChannelLoadedRef$c","isInitialLoad","newVersions","isLoaded","onImageLoaded","_viewerStateRef$curre","setChannelStateForNewImage","every","_channelSettings$idx","openImage","_getCurrentViewerChan","_viewerStateRef$curre2","requiredLoadSpec","requiredChannelsToLoad","maskChannelIndex","LoadSpec","_viewerStateRef$curre3","times","indexOf","subregion","Box3","Vector3","loadScene","setTime","view3d","setScene","_ref$step","step","_ref$precision","precision","_ref$min","_ref$max","Number","MAX_SAFE_INTEGER","_ref$disabled","disabled","_ref$className","onChange","hasFocus","_setHasFocus","hasFocusRef","setHasFocus","textContent","setTextContent","inputRef","clamp","roundToPrecision","round","shouldChange","displayedValue","changeByStep","up","_inputRef$current","focus","fullClassName","onKeyDown","event","preventDefault","_inputRef$current2","blur","autoComplete","role","inputStr","inputNum","handleTyping","onFocus","onBlur","CaretUpOutlined","CaretDownOutlined","MemoedNouislider","Nouislider","_prevProps","noUpdate","setNoUpdate","wrapEventHandler","shouldNotUpdate","handler","onStart","onEnd","AXES","SliderRow","label","vals","_ref$valsReadout","valsReadout","onSlide","_ref$onChange","isRange","wrappedOnSlide","wrappedOnChange","SmarterSlider","connect","range","start","margin","behaviour","pips","mode","density","format","to","NumericInput","PlaySliderRow","valReadout","setValReadout","sliderHeld","setSliderHeld","wrappedSetValReadout","_ref4","wrappedOnStart","wrappedOnEnd","updateWhileSliding","Tooltip","placement","title","trigger","onTogglePlayback","playing","icon","PauseOutlined","CaretRightOutlined","activeAxis","pauseOnInput","numSlices","numSlicesLoaded","handlePlayPause","willPlay","play","toUpperCase","slices","updateSlice","startHold","endHold","region","minval","maxval","updateRegion","numTimesteps","updateTime","numScenes","_ref6","axes","_extends","xmlns","width","height","viewBox","cx","cy","boundingBox","camera","closePanel","download","dropdownArrow","metadata","preferences","resetView","turnTable","STYLE","fontSize","newProps","Icon","ICONS","openProp","open","onOpenChange","openState","setOpenState","toggleDrawer","optionsButton","size","ViewerIcon","Drawer","getContainer","mask","view3dviewerRef","appendChild","getDOMElement","spinner","noImageText","appHeight","visibleControls","clippingPanelTall","STYLES","viewer","BottomPanel","clippingPanelOpen","onClippingPanelOpenChange","CLIPPING_PANEL_HEIGHT_TALL","CLIPPING_PANEL_HEIGHT_DEFAULT","axisClipSliders","AxisClipSliders","loadingImage","noImage","LoadingOutlined","zIndex","removeAllVolumes","position","overflow","top","left","bottom","right","justifyContent","alignItems","backgroundColor","DEFAULT_COLOR","isOpen","setIsOpen","openAboveSwatch","setOpenAboveSwatch","currentColor","setCurrentColor","swatchRef","popoverDirectionStyle","swatch","swatchRect","getBoundingClientRect","noRoomBelowSwatch","innerHeight","background","ele","popover","cover","SketchPicker","_props$onColorChange","rgb","onColorChange","onChangeComplete","_props$onColorChangeC","onColorChangeComplete","disableAlpha","borderRadius","border","cursor","verticalAlign","INTEGER_FORMATTER","hideSlider","tooltips","formatInteger","onUpdate","TfEditorRampSliderHandle","TF_GENERATORS","autoXF","histo","_histo$findAutoMinMax2","findAutoMinMax","auto2XF","_histo$findAutoIJBins2","auto98XF","bestFitXF","_histo$findBestFitBin2","findBestFitBins","resetXF","_histo","createFullRange","sliderHandleSymbol","draw","sqrt","triangleHeight","halfWidth","moveTo","lineTo","closePath","u8ToAbsolute","absoluteToU8","controlPointToAbsolute","cp","coverRangeWithPoint","point","createPointOnRangeBoundary","outOfRangePt","inRangePt","rangeRatio","ControlPointGradientDef","id","gradientUnits","spreadMethod","x2","offset","stopColor","stopOpacity","numberFormatter","toFixed","innerWidth","selectedPointIdx","setSelectedPointIdx","draggedPointIdx","_setDraggedPointIdx","_setCPs","setRamp","controlPointsRef","setControlPoints","_useRefWithSetter4","draggedPointIdxRef","setDraggedPointIdx","colorPickerPosition","setColorPickerPosition","lastColorRef","svgRef","_props$channelData","channelData","dtype","typeRange","DTYPE_RANGE","xScale","d3","domain","plotMinU8","plotMaxU8","yScale","mouseEventToControlPointValues","_svgRef$current$getBo","_svgRef$current","svgRect","invert","clientX","clientY","handleDragEnd","currentTarget","releasePointerCapture","pointerId","handleControlPointContextMenu","cpRect","xPosition","yPosition","controlPointsToRender","points","firstPoint","lastPoint","unshift","outOfRangePoint","shift","fitControlPointsToRange","areaPath","_areaGenerator","y0","y1","curve","areaGenerator","sliderHandlePath","_d3$symbol$type$size","xAxisRef","el","ticks","_xScale$domain2","tickValues","tickPadding","yAxisRef","histogramRef","numBins","getNumBins","_getHistogramBinLengt","binLengths","NEGATIVE_INFINITY","binLength","getBin","getHistogramBinLengths","ceil","end","floor","binLengthsToRender","barWidth","binScale","base","selectAll","data","join","attr","_len","len","applyTFGenerator","generator","createTFGeneratorButton","description","controlPointCircles","onPointerDown","onContextMenu","splice","viewerModeString","Checkbox","checked","marginLeft","InputNumber","formatter","controls","abs","newControlPoints","button","_mouseEventToControlP2","setPointerCapture","nativeEvent","onPointerMove","buttons","stopPropagation","_mouseEventToControlP4","draggedIdx","draggedPoint","bisector","idxLeft","idxRight","numPointsToRemove","newIdx","dragControlPoint","Min","dragRampSlider","onPointerUp","transform","strokeDasharray","strokeWidth","Max","saveIsosurface","channelState","controlsOpen","setControlsOpen","changeSettingForThisChannel","visibilityControls","rowClass","List","Item","Meta","avatar","ColorPicker","newRGB","_oldRGB","TfEditor","channelDataForChannel","ISOSURFACE_OPACITY_SLIDER_MAX","_ref5","fontStyle","indeterminate","checkedList","allOptions","checkAll","channelDataChannels","filterFunc","createCheckboxHandler","channelArray","showVolumes","showSurfaces","renderVisibilityControls","volChecked","isoChecked","channelSetting","SharedCheckBox","flex","renderChannelRow","thisChannelSettings","ChannelsWidgetRow","firstKey","rows","entries","itemLayout","dataSource","renderItem","extra","Collapse","bordered","defaultActiveKey","items","collapsible","ColorPickerRow","colorPickerRow","colorPicker","padding","borderBottom","marginRight","backgroundColorPicker","boundingBoxColorPicker","boundingBoxColor","showBoundingBox","createSliderRow","propKey","_strValues","_handle","selectValue","showControls","maskAlpha","brightness","levels","paddingTop","paddingBottom","alphaMaskSlider","brightnessSlider","densitySlider","levelsSliders","interpolationControl","interpolationEnabled","isCategory","entry","MetadataCategory","collapsed","setCollapsed","collapsedClass","colSpan","MetadataTable","topLevel","metadataKeys","metadataIsArray","metadataValue","cats","sortCategoriesFirst","ControlTab","ControlTabNames","Channels","Advanced","Metadata","showCustomize","dropDownMenuProps","tab","_setTab","controlPanelContainerRef","getDropdownContainer","hasImage","renderTab","thisTab","metadataViewer","colorPresetsDropdown","PRESET_COLOR_MAP","preset","onApplyColorPresets","colors","Dropdown","menu","getPopupContainer","flexDirection","gap","ChannelsWidget","GlobalVolumeControls","imageName","pixelSize","CustomizeWidget","Flex","vertical","MetadataViewer","getMetadata","fovDownloadHref","cellDownloadHref","hasFov","viewModes","Radio","onViewModeChange","visuallyHiddenStyle","clip","whiteSpace","borderWidth","containerRef","barRef","leftRef","rightRef","centerRef","scrollMode","setScrollMode","showScrollBtnLeft","setScrollBtnLeft","showScrollBtnRight","setScrollBtnRight","checkScrollBtnVisible","barEl","scrollLeft","scrollWidth","clientWidth","checkSize","debounce","leftRect","centerRect","rightRect","addEventListener","removeEventListener","scrollX","amount","classForToggleBtn","active","showAxes","twoDMode","renderGroup1","viewModeRadioButtons","resetCameraButton","autoRotateButton","renderGroup4","showAxesButton","showBoundingBoxButton","axesToggleTitle","boundingBoxToggleTitle","turntableToggleTitle","onWheel","deltaY","onScroll","ReloadOutlined","ViewModeRadioButtons","newMode","resetCamera","fovCellSwitchControls","hasCellId","hasParentImage","imageType","ImageType","segmentedCell","fullField","Select","popupClassName","Option","canPathTrace","maxProject","DownloadButton","downloadScreenshot","useImageEffect","effect","deps","setVolumeChannelEnabled","updateLuts","setVolumeChannelOptions","currentImage","isosurfaceOpacity","gradient","controlPointsToLut","createLabelColors","setColorPalette","setColorPaletteAlpha","Sider","Layout","Content","defaultVisibleControls","saveSurfaceButtons","defaultProps","rawData","rawDims","imageUrl","parentImageUrl","cellId","imageDownloadHref","parentImageDownloadHref","canvasMargin","view3dRef","showError","_props$showError","_scenes$length","_scenes2","_image$imageInfo$volu","_image$imageInfo$subr","_image$imageInfo$time","_props$transform2","_props$transform4","_viewerState$current","_props","onControlPanelToggle","metadataFormatter","View3d","_useErrorAlert2","errorAlert","_showError","setLoadErrorHandler","_vol","imageUrlRef","scenesRef","_props2","scenes","_scenes","channelRangesRef","_viewerState$current2","thisChannel","getChannel","has","_initializeLut","onVolumeData","setVolumeChannelAsMask","updateActiveChannels","volume","useVolume","addVolume","ch","find","CONTROL_PANEL_CLOSE_WIDTH","controlPanelClosed","setControlPanelClosed","hasAutoClosedControlPanel","setHasAutoClosedControlPanel","setClippingPanelOpen","clippingPanelOpenTimeout","saveChannelIsosurface","saveScreenshot","capture","dataUrl","anchor","document","createElement","click","sceneMeta","_sceneMeta","imageMetadata","Image","hasTime","hasScenes","mode3d","panelOpen","isMode3d","axisY","AXIS_MARGIN_DEFAULT","_SCALE_BAR_MARGIN_DEF","SCALE_BAR_MARGIN_DEFAULT","scaleBarX","scaleBarY","clippingPanelHeight","setShowTimestepIndicator","setAxisPosition","setTimestepIndicatorPosition","setScaleBarPosition","setIndicatorPositions","setShowScaleBar","setShowAxis","onResizeDebounced","dispatchEvent","Event","_currentImage","setCameraMode","resize","setCameraState","setAutoRotate","setBackgroundColor","setBoundingBoxColor","setShowBoundingBox","channelsAwaitingReset","_initializeLut2","setMaxProjectMode","setVolumeRenderMode","RENDERMODE_PATHTRACE","RENDERMODE_RAYMARCH","updateMaskAlpha","updateExposure","updateDensity","imageValues","sliderValues","mid","scale","gammaSliderToImageValues","setGamma","setInterpolationEnabled","_props$transform","setVolumeTranslation","translation","_props$transform3","setVolumeRotation","rotation","usePerAxisClippingUpdater","isOrthoAxis","axismin","axismax","oneSlice","setZSlice","setAxisClip","physicalPixelSize","toArray","StyleProvider","ChannelUpdater","defaultCollapsed","collapsedWidth","ControlPanel","Toolbar","hasWebGL2","CellViewerCanvasWrapper","PrimaryButton","SecondaryButton","styled","_templateObject","HelpDropdown","container","setContainer","showVersionModal","setShowVersionModal","Link","FlexRowAlignCenter","$gap","DropdownSVG","Modal","onCancel","footer","FlexColumnAlignCenter","VOLEAPP_VERSION","VOLECORE_VERSION","useRecentDataUrls","_useLocalStorage2","useLocalStorage","storedRecentEntries","setRecentEntries","recentEntries","url","addRecentEntry","newEntry","datasetIndex","findIndex","MAX_RECENT_URLS","startCharacters","endCharacters","MiddleTruncatedTextContainer","div","_taggedTemplateLiteral","css","_templateObject2","$startChars","$endChars","MiddleTruncatedText","inputProps","startChars","endChars","text","splitIndex","startText","endText","MAX_RECENT_URLS_TO_DISPLAY","ModalContainer","LoadModal","showModal","_setShowModal","urlInput","setUrlInput","errorText","setErrorText","_useRecentDataUrls2","recentDataUrls","addRecentDataUrl","modalContainerRef","setShowModal","show","fuse","Fuse","isCaseSensitive","shouldSort","ignoreLocation","findAllMatches","autoCompleteOptions","search","option","item","getAutoCompletePopupContainer","UploadOutlined","okButtonProps","destroyOnClose","FlexRow","AutoComplete","onSelect","allowClear","placeholder","autoFocus","isValidUrl","appProps","onLoad"],"sourceRoot":""}