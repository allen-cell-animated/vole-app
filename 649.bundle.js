/*! For license information please see 649.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunk_aics_vole_app=self.webpackChunk_aics_vole_app||[]).push([[649],{3e3:(t,e,s)=>{s.d(e,{A:()=>n,y:()=>i});const i=t=>void 0!==t.data,r=t=>t.byteLength??(({data:t})=>Array.isArray(t)?t.length:t.byteLength)(t);class n{constructor(t=25e7){this.entries=new Map,this.maxSize=t,this.currentSize=0,this.first=null,this.last=null}get size(){return this.currentSize}get numberOfEntries(){return this.entries.size}removeEntryFromStore(t){this.entries.delete(t.key),this.currentSize-=r(t.data)}removeEntryFromList(t){const{prev:e,next:s}=t;e?e.next=s:this.first=s,s?s.prev=e:this.last=e}addEntryAsFirst(t){this.first?this.first.prev=t:this.last=t,t.next=this.first,t.prev=null,this.first=t}moveEntryToFirst(t){t!==this.first&&(this.removeEntryFromList(t),this.addEntryAsFirst(t))}evictLast(){this.last?(this.removeEntryFromStore(this.last),this.last.prev&&(this.last.prev.next=null),this.last=this.last.prev):console.error("VolumeCache: attempt to evict last entry from cache when no last entry is set")}evict(t){this.removeEntryFromStore(t),this.removeEntryFromList(t)}insert(t,e){const s=r(e);if(s>this.maxSize)return console.error("VolumeCache: attempt to insert a single entry larger than the cache"),!1;const i=this.getEntry(t);if(void 0!==i)return i.data=e,!0;const n={data:e,prev:null,next:null,key:t};for(this.addEntryAsFirst(n),this.entries.set(t,n),this.currentSize+=s;this.currentSize>this.maxSize;)this.evictLast();return!0}getEntry(t){const e=this.entries.get(t);return e&&this.moveEntryToFirst(e),e}get(t){return this.getEntry(t)?.data}clearWithPrefix(t){for(const[e,s]of this.entries.entries())e.startsWith(t)&&this.evict(s)}clear(){for(;this.last;)this.evictLast()}}},649:(t,e,s)=>{var i=s(205);class r extends Error{name="NonError";constructor(t){super(r._prepareSuperMessage(t))}static _prepareSuperMessage(t){try{return JSON.stringify(t)}catch{return String(t)}}}const n=[{property:"name",enumerable:!1},{property:"message",enumerable:!1},{property:"stack",enumerable:!1},{property:"code",enumerable:!0},{property:"cause",enumerable:!1}],a=new WeakSet,o=t=>i.A.get(t)??Error,h=({from:t,seen:e,to:s,forceEnumerable:i,maxDepth:r,depth:l,useToJSON:c,serialize:m})=>{if(s||(s=Array.isArray(t)?[]:!m&&u(t)?new(o(t.name)):{}),e.push(t),l>=r)return s;if(c&&"function"==typeof t.toJSON&&!a.has(t))return(t=>{a.add(t);const e=t.toJSON();return a.delete(t),e})(t);const d=t=>h({from:t,seen:[...e],forceEnumerable:i,maxDepth:r,depth:l,useToJSON:c,serialize:m});for(const[i,r]of Object.entries(t))if(r&&r instanceof Uint8Array&&"Buffer"===r.constructor.name)s[i]="[object Buffer]";else if(null===r||"object"!=typeof r||"function"!=typeof r.pipe){if("function"!=typeof r)if(r&&"object"==typeof r)e.includes(t[i])?s[i]="[Circular]":(l++,s[i]=d(t[i]));else try{s[i]=r}catch{}}else s[i]="[object Stream]";for(const{property:e,enumerable:r}of n)void 0!==t[e]&&null!==t[e]&&Object.defineProperty(s,e,{value:u(t[e])?d(t[e]):t[e],enumerable:!!i||r,configurable:!0,writable:!0});return s};function l(t,e={}){const{maxDepth:s=Number.POSITIVE_INFINITY,useToJSON:i=!0}=e;return"object"==typeof t&&null!==t?h({from:t,seen:[],forceEnumerable:!0,maxDepth:s,depth:0,useToJSON:i,serialize:!0}):"function"==typeof t?`[Function: ${t.name||"anonymous"}]`:t}function c(t,e={}){const{maxDepth:s=Number.POSITIVE_INFINITY}=e;if(t instanceof Error)return t;if(function(t){return Boolean(t)&&"object"==typeof t&&"message"in t&&!Array.isArray(t)}(t)){const e=o(t.name);return h({from:t,seen:[],to:new e,maxDepth:s,depth:0,serialize:!1})}return new r(t)}function u(t){return Boolean(t)&&"object"==typeof t&&"name"in t&&"message"in t&&"stack"in t}var m=s(3e3),d=s(4922),p=s(8613),y=s(6712),x=s(2081),g=s(7950),f=s(9565);const b={int8:Int8Array,int16:Int16Array,int32:Int32Array,int64:globalThis.BigInt64Array,uint8:Uint8Array,uint16:Uint16Array,uint32:Uint32Array,uint64:globalThis.BigUint64Array,float32:Float32Array,float64:Float64Array};class _{constructor(t){this.dataMinBin=0,this.dataMaxBin=0,this.maxBin=0,this.bins=new Uint32Array,this.min=0,this.max=0,this.binSize=0;const e=_.calculateHistogram(t,256);this.bins=e.bins,this.min=e.min,this.max=e.max,this.binSize=e.binSize;for(let t=0;t<this.bins.length;t++)if(this.bins[t]>0){this.dataMinBin=t;break}for(let t=this.bins.length-1;t>=0;t--)if(this.bins[t]>0){this.dataMaxBin=t;break}this.pixelCount=t.length,this.maxBin=1;let s=this.bins[1];for(let t=1;t<this.bins.length;t++)this.bins[t]>s&&(this.maxBin=t,s=this.bins[t])}static findBin(t,e,s,i){const r=(t-e)/s;return i?Math.max(Math.min(Math.floor(r),255),0):r}findBinOfValue(t){return _.findBin(t,this.min,this.binSize,!0)}findFractionalBinOfValue(t){return _.findBin(t,this.min,this.binSize,!1)}getValueFromBinIndex(t){return this.min+t*this.binSize}getDataMin(){return this.min}getDataMax(){return this.max}getMin(){return this.dataMinBin}getMax(){return this.dataMaxBin}getNumBins(){return this.bins.length}getBin(t){return this.bins[t]}getBinRange(t){return[this.min+t*this.binSize,this.min+(t+1)*this.binSize]}findBinOfPercentile(t){const e=this.pixelCount*t;let s=0,i=0;for(s=0;s<this.bins.length&&(i+=this.bins[s],!(i>e));++s);return s}findBestFitBins(){const t=this.pixelCount/10;let e=0,s=0;for(e=1;e<this.bins.length&&(s+=this.bins[e],!(s>t));++e);const i=e;for(s=0,e=this.bins.length-1;e>=1&&(s+=this.bins[e],!(s>t));--e);return[i,e]}findAutoIJBins(){const t=this.pixelCount,e=t/10,s=t/5e3;let i=this.bins.length-1,r=1;for(let t=1;t<this.bins.length;++t)if(this.bins[t]>s&&this.bins[t]<=e){i=t;break}for(let t=this.bins.length-1;t>=1;--t)if(this.bins[t]>s&&this.bins[t]<=e){r=t;break}return r<i&&(i=0,r=255),[i,r]}findAutoMinMax(){const t=Math.floor(.1*this.bins[this.maxBin]);let e=0,s=this.bins.length-1;for(let s=1;s<this.bins.length;++s)if(this.bins[s]>t){e=s;break}for(let e=this.bins.length-1;e>=1;--e)if(this.bins[e]>t){s=e;break}return[e,s]}static calculateHistogram(t,e=1){e<1&&(e=1);let s=t[0],i=t[0];for(let e=1;e<t.length;e++)t[e]<s?s=t[e]:t[e]>i&&(i=t[e]);const r=new Uint32Array(e).fill(0),n=(a=t)instanceof Float32Array||a instanceof Float64Array?i:i+1;var a;const o=n<=s?1:(n-s)/e;for(let e=0;e<t.length;e++){const i=t[e];r[_.findBin(i,s,o,!0)]++}return{bins:r,min:s,max:i,binSize:o}}}const M=[[255,0,255],[255,255,255],[0,255,255]],w=(z=123,function(){return(2147483647&(z=0|Math.imul(48271,z)))/2147483648});var z;const v=t=>(M[t]||(M[t]=function(t,e,s){let i,r,n,a=0;if(1===arguments.length){const i=t;e=i.s,s=i.v,a=i.h}else a=t;const o=Math.floor(6*a),h=6*a-o,l=s*(1-e),c=s*(1-h*e),u=s*(1-(1-h)*e);switch(o%6){case 0:i=s,r=u,n=l;break;case 1:i=c,r=s,n=l;break;case 2:i=l,r=s,n=u;break;case 3:i=l,r=c,n=s;break;case 4:i=u,r=l,n=s;break;case 5:i=s,r=l,n=c}return[Math.round(255*i),Math.round(255*r),Math.round(255*n)]}(w(),.5*w()+.5,.5*w()+.5)),M[t]);function S(t,e,s){return Math.min(Math.max(e,t),s)}function A(t,e,s){return s*(e-t)+t}function C(t,e,s,i,r,n,a){return e+((t-e)/(s-e)*(a-n)+n-i)/(r-i)*(s-e)}function T(t,e,s,i,r,n,a){return e+((t-e)/(s-e)*(r-i)+i-n)/(a-n)*(s-e)}const E=256,k=1024;function I(t){return[t.color[0],t.color[1],t.color[2],Math.floor(255*t.opacity)]}const D=(t=0,e=1)=>[{x:0,opacity:t,color:[255,255,255]},{x:255,opacity:e,color:[255,255,255]}];class O{constructor(){this.lut=new Uint8Array(k),this.controlPoints=[],this.createFullRange()}createFromMinMax(t,e){if(e<t){const s=e;e=t,t=s}if(t<0&&e<0)return this.controlPoints=D(1,1),this.createFromControlPoints(this.controlPoints);if(t>=255&&e>=255)return this.controlPoints=D(0,0),this.createFromControlPoints(this.controlPoints);const s=[];let i=0;t<0&&(i=-t/(e-t)),s.push({x:0,opacity:i,color:[255,255,255]}),t>0&&s.push({x:t,opacity:0,color:[255,255,255]}),e<255&&(e===t?s.push({x:t+.5,opacity:1,color:[255,255,255]}):s.push({x:e,opacity:1,color:[255,255,255]}));let r=1;return e>255&&(r=(255-t)/(e-t)),s.push({x:255,opacity:r,color:[255,255,255]}),this.createFromControlPoints(s)}createFullRange(){return this.controlPoints=D(),this.createFromControlPoints(this.controlPoints)}createFromWindowLevel(t,e){const s=e-.5*t,i=e+.5*t;return this.createFromMinMax(255*s,255*i)}createFromControlPoints(t){return this.lut=function(t){const e=new Uint8Array(1024).fill(0);if(0===t.length)return e;if(t.sort(((t,e)=>t.x-e.x)),1===t.length){const s=I(t[0]);for(let i=S(t[0].x,0,255);i<256;++i)e[4*i+0]=s[0],e[4*i+1]=s[1],e[4*i+2]=s[2],e[4*i+3]=s[3];return e}let s=t[0],i=t[1],r=I(s),n=I(i),a=1,o=0;for(let h=0;h<256;++h){for(;h>i.x;)s=i,r=n,a++,i=a>=t.length?{x:255,color:i.color,opacity:i.opacity}:t[a],n=I(i);o=i.x===s.x?1:(h-s.x)/(i.x-s.x),e[4*h+0]=S(A(r[0],n[0],o),0,255),e[4*h+1]=S(A(r[1],n[1],o),0,255),e[4*h+2]=S(A(r[2],n[2],o),0,255),e[4*h+3]=S(A(r[3],n[3],o),0,255)}return e}(t),this.controlPoints=t,this}createFromEqHistogram(t){const e=[];for(let s=0;s<t.getNumBins();++s)e[s]=0;e[0]=t.getBin(0);for(let s=1;s<t.getNumBins();++s)e[s]=e[s-1]+t.getBin(s);if(e[e.length-1]-e[0]>0){const t=[{x:0,opacity:0,color:[255,255,255]}];let s=0,i=0,r=0,n=0;for(let a=1;a<E;++a)n=r,r=S(Math.round(255*(e[a]-e[0])),0,255),s=r-n,s!=i&&(t.push({x:a-1,opacity:n/255,color:[255,255,255]}),i=s);return t.push({x:255,opacity:1,color:[255,255,255]}),this.createFromControlPoints(t)}return this.createFullRange()}createLabelColors(t){const e=new Uint8Array(k).fill(0),s=[];s.push({x:0,opacity:0,color:[0,0,0]});let i=0,r=0,n=0,a=0,o=0,h=0,l=0,c=0;for(let u=1;u<E;++u){const m=Math.floor(u/255*(t.getNumBins()-1));if(t.getBin(m)>0){const t=v(m);e[4*u+0]=t[0],e[4*u+1]=t[1],e[4*u+2]=t[2],e[4*u+3]=255,o=t[0],h=t[1],l=t[2],c=1}else o=0,h=0,l=0,c=0;o===i&&h===r&&l===n&&c===a||(0===a&&s.push({x:u-.5,opacity:a,color:[i,r,n]}),s.push({x:u,opacity:c,color:[o,h,l]}),i=o,r=h,n=l,a=c)}return this.lut=e,this.controlPoints=s,this}remapDomains(t,e,s,i){this.lut=function(t,e,s,i,r){const n=new Uint8Array(k);for(let a=0;a<E;++a){let o=C(a,0,255,e,s,i,r);o<0&&(o=0),o>255&&(o=255);const h=Math.floor(o),l=Math.ceil(o),c=o-h;n[4*a+0]=Math.round(A(t[4*h+0],t[4*l+0],c)),n[4*a+1]=Math.round(A(t[4*h+1],t[4*l+1],c)),n[4*a+2]=Math.round(A(t[4*h+2],t[4*l+2],c)),n[4*a+3]=Math.round(A(t[4*h+3],t[4*l+3],c))}return n}(this.lut,t,e,s,i),this.controlPoints=function(t,e,s,i,r,n=!0){if(0===t.length)return t;const a=[],o=t[0].x,h=t[t.length-1].x;for(let n=0;n<t.length;++n){const o=t[n],h={x:T(o.x,0,255,e,s,i,r),opacity:o.opacity,color:[o.color[0],o.color[1],o.color[2]]};a.push(h)}return n?function(t,e,s){const i=1e-4,r=t[0],n=t[1],a=t[t.length-2],o=t[t.length-1];return Math.abs(r.opacity-(n?.opacity??1/0))<i&&(r.x<0?r.x=Math.min(0,n.x-1):e<i&&(r.x=0)),Math.abs(o.opacity-(a?.opacity??1/0))<i&&(o.x>255?o.x=Math.max(255,a.x+1):s>254.9999&&(o.x=255)),t}(a,o,h):a}(this.controlPoints,t,e,s,i)}}class P{constructor(t){this.loaded=!1,this.dtype="uint8",this.imgData={data:new Uint8Array,width:0,height:0},this.rawMin=0,this.rawMax=255,this.frame=0,this.dataTexture=new d.GYF(new Uint8Array,0,0),this.lutTexture=new d.GYF(new Uint8Array(k),256,1,d.GWd,d.OUM),this.lutTexture.minFilter=this.lutTexture.magFilter=d.k6q,this.lutTexture.generateMipmaps=!1,this.volumeData=new Uint8Array,this.name=t,this.histogram=new _(new Uint8Array),this.dims=[0,0,0],this.lut=(new O).createFromMinMax(0,255),this.colorPalette=new Uint8Array(k).fill(0),this.colorPaletteAlpha=0}combineLuts(t,e){const s=e||new Uint8Array(k);if(!t)return s;const i=[t[0]/255,t[1]/255,t[2]/255];if(1===this.colorPaletteAlpha)s.set(this.colorPalette);else if(0===this.colorPaletteAlpha){s.set(this.lut.lut);for(let t=0;t<256;++t)s[4*t+0]*=i[0],s[4*t+1]*=i[1],s[4*t+2]*=i[2]}else for(let t=0;t<256;++t)s[4*t+0]=this.colorPalette[4*t+0]*this.colorPaletteAlpha+this.lut.lut[4*t+0]*(1-this.colorPaletteAlpha)*i[0],s[4*t+1]=this.colorPalette[4*t+1]*this.colorPaletteAlpha+this.lut.lut[4*t+1]*(1-this.colorPaletteAlpha)*i[1],s[4*t+2]=this.colorPalette[4*t+2]*this.colorPaletteAlpha+this.lut.lut[4*t+2]*(1-this.colorPaletteAlpha)*i[2],s[4*t+3]=this.colorPalette[4*t+3]*this.colorPaletteAlpha+this.lut.lut[4*t+3]*(1-this.colorPaletteAlpha);return this.lutTexture.image.data.set(s),this.lutTexture.needsUpdate=!0,s}setRawDataRange(t,e){0===this.rawMin&&0===this.rawMax||0===t&&0===e||(this.lut.remapDomains(this.rawMin,this.rawMax,t,e),this.rawMin=t,this.rawMax=e)}getHistogram(){return this.histogram}getIntensity(t,e,s){return this.volumeData[t+e*this.dims[0]+s*(this.dims[0]*this.dims[1])]}normalizeRaw(t){return(t-this.rawMin)/(this.rawMax-this.rawMin)}getIntensityFromAtlas(t,e,s){const i=this.imgData.width/this.dims[0],r=s%i,n=Math.floor(s/i),a=r*this.dims[0]+t+(n*this.dims[1]+e)*this.imgData.width;return this.imgData.data[a]}rebuildDataTexture(t,e,s){this.dataTexture&&this.dataTexture.dispose();let i=d.Kzv,r=d.OUM,n="LUMINANCE";switch(this.dtype){case"uint8":r=d.OUM,i=d.ZQM,n="R8UI";break;case"int8":r=d.tJf,i=d.ZQM,n="R8I";break;case"uint16":r=d.cHt,i=d.ZQM,n="R16UI";break;case"int16":r=d.fBL,i=d.ZQM,n="R16I";break;case"uint32":r=d.bkx,i=d.ZQM,n="R32UI";break;case"int32":r=d.Yuy,i=d.ZQM,n="R32I";break;case"float32":r=d.RQf,i=d.VT0,n="R32F";break;default:console.warn("unsupported dtype for channel data",this.dtype)}this.dataTexture=new d.GYF(t,e,s,i,r,d.UTZ,d.ghU,d.ghU,d.hxR,d.hxR),this.dataTexture.internalFormat=n,this.dataTexture.needsUpdate=!0}setFromAtlas(t,e,s,i,r,n,a,o=0){this.dtype=i,this.imgData={data:t,width:e,height:s},this.rebuildDataTexture(this.imgData.data,e,s),this.loaded=!0,this.histogram=new _(t),this.frame=o,this.setRawDataRange(r,n),this.unpackFromAtlas(a.x,a.y,a.z)}unpackFromAtlas(t,e,s){const i=this.imgData.data;this.dims=[t,e,s];const r=b[this.dtype];this.volumeData=new r(t*e*s);const n=this.imgData.width/t,a=this.imgData.width;let o=0,h=0,l=0,c=0,u=0;for(let r=0;r<s;++r){o=r%n,h=Math.floor(r/n),l=o*t+h*e*a;for(let s=0;s<e;++s)c=s*a,u=r*(t*e)+s*t,this.volumeData.set(i.subarray(l+c,l+c+t),u)}}setFromVolumeData(t,e,s,i,r,n,a,o,h,l=0){this.dims=[e,s,i],this.volumeData=t,this.dtype=h,this.frame=l,this.packToAtlas(e,s,i,r,n),this.loaded=!0,this.setRawDataRange(a,o),this.histogram=new _(this.volumeData)}packToAtlas(t,e,s,i,r){(i%t!=0||r%e!=0||i/t*(r/e)<s)&&(console.log("ERROR - atlas and volume dims are inconsistent"),console.log(i,r,t,e,s));const n=b[this.dtype];this.imgData={width:i,height:r,data:new n(i*r)},this.imgData.data.fill(0);const a=this.imgData.data,o=t,h=e,l=s,c=this.imgData.width/o,u=this.imgData.width;let m=0,d=0,p=0,y=0,x=0;for(let t=0;t<l;++t){m=t%c,d=Math.floor(t/c),p=m*o+d*h*u;for(let e=0;e<h;++e)y=e*u,x=t*(o*h)+e*o,a.set(this.volumeData.subarray(x,x+o),p+y)}this.rebuildDataTexture(this.imgData.data,i,r)}setLut(t){this.lut=t}setColorPalette(t){this.colorPalette=t}setColorPaletteAlpha(t){this.colorPaletteAlpha=t}}var N=s(9519);const F=4096,R={angstrom:"Å",day:"d",foot:"ft",hour:"h",inch:"in",meter:"m",micron:"μm",mile:"mi",minute:"min",parsec:"pc",second:"s",yard:"yd"},L=["meter","second"],U={micro:"μ",deca:"da"};function V(t){if(void 0===t)return null;if(R[t])return R[t];const e=L.find((e=>t.endsWith(e)));if(e){const s=t.substring(0,t.length-e.length);return U[s]?U[s]+R[e]:(s.endsWith("a")?s[0].toUpperCase():s[0])+R[e]}return null}function B(t,e,s){let i=1,r=t,n=r*e/(i*s),a=i,o=r;for(;n>1;)a=i,o=r,r-=1,i=Math.ceil(t/r),n=r*e/(i*s);return new d.I9Y(a,o)}function q(t,e=4096){const s=t[2],i=t[1],r=t[0];return Math.floor(e/s)*Math.floor(e/i)>=r}const W=t=>Math.max(Math.ceil(t),1);function j(t,e){if(t.useExplicitLevel&&void 0!==t.multiscaleLevel)return Math.max(0,Math.min(e.length-1,t.multiscaleLevel));let s=function(t,e=4096){if(t.length<=1)return 0;for(let s=0;s<t.length;++s)if(q(t[s],e))return s}(e,t.maxAtlasEdge);if(void 0!==s&&(s=Math.max(s+(t.scaleLevelBias??0),t.multiscaleLevel??0),s=Math.max(0,Math.min(e.length-1,s)),q(e[s],t.maxAtlasEdge)))return s;void 0===s&&(s=e.length-1);const i=e[s];return console.error(`Volume is too large; no multiscale level found that fits in preferred memory footprint. Selected level ${s}  has dimensions `,i,`. Max atlas edge allowed is ${t.maxAtlasEdge}.`),console.log("All available levels: ",e),s}function Y(t,e){return j(t,function(t,e){const s=t.getSize(new d.Pq0);return e.map((t=>((t,[e,s,i])=>[W(e*t.z),W(s*t.y),W(i*t.x)])(s,t)))}(t.subregion,e))}function H(t,e){const s=t.min.clone().multiply(e).floor(),i=t.max.clone().multiply(e).ceil();return s.x===i.x&&s.x<e.x&&(i.x+=1),s.y===i.y&&s.y<e.y&&(i.y+=1),s.z===i.z&&s.z<e.z&&(i.z+=1),new d.NRn(s,i)}function Z(t,e){const s=e.getSize(new d.Pq0),i=t.min.clone().multiply(s).add(e.min),r=t.max.clone().multiply(s).add(e.min);return new d.NRn(i,r)}class X{constructor(t=(0,N.jI)(),e=new J,s){if(this.loaded=!1,this.imageInfo=new N.Nl(t),this.name=t.name,this.loadSpec={multiscaleLevel:0,scaleLevelBias:0,maxAtlasEdge:F,channels:Array.from({length:this.imageInfo.numChannels},((t,e)=>e)),...e},this.loadSpecRequired={...this.loadSpec,channels:this.loadSpec.channels.slice(),subregion:this.loadSpec.subregion.clone()},this.loader=s,this.imageMetadata={},this.normRegionSize=new d.Pq0(1,1,1),this.normRegionOffset=new d.Pq0(0,0,0),this.physicalSize=new d.Pq0(1,1,1),this.physicalScale=1,this.normPhysicalSize=new d.Pq0(1,1,1),this.physicalPixelSize=this.imageInfo.physicalPixelSize,this.tickMarkPhysicalLength=1,this.setVoxelSize(this.physicalPixelSize),this.numChannels=this.imageInfo.numChannels,this.channelNames=this.imageInfo.channelNames.slice(),this.channelColorsDefault=this.imageInfo.channelColors?this.imageInfo.channelColors.slice():this.channelNames.map(((t,e)=>v(e))),this.channelColorsDefault.length<this.imageInfo.numChannels)for(let t=this.channelColorsDefault.length-1;t<this.imageInfo.numChannels;++t)this.channelColorsDefault[t]=v(t);this.channels=[];for(let t=0;t<this.imageInfo.numChannels;++t){const e=new P(this.channelNames[t]);this.channels.push(e),e.dims=this.imageInfo.subregionSize.toArray()}this.physicalUnitSymbol=this.imageInfo.spatialUnit,this.volumeDataObservers=[]}setUnloaded(){this.loaded=!1,this.channels.forEach((t=>{t.loaded=!1}))}isLoaded(){return this.loaded}updateDimensions(){const{volumeSize:t,subregionSize:e,subregionOffset:s}=this.imageInfo;this.setVoxelSize(this.physicalPixelSize),this.normRegionSize=e.clone().divide(t),this.normRegionOffset=s.clone().divide(t)}mustLoadNewData(){return this.loadSpec.useExplicitLevel!==this.loadSpecRequired.useExplicitLevel||this.loadSpec.time!==this.loadSpecRequired.time||!this.loadSpec.subregion.containsBox(this.loadSpecRequired.subregion)||this.loadSpecRequired.channels.some((t=>!this.loadSpec.channels.includes(t)))}mayLoadNewScaleLevel(){return!this.loadSpec.subregion.equals(this.loadSpecRequired.subregion)||this.loadSpecRequired.maxAtlasEdge!==this.loadSpec.maxAtlasEdge||this.loadSpecRequired.multiscaleLevel!==this.loadSpec.multiscaleLevel||this.loadSpecRequired.scaleLevelBias!==this.loadSpec.scaleLevelBias}async updateRequiredData(t,e){this.loadSpecRequired={...this.loadSpecRequired,...t};let s=this.mustLoadNewData();if(!s&&this.mayLoadNewScaleLevel()){const t=await this.loadScaleLevelDims();if(t){const e=t.map((({shape:t})=>[t[2],t[3],t[4]])),i=j(this.loadSpecRequired,e);s=this.imageInfo.multiscaleLevel!==i}}s&&await this.loadNewData(e)}async loadScaleLevelDims(){try{return await(this.loader?.loadDims(this.loadSpecRequired))}catch(t){return void this.volumeDataObservers.forEach((e=>e.onVolumeLoadError(this,t)))}}async loadNewData(t){this.setUnloaded(),this.loadSpec={...this.loadSpecRequired,subregion:this.loadSpecRequired.subregion.clone()};try{await(this.loader?.loadVolumeData(this,void 0,t))}catch(t){throw this.volumeDataObservers.forEach((e=>e.onVolumeLoadError(this,t))),t}}setVoxelSize(t){t.x=t.x>0?t.x:1,t.y=t.y>0?t.y:1,t.z=t.z>0?t.z:1,this.physicalPixelSize=t,this.physicalSize=this.imageInfo.originalSize.clone().multiply(this.physicalPixelSize),this.physicalScale=Math.max(this.physicalSize.x,this.physicalSize.y,this.physicalSize.z),this.normPhysicalSize=this.physicalSize.clone().divideScalar(this.physicalScale),this.tickMarkPhysicalLength=10**Math.floor(Math.log10(this.physicalScale/2))}setUnitSymbol(t){this.physicalUnitSymbol=t}getContentCenter(){return this.normRegionSize.clone().divideScalar(2).add(this.normRegionOffset).subScalar(.5).multiply(this.normPhysicalSize)}cleanup(){}getChannel(t){return this.channels[t]}onChannelLoaded(t){this.loadSpec.channels.every((t=>this.channels[t].loaded))&&(this.loaded=!0),t.forEach((t=>this.channelLoadCallback?.(this,t))),this.volumeDataObservers.forEach((e=>e.onVolumeData(this,t)))}setChannelDataFromAtlas(t,e,s,i,r,n="uint8",a=0){this.channels[t].setFromAtlas(e,s,i,n,r[0],r[1],this.imageInfo.subregionSize,a),this.onChannelLoaded([t])}setChannelDataFromVolume(t,e,s,i="uint8",r=0){const{subregionSize:n,atlasTileDims:a}=this.imageInfo;this.channels[t].setFromVolumeData(e,n.x,n.y,n.z,a.x*n.x,a.y*n.y,s[0],s[1],i,r),this.onChannelLoaded([t])}appendEmptyChannel(t,e){const s=this.imageInfo.numChannels,i=t||"channel_"+s,r=e||v(s);this.numChannels+=1,this.channelNames.push(i),this.channelColorsDefault.push(r),this.channels.push(new P(i));for(let t=0;t<this.volumeDataObservers.length;++t)this.volumeDataObservers[t].onVolumeChannelAdded(this,s);return s}getIntensity(t,e,s,i){return this.channels[t].getIntensity(e,s,i)}getHistogram(t){return this.channels[t].getHistogram()}setLut(t,e){this.channels[t].setLut(e)}setColorPalette(t,e){this.channels[t].setColorPalette(e)}setColorPaletteAlpha(t,e){this.channels[t].setColorPaletteAlpha(e)}getRotation(){return this.imageInfo.transform.rotation.toArray()}getTranslation(){return this.voxelsToWorldSpace(this.imageInfo.transform.translation.toArray())}voxelsToWorldSpace(t){const e=1/Math.max(this.physicalSize.x,Math.max(this.physicalSize.y,this.physicalSize.z));return(new d.Pq0).fromArray(t).multiply(this.physicalPixelSize).multiplyScalar(e).toArray()}addVolumeDataObserver(t){this.volumeDataObservers.push(t)}removeVolumeDataObserver(t){if(t){const e=this.volumeDataObservers.indexOf(t);-1!==e&&this.volumeDataObservers.splice(e,1)}}removeAllVolumeDataObservers(){this.volumeDataObservers=[]}}class J{time=0;subregion=new d.NRn(new d.Pq0(0,0,0),new d.Pq0(1,1,1));useExplicitLevel=!1}class G{setPrefetchPriority(t){}syncMultichannelLoading(t){}updateFetchOptions(t){}async createVolume(t,e){const{imageInfo:s,loadSpec:i}=await this.createImageInfo(t),r=new X(s,i,this);return r.channelLoadCallback=e,r.imageMetadata=function(t){const e=new N.Nl(t),s=e.volumeSize.clone().multiply(e.physicalPixelSize),i={};return i.Dimensions={...e.subregionSize},i["Original dimensions"]={...e.originalSize},i["Physical size"]={x:s.x+e.spatialUnit,y:s.y+e.spatialUnit,z:s.z+e.spatialUnit},i["Physical size per pixel"]={x:e.physicalPixelSize.x+e.spatialUnit,y:e.physicalPixelSize.y+e.spatialUnit,z:e.physicalPixelSize.z+e.spatialUnit},i["Multiresolution levels"]=t.multiscaleLevelDims,i.Channels=t.combinedNumChannels,i["Time series frames"]=e.times||1,t.userData&&!function(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}(t.userData)&&(i["User data"]=t.userData),i}(s),r}async loadVolumeData(t,e,s){const i={...t.loadSpec,...e};return this.loadRawChannelData(t.imageInfo.imageInfo,i,((e,s)=>{e&&(t.imageInfo=new N.Nl(e),t.updateDimensions()),t.loadSpec={...s,...i}}),((e,i,r,n,a)=>{for(let o=0;o<e.length;o++){const h=e[o],l=i[o],c=r[o],u=n[o],m=t.loadSpec.time;a?t.setChannelDataFromAtlas(h,c,a[0],a[1],u,l,m):t.setChannelDataFromVolume(h,c,u,l,m),s?.(t,h)}}))}}var $=s(3487),Q=s(7710),K=s(471),tt=s(5390),et=s(4296);const{di:st}=p,it="chunk request cancelled",rt={maxPrefetchDistance:[5,5,5,5],maxPrefetchChunks:30};class nt extends G{syncChannels=!1;constructor(t,e,s=rt,i=[]){super(),this.sources=t,this.requestQueue=e,this.fetchOptions=s,this.priorityDirections=i}static async createLoader(t,e=0,s,i,r){i||(i=new f.A(r?.concurrencyLimit,r?.prefetchConcurrencyLimit));const n=Array.isArray(t)?t:[t],a=Array.isArray(e)?e:[e],o=n.map((async(t,e)=>{const r=new tt.L(t),o=y.zr(r),h=await x.h(o,{kind:"group"}).catch((0,K.ne)(`Failed to open OME-Zarr data at ${t}`,K.f8.NOT_FOUND)),l=n.length>1?`Zarr source ${e}`:"Zarr",c=(0,et.P9)(h.attrs);(0,et.iM)(c,l);let u=a[Math.min(e,a.length-1)];u>c.multiscales?.length&&(console.warn(`WARNING: OMEZarrLoader: scene ${u} is invalid. Using scene 0.`),u=0),(0,et.GB)(c,u,l);const{multiscales:m,omero:d}=c,p=m[u],g=p.datasets.map((({path:e})=>x.h(o.resolve(e),{kind:"array"}).then((e=>(0,tt.A)(e,t,s,i))).catch((0,K.ne)(`Failed to open scale level ${e} of OME-Zarr data at ${t}`,K.f8.NOT_FOUND))));return{scaleLevels:await Promise.all(g),multiscaleMetadata:p,omeroMetadata:d,axesTCZYX:(0,Q.U0)(p.axes),channelOffset:0}})),h=await Promise.all(o);let l=0;for(const t of h)t.channelOffset=l,l+=t.omeroMetadata?.channels.length??t.scaleLevels[0].shape[t.axesTCZYX[1]];(0,Q.mU)(h);const c=r?.priorityDirections?r.priorityDirections.slice():void 0;return new nt(h,i,r,c)}getUnitSymbols(){const t=this.sources[0],e=t.axesTCZYX[4],s=t.multiscaleMetadata.axes[e].unit,i=V(s)||s||"",r=t.axesTCZYX[0],n=r>-1?t.multiscaleMetadata.axes[r].unit:void 0;return[i,V(n)||n||""]}getLevelShapesZYX(){const t=this.sources[0],[e,s,i]=t.axesTCZYX.slice(-3);return t.scaleLevels.map((({shape:t})=>[-1===e?1:t[e],t[s],t[i]]))}getScale(t){return(0,Q.X_)(this.sources[0].multiscaleMetadata.datasets[t],this.sources[0].axesTCZYX)}orderByDimension(t,e=0){return(0,Q.WD)(t,this.sources[e].axesTCZYX)}orderByTCZYX(t,e,s=0){return(0,Q.yH)(t,this.sources[s].axesTCZYX,e)}matchChannelToSource(t){const e=this.sources.length-1,s=this.sources[e],i=s.scaleLevels[0].shape[s.axesTCZYX[1]],r=s.channelOffset+i;if(t>r)throw new K.nu(`Volume channel index ${t} out of range (${r} channels available)`,{type:K.f8.INVALID_METADATA});const n=this.sources.findIndex((e=>e.channelOffset>t)),a=-1===n?e:n-1;return{sourceIndex:a,channelIndexInSource:t-this.sources[a].channelOffset}}setPrefetchPriority(t){this.priorityDirections=t}syncMultichannelLoading(t){this.syncChannels=t}updateFetchOptions(t){this.fetchOptions={...this.fetchOptions,...t}}loadDims(t){const[e,s]=this.getUnitSymbols(),i=this.maxExtent??new d.NRn(new d.Pq0(0,0,0),new d.Pq0(1,1,1)),r=Z(t.subregion,i).getSize(new d.Pq0),n=[1,1,r.z,r.y,r.x],a=this.sources[0].scaleLevels.map(((t,i)=>{const r=this.getScale(i);return{spaceUnit:e,timeUnit:s,shape:this.orderByTCZYX(t.shape,1).map(((t,e)=>Math.max(Math.ceil(t*n[e]),1))),spacing:this.orderByTCZYX(r,1),dataType:t.dtype}}));return Promise.resolve(a)}createImageInfo(t){const e=this.sources[0],[s,,i,r,n]=e.axesTCZYX,a=s>-1,o=i>-1,h=Y(t,this.getLevelShapesZYX()),l=e.scaleLevels[h].shape,[c,u]=this.getUnitSymbols(),m=this.sources[this.sources.length-1],p=m.axesTCZYX[1],y=p>-1,x=m.channelOffset+(y?m.scaleLevels[h].shape[p]:1);let g=1;if(a){g=l[s];for(let t=0;t<this.sources.length;t++){const e=this.sources[t].scaleLevels[h].shape,s=this.sources[t].axesTCZYX[0];e[s]<g&&(console.warn("The number of time points is not consistent across sources: ",e[s],g),g=e[s])}}this.maxExtent||(this.maxExtent=t.subregion.clone());const f=H(t.subregion,new d.Pq0(l[n],l[r],o?l[i]:1)).getSize(new d.Pq0),b=B(f.z,f.x,f.y),_=new Map,M=this.sources.flatMap((t=>(0,Q.Di)(t).map((t=>{const e=_.get(t);return void 0!==e?(_.set(t,e+1),`${t} (${e})`):(_.set(t,1),t)})))),w=e.scaleLevels.map(((t,e)=>({spaceUnit:c,timeUnit:u,shape:this.orderByTCZYX(t.shape,1),spacing:this.getScale(e),dataType:t.dtype}))),z={name:e.omeroMetadata?.name||"Volume",atlasTileDims:[b.x,b.y],subregionSize:[f.x,f.y,f.z],subregionOffset:[0,0,0],combinedNumChannels:x,channelNames:M,multiscaleLevel:h,multiscaleLevelDims:w,transform:{translation:[0,0,0],rotation:[0,0,0],scale:[1,1,1]}},v={...t,subregion:new d.NRn(new d.Pq0(0,0,0),new d.Pq0(1,1,1))};return Promise.resolve({imageInfo:z,loadSpec:v})}prefetchChunk(t,e,s){t.getChunk(this.orderByDimension(e),{subscriber:s,isPrefetch:!0}).catch((0,K.ne)(`Unable to prefetch chunk with coords ${e.join(", ")}`,K.f8.LOAD_DATA_FAILED,it))}beginPrefetch(t,e){if(0===t.length)return;const s=t.map((({sourceIdx:t,coords:e})=>{const s=this.orderByTCZYX(e,0,t);return s[1]+=this.sources[t].channelOffset,s})),i=this.sources.map((t=>{const s=t.scaleLevels[e],i=s.shape.map(((t,e)=>Math.ceil(t/s.chunks[e])));return this.orderByTCZYX(i,1)})),r=new $.A(s,this.fetchOptions.maxPrefetchDistance,i,this.priorityDirections,this.fetchOptions.onlyPriorityDirections),n=this.requestQueue.addSubscriber();let a=0;for(const t of r){if(a>=this.fetchOptions.maxPrefetchChunks)break;const{sourceIndex:s,channelIndexInSource:i}=this.matchChannelToSource(t[1]),r=this.sources[s].scaleLevels[e];t[1]=i,this.prefetchChunk(r,t,n),a++}void 0!==this.prefetchSubscriber&&this.requestQueue.removeSubscriber(this.prefetchSubscriber,it),this.prefetchSubscriber=n}updateImageInfoForLoad(t,e){const s=this.maxExtent??new d.NRn(new d.Pq0(0,0,0),new d.Pq0(1,1,1)),i=Z(e.subregion,s),r=Y({...e,subregion:i},this.getLevelShapesZYX()),n=this.sources[0].scaleLevels[r].shape,[a,o,h]=this.sources[0].axesTCZYX.slice(2),l=H(i,new d.Pq0(n[h],n[o],-1===a?1:n[a])),c=l.getSize(new d.Pq0),u=B(c.z,c.x,c.y);return{...t,atlasTileDims:[u.x,u.y],subregionSize:[c.x,c.y,c.z],subregionOffset:[l.min.x,l.min.y,l.min.z],multiscaleLevel:r}}async loadRawChannelData(t,e,s,i){const r=this.syncChannels,n=this.updateImageInfoForLoad(t,e);s(n);const{combinedNumChannels:a,multiscaleLevel:o}=n,h=e.channels??Array.from({length:a},((t,e)=>e)),l=this.requestQueue.addSubscriber(),c=[],u=[],m=[],p=[],y=[],x=h.map((async t=>{const s=new d.Pq0(...n.subregionOffset),a=s.clone().add(new d.Pq0(...n.subregionSize)),{sourceIndex:h,channelIndexInSource:x}=this.matchChannelToSource(t),f=[e.time,x,st(s.z,a.z),st(s.y,a.y),st(s.x,a.x)],b=this.sources[h].scaleLevels[o],_=this.orderByDimension(f,h);console.log(b);const M=await g.Jt(b,_,{opts:{subscriber:l,reportChunk:(t,e)=>((t,e,s)=>{s===l&&c.push({sourceIdx:t,coords:e})})(h,t,e)}}).catch((0,K.ne)("Could not load OME-Zarr volume data",K.f8.LOAD_DATA_FAILED,it));if(void 0===M?.data)return;const w=function(t,e){let s=t[0],i=t[0];for(let e=0;e<t.length;e++){const r=t[e];r<s&&(s=r),r>i&&(i=r)}if("float64"===e){const s=new Float32Array(t.length);for(let e=0;e<t.length;e++)s[e]=t[e];e="float32",t=s}return{data:t,dtype:e,min:s,max:i}}(M.data,b.dtype);r?(p.push(w.dtype),m.push(w.data),u.push(t),y.push([w.min,w.max])):i([t],[w.dtype],[w.data],[[w.min,w.max]])}));void 0!==this.loadSubscriber&&this.requestQueue.removeSubscriber(this.loadSubscriber,it),this.loadSubscriber=l,this.beginPrefetch(c,o),await Promise.all(x),r&&i(u,p,m,y),this.requestQueue.removeSubscriber(l,it)}}let at=function(t){return t[t.MILLISECOND=0]="MILLISECOND",t[t.SECOND=1]="SECOND",t[t.MINUTE=2]="MINUTE",t[t.HOUR=3]="HOUR",t[t.DAY=4]="DAY",t}({});at.MILLISECOND,new Set(["ms","millisecond","milliseconds"]),at.SECOND,new Set(["s","sec","second","seconds"]),at.MINUTE,new Set(["m","min","minute","minutes"]),at.HOUR,new Set(["h","hr","hour","hours"]),at.DAY,new Set(["d","day","days"]);function ot(t){let e=t[0],s=t[0];for(let i=1;i<t.length;i++)e=Math.min(e,t[i]),s=Math.max(s,t[i]);return[e,s]}at.MILLISECOND,at.SECOND,at.MINUTE,at.HOUR,at.DAY;const ht=t=>[t.pixel_size_x*t.width/t.tile_width,t.pixel_size_y*t.height/t.tile_height,t.pixel_size_z],lt=t=>{const[e,s,i]=ht(t),r=t.transform?.translation??[0,0,0];return r[0]=r[0]*t.tile_width/t.width,r[1]=r[1]*t.tile_height/t.height,{name:t.name,atlasTileDims:[t.cols,t.rows],subregionSize:[t.tile_width,t.tile_height,t.tiles],subregionOffset:[0,0,0],combinedNumChannels:t.channels,channelNames:t.channel_names,channelColors:t.channel_colors,multiscaleLevel:0,multiscaleLevelDims:[{shape:[t.times||1,t.channels,t.tiles,t.tile_height,t.tile_width],spacing:[t.time_scale||1,1,i,s,e],spaceUnit:t.pixel_size_unit||"μm",timeUnit:t.time_unit||"s",dataType:"uint8"}],transform:{translation:r,rotation:t.transform?.rotation?t.transform.rotation:[0,0,0],scale:[1,1,1]},userData:{...t.userData,originalVolumeSize:[t.width,t.height,t.tiles],originalPhysicalPixelSize:[t.pixel_size_x,t.pixel_size_y,t.pixel_size_z]}}};class ct extends G{syncChannels=!1;constructor(t,e){super(),Array.isArray(t)?this.urls=t:this.urls=[t],this.jsonInfo=new Array(this.urls.length),this.cache=e}async getJsonImageInfo(t){const e=this.jsonInfo[t];if(e)return e;const s=await fetch(this.urls[t]),i=await s.json();return i.pixel_size_unit=i.pixel_size_unit||"μm",i.times=i.times||this.urls.length,this.jsonInfo[t]=i,i}syncMultichannelLoading(t){this.syncChannels=t}async loadDims(t){const e=await this.getJsonImageInfo(t.time),[s,i,r]=ht(e);return[{shape:[e.times||1,e.channels,e.tiles,e.tile_height,e.tile_width],spacing:[1,1,r,i,s],spaceUnit:e.pixel_size_unit??"μm",dataType:"uint8",timeUnit:e.time_unit??"s"}]}async createImageInfo(t){const e=await this.getJsonImageInfo(t.time);return{imageInfo:lt(e),loadSpec:t}}async loadRawChannelData(t,e,s,i){const r=await this.getJsonImageInfo(e.time);let n=r?.images;if(!n)return;const a=e.channels;a&&(n=n.filter((({channels:t})=>t.some((t=>a.includes(t))))));const o=this.urls[e.time].replace(/[^/]*$/,"");n=n.map((t=>({...t,name:o+t.name}))),s(void 0,{...e,subregion:new d.NRn(new d.Pq0(0,0,0),new d.Pq0(1,1,1)),multiscaleLevel:0,channels:n.flatMap((({channels:t})=>t))});const[h,l]=(0,N.QX)(t);await ct.loadVolumeAtlasData(n,((t,e,s,r)=>i(t,e,s,r,[h,l])),this.cache,this.syncChannels)}static async loadVolumeAtlasData(t,e,s,i=!1){const r=[],n=[],a=[],o=[],h=t.map((async t=>{let h=!0;for(let l=0;l<Math.min(t.channels.length,4);++l){const c=t.channels[l],u=s?.get(`${t.name}/${c}`);if(!u||(0,m.y)(u)){h=!1;break}{const t=new Uint8Array(u);i?(r.push(c),n.push("uint8"),a.push(t),o.push(ot(t))):e([c],["uint8"],[t],[ot(t)])}}if(h)return;const l=await fetch(t.name,{mode:"cors"}),c=await l.blob(),u=await createImageBitmap(c),d=new OffscreenCanvas(u.width,u.height).getContext("2d");if(!d)return void console.log("Error creating canvas 2d context for "+t.name);d.globalCompositeOperation="copy",d.globalAlpha=1,d.drawImage(u,0,0);const p=d.getImageData(0,0,u.width,u.height),y=[],x=u.width*u.height;for(let e=0;e<Math.min(t.channels.length,4);++e)y.push(new Uint8Array(x));const g=[];for(let e=0;e<Math.min(t.channels.length,4);++e){let t=1/0,s=-1/0;for(let i=0;i<x;i++)y[e][i]=p.data[4*i+e],t=Math.min(t,y[e][i]),s=Math.max(s,y[e][i]);g[e]=[t,s]}for(let h=0;h<Math.min(t.channels.length,4);++h){const l=t.channels[h];s?.insert(`${t.name}/${l}`,y[h]),i?(r.push(l),n.push("uint8"),a.push(y[h]),o.push(g[h])):e([l],["uint8"],[y[h]],[g[h]],[u.width,u.height])}}));await Promise.all(h),i&&e(r,n,a,o)}}function ut(t){switch(t){case"uint8":case"int8":return 1;case"uint16":case"int16":return 2;case"uint32":case"int32":case"float32":return 4;case"float64":return 8;default:throw new Error(`Unsupported dtype: ${t}`)}}const mt=(t,e)=>{const s=B(t.sizeZ,t.sizeX,t.sizeY);return{name:t.name,atlasTileDims:[s.x,s.y],subregionSize:[t.sizeX,t.sizeY,t.sizeZ],subregionOffset:[0,0,0],combinedNumChannels:t.sizeC,channelNames:t.channelNames,channelColors:void 0,multiscaleLevel:0,multiscaleLevelDims:[{shape:[1,t.sizeC,t.sizeZ,t.sizeY,t.sizeX],spacing:[1,1,t.physicalPixelSize[2],t.physicalPixelSize[1],t.physicalPixelSize[0]],spaceUnit:t.spatialUnit||"μm",timeUnit:"s",dataType:e}],transform:{translation:[0,0,0],rotation:[0,0,0],scale:[1,1,1]},userData:t.userData}};class dt extends G{constructor(t,e){if(super(),this.jsonInfo=e,this.data=t,this.data.shape[0]!==this.jsonInfo.sizeC||this.data.shape[1]!==this.jsonInfo.sizeZ||this.data.shape[2]!==this.jsonInfo.sizeY||this.data.shape[3]!==this.jsonInfo.sizeX)throw new Error("RawArrayLoader: data shape does not match metadata")}async loadDims(t){const e=this.jsonInfo;return[{shape:[1,e.sizeC,e.sizeZ,e.sizeY,e.sizeX],spacing:[1,1,e.physicalPixelSize[2],e.physicalPixelSize[1],e.physicalPixelSize[0]],spaceUnit:e.spatialUnit||"μm",dataType:this.data.dtype,timeUnit:"s"}]}async createImageInfo(t){return{imageInfo:mt(this.jsonInfo,this.data.dtype),loadSpec:t}}loadRawChannelData(t,e,s,i){const r=e.channels;s(void 0,{...e,subregion:new d.NRn(new d.Pq0(0,0,0),new d.Pq0(1,1,1)),multiscaleLevel:0});for(let e=0;e<t.combinedNumChannels;++e){if(r&&r.length>0&&!r.includes(e))continue;const t=this.data.shape[3]*this.data.shape[2]*this.data.shape[1],s=new(0,b[this.data.dtype])(this.data.buffer.buffer,e*t*ut(this.data.dtype),t),n=ot(s);i([e],[this.data.dtype],[s],[n])}return Promise.resolve()}}var pt=s(4357);class yt{sizex=0;sizey=0;sizez=1;sizec=1;sizet=1;unit="";pixeltype="";dimensionorder="";pixelsizex=1;pixelsizey=1;pixelsizez=1;channelnames=[]}function xt(t){const e={uint8:"uint8",uint16:"uint16",uint32:"uint32",int8:"int8",int16:"int16",int32:"int32",float:"float32"}[t];return void 0===e?(console.warn(`Unsupported OME pixel type ${t}; defaulting to uint8`),"uint8"):e}function gt(t,e){const s=t.getAttribute(e);if(null===s)throw new K.nu(`Missing attribute ${e} in OME-TIFF metadata`,{type:K.f8.INVALID_METADATA});return s}class ft extends G{constructor(t){super(),this.url=t}async loadOmeDims(){if(!this.dims){const e=await(0,pt.uz)(this.url[0],{allowFullFile:!0}).catch((0,K.ne)(`Could not open TIFF file at ${this.url[0]}`,K.f8.NOT_FOUND)),s=await e.getImage().catch((0,K.ne)("Failed to open TIFF image",K.f8.NOT_FOUND)),i=function(t){if(void 0===t)return;const e=function(t){return t.trim().replace(/[\u0000]$/g,"").trim()}(t),s=new DOMParser;try{return s.parseFromString(e,"text/xml").getElementsByTagName("OME")[0]}catch(t){return}}(s.getFileDirectory().ImageDescription);if(void 0!==i){const t=i.getElementsByTagName("Image")[0];this.dims=function(t){const e=new yt,s=t.getElementsByTagName("Pixels")[0];e.sizex=Number(gt(s,"SizeX")),e.sizey=Number(gt(s,"SizeY")),e.sizez=Number(s.getAttribute("SizeZ")),e.sizec=Number(s.getAttribute("SizeC")),e.sizet=Number(s.getAttribute("SizeT")),e.unit=s.getAttribute("PhysicalSizeXUnit")||"",e.pixeltype=s.getAttribute("Type")||"",e.dimensionorder=s.getAttribute("DimensionOrder")||"XYZCT",e.pixelsizex=Number(s.getAttribute("PhysicalSizeX")),e.pixelsizey=Number(s.getAttribute("PhysicalSizeY")),e.pixelsizez=Number(s.getAttribute("PhysicalSizeZ"));const i=s.getElementsByTagName("Channel");for(let t=0;t<i.length;++t){const s=i[t].getAttribute("Name"),r=i[t].getAttribute("ID");e.channelnames.push(s||r||"Channel"+t)}return e}(t)}else console.warn("Could not read OME-TIFF metadata from file. Doing our best with base TIFF metadata."),this.dims=new yt,this.dims.sizex=s.getWidth(),this.dims.sizey=s.getHeight(),this.dims.sizec=this.url.length>1?this.url.length:1,this.dims.pixeltype=1===(t=s.getBytesPerPixel())?"uint8":2===t?"uint16":"uint32",this.dims.channelnames=Array.from({length:this.dims.sizec},((t,e)=>"Channel"+e))}var t;return this.dims}async loadDims(t){const e=await this.loadOmeDims(),s=B(e.sizez,e.sizex,e.sizey),i=F,r=Math.floor(i/s.x),n=Math.floor(i/s.y);return[{shape:[e.sizet,e.sizec,e.sizez,n,r],spacing:[1,1,e.pixelsizez,e.pixelsizey*e.sizey/n,e.pixelsizex*e.sizex/r],spaceUnit:e.unit?e.unit:"micron",dataType:xt(e.pixeltype),timeUnit:"s"}]}async createImageInfo(t){const e=await this.loadOmeDims(),s=B(e.sizez,e.sizex,e.sizey),i=F,r=Math.floor(i/s.x),n=Math.floor(i/s.y);return{imageInfo:{name:"TEST",atlasTileDims:[s.x,s.y],subregionSize:[r,n,e.sizez],subregionOffset:[0,0,0],combinedNumChannels:e.sizec,channelNames:e.channelnames,multiscaleLevel:0,multiscaleLevelDims:[{shape:[e.sizet,e.sizec,e.sizez,n,r],spacing:[1,1,e.pixelsizez,e.pixelsizey*e.sizey/n,e.pixelsizex*e.sizex/r],spaceUnit:e.unit||"",timeUnit:"",dataType:xt(e.pixeltype)}],transform:{translation:[0,0,0],rotation:[0,0,0],scale:[1,1,1]}},loadSpec:new J}}async loadRawChannelData(t,e,i,r){const n=await this.loadOmeDims(),a=new N.Nl(t).volumeSize,o=[];for(let e=0;e<t.combinedNumChannels;++e){const i=new Promise(((i,o)=>{const h={channel:e,tilesizex:a.x,tilesizey:a.y,sizec:t.combinedNumChannels,sizez:a.z,dimensionOrder:n.dimensionorder,bytesPerSample:(l=n.pixeltype,"uint8"===l?1:"uint16"===l?2:4),url:this.url.length>1?this.url[e]:this.url[0]};var l;const u=new Worker(new URL(s.p+s.u(647),s.b),{type:void 0});u.onmessage=t=>{if(t.data.isError)return void o(c(t.data.error));const{data:e,dtype:s,channel:n,range:a}=t.data;r([n],[s],[e],[a]),u.terminate(),i()},u.postMessage(h)}));o.push(i)}await Promise.all(o)}}let bt=function(t){return t.ZARR="zarr",t.JSON="json",t.TIFF="tiff",t.DATA="data",t}({});function _t(t){return t.endsWith(".json")?bt.JSON:t.endsWith(".tif")||t.endsWith(".tiff")?bt.TIFF:bt.ZARR}var Mt=s(5448),wt=s(9177),zt=s(6238);let vt,St,At,Ct=0;const Tt=new Map,Et=t=>{const e=Tt.get(t);if(void 0===e)throw new K.nu(`Loader with ID ${t} does not exist`);return e};let kt=!1;const It={[wt.K2.INIT]:({maxCacheSize:t,maxActiveRequests:e,maxLowPriorityRequests:s})=>(kt||(vt=new m.A(t),St=new Mt.A(e,s),At=new f.A(St),kt=!0),Promise.resolve()),[wt.K2.CREATE_LOADER]:async({path:t,options:e})=>{const s=await async function(t,e){const s=Array.isArray(t)?t[0]:t,i=e?.fileType||_t(s),r=Array.isArray(t)?t:[t];switch(i){case bt.ZARR:return await nt.createLoader(t,e?.scene,e?.cache,e?.queue,e?.fetchOptions);case bt.JSON:return new ct(t,e?.cache);case bt.TIFF:return new ft(r);case bt.DATA:if(!e?.rawArrayOptions)throw new Error("Must provide RawArrayOptions for RawArrayLoader");return new dt(e?.rawArrayOptions.data,e?.rawArrayOptions.metadata)}}(t,{...e,cache:vt,queue:At});if(void 0===s)return;const i=Array.isArray(t)?t[0]:t,r=(e?.fileType||_t(i))===bt.JSON,n=Ct;return Ct+=1,Tt.set(n,{loader:s,copyOnLoad:r}),n},[wt.K2.CLOSE_LOADER]:(t,e)=>(Tt.delete(e),Promise.resolve()),[wt.K2.CREATE_VOLUME]:async(t,e)=>{const{loader:s}=Et(e);return await s.createImageInfo((0,zt.N)(t))},[wt.K2.LOAD_DIMS]:async(t,e)=>{const{loader:s}=Et(e);return await s.loadDims((0,zt.N)(t))},[wt.K2.LOAD_VOLUME_DATA]:({imageInfo:t,loadSpec:e,loadId:s},i)=>{const{loader:r,copyOnLoad:n}=Et(i);return r.loadRawChannelData(t,(0,zt.N)(e),((t,e)=>{const r={responseResult:wt.VC.EVENT,eventType:wt.dE.METADATA_UPDATE,loaderId:i,loadId:s,imageInfo:t,loadSpec:e};self.postMessage(r)}),((t,e,r,a,o)=>{const h={responseResult:wt.VC.EVENT,eventType:wt.dE.CHANNEL_LOAD,loaderId:i,loadId:s,channelIndex:t,dtype:e,data:r,ranges:a,atlasDims:o};self.postMessage(h,n?[]:r.map((t=>t.buffer)))}))},[wt.K2.SET_PREFETCH_PRIORITY_DIRECTIONS]:(t,e)=>{const{loader:s}=Et(e);return s?.setPrefetchPriority(t),Promise.resolve()},[wt.K2.SYNCHRONIZE_MULTICHANNEL_LOADING]:(t,e)=>{const{loader:s}=Et(e);return s?.syncMultichannelLoading(t),Promise.resolve()},[wt.K2.UPDATE_FETCH_OPTIONS]:(t,e)=>{const{loader:s}=Et(e);return s?.updateFetchOptions(t),Promise.resolve()}};self.onmessage=async({data:t})=>{let e;try{const s=await It[t.type](t.payload,t.loaderId);e={...t,responseResult:wt.VC.SUCCESS,payload:s}}catch(s){e={...t,responseResult:wt.VC.ERROR,payload:l(s)}}self.postMessage(e)}},4922:(t,e,s)=>{s.d(e,{GWd:()=>p,GYF:()=>Ht,I9Y:()=>k,Kzv:()=>y,NRn:()=>$,OUM:()=>o,Pq0:()=>X,RQf:()=>d,UTZ:()=>i,VT0:()=>x,Yuy:()=>u,ZQM:()=>g,bkx:()=>m,cHt:()=>c,fBL:()=>l,ghU:()=>r,hxR:()=>n,k6q:()=>a,tJf:()=>h});const i=300,r=1001,n=1003,a=1006,o=1009,h=1010,l=1011,c=1012,u=1013,m=1014,d=1015,p=1023,y=1024,x=1028,g=1029,f=2300,b=2301,_=2302,M="srgb",w="srgb-linear",z="linear",v="srgb";class S{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const s=this._listeners;void 0===s[t]&&(s[t]=[]),-1===s[t].indexOf(e)&&s[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const s=this._listeners;return void 0!==s[t]&&-1!==s[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const s=this._listeners[t];if(void 0!==s){const t=s.indexOf(e);-1!==t&&s.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const s=e.slice(0);for(let e=0,i=s.length;e<i;e++)s[e].call(this,t);t.target=null}}}const A=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function C(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,s=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(A[255&t]+A[t>>8&255]+A[t>>16&255]+A[t>>24&255]+"-"+A[255&e]+A[e>>8&255]+"-"+A[e>>16&15|64]+A[e>>24&255]+"-"+A[63&s|128]+A[s>>8&255]+"-"+A[s>>16&255]+A[s>>24&255]+A[255&i]+A[i>>8&255]+A[i>>16&255]+A[i>>24&255]).toLowerCase()}function T(t,e,s){return Math.max(e,Math.min(s,t))}function E(t,e,s){return(1-s)*t+s*e}Math.PI,Math.PI;class k{constructor(t=0,e=0){k.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,s=this.y,i=t.elements;return this.x=i[0]*e+i[3]*s+i[6],this.y=i[1]*e+i[4]*s+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=T(this.x,t.x,e.x),this.y=T(this.y,t.y,e.y),this}clampScalar(t,e){return this.x=T(this.x,t,e),this.y=T(this.y,t,e),this}clampLength(t,e){const s=this.length();return this.divideScalar(s||1).multiplyScalar(T(s,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const s=this.dot(t)/e;return Math.acos(T(s,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,s=this.y-t.y;return e*e+s*s}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,s){return this.x=t.x+(e.x-t.x)*s,this.y=t.y+(e.y-t.y)*s,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const s=Math.cos(e),i=Math.sin(e),r=this.x-t.x,n=this.y-t.y;return this.x=r*s-n*i+t.x,this.y=r*i+n*s+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class I{constructor(t,e,s,i,r,n,a,o,h){I.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==t&&this.set(t,e,s,i,r,n,a,o,h)}set(t,e,s,i,r,n,a,o,h){const l=this.elements;return l[0]=t,l[1]=i,l[2]=a,l[3]=e,l[4]=r,l[5]=o,l[6]=s,l[7]=n,l[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,s=t.elements;return e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e[4]=s[4],e[5]=s[5],e[6]=s[6],e[7]=s[7],e[8]=s[8],this}extractBasis(t,e,s){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),s.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const s=t.elements,i=e.elements,r=this.elements,n=s[0],a=s[3],o=s[6],h=s[1],l=s[4],c=s[7],u=s[2],m=s[5],d=s[8],p=i[0],y=i[3],x=i[6],g=i[1],f=i[4],b=i[7],_=i[2],M=i[5],w=i[8];return r[0]=n*p+a*g+o*_,r[3]=n*y+a*f+o*M,r[6]=n*x+a*b+o*w,r[1]=h*p+l*g+c*_,r[4]=h*y+l*f+c*M,r[7]=h*x+l*b+c*w,r[2]=u*p+m*g+d*_,r[5]=u*y+m*f+d*M,r[8]=u*x+m*b+d*w,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],s=t[1],i=t[2],r=t[3],n=t[4],a=t[5],o=t[6],h=t[7],l=t[8];return e*n*l-e*a*h-s*r*l+s*a*o+i*r*h-i*n*o}invert(){const t=this.elements,e=t[0],s=t[1],i=t[2],r=t[3],n=t[4],a=t[5],o=t[6],h=t[7],l=t[8],c=l*n-a*h,u=a*o-l*r,m=h*r-n*o,d=e*c+s*u+i*m;if(0===d)return this.set(0,0,0,0,0,0,0,0,0);const p=1/d;return t[0]=c*p,t[1]=(i*h-l*s)*p,t[2]=(a*s-i*n)*p,t[3]=u*p,t[4]=(l*e-i*o)*p,t[5]=(i*r-a*e)*p,t[6]=m*p,t[7]=(s*o-h*e)*p,t[8]=(n*e-s*r)*p,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,s,i,r,n,a){const o=Math.cos(r),h=Math.sin(r);return this.set(s*o,s*h,-s*(o*n+h*a)+n+t,-i*h,i*o,-i*(-h*n+o*a)+a+e,0,0,1),this}scale(t,e){return this.premultiply(D.makeScale(t,e)),this}rotate(t){return this.premultiply(D.makeRotation(-t)),this}translate(t,e){return this.premultiply(D.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),s=Math.sin(t);return this.set(e,-s,0,s,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,s=t.elements;for(let t=0;t<9;t++)if(e[t]!==s[t])return!1;return!0}fromArray(t,e=0){for(let s=0;s<9;s++)this.elements[s]=t[s+e];return this}toArray(t=[],e=0){const s=this.elements;return t[e]=s[0],t[e+1]=s[1],t[e+2]=s[2],t[e+3]=s[3],t[e+4]=s[4],t[e+5]=s[5],t[e+6]=s[6],t[e+7]=s[7],t[e+8]=s[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}const D=new I;function O(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;const P=(new I).set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),N=(new I).set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function F(){const t={enabled:!0,workingColorSpace:w,spaces:{},convert:function(t,e,s){return!1!==this.enabled&&e!==s&&e&&s?(this.spaces[e].transfer===v&&(t.r=L(t.r),t.g=L(t.g),t.b=L(t.b)),this.spaces[e].primaries!==this.spaces[s].primaries&&(t.applyMatrix3(this.spaces[e].toXYZ),t.applyMatrix3(this.spaces[s].fromXYZ)),this.spaces[s].transfer===v&&(t.r=U(t.r),t.g=U(t.g),t.b=U(t.b)),t):t},fromWorkingColorSpace:function(t,e){return this.convert(t,this.workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this.workingColorSpace)},getPrimaries:function(t){return this.spaces[t].primaries},getTransfer:function(t){return""===t?z:this.spaces[t].transfer},getLuminanceCoefficients:function(t,e=this.workingColorSpace){return t.fromArray(this.spaces[e].luminanceCoefficients)},define:function(t){Object.assign(this.spaces,t)},_getMatrix:function(t,e,s){return t.copy(this.spaces[e].toXYZ).multiply(this.spaces[s].fromXYZ)},_getDrawingBufferColorSpace:function(t){return this.spaces[t].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(t=this.workingColorSpace){return this.spaces[t].workingColorSpaceConfig.unpackColorSpace}},e=[.64,.33,.3,.6,.15,.06],s=[.2126,.7152,.0722],i=[.3127,.329];return t.define({[w]:{primaries:e,whitePoint:i,transfer:z,toXYZ:P,fromXYZ:N,luminanceCoefficients:s,workingColorSpaceConfig:{unpackColorSpace:M},outputColorSpaceConfig:{drawingBufferColorSpace:M}},[M]:{primaries:e,whitePoint:i,transfer:v,toXYZ:P,fromXYZ:N,luminanceCoefficients:s,outputColorSpaceConfig:{drawingBufferColorSpace:M}}}),t}const R=F();function L(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function U(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}let V;class B{static getDataURL(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===V&&(V=O("canvas")),V.width=t.width,V.height=t.height;const s=V.getContext("2d");t instanceof ImageData?s.putImageData(t,0,0):s.drawImage(t,0,0,t.width,t.height),e=V}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const e=O("canvas");e.width=t.width,e.height=t.height;const s=e.getContext("2d");s.drawImage(t,0,0,t.width,t.height);const i=s.getImageData(0,0,t.width,t.height),r=i.data;for(let t=0;t<r.length;t++)r[t]=255*L(r[t]/255);return s.putImageData(i,0,0),e}if(t.data){const e=t.data.slice(0);for(let t=0;t<e.length;t++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[t]=Math.floor(255*L(e[t]/255)):e[t]=L(e[t]);return{data:e,width:t.width,height:t.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let q=0;class W{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:q++}),this.uuid=C(),this.data=t,this.dataReady=!0,this.version=0}set needsUpdate(t){!0===t&&this.version++}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.images[this.uuid])return t.images[this.uuid];const s={uuid:this.uuid,url:""},i=this.data;if(null!==i){let t;if(Array.isArray(i)){t=[];for(let e=0,s=i.length;e<s;e++)i[e].isDataTexture?t.push(j(i[e].image)):t.push(j(i[e]))}else t=j(i);s.url=t}return e||(t.images[this.uuid]=s),s}}function j(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?B.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Y=0;class H extends S{constructor(t=H.DEFAULT_IMAGE,e=H.DEFAULT_MAPPING,s=r,i=r,n=a,h=1008,l=p,c=o,u=H.DEFAULT_ANISOTROPY,m=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Y++}),this.uuid=C(),this.name="",this.source=new W(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=s,this.wrapT=i,this.magFilter=n,this.minFilter=h,this.anisotropy=u,this.format=l,this.internalFormat=null,this.type=c,this.offset=new k(0,0),this.repeat=new k(1,1),this.center=new k(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new I,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=m,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const s={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(s.userData=this.userData),e||(t.textures[this.uuid]=s),s}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==i)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case 1e3:t.x=t.x-Math.floor(t.x);break;case r:t.x=t.x<0?0:1;break;case 1002:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case 1e3:t.y=t.y-Math.floor(t.y);break;case r:t.y=t.y<0?0:1;break;case 1002:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){!0===t&&this.pmremVersion++}}H.DEFAULT_IMAGE=null,H.DEFAULT_MAPPING=i,H.DEFAULT_ANISOTROPY=1,Symbol.iterator;class Z{constructor(t=0,e=0,s=0,i=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=s,this._w=i}static slerpFlat(t,e,s,i,r,n,a){let o=s[i+0],h=s[i+1],l=s[i+2],c=s[i+3];const u=r[n+0],m=r[n+1],d=r[n+2],p=r[n+3];if(0===a)return t[e+0]=o,t[e+1]=h,t[e+2]=l,void(t[e+3]=c);if(1===a)return t[e+0]=u,t[e+1]=m,t[e+2]=d,void(t[e+3]=p);if(c!==p||o!==u||h!==m||l!==d){let t=1-a;const e=o*u+h*m+l*d+c*p,s=e>=0?1:-1,i=1-e*e;if(i>Number.EPSILON){const r=Math.sqrt(i),n=Math.atan2(r,e*s);t=Math.sin(t*n)/r,a=Math.sin(a*n)/r}const r=a*s;if(o=o*t+u*r,h=h*t+m*r,l=l*t+d*r,c=c*t+p*r,t===1-a){const t=1/Math.sqrt(o*o+h*h+l*l+c*c);o*=t,h*=t,l*=t,c*=t}}t[e]=o,t[e+1]=h,t[e+2]=l,t[e+3]=c}static multiplyQuaternionsFlat(t,e,s,i,r,n){const a=s[i],o=s[i+1],h=s[i+2],l=s[i+3],c=r[n],u=r[n+1],m=r[n+2],d=r[n+3];return t[e]=a*d+l*c+o*m-h*u,t[e+1]=o*d+l*u+h*c-a*m,t[e+2]=h*d+l*m+a*u-o*c,t[e+3]=l*d-a*c-o*u-h*m,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,s,i){return this._x=t,this._y=e,this._z=s,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){const s=t._x,i=t._y,r=t._z,n=t._order,a=Math.cos,o=Math.sin,h=a(s/2),l=a(i/2),c=a(r/2),u=o(s/2),m=o(i/2),d=o(r/2);switch(n){case"XYZ":this._x=u*l*c+h*m*d,this._y=h*m*c-u*l*d,this._z=h*l*d+u*m*c,this._w=h*l*c-u*m*d;break;case"YXZ":this._x=u*l*c+h*m*d,this._y=h*m*c-u*l*d,this._z=h*l*d-u*m*c,this._w=h*l*c+u*m*d;break;case"ZXY":this._x=u*l*c-h*m*d,this._y=h*m*c+u*l*d,this._z=h*l*d+u*m*c,this._w=h*l*c-u*m*d;break;case"ZYX":this._x=u*l*c-h*m*d,this._y=h*m*c+u*l*d,this._z=h*l*d-u*m*c,this._w=h*l*c+u*m*d;break;case"YZX":this._x=u*l*c+h*m*d,this._y=h*m*c+u*l*d,this._z=h*l*d-u*m*c,this._w=h*l*c-u*m*d;break;case"XZY":this._x=u*l*c-h*m*d,this._y=h*m*c-u*l*d,this._z=h*l*d+u*m*c,this._w=h*l*c+u*m*d;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+n)}return!0===e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const s=e/2,i=Math.sin(s);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(s),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,s=e[0],i=e[4],r=e[8],n=e[1],a=e[5],o=e[9],h=e[2],l=e[6],c=e[10],u=s+a+c;if(u>0){const t=.5/Math.sqrt(u+1);this._w=.25/t,this._x=(l-o)*t,this._y=(r-h)*t,this._z=(n-i)*t}else if(s>a&&s>c){const t=2*Math.sqrt(1+s-a-c);this._w=(l-o)/t,this._x=.25*t,this._y=(i+n)/t,this._z=(r+h)/t}else if(a>c){const t=2*Math.sqrt(1+a-s-c);this._w=(r-h)/t,this._x=(i+n)/t,this._y=.25*t,this._z=(o+l)/t}else{const t=2*Math.sqrt(1+c-s-a);this._w=(n-i)/t,this._x=(r+h)/t,this._y=(o+l)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let s=t.dot(e)+1;return s<Number.EPSILON?(s=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=s):(this._x=0,this._y=-t.z,this._z=t.y,this._w=s)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=s),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(T(this.dot(t),-1,1)))}rotateTowards(t,e){const s=this.angleTo(t);if(0===s)return this;const i=Math.min(1,e/s);return this.slerp(t,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const s=t._x,i=t._y,r=t._z,n=t._w,a=e._x,o=e._y,h=e._z,l=e._w;return this._x=s*l+n*a+i*h-r*o,this._y=i*l+n*o+r*a-s*h,this._z=r*l+n*h+s*o-i*a,this._w=n*l-s*a-i*o-r*h,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const s=this._x,i=this._y,r=this._z,n=this._w;let a=n*t._w+s*t._x+i*t._y+r*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=n,this._x=s,this._y=i,this._z=r,this;const o=1-a*a;if(o<=Number.EPSILON){const t=1-e;return this._w=t*n+e*this._w,this._x=t*s+e*this._x,this._y=t*i+e*this._y,this._z=t*r+e*this._z,this.normalize(),this}const h=Math.sqrt(o),l=Math.atan2(h,a),c=Math.sin((1-e)*l)/h,u=Math.sin(e*l)/h;return this._w=n*c+this._w*u,this._x=s*c+this._x*u,this._y=i*c+this._y*u,this._z=r*c+this._z*u,this._onChangeCallback(),this}slerpQuaternions(t,e,s){return this.copy(t).slerp(e,s)}random(){const t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),s=Math.random(),i=Math.sqrt(1-s),r=Math.sqrt(s);return this.set(i*Math.sin(t),i*Math.cos(t),r*Math.sin(e),r*Math.cos(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class X{constructor(t=0,e=0,s=0){X.prototype.isVector3=!0,this.x=t,this.y=e,this.z=s}set(t,e,s){return void 0===s&&(s=this.z),this.x=t,this.y=e,this.z=s,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(G.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(G.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,s=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[3]*s+r[6]*i,this.y=r[1]*e+r[4]*s+r[7]*i,this.z=r[2]*e+r[5]*s+r[8]*i,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,s=this.y,i=this.z,r=t.elements,n=1/(r[3]*e+r[7]*s+r[11]*i+r[15]);return this.x=(r[0]*e+r[4]*s+r[8]*i+r[12])*n,this.y=(r[1]*e+r[5]*s+r[9]*i+r[13])*n,this.z=(r[2]*e+r[6]*s+r[10]*i+r[14])*n,this}applyQuaternion(t){const e=this.x,s=this.y,i=this.z,r=t.x,n=t.y,a=t.z,o=t.w,h=2*(n*i-a*s),l=2*(a*e-r*i),c=2*(r*s-n*e);return this.x=e+o*h+n*c-a*l,this.y=s+o*l+a*h-r*c,this.z=i+o*c+r*l-n*h,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,s=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[4]*s+r[8]*i,this.y=r[1]*e+r[5]*s+r[9]*i,this.z=r[2]*e+r[6]*s+r[10]*i,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=T(this.x,t.x,e.x),this.y=T(this.y,t.y,e.y),this.z=T(this.z,t.z,e.z),this}clampScalar(t,e){return this.x=T(this.x,t,e),this.y=T(this.y,t,e),this.z=T(this.z,t,e),this}clampLength(t,e){const s=this.length();return this.divideScalar(s||1).multiplyScalar(T(s,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,s){return this.x=t.x+(e.x-t.x)*s,this.y=t.y+(e.y-t.y)*s,this.z=t.z+(e.z-t.z)*s,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const s=t.x,i=t.y,r=t.z,n=e.x,a=e.y,o=e.z;return this.x=i*o-r*a,this.y=r*n-s*o,this.z=s*a-i*n,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const s=t.dot(this)/e;return this.copy(t).multiplyScalar(s)}projectOnPlane(t){return J.copy(this).projectOnVector(t),this.sub(J)}reflect(t){return this.sub(J.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const s=this.dot(t)/e;return Math.acos(T(s,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,s=this.y-t.y,i=this.z-t.z;return e*e+s*s+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,s){const i=Math.sin(e)*t;return this.x=i*Math.sin(s),this.y=Math.cos(e)*t,this.z=i*Math.cos(s),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,s){return this.x=t*Math.sin(e),this.y=s,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),s=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=s,this.z=i,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,e=2*Math.random()-1,s=Math.sqrt(1-e*e);return this.x=s*Math.cos(t),this.y=e,this.z=s*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const J=new X,G=new Z;class ${constructor(t=new X(1/0,1/0,1/0),e=new X(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,s=t.length;e<s;e+=3)this.expandByPoint(K.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,s=t.count;e<s;e++)this.expandByPoint(K.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,s=t.length;e<s;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const s=K.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(s),this.max.copy(t).add(s),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const s=t.geometry;if(void 0!==s){const i=s.getAttribute("position");if(!0===e&&void 0!==i&&!0!==t.isInstancedMesh)for(let e=0,s=i.count;e<s;e++)!0===t.isMesh?t.getVertexPosition(e,K):K.fromBufferAttribute(i,e),K.applyMatrix4(t.matrixWorld),this.expandByPoint(K);else void 0!==t.boundingBox?(null===t.boundingBox&&t.computeBoundingBox(),tt.copy(t.boundingBox)):(null===s.boundingBox&&s.computeBoundingBox(),tt.copy(s.boundingBox)),tt.applyMatrix4(t.matrixWorld),this.union(tt)}const i=t.children;for(let t=0,s=i.length;t<s;t++)this.expandByObject(i[t],e);return this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y&&t.max.z>=this.min.z&&t.min.z<=this.max.z}intersectsSphere(t){return this.clampPoint(t.center,K),K.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,s;return t.normal.x>0?(e=t.normal.x*this.min.x,s=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,s=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,s+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,s+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,s+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,s+=t.normal.z*this.min.z),e<=-t.constant&&s>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(ot),ht.subVectors(this.max,ot),et.subVectors(t.a,ot),st.subVectors(t.b,ot),it.subVectors(t.c,ot),rt.subVectors(st,et),nt.subVectors(it,st),at.subVectors(et,it);let e=[0,-rt.z,rt.y,0,-nt.z,nt.y,0,-at.z,at.y,rt.z,0,-rt.x,nt.z,0,-nt.x,at.z,0,-at.x,-rt.y,rt.x,0,-nt.y,nt.x,0,-at.y,at.x,0];return!!ut(e,et,st,it,ht)&&(e=[1,0,0,0,1,0,0,0,1],!!ut(e,et,st,it,ht)&&(lt.crossVectors(rt,nt),e=[lt.x,lt.y,lt.z],ut(e,et,st,it,ht)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,K).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=.5*this.getSize(K).length()),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(Q[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Q[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Q[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Q[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Q[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Q[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Q[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Q[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Q)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const Q=[new X,new X,new X,new X,new X,new X,new X,new X],K=new X,tt=new $,et=new X,st=new X,it=new X,rt=new X,nt=new X,at=new X,ot=new X,ht=new X,lt=new X,ct=new X;function ut(t,e,s,i,r){for(let n=0,a=t.length-3;n<=a;n+=3){ct.fromArray(t,n);const a=r.x*Math.abs(ct.x)+r.y*Math.abs(ct.y)+r.z*Math.abs(ct.z),o=e.dot(ct),h=s.dot(ct),l=i.dot(ct);if(Math.max(-Math.max(o,h,l),Math.min(o,h,l))>a)return!1}return!0}class mt{constructor(t,e,s,i,r,n,a,o,h,l,c,u,m,d,p,y){mt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==t&&this.set(t,e,s,i,r,n,a,o,h,l,c,u,m,d,p,y)}set(t,e,s,i,r,n,a,o,h,l,c,u,m,d,p,y){const x=this.elements;return x[0]=t,x[4]=e,x[8]=s,x[12]=i,x[1]=r,x[5]=n,x[9]=a,x[13]=o,x[2]=h,x[6]=l,x[10]=c,x[14]=u,x[3]=m,x[7]=d,x[11]=p,x[15]=y,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new mt).fromArray(this.elements)}copy(t){const e=this.elements,s=t.elements;return e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e[4]=s[4],e[5]=s[5],e[6]=s[6],e[7]=s[7],e[8]=s[8],e[9]=s[9],e[10]=s[10],e[11]=s[11],e[12]=s[12],e[13]=s[13],e[14]=s[14],e[15]=s[15],this}copyPosition(t){const e=this.elements,s=t.elements;return e[12]=s[12],e[13]=s[13],e[14]=s[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,s){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),s.setFromMatrixColumn(this,2),this}makeBasis(t,e,s){return this.set(t.x,e.x,s.x,0,t.y,e.y,s.y,0,t.z,e.z,s.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,s=t.elements,i=1/dt.setFromMatrixColumn(t,0).length(),r=1/dt.setFromMatrixColumn(t,1).length(),n=1/dt.setFromMatrixColumn(t,2).length();return e[0]=s[0]*i,e[1]=s[1]*i,e[2]=s[2]*i,e[3]=0,e[4]=s[4]*r,e[5]=s[5]*r,e[6]=s[6]*r,e[7]=0,e[8]=s[8]*n,e[9]=s[9]*n,e[10]=s[10]*n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,s=t.x,i=t.y,r=t.z,n=Math.cos(s),a=Math.sin(s),o=Math.cos(i),h=Math.sin(i),l=Math.cos(r),c=Math.sin(r);if("XYZ"===t.order){const t=n*l,s=n*c,i=a*l,r=a*c;e[0]=o*l,e[4]=-o*c,e[8]=h,e[1]=s+i*h,e[5]=t-r*h,e[9]=-a*o,e[2]=r-t*h,e[6]=i+s*h,e[10]=n*o}else if("YXZ"===t.order){const t=o*l,s=o*c,i=h*l,r=h*c;e[0]=t+r*a,e[4]=i*a-s,e[8]=n*h,e[1]=n*c,e[5]=n*l,e[9]=-a,e[2]=s*a-i,e[6]=r+t*a,e[10]=n*o}else if("ZXY"===t.order){const t=o*l,s=o*c,i=h*l,r=h*c;e[0]=t-r*a,e[4]=-n*c,e[8]=i+s*a,e[1]=s+i*a,e[5]=n*l,e[9]=r-t*a,e[2]=-n*h,e[6]=a,e[10]=n*o}else if("ZYX"===t.order){const t=n*l,s=n*c,i=a*l,r=a*c;e[0]=o*l,e[4]=i*h-s,e[8]=t*h+r,e[1]=o*c,e[5]=r*h+t,e[9]=s*h-i,e[2]=-h,e[6]=a*o,e[10]=n*o}else if("YZX"===t.order){const t=n*o,s=n*h,i=a*o,r=a*h;e[0]=o*l,e[4]=r-t*c,e[8]=i*c+s,e[1]=c,e[5]=n*l,e[9]=-a*l,e[2]=-h*l,e[6]=s*c+i,e[10]=t-r*c}else if("XZY"===t.order){const t=n*o,s=n*h,i=a*o,r=a*h;e[0]=o*l,e[4]=-c,e[8]=h*l,e[1]=t*c+r,e[5]=n*l,e[9]=s*c-i,e[2]=i*c-s,e[6]=a*l,e[10]=r*c+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(yt,t,xt)}lookAt(t,e,s){const i=this.elements;return bt.subVectors(t,e),0===bt.lengthSq()&&(bt.z=1),bt.normalize(),gt.crossVectors(s,bt),0===gt.lengthSq()&&(1===Math.abs(s.z)?bt.x+=1e-4:bt.z+=1e-4,bt.normalize(),gt.crossVectors(s,bt)),gt.normalize(),ft.crossVectors(bt,gt),i[0]=gt.x,i[4]=ft.x,i[8]=bt.x,i[1]=gt.y,i[5]=ft.y,i[9]=bt.y,i[2]=gt.z,i[6]=ft.z,i[10]=bt.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const s=t.elements,i=e.elements,r=this.elements,n=s[0],a=s[4],o=s[8],h=s[12],l=s[1],c=s[5],u=s[9],m=s[13],d=s[2],p=s[6],y=s[10],x=s[14],g=s[3],f=s[7],b=s[11],_=s[15],M=i[0],w=i[4],z=i[8],v=i[12],S=i[1],A=i[5],C=i[9],T=i[13],E=i[2],k=i[6],I=i[10],D=i[14],O=i[3],P=i[7],N=i[11],F=i[15];return r[0]=n*M+a*S+o*E+h*O,r[4]=n*w+a*A+o*k+h*P,r[8]=n*z+a*C+o*I+h*N,r[12]=n*v+a*T+o*D+h*F,r[1]=l*M+c*S+u*E+m*O,r[5]=l*w+c*A+u*k+m*P,r[9]=l*z+c*C+u*I+m*N,r[13]=l*v+c*T+u*D+m*F,r[2]=d*M+p*S+y*E+x*O,r[6]=d*w+p*A+y*k+x*P,r[10]=d*z+p*C+y*I+x*N,r[14]=d*v+p*T+y*D+x*F,r[3]=g*M+f*S+b*E+_*O,r[7]=g*w+f*A+b*k+_*P,r[11]=g*z+f*C+b*I+_*N,r[15]=g*v+f*T+b*D+_*F,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],s=t[4],i=t[8],r=t[12],n=t[1],a=t[5],o=t[9],h=t[13],l=t[2],c=t[6],u=t[10],m=t[14];return t[3]*(+r*o*c-i*h*c-r*a*u+s*h*u+i*a*m-s*o*m)+t[7]*(+e*o*m-e*h*u+r*n*u-i*n*m+i*h*l-r*o*l)+t[11]*(+e*h*c-e*a*m-r*n*c+s*n*m+r*a*l-s*h*l)+t[15]*(-i*a*l-e*o*c+e*a*u+i*n*c-s*n*u+s*o*l)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,s){const i=this.elements;return t.isVector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=e,i[14]=s),this}invert(){const t=this.elements,e=t[0],s=t[1],i=t[2],r=t[3],n=t[4],a=t[5],o=t[6],h=t[7],l=t[8],c=t[9],u=t[10],m=t[11],d=t[12],p=t[13],y=t[14],x=t[15],g=c*y*h-p*u*h+p*o*m-a*y*m-c*o*x+a*u*x,f=d*u*h-l*y*h-d*o*m+n*y*m+l*o*x-n*u*x,b=l*p*h-d*c*h+d*a*m-n*p*m-l*a*x+n*c*x,_=d*c*o-l*p*o-d*a*u+n*p*u+l*a*y-n*c*y,M=e*g+s*f+i*b+r*_;if(0===M)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const w=1/M;return t[0]=g*w,t[1]=(p*u*r-c*y*r-p*i*m+s*y*m+c*i*x-s*u*x)*w,t[2]=(a*y*r-p*o*r+p*i*h-s*y*h-a*i*x+s*o*x)*w,t[3]=(c*o*r-a*u*r-c*i*h+s*u*h+a*i*m-s*o*m)*w,t[4]=f*w,t[5]=(l*y*r-d*u*r+d*i*m-e*y*m-l*i*x+e*u*x)*w,t[6]=(d*o*r-n*y*r-d*i*h+e*y*h+n*i*x-e*o*x)*w,t[7]=(n*u*r-l*o*r+l*i*h-e*u*h-n*i*m+e*o*m)*w,t[8]=b*w,t[9]=(d*c*r-l*p*r-d*s*m+e*p*m+l*s*x-e*c*x)*w,t[10]=(n*p*r-d*a*r+d*s*h-e*p*h-n*s*x+e*a*x)*w,t[11]=(l*a*r-n*c*r-l*s*h+e*c*h+n*s*m-e*a*m)*w,t[12]=_*w,t[13]=(l*p*i-d*c*i+d*s*u-e*p*u-l*s*y+e*c*y)*w,t[14]=(d*a*i-n*p*i-d*s*o+e*p*o+n*s*y-e*a*y)*w,t[15]=(n*c*i-l*a*i+l*s*o-e*c*o-n*s*u+e*a*u)*w,this}scale(t){const e=this.elements,s=t.x,i=t.y,r=t.z;return e[0]*=s,e[4]*=i,e[8]*=r,e[1]*=s,e[5]*=i,e[9]*=r,e[2]*=s,e[6]*=i,e[10]*=r,e[3]*=s,e[7]*=i,e[11]*=r,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],s=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,s,i))}makeTranslation(t,e,s){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,s,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),s=Math.sin(t);return this.set(1,0,0,0,0,e,-s,0,0,s,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),s=Math.sin(t);return this.set(e,0,s,0,0,1,0,0,-s,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),s=Math.sin(t);return this.set(e,-s,0,0,s,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const s=Math.cos(e),i=Math.sin(e),r=1-s,n=t.x,a=t.y,o=t.z,h=r*n,l=r*a;return this.set(h*n+s,h*a-i*o,h*o+i*a,0,h*a+i*o,l*a+s,l*o-i*n,0,h*o-i*a,l*o+i*n,r*o*o+s,0,0,0,0,1),this}makeScale(t,e,s){return this.set(t,0,0,0,0,e,0,0,0,0,s,0,0,0,0,1),this}makeShear(t,e,s,i,r,n){return this.set(1,s,r,0,t,1,n,0,e,i,1,0,0,0,0,1),this}compose(t,e,s){const i=this.elements,r=e._x,n=e._y,a=e._z,o=e._w,h=r+r,l=n+n,c=a+a,u=r*h,m=r*l,d=r*c,p=n*l,y=n*c,x=a*c,g=o*h,f=o*l,b=o*c,_=s.x,M=s.y,w=s.z;return i[0]=(1-(p+x))*_,i[1]=(m+b)*_,i[2]=(d-f)*_,i[3]=0,i[4]=(m-b)*M,i[5]=(1-(u+x))*M,i[6]=(y+g)*M,i[7]=0,i[8]=(d+f)*w,i[9]=(y-g)*w,i[10]=(1-(u+p))*w,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this}decompose(t,e,s){const i=this.elements;let r=dt.set(i[0],i[1],i[2]).length();const n=dt.set(i[4],i[5],i[6]).length(),a=dt.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),t.x=i[12],t.y=i[13],t.z=i[14],pt.copy(this);const o=1/r,h=1/n,l=1/a;return pt.elements[0]*=o,pt.elements[1]*=o,pt.elements[2]*=o,pt.elements[4]*=h,pt.elements[5]*=h,pt.elements[6]*=h,pt.elements[8]*=l,pt.elements[9]*=l,pt.elements[10]*=l,e.setFromRotationMatrix(pt),s.x=r,s.y=n,s.z=a,this}makePerspective(t,e,s,i,r,n,a=2e3){const o=this.elements,h=2*r/(e-t),l=2*r/(s-i),c=(e+t)/(e-t),u=(s+i)/(s-i);let m,d;if(2e3===a)m=-(n+r)/(n-r),d=-2*n*r/(n-r);else{if(2001!==a)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);m=-n/(n-r),d=-n*r/(n-r)}return o[0]=h,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=l,o[9]=u,o[13]=0,o[2]=0,o[6]=0,o[10]=m,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(t,e,s,i,r,n,a=2e3){const o=this.elements,h=1/(e-t),l=1/(s-i),c=1/(n-r),u=(e+t)*h,m=(s+i)*l;let d,p;if(2e3===a)d=(n+r)*c,p=-2*c;else{if(2001!==a)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);d=r*c,p=-1*c}return o[0]=2*h,o[4]=0,o[8]=0,o[12]=-u,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-m,o[2]=0,o[6]=0,o[10]=p,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(t){const e=this.elements,s=t.elements;for(let t=0;t<16;t++)if(e[t]!==s[t])return!1;return!0}fromArray(t,e=0){for(let s=0;s<16;s++)this.elements[s]=t[s+e];return this}toArray(t=[],e=0){const s=this.elements;return t[e]=s[0],t[e+1]=s[1],t[e+2]=s[2],t[e+3]=s[3],t[e+4]=s[4],t[e+5]=s[5],t[e+6]=s[6],t[e+7]=s[7],t[e+8]=s[8],t[e+9]=s[9],t[e+10]=s[10],t[e+11]=s[11],t[e+12]=s[12],t[e+13]=s[13],t[e+14]=s[14],t[e+15]=s[15],t}}const dt=new X,pt=new mt,yt=new X(0,0,0),xt=new X(1,1,1),gt=new X,ft=new X,bt=new X,_t=new mt,Mt=new Z;class wt{constructor(t=0,e=0,s=0,i=wt.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=s,this._order=i}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,s,i=this._order){return this._x=t,this._y=e,this._z=s,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,s=!0){const i=t.elements,r=i[0],n=i[4],a=i[8],o=i[1],h=i[5],l=i[9],c=i[2],u=i[6],m=i[10];switch(e){case"XYZ":this._y=Math.asin(T(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-l,m),this._z=Math.atan2(-n,r)):(this._x=Math.atan2(u,h),this._z=0);break;case"YXZ":this._x=Math.asin(-T(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(a,m),this._z=Math.atan2(o,h)):(this._y=Math.atan2(-c,r),this._z=0);break;case"ZXY":this._x=Math.asin(T(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-c,m),this._z=Math.atan2(-n,h)):(this._y=0,this._z=Math.atan2(o,r));break;case"ZYX":this._y=Math.asin(-T(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(u,m),this._z=Math.atan2(o,r)):(this._x=0,this._z=Math.atan2(-n,h));break;case"YZX":this._z=Math.asin(T(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-l,h),this._y=Math.atan2(-c,r)):(this._x=0,this._y=Math.atan2(a,m));break;case"XZY":this._z=Math.asin(-T(n,-1,1)),Math.abs(n)<.9999999?(this._x=Math.atan2(u,h),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-l,m),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===s&&this._onChangeCallback(),this}setFromQuaternion(t,e,s){return _t.makeRotationFromQuaternion(t),this.setFromRotationMatrix(_t,e,s)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return Mt.setFromEuler(this),this.setFromQuaternion(Mt,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}wt.DEFAULT_ORDER="XYZ";class zt{constructor(){this.mask=1}set(t){this.mask=1<<t>>>0}enable(t){this.mask|=1<<t}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t}disable(t){this.mask&=~(1<<t)}disableAll(){this.mask=0}test(t){return!!(this.mask&t.mask)}isEnabled(t){return!!(this.mask&1<<t)}}let vt=0;const St=new X,At=new Z,Ct=new mt,Tt=new X,Et=new X,kt=new X,It=new Z,Dt=new X(1,0,0),Ot=new X(0,1,0),Pt=new X(0,0,1),Nt={type:"added"},Ft={type:"removed"},Rt={type:"childadded",child:null},Lt={type:"childremoved",child:null};class Ut extends S{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:vt++}),this.uuid=C(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ut.DEFAULT_UP.clone();const t=new X,e=new wt,s=new Z,i=new X(1,1,1);e._onChange((function(){s.setFromEuler(e,!1)})),s._onChange((function(){e.setFromQuaternion(s,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:s},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new mt},normalMatrix:{value:new I}}),this.matrix=new mt,this.matrixWorld=new mt,this.matrixAutoUpdate=Ut.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Ut.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new zt,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return At.setFromAxisAngle(t,e),this.quaternion.multiply(At),this}rotateOnWorldAxis(t,e){return At.setFromAxisAngle(t,e),this.quaternion.premultiply(At),this}rotateX(t){return this.rotateOnAxis(Dt,t)}rotateY(t){return this.rotateOnAxis(Ot,t)}rotateZ(t){return this.rotateOnAxis(Pt,t)}translateOnAxis(t,e){return St.copy(t).applyQuaternion(this.quaternion),this.position.add(St.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(Dt,t)}translateY(t){return this.translateOnAxis(Ot,t)}translateZ(t){return this.translateOnAxis(Pt,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(Ct.copy(this.matrixWorld).invert())}lookAt(t,e,s){t.isVector3?Tt.copy(t):Tt.set(t,e,s);const i=this.parent;this.updateWorldMatrix(!0,!1),Et.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ct.lookAt(Et,Tt,this.up):Ct.lookAt(Tt,Et,this.up),this.quaternion.setFromRotationMatrix(Ct),i&&(Ct.extractRotation(i.matrixWorld),At.setFromRotationMatrix(Ct),this.quaternion.premultiply(At.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(Nt),Rt.child=t,this.dispatchEvent(Rt),Rt.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(Ft),Lt.child=t,this.dispatchEvent(Lt),Lt.child=null),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),Ct.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),Ct.multiply(t.parent.matrixWorld)),t.applyMatrix4(Ct),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(Nt),Rt.child=t,this.dispatchEvent(Rt),Rt.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let s=0,i=this.children.length;s<i;s++){const i=this.children[s].getObjectByProperty(t,e);if(void 0!==i)return i}}getObjectsByProperty(t,e,s=[]){this[t]===e&&s.push(this);const i=this.children;for(let r=0,n=i.length;r<n;r++)i[r].getObjectsByProperty(t,e,s);return s}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Et,t,kt),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Et,It,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let s=0,i=e.length;s<i;s++)e[s].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let s=0,i=e.length;s<i;s++)e[s].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let s=0,i=e.length;s<i;s++)e[s].updateMatrixWorld(t)}updateWorldMatrix(t,e){const s=this.parent;if(!0===t&&null!==s&&s.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),!0===this.matrixWorldAutoUpdate&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),!0===e){const t=this.children;for(let e=0,s=t.length;e<s;e++)t[e].updateWorldMatrix(!1,!0)}}toJSON(t){const e=void 0===t||"string"==typeof t,s={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},s.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};function r(e,s){return void 0===e[s.uuid]&&(e[s.uuid]=s.toJSON(t)),s.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.visibility=this._visibility,i.active=this._active,i.bounds=this._bounds.map((t=>({boxInitialized:t.boxInitialized,boxMin:t.box.min.toArray(),boxMax:t.box.max.toArray(),sphereInitialized:t.sphereInitialized,sphereRadius:t.sphere.radius,sphereCenter:t.sphere.center.toArray()}))),i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.geometryCount=this._geometryCount,i.matricesTexture=this._matricesTexture.toJSON(t),null!==this._colorsTexture&&(i.colorsTexture=this._colorsTexture.toJSON(t)),null!==this.boundingSphere&&(i.boundingSphere={center:i.boundingSphere.center.toArray(),radius:i.boundingSphere.radius}),null!==this.boundingBox&&(i.boundingBox={min:i.boundingBox.min.toArray(),max:i.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(i.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const s=e.shapes;if(Array.isArray(s))for(let e=0,i=s.length;e<i;e++){const i=s[e];r(t.shapes,i)}else r(t.shapes,s)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(t.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let s=0,i=this.material.length;s<i;s++)e.push(r(t.materials,this.material[s]));i.material=e}else i.material=r(t.materials,this.material);if(this.children.length>0){i.children=[];for(let e=0;e<this.children.length;e++)i.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){i.animations=[];for(let e=0;e<this.animations.length;e++){const s=this.animations[e];i.animations.push(r(t.animations,s))}}if(e){const e=n(t.geometries),i=n(t.materials),r=n(t.textures),a=n(t.images),o=n(t.shapes),h=n(t.skeletons),l=n(t.animations),c=n(t.nodes);e.length>0&&(s.geometries=e),i.length>0&&(s.materials=i),r.length>0&&(s.textures=r),a.length>0&&(s.images=a),o.length>0&&(s.shapes=o),h.length>0&&(s.skeletons=h),l.length>0&&(s.animations=l),c.length>0&&(s.nodes=c)}return s.object=i,s;function n(t){const e=[];for(const s in t){const i=t[s];delete i.metadata,e.push(i)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const s=t.children[e];this.add(s.clone())}return this}}Ut.DEFAULT_UP=new X(0,1,0),Ut.DEFAULT_MATRIX_AUTO_UPDATE=!0,Ut.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Vt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Bt={h:0,s:0,l:0},qt={h:0,s:0,l:0};function Wt(t,e,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?t+6*(e-t)*s:s<.5?e:s<2/3?t+6*(e-t)*(2/3-s):t}class jt{constructor(t,e,s){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,s)}set(t,e,s){if(void 0===e&&void 0===s){const e=t;e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e)}else this.setRGB(t,e,s);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=M){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,R.toWorkingColorSpace(this,e),this}setRGB(t,e,s,i=R.workingColorSpace){return this.r=t,this.g=e,this.b=s,R.toWorkingColorSpace(this,i),this}setHSL(t,e,s,i=R.workingColorSpace){if(t=(t%(r=1)+r)%r,e=T(e,0,1),s=T(s,0,1),0===e)this.r=this.g=this.b=s;else{const i=s<=.5?s*(1+e):s+e-s*e,r=2*s-i;this.r=Wt(r,i,t+1/3),this.g=Wt(r,i,t),this.b=Wt(r,i,t-1/3)}var r;return R.toWorkingColorSpace(this,i),this}setStyle(t,e=M){function s(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(t)){let r;const n=i[1],a=i[2];switch(n){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return s(r[4]),this.setRGB(Math.min(255,parseInt(r[1],10))/255,Math.min(255,parseInt(r[2],10))/255,Math.min(255,parseInt(r[3],10))/255,e);if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return s(r[4]),this.setRGB(Math.min(100,parseInt(r[1],10))/100,Math.min(100,parseInt(r[2],10))/100,Math.min(100,parseInt(r[3],10))/100,e);break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return s(r[4]),this.setHSL(parseFloat(r[1])/360,parseFloat(r[2])/100,parseFloat(r[3])/100,e);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const s=i[1],r=s.length;if(3===r)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,e);if(6===r)return this.setHex(parseInt(s,16),e);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=M){const s=Vt[t.toLowerCase()];return void 0!==s?this.setHex(s,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=L(t.r),this.g=L(t.g),this.b=L(t.b),this}copyLinearToSRGB(t){return this.r=U(t.r),this.g=U(t.g),this.b=U(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=M){return R.fromWorkingColorSpace(Yt.copy(this),t),65536*Math.round(T(255*Yt.r,0,255))+256*Math.round(T(255*Yt.g,0,255))+Math.round(T(255*Yt.b,0,255))}getHexString(t=M){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=R.workingColorSpace){R.fromWorkingColorSpace(Yt.copy(this),e);const s=Yt.r,i=Yt.g,r=Yt.b,n=Math.max(s,i,r),a=Math.min(s,i,r);let o,h;const l=(a+n)/2;if(a===n)o=0,h=0;else{const t=n-a;switch(h=l<=.5?t/(n+a):t/(2-n-a),n){case s:o=(i-r)/t+(i<r?6:0);break;case i:o=(r-s)/t+2;break;case r:o=(s-i)/t+4}o/=6}return t.h=o,t.s=h,t.l=l,t}getRGB(t,e=R.workingColorSpace){return R.fromWorkingColorSpace(Yt.copy(this),e),t.r=Yt.r,t.g=Yt.g,t.b=Yt.b,t}getStyle(t=M){R.fromWorkingColorSpace(Yt.copy(this),t);const e=Yt.r,s=Yt.g,i=Yt.b;return t!==M?`color(${t} ${e.toFixed(3)} ${s.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(255*e)},${Math.round(255*s)},${Math.round(255*i)})`}offsetHSL(t,e,s){return this.getHSL(Bt),this.setHSL(Bt.h+t,Bt.s+e,Bt.l+s)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,s){return this.r=t.r+(e.r-t.r)*s,this.g=t.g+(e.g-t.g)*s,this.b=t.b+(e.b-t.b)*s,this}lerpHSL(t,e){this.getHSL(Bt),t.getHSL(qt);const s=E(Bt.h,qt.h,e),i=E(Bt.s,qt.s,e),r=E(Bt.l,qt.l,e);return this.setHSL(s,i,r),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,s=this.g,i=this.b,r=t.elements;return this.r=r[0]*e+r[3]*s+r[6]*i,this.g=r[1]*e+r[4]*s+r[7]*i,this.b=r[2]*e+r[5]*s+r[8]*i,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Yt=new jt;jt.NAMES=Vt;class Ht extends H{constructor(t=null,e=1,s=1,i,r,a,o,h,l=n,c=n,u,m){super(null,a,o,h,l,c,i,r,u,m),this.isDataTexture=!0,this.image={data:t,width:e,height:s},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}function Zt(t,e,s){return!t||!s&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)}class Xt{constructor(t,e,s,i){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new e.constructor(s),this.sampleValues=e,this.valueSize=s,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let s=this._cachedIndex,i=e[s],r=e[s-1];t:{e:{let n;s:{i:if(!(t<i)){for(let n=s+2;;){if(void 0===i){if(t<r)break i;return s=e.length,this._cachedIndex=s,this.copySampleValue_(s-1)}if(s===n)break;if(r=i,i=e[++s],t<i)break e}n=e.length;break s}if(t>=r)break t;{const a=e[1];t<a&&(s=2,r=a);for(let n=s-2;;){if(void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(s===n)break;if(i=r,r=e[--s-1],t>=r)break e}n=s,s=0}}for(;s<n;){const i=s+n>>>1;t<e[i]?n=i:s=i+1}if(i=e[s],r=e[s-1],void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===i)return s=e.length,this._cachedIndex=s,this.copySampleValue_(s-1)}this._cachedIndex=s,this.intervalChanged_(s,r,i)}return this.interpolate_(s,r,t,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,s=this.sampleValues,i=this.valueSize,r=t*i;for(let t=0;t!==i;++t)e[t]=s[r+t];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Jt extends Xt{constructor(t,e,s,i){super(t,e,s,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:2400,endingEnd:2400}}intervalChanged_(t,e,s){const i=this.parameterPositions;let r=t-2,n=t+1,a=i[r],o=i[n];if(void 0===a)switch(this.getSettings_().endingStart){case 2401:r=t,a=2*e-s;break;case 2402:r=i.length-2,a=e+i[r]-i[r+1];break;default:r=t,a=s}if(void 0===o)switch(this.getSettings_().endingEnd){case 2401:n=t,o=2*s-e;break;case 2402:n=1,o=s+i[1]-i[0];break;default:n=t-1,o=e}const h=.5*(s-e),l=this.valueSize;this._weightPrev=h/(e-a),this._weightNext=h/(o-s),this._offsetPrev=r*l,this._offsetNext=n*l}interpolate_(t,e,s,i){const r=this.resultBuffer,n=this.sampleValues,a=this.valueSize,o=t*a,h=o-a,l=this._offsetPrev,c=this._offsetNext,u=this._weightPrev,m=this._weightNext,d=(s-e)/(i-e),p=d*d,y=p*d,x=-u*y+2*u*p-u*d,g=(1+u)*y+(-1.5-2*u)*p+(-.5+u)*d+1,f=(-1-m)*y+(1.5+m)*p+.5*d,b=m*y-m*p;for(let t=0;t!==a;++t)r[t]=x*n[l+t]+g*n[h+t]+f*n[o+t]+b*n[c+t];return r}}class Gt extends Xt{constructor(t,e,s,i){super(t,e,s,i)}interpolate_(t,e,s,i){const r=this.resultBuffer,n=this.sampleValues,a=this.valueSize,o=t*a,h=o-a,l=(s-e)/(i-e),c=1-l;for(let t=0;t!==a;++t)r[t]=n[h+t]*c+n[o+t]*l;return r}}class $t extends Xt{constructor(t,e,s,i){super(t,e,s,i)}interpolate_(t){return this.copySampleValue_(t-1)}}class Qt{constructor(t,e,s,i){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Zt(e,this.TimeBufferType),this.values=Zt(s,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let s;if(e.toJSON!==this.toJSON)s=e.toJSON(t);else{s={name:t.name,times:Zt(t.times,Array),values:Zt(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(s.interpolation=e)}return s.type=t.ValueTypeName,s}InterpolantFactoryMethodDiscrete(t){return new $t(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new Gt(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new Jt(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case f:e=this.InterpolantFactoryMethodDiscrete;break;case b:e=this.InterpolantFactoryMethodLinear;break;case _:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return f;case this.InterpolantFactoryMethodLinear:return b;case this.InterpolantFactoryMethodSmooth:return _}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){const e=this.times;for(let s=0,i=e.length;s!==i;++s)e[s]+=t}return this}scale(t){if(1!==t){const e=this.times;for(let s=0,i=e.length;s!==i;++s)e[s]*=t}return this}trim(t,e){const s=this.times,i=s.length;let r=0,n=i-1;for(;r!==i&&s[r]<t;)++r;for(;-1!==n&&s[n]>e;)--n;if(++n,0!==r||n!==i){r>=n&&(n=Math.max(n,1),r=n-1);const t=this.getValueSize();this.times=s.slice(r,n),this.values=this.values.slice(r*t,n*t)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const s=this.times,i=this.values,r=s.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let n=null;for(let e=0;e!==r;e++){const i=s[e];if("number"==typeof i&&isNaN(i)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,e,i),t=!1;break}if(null!==n&&n>i){console.error("THREE.KeyframeTrack: Out of order keys.",this,e,i,n),t=!1;break}n=i}if(void 0!==i&&(a=i,ArrayBuffer.isView(a)&&!(a instanceof DataView)))for(let e=0,s=i.length;e!==s;++e){const s=i[e];if(isNaN(s)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,e,s),t=!1;break}}var a;return t}optimize(){const t=this.times.slice(),e=this.values.slice(),s=this.getValueSize(),i=this.getInterpolation()===_,r=t.length-1;let n=1;for(let a=1;a<r;++a){let r=!1;const o=t[a];if(o!==t[a+1]&&(1!==a||o!==t[0]))if(i)r=!0;else{const t=a*s,i=t-s,n=t+s;for(let a=0;a!==s;++a){const s=e[t+a];if(s!==e[i+a]||s!==e[n+a]){r=!0;break}}}if(r){if(a!==n){t[n]=t[a];const i=a*s,r=n*s;for(let t=0;t!==s;++t)e[r+t]=e[i+t]}++n}}if(r>0){t[n]=t[r];for(let t=r*s,i=n*s,a=0;a!==s;++a)e[i+a]=e[t+a];++n}return n!==t.length?(this.times=t.slice(0,n),this.values=e.slice(0,n*s)):(this.times=t,this.values=e),this}clone(){const t=this.times.slice(),e=this.values.slice(),s=new(0,this.constructor)(this.name,t,e);return s.createInterpolant=this.createInterpolant,s}}Qt.prototype.TimeBufferType=Float32Array,Qt.prototype.ValueBufferType=Float32Array,Qt.prototype.DefaultInterpolation=b;class Kt extends Qt{constructor(t,e,s){super(t,e,s)}}Kt.prototype.ValueTypeName="bool",Kt.prototype.ValueBufferType=Array,Kt.prototype.DefaultInterpolation=f,Kt.prototype.InterpolantFactoryMethodLinear=void 0,Kt.prototype.InterpolantFactoryMethodSmooth=void 0;(class extends Qt{}).prototype.ValueTypeName="color";(class extends Qt{}).prototype.ValueTypeName="number";class te extends Xt{constructor(t,e,s,i){super(t,e,s,i)}interpolate_(t,e,s,i){const r=this.resultBuffer,n=this.sampleValues,a=this.valueSize,o=(s-e)/(i-e);let h=t*a;for(let t=h+a;h!==t;h+=4)Z.slerpFlat(r,0,n,h-a,n,h,o);return r}}class ee extends Qt{InterpolantFactoryMethodLinear(t){return new te(this.times,this.values,this.getValueSize(),t)}}ee.prototype.ValueTypeName="quaternion",ee.prototype.InterpolantFactoryMethodSmooth=void 0;class se extends Qt{constructor(t,e,s){super(t,e,s)}}se.prototype.ValueTypeName="string",se.prototype.ValueBufferType=Array,se.prototype.DefaultInterpolation=f,se.prototype.InterpolantFactoryMethodLinear=void 0,se.prototype.InterpolantFactoryMethodSmooth=void 0;(class extends Qt{}).prototype.ValueTypeName="vector";Error;const ie="\\[\\]\\.:\\/",re=new RegExp("["+ie+"]","g"),ne="[^"+ie+"]",ae="[^"+ie.replace("\\.","")+"]",oe=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",ne)+/(WCOD+)?/.source.replace("WCOD",ae)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",ne)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",ne)+"$"),he=["material","materials","bones","map"];class le{constructor(t,e,s){this.path=e,this.parsedPath=s||le.parseTrackName(e),this.node=le.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,s){return t&&t.isAnimationObjectGroup?new le.Composite(t,e,s):new le(t,e,s)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(re,"")}static parseTrackName(t){const e=oe.exec(t);if(null===e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const s={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},i=s.nodeName&&s.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){const t=s.nodeName.substring(i+1);-1!==he.indexOf(t)&&(s.nodeName=s.nodeName.substring(0,i),s.objectName=t)}if(null===s.propertyName||0===s.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return s}static findNode(t,e){if(void 0===e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const s=t.skeleton.getBoneByName(e);if(void 0!==s)return s}if(t.children){const s=function(t){for(let i=0;i<t.length;i++){const r=t[i];if(r.name===e||r.uuid===e)return r;const n=s(r.children);if(n)return n}return null},i=s(t.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const s=this.resolvedProperty;for(let i=0,r=s.length;i!==r;++i)t[e++]=s[i]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const s=this.resolvedProperty;for(let i=0,r=s.length;i!==r;++i)s[i]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const s=this.resolvedProperty;for(let i=0,r=s.length;i!==r;++i)s[i]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const s=this.resolvedProperty;for(let i=0,r=s.length;i!==r;++i)s[i]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,s=e.objectName,i=e.propertyName;let r=e.propertyIndex;if(t||(t=le.findNode(this.rootNode,e.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(s){let i=e.objectIndex;switch(s){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===i){i=e;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);t=t.material.map;break;default:if(void 0===t[s])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[s]}if(void 0!==i){if(void 0===t[i])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[i]}}const n=t[i];if(void 0===n){const s=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+s+"."+i+" but it wasn't found.",t)}let a=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?a=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(a=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===i){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[r]&&(r=t.morphTargetDictionary[r])}o=this.BindingType.ArrayElement,this.resolvedProperty=n,this.propertyIndex=r}else void 0!==n.fromArray&&void 0!==n.toArray?(o=this.BindingType.HasFromToArray,this.resolvedProperty=n):Array.isArray(n)?(o=this.BindingType.EntireArray,this.resolvedProperty=n):this.propertyName=i;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}le.Composite=class{constructor(t,e,s){const i=s||le.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,i)}getValue(t,e){this.bind();const s=this._targetGroup.nCachedObjects_,i=this._bindings[s];void 0!==i&&i.getValue(t,e)}setValue(t,e){const s=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=s.length;i!==r;++i)s[i].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,s=t.length;e!==s;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,s=t.length;e!==s;++e)t[e].unbind()}},le.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},le.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},le.prototype.GetterByBindingType=[le.prototype._getValue_direct,le.prototype._getValue_array,le.prototype._getValue_arrayElement,le.prototype._getValue_toArray],le.prototype.SetterByBindingTypeAndVersioning=[[le.prototype._setValue_direct,le.prototype._setValue_direct_setNeedsUpdate,le.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[le.prototype._setValue_array,le.prototype._setValue_array_setNeedsUpdate,le.prototype._setValue_array_setMatrixWorldNeedsUpdate],[le.prototype._setValue_arrayElement,le.prototype._setValue_arrayElement_setNeedsUpdate,le.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[le.prototype._setValue_fromArray,le.prototype._setValue_fromArray_setNeedsUpdate,le.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]],new Float32Array(1),"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"171"}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="171")}}]);
//# sourceMappingURL=649.bundle.js.map